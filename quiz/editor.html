<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Arcade Editor | English 1 Batam</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                        heading: ['Fredoka', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            pink: '#FF6B95',
                            orange: '#FF8C42',
                            green: '#00E676',
                            blue: '#2979FF',
                            dark: '#1e293b',
                            chalk: '#f8fafc',
                        }
                    },
                    boxShadow: {
                        'hard': '4px 4px 0px 0px rgba(30, 41, 59, 1)',
                        'hard-lg': '8px 8px 0px 0px rgba(30, 41, 59, 1)',
                        'hard-sm': '2px 2px 0px 0px rgba(30, 41, 59, 1)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            background-image: linear-gradient(#cbd5e1 1px, transparent 1px), linear-gradient(90deg, #cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
        }

        .neo-field {
            display: flex;
            align-items: stretch;
            background: white;
            border: 4px solid #1e293b;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .neo-field:focus-within {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px 0px rgba(30, 41, 59, 1);
        }

        .neo-icon-box {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3.5rem;
            flex-shrink: 0;
            border-right: 4px solid #1e293b;
            font-weight: 800;
        }

        .neo-input-text {
            width: 100%;
            padding: 12px 16px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            color: #1e293b;
            border: none;
            outline: none;
            background: transparent;
        }

        .neo-btn {
            @apply transition-all active:translate-x-[2px] active:translate-y-[2px] active:shadow-none hover:-translate-x-[2px] hover:-translate-y-[2px] hover:shadow-hard;
        }

        .set-item.active {
            @apply bg-brand-blue text-white translate-x-1 translate-y-1 shadow-none border-brand-dark ring-2 ring-offset-2 ring-brand-blue;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body class="min-h-screen text-brand-dark flex flex-col font-sans">

    <header class="bg-white border-b-4 border-brand-dark sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-brand-pink border-4 border-brand-dark rounded-xl flex items-center justify-center shadow-hard">
                    <i data-lucide="layout" class="text-white w-7 h-7"></i>
                </div>
                <div>
                    <h1 class="font-heading font-bold text-3xl tracking-tight leading-none">Arcade Editor</h1>
                    <p class="text-xs font-black text-slate-500 uppercase tracking-widest mt-0.5">English 1 Batam</p>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <input type="file" id="import-json" accept=".json" class="hidden">
                <button onclick="document.getElementById('import-json').click()" class="neo-btn bg-white border-4 border-brand-dark px-4 py-2 rounded-xl font-heading font-bold shadow-hard-sm flex items-center gap-2">
                    <i data-lucide="upload" class="w-4 h-4"></i> Import
                </button>
                <button id="copy-btn" onclick="copyJSON()" class="neo-btn bg-brand-blue text-white border-4 border-brand-dark px-4 py-2 rounded-xl font-heading font-bold shadow-hard-sm flex items-center gap-2">
                    <i data-lucide="copy" class="w-4 h-4"></i> Copy JSON
                </button>
                <button onclick="exportJSON()" class="neo-btn bg-brand-green border-4 border-brand-dark px-4 py-2 rounded-xl font-heading font-bold shadow-hard-sm flex items-center gap-2">
                    <i data-lucide="download" class="w-4 h-4"></i> Export
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto w-full p-6 flex flex-col lg:flex-row gap-8 items-start">
        
        <aside class="w-full lg:w-80 flex flex-col gap-6 shrink-0 lg:sticky lg:top-28">
            <div class="bg-white border-4 border-brand-dark rounded-2xl p-6 shadow-hard flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-heading text-2xl font-bold">Quiz Sets</h2>
                    <button onclick="addNewSet()" class="w-10 h-10 bg-brand-orange text-white border-4 border-brand-dark rounded-xl shadow-hard-sm neo-btn flex items-center justify-center">
                        <i data-lucide="plus" class="w-6 h-6"></i>
                    </button>
                </div>
                <div id="set-list" class="flex flex-col gap-3 overflow-y-auto max-h-[60vh] pr-2"></div>
            </div>
        </aside>

        <section class="flex-grow w-full">
            <div id="editor-placeholder" class="bg-white border-4 border-brand-dark border-dashed rounded-[2rem] p-20 text-center shadow-hard flex flex-col items-center justify-center h-full">
                <i data-lucide="mouse-pointer-click" class="w-16 h-16 text-slate-300 mb-4"></i>
                <h3 class="font-heading text-3xl font-bold text-brand-dark">Select a Set</h3>
                <p class="text-slate-500 font-bold">Import your file or create a new set to start editing.</p>
            </div>

            <div id="editor-content" class="hidden space-y-8">
                <div class="bg-white border-4 border-brand-dark rounded-2xl p-8 shadow-hard space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="flex flex-col gap-1.5">
                            <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Unique ID</label>
                            <div class="neo-field">
                                <div class="neo-icon-box bg-slate-100 text-slate-500"><i data-lucide="hash" class="w-5 h-5"></i></div>
                                <input type="text" id="edit-id" class="neo-input-text" oninput="updateActiveSet('id', this.value)">
                            </div>
                        </div>
                        <div class="flex flex-col gap-1.5">
                            <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Topic</label>
                            <div class="neo-field">
                                <div class="neo-icon-box bg-orange-100 text-brand-orange"><i data-lucide="tag" class="w-5 h-5"></i></div>
                                <input type="text" id="edit-topic" class="neo-input-text" oninput="updateActiveSet('topic', this.value)">
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col gap-1.5">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Quiz Title</label>
                        <div class="neo-field">
                            <div class="neo-icon-box bg-blue-100 text-brand-blue"><i data-lucide="type" class="w-5 h-5"></i></div>
                            <input type="text" id="edit-title" class="neo-input-text" oninput="updateActiveSet('title', this.value)">
                        </div>
                    </div>
                </div>

                <div class="bg-white border-4 border-brand-dark rounded-2xl p-8 shadow-hard">
                    <div class="flex justify-between items-center mb-8">
                        <h3 class="font-heading text-2xl font-bold">Questions (<span id="q-count">0</span>)</h3>
                        <button onclick="addQuestion()" class="neo-btn bg-brand-orange text-white border-4 border-brand-dark px-6 py-2 rounded-xl font-heading font-bold shadow-hard flex items-center gap-2">
                            <i data-lucide="plus-circle" class="w-5 h-5"></i> Add Question
                        </button>
                    </div>
                    <div id="questions-container" class="space-y-8"></div>
                </div>
            </div>
        </section>
    </main>

    <script>
        let appData = [];
        let activeSetIndex = -1;

        window.onload = () => lucide.createIcons();

        function renderSetList() {
            const list = document.getElementById('set-list');
            list.innerHTML = appData.length ? '' : '<p class="text-center py-4 text-slate-400 font-bold">No sets found.</p>';
            
            appData.forEach((set, idx) => {
                const item = document.createElement('div');
                const isActive = activeSetIndex === idx;
                item.className = `set-item p-4 border-4 border-brand-dark rounded-xl cursor-pointer transition-all flex justify-between items-center ${isActive ? 'active' : 'bg-white shadow-hard-sm'}`;
                item.innerHTML = `
                    <div class="flex-grow font-heading font-bold truncate" onclick="selectSet(${idx})">${set.title || 'Untitled'}</div>
                    <button onclick="deleteSet(${idx})" class="${isActive ? 'text-white' : 'text-slate-400'} hover:text-brand-pink"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                `;
                list.appendChild(item);
            });
            lucide.createIcons();
        }

        function selectSet(idx) {
            activeSetIndex = idx;
            const set = appData[idx];
            document.getElementById('editor-placeholder').classList.add('hidden');
            document.getElementById('editor-content').classList.remove('hidden');
            document.getElementById('edit-id').value = set.id || '';
            document.getElementById('edit-title').value = set.title || '';
            document.getElementById('edit-topic').value = set.topic || '';
            renderSetList();
            renderQuestions();
        }

        function renderQuestions() {
            const container = document.getElementById('questions-container');
            const questions = appData[activeSetIndex].questions;
            document.getElementById('q-count').innerText = questions.length;
            container.innerHTML = '';

            questions.forEach((q, qIdx) => {
                const card = document.createElement('div');
                card.className = "p-6 border-4 border-brand-dark rounded-2xl bg-brand-chalk space-y-4";
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="bg-brand-dark text-white px-3 py-1 rounded-lg font-bold">Q${qIdx + 1}</span>
                        <button onclick="deleteQuestion(${qIdx})" class="text-slate-400 hover:text-brand-pink"><i data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                    <div class="neo-field">
                        <div class="neo-icon-box bg-white"><i data-lucide="help-circle" class="w-5 h-5 text-brand-orange"></i></div>
                        <input type="text" class="neo-input-text" value="${escapeHtml(q.q)}" oninput="updateQuestion(${qIdx}, 'q', this.value)" placeholder="Enter question text...">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${q.opts.map((opt, oIdx) => `
                            <div class="flex items-center gap-3">
                                <label class="cursor-pointer group">
                                    <input type="radio" name="correct-${qIdx}" class="peer hidden" ${q.a === oIdx ? 'checked' : ''} onchange="updateQuestion(${qIdx}, 'a', ${oIdx})">
                                    <div class="w-10 h-10 border-4 border-brand-dark rounded-xl bg-white peer-checked:bg-brand-green flex items-center justify-center shadow-hard-sm transition-all group-active:translate-y-0.5">
                                        <i data-lucide="check" class="text-white opacity-0 peer-checked:opacity-100 w-6 h-6 stroke-[4]"></i>
                                    </div>
                                </label>
                                <div class="neo-field flex-grow">
                                    <div class="neo-icon-box w-10 text-xs bg-slate-50">${String.fromCharCode(65+oIdx)}</div>
                                    <input type="text" class="neo-input-text py-2" value="${escapeHtml(opt)}" oninput="updateOption(${qIdx}, ${oIdx}, this.value)" placeholder="Option ${oIdx+1}">
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="neo-field bg-white/50">
                        <div class="neo-icon-box"><i data-lucide="info" class="w-5 h-5 text-brand-blue"></i></div>
                        <input type="text" class="neo-input-text" value="${escapeHtml(q.exp || '')}" oninput="updateQuestion(${qIdx}, 'exp', this.value)" placeholder="Explanation (optional)">
                    </div>
                `;
                container.appendChild(card);
            });
            lucide.createIcons();
        }

        // --- NEW: Copy JSON Functionality ---
        async function copyJSON() {
            if (appData.length === 0) return;
            const jsonString = JSON.stringify(appData, null, 2);
            try {
                await navigator.clipboard.writeText(jsonString);
                
                const btn = document.getElementById('copy-btn');
                const originalContent = btn.innerHTML;
                
                // Feedback State
                btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> Copied!`;
                btn.classList.replace('bg-brand-blue', 'bg-brand-green');
                lucide.createIcons();

                setTimeout(() => {
                    btn.innerHTML = originalContent;
                    btn.classList.replace('bg-brand-green', 'bg-brand-blue');
                    lucide.createIcons();
                }, 2000);
            } catch (err) {
                alert("Failed to copy to clipboard.");
            }
        }

        function updateActiveSet(key, val) { appData[activeSetIndex][key] = val; renderSetList(); }
        function updateQuestion(qIdx, key, val) { appData[activeSetIndex].questions[qIdx][key] = val; }
        function updateOption(qIdx, oIdx, val) { appData[activeSetIndex].questions[qIdx].opts[oIdx] = val; }

        function addNewSet() {
            appData.push({ id: "set_" + Date.now(), title: "New Quiz", topic: "English", questions: [] });
            selectSet(appData.length - 1);
        }

        function addQuestion() {
            appData[activeSetIndex].questions.push({ q: "", opts: ["", "", "", ""], a: 0, exp: "" });
            renderQuestions();
        }

        function deleteQuestion(idx) {
            appData[activeSetIndex].questions.splice(idx, 1);
            renderQuestions();
        }

        function deleteSet(idx) {
            if(confirm("Delete this set?")) {
                appData.splice(idx, 1);
                activeSetIndex = -1;
                document.getElementById('editor-content').classList.add('hidden');
                document.getElementById('editor-placeholder').classList.remove('hidden');
                renderSetList();
            }
        }

        function exportJSON() {
            const blob = new Blob([JSON.stringify(appData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'questions.json'; a.click();
        }

        document.getElementById('import-json').addEventListener('change', (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => {
                appData = JSON.parse(ev.target.result);
                renderSetList();
            };
            reader.readAsText(e.target.files[0]);
        });

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>