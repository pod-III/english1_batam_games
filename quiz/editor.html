<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Arcade Editor | English 1 Batam</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                        heading: ['Fredoka', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            pink: '#FF6B95',
                            orange: '#FF8C42',
                            green: '#00E676',
                            blue: '#2979FF',
                            dark: '#1e293b',
                            chalk: '#f8fafc',
                        }
                    },
                    boxShadow: {
                        'hard': '4px 4px 0px 0px rgba(30, 41, 59, 1)',
                        'hard-lg': '8px 8px 0px 0px rgba(30, 41, 59, 1)',
                        'hard-sm': '2px 2px 0px 0px rgba(30, 41, 59, 1)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            background-image: linear-gradient(#e2e8f0 1px, transparent 1px), linear-gradient(90deg, #e2e8f0 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .neo-input {
            @apply border-4 border-brand-dark rounded-xl px-4 py-2 focus:outline-none focus:ring-4 focus:ring-brand-blue/20 transition-all font-bold;
        }
        .neo-btn {
            @apply transition-all active:translate-x-1 active:translate-y-1 active:shadow-none;
        }
    </style>
</head>
<body class="min-h-screen text-brand-dark flex flex-col font-sans">

    <!-- Header -->
    <header class="bg-white border-b-4 border-brand-dark sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex flex-wrap justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-brand-blue border-2 border-brand-dark rounded-lg flex items-center justify-center shadow-hard-sm">
                    <i data-lucide="edit-3" class="text-white w-6 h-6"></i>
                </div>
                <h1 class="font-heading font-bold text-2xl tracking-tight">Quiz Editor</h1>
            </div>
            
            <div class="flex items-center gap-3">
                <input type="file" id="import-json" accept=".json" class="hidden">
                <button onclick="document.getElementById('import-json').click()" class="neo-btn bg-white border-4 border-brand-dark px-4 py-2 rounded-xl font-heading font-bold shadow-hard hover:bg-slate-50 flex items-center gap-2">
                    <i data-lucide="upload" class="w-5 h-5"></i> Import JSON
                </button>
                <button onclick="exportJSON()" class="neo-btn bg-brand-green border-4 border-brand-dark px-4 py-2 rounded-xl font-heading font-bold shadow-hard flex items-center gap-2">
                    <i data-lucide="download" class="w-5 h-5"></i> Export JSON
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto w-full p-6 flex flex-col lg:flex-row gap-8">
        
        <!-- Sidebar: List of Sets -->
        <aside class="w-full lg:w-1/3 flex flex-col gap-6">
            <div class="bg-white border-4 border-brand-dark rounded-2xl p-6 shadow-hard flex flex-col gap-4">
                <div class="flex justify-between items-center">
                    <h2 class="font-heading text-xl font-bold">Quiz Sets</h2>
                    <button onclick="addNewSet()" class="p-2 bg-brand-orange text-white border-2 border-brand-dark rounded-lg shadow-hard-sm hover:scale-110 transition-transform">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                    </button>
                </div>
                <div id="set-list" class="flex flex-col gap-3 max-h-[60vh] overflow-y-auto pr-2">
                    <!-- Set items injected here -->
                </div>
            </div>
        </aside>

        <!-- Main Editor Section -->
        <section class="flex-grow flex flex-col gap-6">
            <div id="editor-placeholder" class="bg-white border-4 border-brand-dark border-dashed rounded-2xl p-20 text-center shadow-hard">
                <i data-lucide="mouse-pointer-click" class="w-16 h-16 mx-auto mb-4 text-slate-300"></i>
                <h3 class="font-heading text-2xl font-bold text-slate-400">Select a set to start editing</h3>
            </div>

            <div id="editor-content" class="hidden space-y-6">
                <!-- Set Metadata Card -->
                <div class="bg-white border-4 border-brand-dark rounded-2xl p-6 shadow-hard space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex flex-col gap-1">
                            <label class="text-xs font-black uppercase text-slate-500">Set ID (Unique)</label>
                            <input type="text" id="edit-id" class="neo-input" oninput="updateActiveSet('id', this.value)">
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-xs font-black uppercase text-slate-500">Title</label>
                            <input type="text" id="edit-title" class="neo-input" oninput="updateActiveSet('title', this.value)">
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-xs font-black uppercase text-slate-500">Topic</label>
                            <input type="text" id="edit-topic" class="neo-input" oninput="updateActiveSet('topic', this.value)">
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-xs font-black uppercase text-slate-500">Lucide Icon Name</label>
                            <input type="text" id="edit-icon" class="neo-input" oninput="updateActiveSet('icon', this.value)">
                        </div>
                        <div class="flex flex-col gap-1 md:col-span-2">
                            <label class="text-xs font-black uppercase text-slate-500">Description</label>
                            <textarea id="edit-desc" class="neo-input h-20 resize-none" oninput="updateActiveSet('desc', this.value)"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Questions Manager -->
                <div class="bg-white border-4 border-brand-dark rounded-2xl p-6 shadow-hard space-y-6">
                    <div class="flex justify-between items-center border-b-4 border-brand-dark pb-4">
                        <h3 class="font-heading text-2xl font-bold">Questions (<span id="q-count">0</span>)</h3>
                        <button onclick="addQuestion()" class="neo-btn bg-brand-pink text-white border-4 border-brand-dark px-4 py-2 rounded-xl font-heading font-bold shadow-hard flex items-center gap-2">
                            <i data-lucide="file-plus" class="w-5 h-5"></i> Add Question
                        </button>
                    </div>

                    <div id="questions-list" class="space-y-8">
                        <!-- Question blocks injected here -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- DATA STATE ---
        let appData = [];
        let activeSetIndex = -1;

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // Listen for imports
            document.getElementById('import-json').addEventListener('change', handleImport);
        });

        // --- CORE FUNCTIONS ---

        function renderSetList() {
            const list = document.getElementById('set-list');
            list.innerHTML = '';
            
            appData.forEach((set, idx) => {
                const item = document.createElement('div');
                item.className = `p-4 border-4 border-brand-dark rounded-xl cursor-pointer transition-all flex justify-between items-center group ${activeSetIndex === idx ? 'bg-brand-blue text-white shadow-none translate-x-1 translate-y-1' : 'bg-white shadow-hard-sm hover:shadow-hard'}`;
                
                item.innerHTML = `
                    <div class="flex-grow" onclick="selectSet(${idx})">
                        <p class="text-xs font-black uppercase opacity-60">${set.topic || 'Untitled'}</p>
                        <h4 class="font-heading font-bold truncate">${set.title || 'New Quiz Set'}</h4>
                    </div>
                    <button onclick="deleteSet(${idx})" class="p-1 opacity-0 group-hover:opacity-100 hover:text-brand-pink transition-opacity">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                `;
                list.appendChild(item);
            });
            lucide.createIcons();
        }

        function selectSet(index) {
            activeSetIndex = index;
            const set = appData[index];
            
            document.getElementById('editor-placeholder').classList.add('hidden');
            document.getElementById('editor-content').classList.remove('hidden');
            
            document.getElementById('edit-id').value = set.id || '';
            document.getElementById('edit-title').value = set.title || '';
            document.getElementById('edit-desc').value = set.desc || '';
            document.getElementById('edit-topic').value = set.topic || '';
            document.getElementById('edit-icon').value = set.icon || 'book';
            
            renderSetList();
            renderQuestions();
        }

        function renderQuestions() {
            const set = appData[activeSetIndex];
            const container = document.getElementById('questions-list');
            container.innerHTML = '';
            document.getElementById('q-count').innerText = set.questions.length;

            set.questions.forEach((q, qIdx) => {
                const block = document.createElement('div');
                block.className = "p-6 bg-brand-chalk border-4 border-brand-dark rounded-2xl shadow-hard relative space-y-4";
                
                block.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="bg-brand-dark text-white font-heading px-3 py-1 rounded-lg text-sm">Question ${qIdx + 1}</span>
                        <button onclick="deleteQuestion(${qIdx})" class="text-brand-pink hover:bg-pink-50 p-1 rounded-lg transition-colors">
                            <i data-lucide="x-square" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <div class="flex flex-col gap-1">
                        <label class="text-xs font-black uppercase text-slate-500">Question Text</label>
                        <input type="text" class="neo-input w-full" value="${q.q}" oninput="updateQuestion(${qIdx}, 'q', this.value)">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${q.opts.map((opt, oIdx) => `
                            <div class="flex items-center gap-3">
                                <input type="radio" name="correct-${qIdx}" class="w-5 h-5 accent-brand-green" ${q.a === oIdx ? 'checked' : ''} onchange="updateQuestion(${qIdx}, 'a', ${oIdx})">
                                <input type="text" class="neo-input flex-grow text-sm" placeholder="Option ${oIdx+1}" value="${opt}" oninput="updateOption(${qIdx}, ${oIdx}, this.value)">
                            </div>
                        `).join('')}
                    </div>

                    <div class="flex flex-col gap-1">
                        <label class="text-xs font-black uppercase text-slate-500">Explanation</label>
                        <input type="text" class="neo-input w-full text-sm font-normal" placeholder="Why is this correct?" value="${q.exp || ''}" oninput="updateQuestion(${qIdx}, 'exp', this.value)">
                    </div>
                `;
                container.appendChild(block);
            });
            lucide.createIcons();
        }

        // --- UPDATE LOGIC ---

        function updateActiveSet(key, value) {
            if (activeSetIndex === -1) return;
            appData[activeSetIndex][key] = value;
            if (key === 'title' || key === 'topic') renderSetList();
        }

        function updateQuestion(qIdx, key, value) {
            appData[activeSetIndex].questions[qIdx][key] = value;
        }

        function updateOption(qIdx, oIdx, value) {
            appData[activeSetIndex].questions[qIdx].opts[oIdx] = value;
        }

        function addNewSet() {
            const newSet = {
                id: "new_set_" + Date.now(),
                title: "New Quiz Set",
                desc: "Description of your quiz.",
                topic: "General",
                icon: "book",
                color: "bg-brand-pink",
                questions: []
            };
            appData.push(newSet);
            selectSet(appData.length - 1);
        }

        function deleteSet(index) {
            if (!confirm("Are you sure you want to delete this set?")) return;
            appData.splice(index, 1);
            if (activeSetIndex === index) {
                activeSetIndex = -1;
                document.getElementById('editor-content').classList.add('hidden');
                document.getElementById('editor-placeholder').classList.remove('hidden');
            } else if (activeSetIndex > index) {
                activeSetIndex--;
            }
            renderSetList();
        }

        function addQuestion() {
            appData[activeSetIndex].questions.push({
                q: "New Question Text",
                opts: ["Option 1", "Option 2", "Option 3", "Option 4"],
                a: 0,
                exp: ""
            });
            renderQuestions();
        }

        function deleteQuestion(qIdx) {
            appData[activeSetIndex].questions.splice(qIdx, 1);
            renderQuestions();
        }

        // --- IO ---

        function handleImport(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const imported = JSON.parse(event.target.result);
                    if (Array.isArray(imported)) {
                        appData = imported;
                        renderSetList();
                        alert("Data imported successfully!");
                    } else {
                        throw new Error();
                    }
                } catch (err) {
                    alert("Invalid JSON format. Please use an array of quiz sets.");
                }
            };
            reader.readAsText(file);
        }

        function exportJSON() {
            if (appData.length === 0) return alert("No data to export!");
            
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement("a");
            link.href = url;
            link.download = "questions.json";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>