<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English 1 Teacher's Library</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config for English 1 Batam System -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            pink: '#FF6B95',
                            orange: '#FF8C42',
                            green: '#00E676',
                            blue: '#2979FF',
                            dark: '#1e293b',
                            chalk: '#f8fafc',
                            yellow: '#FACC15',
                        }
                    },
                    fontFamily: {
                        heading: ['Fredoka', 'sans-serif'],
                        body: ['Nunito', 'sans-serif'],
                    },
                    boxShadow: {
                        'hard': '4px 4px 0px 0px rgba(30, 41, 59, 1)',
                        'hard-sm': '2px 2px 0px 0px rgba(30, 41, 59, 1)',
                        'hard-hover': '6px 6px 0px 0px rgba(30, 41, 59, 1)',
                    },
                    translate: {
                        'click': '4px',
                    }
                }
            }
        }
    </script>

    <style>
        /* Graph Paper Background */
        body {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.05) 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-left: 2px solid #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border: 2px solid #1e293b;
            border-radius: 6px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Modal Specific Styles */
        .modal-open { overflow: hidden; }
        
        .chapter-active {
            background-color: #2979FF; /* brand-blue */
            color: white;
            border-right: 4px solid #1e293b;
        }
        .chapter-active:hover {
            background-color: #2979FF;
            color: white;
        }
        
        /* Typography for Reader */
        .prose p { margin-bottom: 1.5em; line-height: 1.8; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1.5em; }
        .prose li { margin-bottom: 0.5em; }
        .prose strong { color: #1e293b; font-weight: 800; }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
    </style>
</head>
<body class="text-brand-dark font-body min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-brand-blue border-b-4 border-brand-dark p-4 sticky top-0 z-40 shadow-hard">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-center md:justify-between items-center gap-4">
            <div class="flex items-center gap-3 bg-brand-chalk border-2 border-brand-dark rounded-xl px-4 py-2 shadow-hard-sm w-full md:w-auto justify-center md:justify-start">
                <i data-lucide="library" class="w-6 h-6 text-brand-blue"></i>
                <h1 class="font-heading text-xl font-bold tracking-wide">English 1 Library</h1>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow p-4 md:p-8">
        <div class="max-w-7xl mx-auto space-y-8">

            <!-- Hero / Search Section -->
            <section class="bg-white border-4 border-brand-dark rounded-2xl p-6 shadow-hard flex flex-col md:flex-row gap-6 items-center justify-between">
                <div class="space-y-2 text-center md:text-left">
                    <h2 class="font-heading text-3xl font-bold text-brand-dark">Detailed Chapter Guides</h2>
                    <p class="text-slate-600 font-bold text-lg">Select a book to enter Reader Mode.</p>
                </div>
                
                <div class="flex flex-col sm:flex-row w-full md:w-auto gap-3">
                    <div class="relative flex-grow md:w-80">
                        <input type="text" id="searchInput" placeholder="Search title, author..." class="w-full bg-brand-chalk border-2 border-brand-dark rounded-xl py-3 pl-10 pr-4 font-bold focus:outline-none focus:ring-4 focus:ring-brand-blue/30 shadow-hard-sm transition-all">
                        <i data-lucide="search" class="absolute left-3 top-3.5 w-5 h-5 text-slate-400"></i>
                    </div>
                </div>
            </section>

            <!-- Book Grid -->
            <div id="bookGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Books will be injected here via JS -->
                <div class="col-span-3 flex justify-center p-12">
                     <div class="animate-spin rounded-full h-12 w-12 border-4 border-brand-blue border-t-transparent"></div>
                </div>
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="hidden flex-col items-center justify-center p-12 text-center bg-white border-4 border-brand-dark border-dashed rounded-2xl">
                <i data-lucide="ghost" class="w-16 h-16 text-brand-pink mb-4"></i>
                <h3 class="font-heading text-2xl font-bold">No books found!</h3>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-brand-dark text-brand-chalk p-6 mt-8 border-t-4 border-brand-pink">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <p class="font-bold font-heading">English 1 Batam</p>
            <p class="font-body text-sm text-slate-400">&copy; 2025 Education Tools.</p>
        </div>
    </footer>

    <!-- READER MODAL OVERLAY (Fullscreen-ish) -->
    <div id="readerModal" class="fixed inset-0 bg-brand-dark/90 backdrop-blur-md z-50 hidden flex justify-center items-center p-2 md:p-6">
        
        <!-- Reader Container -->
        <div class="bg-brand-chalk w-full max-w-6xl h-full md:h-[90vh] border-4 border-brand-dark rounded-xl shadow-hard flex flex-col overflow-hidden relative">
            
            <!-- 1. Header Area -->
            <div id="readerHeader" class="bg-white border-b-4 border-brand-dark p-4 flex justify-between items-center shrink-0 z-10">
                <div class="flex items-center gap-3 overflow-hidden">
                    <button onclick="closeReader()" class="md:hidden p-2 hover:bg-slate-100 rounded-lg border-2 border-transparent hover:border-brand-dark transition-all">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                    <div class="h-10 w-1 bg-brand-dark rounded-full hidden md:block"></div>
                    <div class="truncate">
                        <h3 id="readerTitle" class="font-heading text-xl md:text-2xl font-bold text-brand-dark truncate">Book Title</h3>
                        <p id="readerAuthor" class="font-body text-sm font-bold text-slate-500 hidden md:block">Author Name</p>
                    </div>
                </div>
                
                <div class="flex gap-2">
                    <span id="chapterProgress" class="hidden md:flex items-center px-3 bg-brand-chalk border-2 border-brand-dark rounded-lg font-bold text-sm">
                        Chapter 1 of 5
                    </span>
                    <button onclick="closeReader()" class="bg-brand-pink border-2 border-brand-dark rounded-lg p-2 text-brand-dark hover:bg-red-400 hover:text-white transition-colors shadow-hard-sm active:shadow-none active:translate-y-[2px]">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <!-- 2. Mobile Chapter Dropdown (Visible only on mobile) -->
            <div class="md:hidden border-b-4 border-brand-dark bg-brand-chalk p-2">
                <select id="mobileChapterSelect" class="w-full p-2 border-2 border-brand-dark rounded-lg font-bold font-heading bg-white focus:outline-none focus:ring-2 focus:ring-brand-blue">
                    <!-- Options injected via JS -->
                </select>
            </div>

            <!-- 3. Main Reader Layout -->
            <div class="flex flex-grow overflow-hidden relative">
                
                <!-- Sidebar (Table of Contents) - Desktop Only -->
                <aside class="hidden md:flex flex-col w-1/4 lg:w-1/5 bg-white border-r-4 border-brand-dark overflow-y-auto">
                    <div class="p-4 bg-slate-50 border-b-2 border-brand-dark sticky top-0 z-10">
                        <span class="text-xs font-bold uppercase tracking-widest text-slate-500">Table of Contents</span>
                    </div>
                    <div id="desktopChapterList" class="flex flex-col">
                        <!-- List items injected via JS -->
                    </div>
                </aside>

                <!-- Reading Pane -->
                <section id="readingPane" class="flex-1 overflow-y-auto bg-white p-6 md:p-12 md:px-20 relative scroll-smooth">
                    <div class="max-w-3xl mx-auto animate-slide-up">
                        <span id="paneChapterNumber" class="text-brand-blue font-heading font-bold text-lg uppercase tracking-wider mb-2 block">Chapter 1</span>
                        <h2 id="paneChapterTitle" class="font-heading text-3xl md:text-4xl font-black text-brand-dark mb-8 border-b-4 border-brand-yellow pb-4 inline-block transform -rotate-1">Introduction</h2>
                        
                        <div id="paneContent" class="prose prose-lg text-slate-700 font-medium text-lg md:text-xl leading-loose">
                            <!-- Long text content injected here -->
                        </div>
                        
                        <!-- Bottom Navigation -->
                        <div class="mt-16 pt-8 border-t-4 border-brand-dark/20 flex justify-between gap-4">
                            <button id="btnPrev" class="px-6 py-3 rounded-xl border-2 border-brand-dark font-bold hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                                <i data-lucide="chevron-left"></i> Previous
                            </button>
                            <button id="btnNext" class="bg-brand-blue text-white px-6 py-3 rounded-xl border-2 border-brand-dark font-bold shadow-hard-sm hover:translate-y-[-2px] hover:shadow-hard active:translate-y-[2px] active:shadow-none transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                                Next Chapter <i data-lucide="chevron-right"></i>
                            </button>
                        </div>
                        
                        <div class="h-20"></div> <!-- Spacer for scrolling -->
                    </div>
                </section>
            </div>

        </div>
    </div>

    <!-- Javascript Logic -->
    <script>
        // --- DOM Elements ---
        const grid = document.getElementById('bookGrid');
        const searchInput = document.getElementById('searchInput');
        const emptyState = document.getElementById('emptyState');
        const modal = document.getElementById('readerModal');
        const body = document.body;

        // Reader Elements
        const readerTitle = document.getElementById('readerTitle');
        const readerAuthor = document.getElementById('readerAuthor');
        const chapterProgress = document.getElementById('chapterProgress');
        const desktopChapterList = document.getElementById('desktopChapterList');
        const mobileChapterSelect = document.getElementById('mobileChapterSelect');
        
        const paneChapterNumber = document.getElementById('paneChapterNumber');
        const paneChapterTitle = document.getElementById('paneChapterTitle');
        const paneContent = document.getElementById('paneContent');
        const readingPane = document.getElementById('readingPane');
        
        const btnPrev = document.getElementById('btnPrev');
        const btnNext = document.getElementById('btnNext');

        // State
        let books = [];
        let currentBook = null;
        let currentChapterIndex = 0;

        // --- FETCH DATA ---
        async function fetchBooks() {
            try {
                const response = await fetch('books.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                books = await response.json();
                renderBooks(books);
            } catch (error) {
                console.error("Could not fetch books:", error);
                grid.innerHTML = `
                    <div class="col-span-3 flex flex-col items-center p-12 text-center">
                         <i data-lucide="alert-triangle" class="w-12 h-12 text-red-500 mb-2"></i>
                         <p class="font-bold text-red-500">Error loading library data.</p>
                         <p class="text-sm">Please ensure "books.json" is in the same folder and you are running a local server.</p>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        // --- Functions ---

        // Render Grid
        function renderBooks(bookList) {
            grid.innerHTML = '';
            
            if (bookList.length === 0) {
                grid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                emptyState.classList.add('flex');
                return;
            }

            grid.classList.remove('hidden');
            emptyState.classList.add('hidden');
            emptyState.classList.remove('flex');

            bookList.forEach(book => {
                const card = document.createElement('div');
                card.className = `bg-white border-4 border-brand-dark rounded-2xl overflow-hidden shadow-hard flex flex-col h-full hover:translate-y-[-4px] hover:shadow-hard-hover transition-all duration-200`;
                const bgClass = `bg-brand-${book.color}`;

                card.innerHTML = `
                    <div class="${bgClass} border-b-4 border-brand-dark p-4 flex justify-between items-start">
                        <span class="bg-brand-dark text-white px-2 py-1 rounded-lg text-xs font-bold font-heading uppercase tracking-wider">${book.category}</span>
                        <i data-lucide="${book.icon}" class="w-8 h-8 text-brand-dark opacity-20"></i>
                    </div>
                    <div class="p-6 flex-grow space-y-4">
                        <h3 class="font-heading text-xl font-bold leading-tight">${book.title}</h3>
                        <p class="text-sm font-bold text-slate-500">by ${book.author}</p>
                        <p class="text-slate-700 text-sm line-clamp-3 font-semibold">${book.synopsis}</p>
                    </div>
                    <div class="p-4 bg-slate-50 border-t-4 border-brand-dark mt-auto">
                        <button onclick="openReader(${book.id})" class="w-full bg-brand-blue text-white border-2 border-brand-dark rounded-xl py-3 font-heading font-bold shadow-hard-sm hover:translate-y-[1px] hover:shadow-none active:translate-y-[4px] transition-all flex justify-center gap-2">
                            <i data-lucide="book-open" class="w-5 h-5"></i> Open Reader
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        // --- READER LOGIC ---

        function openReader(id) {
            const book = books.find(b => b.id === id);
            if (!book) return;

            currentBook = book;
            currentChapterIndex = 0; // Reset to start

            // Set Header Info
            readerTitle.innerText = book.title;
            readerAuthor.innerText = "by " + book.author;
            
            // Render Table of Contents (Sidebar & Mobile Select)
            renderTableOfContents();
            
            // Load First Chapter
            loadChapter(0);

            // Show Modal
            modal.classList.remove('hidden');
            body.classList.add('modal-open');
        }

        function renderTableOfContents() {
            // Desktop Sidebar
            desktopChapterList.innerHTML = currentBook.chapters.map((chap, index) => `
                <button onclick="loadChapter(${index})" 
                        id="toc-btn-${index}"
                        class="text-left px-4 py-3 border-b-2 border-brand-dark/10 font-bold text-slate-600 hover:bg-slate-100 hover:text-brand-blue transition-colors flex items-center gap-3">
                    <span class="text-xs bg-slate-200 px-2 py-1 rounded text-slate-500 font-heading">#${index + 1}</span>
                    <span class="truncate">${chap.title}</span>
                </button>
            `).join('');

            // Mobile Dropdown
            mobileChapterSelect.innerHTML = currentBook.chapters.map((chap, index) => `
                <option value="${index}">Chapter ${index + 1}: ${chap.title}</option>
            `).join('');
            
            // Bind Mobile Select Event
            mobileChapterSelect.onchange = (e) => loadChapter(parseInt(e.target.value));
        }

        function loadChapter(index) {
            if (index < 0 || index >= currentBook.chapters.length) return;
            
            currentChapterIndex = index;
            const chapter = currentBook.chapters[index];

            // Update UI State for Active Chapter
            document.querySelectorAll('#desktopChapterList button').forEach(btn => {
                btn.classList.remove('chapter-active');
            });
            const activeBtn = document.getElementById(`toc-btn-${index}`);
            if(activeBtn) activeBtn.classList.add('chapter-active');
            
            mobileChapterSelect.value = index;

            // Content Injection
            paneChapterNumber.innerText = `Chapter ${index + 1}`;
            paneChapterTitle.innerText = chapter.title;
            paneContent.innerHTML = chapter.detailedContent; // Inject HTML
            
            // Update Progress Header
            chapterProgress.innerText = `Chapter ${index + 1} of ${currentBook.chapters.length}`;

            // Handle Buttons
            btnPrev.disabled = index === 0;
            btnNext.disabled = index === currentBook.chapters.length - 1;

            // Scroll to top of pane
            readingPane.scrollTop = 0;
        }

        // Navigation Handlers
        btnPrev.addEventListener('click', () => loadChapter(currentChapterIndex - 1));
        btnNext.addEventListener('click', () => loadChapter(currentChapterIndex + 1));

        function closeReader() {
            modal.classList.add('hidden');
            body.classList.remove('modal-open');
        }

        // Search Filter
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = books.filter(book => 
                book.title.toLowerCase().includes(term) || 
                book.author.toLowerCase().includes(term) ||
                book.category.toLowerCase().includes(term)
            );
            renderBooks(filtered);
        });

        // Close on outside click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeReader();
        });

        // Close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) closeReader();
        });

        // Init - Load data
        fetchBooks();

    </script>
</body>
</html>