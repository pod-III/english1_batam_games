<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kim's Game Ultimate - English 1 Batam</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            pink: '#FF6B95',
                            orange: '#FF8C42',
                            green: '#00E676',
                            blue: '#2979FF',
                            dark: '#1e293b',
                            chalk: '#f8fafc',
                        }
                    },
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                        heading: ['Fredoka', 'sans-serif'],
                    },
                    boxShadow: {
                        'neo': '4px 4px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-sm': '2px 2px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-lg': '8px 8px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-pressed': '0px 0px 0px 0px rgba(30, 41, 59, 1)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Background Pattern */
        body {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.07) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.07) 1px, transparent 1px);
            background-size: 40px 40px;
        }
        .dark body {
            background-color: #0f172a;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
        }

        /* 3D Mechanics */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }

        /* Button Interaction */
        .btn-neo { transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-neo:hover { transform: translate(-2px, -2px); box-shadow: 6px 6px 0px 0px rgba(30, 41, 59, 1); }
        .btn-neo:active { transform: translate(2px, 2px); box-shadow: 0px 0px 0px 0px rgba(30, 41, 59, 1); }

        /* Image Handling */
        .card-img { 
            object-fit: contain; 
            width: 85%; 
            height: 85%; 
            pointer-events: none;
            filter: drop-shadow(0 4px 3px rgb(0 0 0 / 0.07));
        }

        /* Drop Zone */
        .drop-zone { transition: all 0.2s; }
        .drop-zone.drag-over { background-color: #e0f2fe; border-color: #2979FF; transform: scale(1.02); }
    </style>
</head>
<body class="text-brand-dark min-h-screen flex flex-col items-center justify-center p-4">

    <header class="w-full max-w-7xl flex flex-col md:flex-row justify-between items-center mb-8 gap-4 z-20">
        <div class="flex items-center gap-4 bg-white dark:bg-slate-800 border-4 border-brand-dark shadow-neo rounded-2xl p-3 md:p-4 w-full md:w-auto transform hover:rotate-1 transition-transform">
            <div class="bg-brand-blue p-2 rounded-xl border-2 border-brand-dark text-white">
                <i data-lucide="brain" class="w-8 h-8"></i>
            </div>
            <div>
                <h1 class="font-heading text-2xl md:text-3xl font-black text-brand-dark dark:text-brand-chalk leading-none tracking-tight">KIM'S GAME</h1>
                <div id="status-text" class="font-sans text-sm md:text-base font-bold text-brand-orange dark:text-brand-green uppercase tracking-wider">Shuffle Edition</div>
            </div>
        </div>

        <div class="flex gap-3">
            <button onclick="Game.openSetup()" class="btn-neo bg-brand-orange text-white font-heading font-bold text-lg px-6 py-3 rounded-xl border-4 border-brand-dark shadow-neo flex items-center gap-2">
                <i data-lucide="settings" class="w-5 h-5"></i> <span class="hidden sm:inline">Setup</span>
            </button>
            <button onclick="Game.toggleTheme()" class="btn-neo bg-brand-dark text-white p-3 rounded-xl border-4 border-brand-dark shadow-neo hover:text-brand-pink">
                <i data-lucide="moon" id="theme-icon"></i>
            </button>
        </div>
    </header>

    <main class="w-full max-w-7xl flex flex-col items-center relative z-10">
        
        <div id="timer-container" class="w-full max-w-3xl h-10 bg-brand-dark rounded-full mb-8 overflow-hidden border-4 border-brand-dark shadow-neo hidden relative">
            <div id="timer-fill" class="h-full bg-brand-green w-full origin-left"></div>
            <div id="timer-number" class="absolute inset-0 flex items-center justify-center font-heading font-bold text-white text-lg drop-shadow-md tracking-wider">00s</div>
        </div>

        <div id="game-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 w-full px-2">
            <div class="col-span-full flex flex-col items-center justify-center h-96 bg-white/60 dark:bg-slate-800/60 border-[6px] border-dashed border-brand-dark/20 rounded-3xl backdrop-blur-sm">
                <div class="bg-brand-pink/20 p-6 rounded-full mb-4 animate-bounce">
                    <i data-lucide="layers" class="w-16 h-16 text-brand-pink"></i>
                </div>
                <p class="font-heading text-3xl font-bold text-brand-dark/60 dark:text-white/60">Ready to Play?</p>
                <button onclick="Game.openSetup()" class="mt-4 px-6 py-2 bg-brand-blue/10 text-brand-blue font-bold rounded-lg hover:bg-brand-blue hover:text-white transition-colors border-2 border-transparent hover:border-brand-dark">
                    Open Setup
                </button>
            </div>
        </div>

        <div class="mt-12 flex flex-wrap justify-center gap-4 w-full">
            <button id="btn-start" onclick="Game.startMemorization()" class="hidden btn-neo bg-brand-green text-white font-heading font-black text-2xl px-12 py-5 rounded-2xl border-4 border-brand-dark shadow-neo hover:scale-105 active:scale-95 transition-transform">
                Start Memorizing
            </button>
            
            <button id="btn-hide" onclick="Game.hideCards()" class="hidden btn-neo bg-brand-pink text-white font-heading font-black text-2xl px-12 py-5 rounded-2xl border-4 border-brand-dark shadow-neo hover:scale-105 active:scale-95 transition-transform">
                Hide Now!
            </button>
            
            <div id="controls-reveal" class="hidden flex flex-wrap justify-center gap-4">
                <button onclick="Game.shuffleAndRestart()" class="btn-neo bg-brand-orange text-white font-heading font-bold text-xl px-8 py-4 rounded-2xl border-4 border-brand-dark shadow-neo flex items-center gap-2">
                    <i data-lucide="shuffle"></i> Shuffle & Play Again
                </button>
                <button onclick="Game.startMemorization()" class="btn-neo bg-white text-brand-dark font-heading font-bold text-xl px-8 py-4 rounded-2xl border-4 border-brand-dark shadow-neo flex items-center gap-2">
                    <i data-lucide="rotate-ccw"></i> Restart Same
                </button>
                <button onclick="Game.revealAll()" class="btn-neo bg-brand-blue text-white font-heading font-bold text-xl px-10 py-4 rounded-2xl border-4 border-brand-dark shadow-neo">
                    Reveal Answers
                </button>
            </div>
        </div>
    </main>

    <div id="setup-modal" class="fixed inset-0 bg-brand-dark/80 flex items-center justify-center z-50 hidden backdrop-blur-md p-4 animate-in fade-in duration-200">
        <div class="bg-white dark:bg-slate-800 border-4 border-brand-dark shadow-neo-lg rounded-3xl p-6 md:p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar relative">
            
            <div class="flex justify-between items-center mb-6 border-b-4 border-brand-dark/10 pb-4">
                <h2 class="font-heading text-3xl font-black text-brand-dark dark:text-brand-chalk tracking-tight">GAME SETUP</h2>
                <button onclick="Game.closeSetup()" class="text-brand-dark dark:text-white hover:text-brand-pink transition-transform hover:rotate-90">
                    <i data-lucide="x" class="w-8 h-8"></i>
                </button>
            </div>

            <div class="space-y-8">
                
                <div>
                    <label class="block font-heading text-xl font-bold text-brand-dark dark:text-brand-chalk mb-3 flex items-center gap-2">
                        <div class="bg-brand-orange text-white p-1 rounded border-2 border-brand-dark"><i data-lucide="type" class="w-4 h-4"></i></div>
                        Vocabulary Words
                    </label>
                    
                    <textarea id="input-words" rows="2" class="w-full font-sans text-xl p-4 border-4 border-brand-dark rounded-xl shadow-neo-sm focus:outline-none focus:ring-4 focus:ring-brand-orange/30 dark:bg-slate-900 dark:text-white transition-all resize-none" placeholder="Apple, Banana, Orange..."></textarea>
                    
                    <div class="flex flex-wrap gap-2 mt-3">
                        <span class="text-xs font-black text-brand-dark/40 dark:text-white/40 self-center mr-1 uppercase tracking-wider">Quick Sets:</span>
                        <button onclick="Game.usePreset('animals')" class="px-3 py-1.5 bg-brand-green/10 text-brand-green border-2 border-brand-green rounded-lg font-bold text-sm hover:bg-brand-green hover:text-white transition">Animals</button>
                        <button onclick="Game.usePreset('fruits')" class="px-3 py-1.5 bg-brand-orange/10 text-brand-orange border-2 border-brand-orange rounded-lg font-bold text-sm hover:bg-brand-orange hover:text-white transition">Fruits</button>
                        <button onclick="Game.usePreset('classroom')" class="px-3 py-1.5 bg-brand-blue/10 text-brand-blue border-2 border-brand-blue rounded-lg font-bold text-sm hover:bg-brand-blue hover:text-white transition">Classroom</button>
                        <button onclick="Game.usePreset('actions')" class="px-3 py-1.5 bg-brand-pink/10 text-brand-pink border-2 border-brand-pink rounded-lg font-bold text-sm hover:bg-brand-pink hover:text-white transition">Actions</button>
                    </div>
                </div>

                <div class="drop-zone border-4 border-dashed border-brand-dark/30 dark:border-white/30 rounded-2xl p-6 bg-brand-chalk dark:bg-slate-900/50" id="drop-area">
                    <label class="block font-heading text-xl font-bold text-brand-dark dark:text-brand-chalk mb-4 flex items-center gap-2">
                        <div class="bg-brand-pink text-white p-1 rounded border-2 border-brand-dark"><i data-lucide="image" class="w-4 h-4"></i></div>
                        Images
                    </label>
                    
                    <div class="flex flex-col items-center justify-center gap-3">
                        <i data-lucide="upload-cloud" class="w-12 h-12 text-brand-blue opacity-50"></i>
                        <p class="text-brand-dark/60 dark:text-white/60 font-bold text-center">Drag & Drop images here<br>or</p>
                        <button onclick="document.getElementById('input-file').click()" class="btn-neo bg-brand-blue text-white font-bold py-2 px-6 rounded-xl border-2 border-brand-dark shadow-neo-sm flex items-center gap-2 hover:bg-blue-600">
                            Browse Files
                        </button>
                        <input type="file" id="input-file" multiple accept="image/*" class="hidden" onchange="Game.handleFiles(this.files)">
                    </div>

                    <div id="image-preview" class="flex flex-wrap gap-3 mt-6 min-h-[0px] transition-all">
                        </div>
                </div>

                <div class="grid grid-cols-2 gap-6 bg-brand-dark/5 p-4 rounded-xl border-2 border-brand-dark/10">
                    <div>
                        <label class="block font-bold text-sm text-brand-dark/70 dark:text-white/70 uppercase mb-1">Timer (Sec)</label>
                        <input type="number" id="input-time" value="30" class="w-full p-2 border-4 border-brand-dark rounded-lg text-center font-bold text-xl dark:bg-slate-900 dark:text-white">
                    </div>
                    <div>
                        <label class="block font-bold text-sm text-brand-dark/70 dark:text-white/70 uppercase mb-1">Card Style</label>
                        <select id="input-color" class="w-full p-2 border-4 border-brand-dark rounded-lg font-bold text-brand-dark cursor-pointer dark:bg-slate-900 dark:text-white">
                            <option value="random">Colorful Mix</option>
                            <option value="white">Clean White</option>
                            <option value="pink">Hot Pink</option>
                        </select>
                    </div>
                </div>

                <div class="flex gap-4 pt-2">
                    <button onclick="Game.saveSetup()" class="flex-[2] btn-neo bg-brand-green text-white font-heading font-black text-xl py-4 rounded-xl border-4 border-brand-dark shadow-neo hover:bg-green-500">
                        START GAME
                    </button>
                    <button onclick="Game.clearAll()" class="flex-1 btn-neo bg-slate-200 text-brand-dark font-heading font-bold text-xl py-4 rounded-xl border-4 border-brand-dark shadow-neo hover:bg-slate-300">
                        Clear
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * Game Module
         * Handles hybrid input (text + images), drag-and-drop, and game states.
         */
        const Game = (function() {
            // --- State ---
            let state = {
                items: [],         // Final mixed list for game
                pendingImages: [], // Base64 strings from upload
                duration: 30,
                theme: 'random',
                timerInterval: null,
                isRevealing: false
            };

            // --- Presets Data ---
            const presets = {
                animals: "Lion, Tiger, Elephant, Monkey, Zebra, Giraffe, Bear",
                fruits: "Apple, Banana, Orange, Grape, Melon, Kiwi, Lemon",
                classroom: "Pencil, Ruler, Book, Desk, Chair, Eraser, Bag",
                actions: "Run, Jump, Sleep, Eat, Drink, Read, Write"
            };

            const colors = {
                pink: 'bg-brand-pink text-white',
                white: 'bg-white text-brand-dark',
                random: ['bg-brand-pink text-white', 'bg-brand-orange text-white', 'bg-brand-green text-white', 'bg-brand-blue text-white']
            };

            // --- DOM Elements ---
            const els = {
                grid: document.getElementById('game-grid'),
                modal: document.getElementById('setup-modal'),
                timerBar: document.getElementById('timer-container'),
                timerFill: document.getElementById('timer-fill'),
                timerNum: document.getElementById('timer-number'),
                preview: document.getElementById('image-preview'),
                dropZone: document.getElementById('drop-area'),
                inputs: {
                    words: document.getElementById('input-words'),
                    time: document.getElementById('input-time'),
                    theme: document.getElementById('input-color')
                },
                btns: {
                    start: document.getElementById('btn-start'),
                    hide: document.getElementById('btn-hide'),
                    revealGroup: document.getElementById('controls-reveal')
                },
                status: document.getElementById('status-text')
            };

            // --- Init ---
            function init() {
                lucide.createIcons();
                setupDragDrop();
            }

            function setupDragDrop() {
                const zone = els.dropZone;
                
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    zone.addEventListener(eventName, preventDefaults, false);
                });

                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                ['dragenter', 'dragover'].forEach(eventName => {
                    zone.addEventListener(eventName, () => zone.classList.add('drag-over'), false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    zone.addEventListener(eventName, () => zone.classList.remove('drag-over'), false);
                });

                zone.addEventListener('drop', (e) => {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    handleFiles(files);
                });
            }

            // --- Setup Logic ---

            function openSetup() { els.modal.classList.remove('hidden'); }
            function closeSetup() { els.modal.classList.add('hidden'); }

            function usePreset(key) {
                const current = els.inputs.words.value.trim();
                const newVal = presets[key];
                
                if(current.length > 0) {
                    els.inputs.words.value = current + ", " + newVal;
                } else {
                    els.inputs.words.value = newVal;
                }
            }

            function handleFiles(files) {
                if (files && files.length > 0) {
                    Array.from(files).forEach(file => {
                        if(!file.type.startsWith('image/')) return;
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            state.pendingImages.push(e.target.result);
                            updatePreview();
                        };
                        reader.readAsDataURL(file);
                    });
                }
            }

            function updatePreview() {
                els.preview.innerHTML = '';
                if(state.pendingImages.length === 0) return;

                state.pendingImages.forEach((src, idx) => {
                    const thumb = document.createElement('div');
                    thumb.className = "w-16 h-16 border-2 border-brand-dark rounded-lg bg-cover bg-center relative shadow-sm hover:scale-105 transition-transform bg-white";
                    thumb.style.backgroundImage = `url(${src})`;
                    
                    // Delete btn
                    thumb.innerHTML = `
                        <button onclick="Game.removeImage(${idx})" class="absolute -top-2 -right-2 bg-brand-pink text-white rounded-full w-5 h-5 flex items-center justify-center text-xs border border-brand-dark hover:bg-red-600 shadow-sm font-bold">
                            Ã—
                        </button>
                    `;
                    els.preview.appendChild(thumb);
                });
            }

            function removeImage(idx) {
                state.pendingImages.splice(idx, 1);
                updatePreview();
            }

            function clearAll() {
                state.pendingImages = [];
                els.inputs.words.value = '';
                updatePreview();
            }

            function saveSetup() {
                state.items = [];

                // 1. Process Text
                const textRaw = els.inputs.words.value;
                if(textRaw.trim()) {
                    const words = textRaw.split(/[\n,]+/).map(w=>w.trim()).filter(w=>w.length>0);
                    words.forEach(w => state.items.push({ type: 'text', value: w }));
                }

                // 2. Process Images
                state.pendingImages.forEach(src => {
                    state.items.push({ type: 'image', value: src });
                });

                // 3. Settings
                state.duration = parseInt(els.inputs.time.value) || 30;
                state.theme = els.inputs.theme.value;

                if(state.items.length === 0) {
                    alert("Please add some words or images first!");
                    return;
                }

                shuffleItems(); // Initial Shuffle
                renderGrid();
                resetUI();
                closeSetup();
                els.status.textContent = `${state.items.length} items loaded. Press Start!`;
            }

            function shuffleItems() {
                state.items.sort(() => Math.random() - 0.5);
            }

            // --- Game Logic ---

            function resetUI() {
                els.btns.start.classList.remove('hidden');
                els.btns.hide.classList.add('hidden');
                els.btns.revealGroup.classList.add('hidden');
                els.timerBar.classList.add('hidden');
            }

            function renderGrid() {
                els.grid.innerHTML = '';
                const count = state.items.length;
                
                // Adaptive Grid
                let gridClass = "grid gap-4 md:gap-6 w-full ";
                if(count <= 4) gridClass += "grid-cols-2 md:grid-cols-2 max-w-3xl";
                else if(count <= 8) gridClass += "grid-cols-3 md:grid-cols-4 max-w-5xl";
                else gridClass += "grid-cols-3 md:grid-cols-5";
                
                els.grid.className = gridClass;

                state.items.forEach((item, index) => {
                    // Color Logic
                    let bgClass = '';
                    if(state.theme === 'random') {
                        bgClass = colors.random[index % colors.random.length];
                    } else {
                        bgClass = colors[state.theme];
                    }

                    // Card Generation
                    const card = document.createElement('div');
                    card.className = "group h-40 md:h-52 perspective-1000 cursor-pointer select-none animate-in zoom-in duration-300";
                    card.style.animationDelay = `${index * 50}ms`;

                    let content = '';
                    if(item.type === 'text') {
                        content = `<span class="font-heading text-2xl md:text-3xl font-black break-words px-2 drop-shadow-sm">${item.value}</span>`;
                    } else {
                        content = `<img src="${item.value}" class="card-img bg-white rounded-lg border-2 border-brand-dark/10">`;
                    }

                    card.innerHTML = `
                        <div class="card-inner relative w-full h-full text-center transition-all duration-700 transform-style-3d shadow-neo rounded-2xl border-[3px] border-brand-dark" id="card-${index}">
                            <div class="absolute inset-0 w-full h-full ${bgClass} rounded-xl backface-hidden flex items-center justify-center z-20 overflow-hidden">
                                ${content}
                            </div>
                            <div class="absolute inset-0 w-full h-full bg-brand-dark rounded-xl rotate-y-180 backface-hidden flex items-center justify-center z-10 border-[3px] border-white/10">
                                <span class="font-heading text-6xl text-brand-chalk opacity-20 font-black">?</span>
                            </div>
                        </div>
                    `;
                    
                    card.onclick = () => toggleCard(index);
                    els.grid.appendChild(card);
                });
            }

            function toggleCard(index) {
                if(!state.isRevealing) return; // Locked during memorization
                const card = document.getElementById(`card-${index}`);
                if(card) card.classList.toggle('rotate-y-180');
            }

            function startMemorization() {
                state.isRevealing = false;
                
                // Flip all to front
                document.querySelectorAll('.card-inner').forEach(c => c.classList.remove('rotate-y-180'));

                els.btns.start.classList.add('hidden');
                els.btns.revealGroup.classList.add('hidden');
                els.btns.hide.classList.remove('hidden');
                
                startTimer();
                els.status.textContent = "Memorize the items!";
                els.status.className = "font-sans text-sm md:text-base font-bold text-brand-blue uppercase tracking-wider animate-pulse";
            }

            function shuffleAndRestart() {
                // 1. Flip everything over first (optional visual polish)
                document.querySelectorAll('.card-inner').forEach(c => c.classList.remove('rotate-y-180'));
                
                // 2. Small delay then shuffle
                setTimeout(() => {
                    shuffleItems();
                    renderGrid();
                    startMemorization();
                }, 300);
            }

            function startTimer() {
                els.timerBar.classList.remove('hidden');
                let timeLeft = state.duration;
                
                els.timerNum.textContent = timeLeft + "s";
                els.timerFill.style.transition = 'none';
                els.timerFill.style.width = '100%';
                void els.timerFill.offsetWidth;
                
                els.timerFill.style.transition = `width ${state.duration}s linear`;
                els.timerFill.style.width = '0%';

                clearInterval(state.timerInterval);
                state.timerInterval = setInterval(() => {
                    timeLeft--;
                    els.timerNum.textContent = timeLeft + "s";
                    
                    // Warning colors
                    if(timeLeft <= 5) els.timerFill.classList.replace('bg-brand-green', 'bg-brand-pink');
                    else els.timerFill.classList.replace('bg-brand-pink', 'bg-brand-green');

                    if(timeLeft <= 0) hideCards();
                }, 1000);
            }

            function hideCards() {
                clearInterval(state.timerInterval);
                state.isRevealing = true;
                
                // Cascade flip
                document.querySelectorAll('.card-inner').forEach((c, i) => {
                    setTimeout(() => c.classList.add('rotate-y-180'), i * 30);
                });

                els.timerBar.classList.add('hidden');
                els.btns.hide.classList.add('hidden');
                els.btns.revealGroup.classList.remove('hidden');
                els.status.textContent = "TIME'S UP! Write it down!";
                els.status.className = "font-sans text-sm md:text-base font-bold text-brand-pink uppercase tracking-wider";
            }

            function revealAll() {
                document.querySelectorAll('.card-inner').forEach((c, i) => {
                    setTimeout(() => c.classList.remove('rotate-y-180'), i * 30);
                });
                els.status.textContent = "Checking answers...";
                els.status.className = "font-sans text-sm md:text-base font-bold text-brand-green uppercase tracking-wider";
            }

            function toggleTheme() {
                document.documentElement.classList.toggle('dark');
            }

            // Public API
            return {
                init, openSetup, closeSetup, usePreset,
                handleFiles, removeImage, clearAll, saveSetup,
                startMemorization, hideCards, revealAll, toggleCard,
                shuffleAndRestart,
                toggleTheme
            };
        })();

        Game.init();
    </script>
</body>
</html>