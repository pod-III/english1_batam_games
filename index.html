<!DOCTYPE html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English 1 Batam - Activity Hub</title>

  <link rel="icon" type="image/x-icon" href="./media/icon.ico" />
  <link rel="apple-touch-icon" href="./media/icon.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito:wght@400;600;700;800&display=swap"
    rel="stylesheet" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            pink: "#FF6B95",
            orange: "#FF8C42",
            green: "#00E676",
            blue: "#2979FF",
            dark: "#0f172a",
            panel: "#1e293b",
            surface: "#334155",
          },
          fontFamily: {
            heading: ["Bebas Neue", "sans-serif"],
            body: ["Nunito", "sans-serif"],
          },
          animation: {
            blob: "blob 10s infinite",
            "fade-in": "fadeIn 0.3s ease-out",
            "slide-up": "slideUp 0.5s ease-out",
            pop: "pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",
          },
          keyframes: {
            blob: {
              "0%": { transform: "translate(0px, 0px) scale(1)" },
              "33%": { transform: "translate(30px, -50px) scale(1.1)" },
              "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
              "100%": { transform: "translate(0px, 0px) scale(1)" },
            },
            fadeIn: {
              "0%": { opacity: "0" },
              "100%": { opacity: "1" },
            },
            pop: {
              "0%": { transform: "scale(0.9)", opacity: "0" },
              "100%": { transform: "scale(1)", opacity: "1" },
            },
            slideUp: {
              "0%": { transform: "translateY(20px)", opacity: "0" },
              "100%": { transform: "translateY(0)", opacity: "1" },
            },
          },
        },
      },
    };
  </script>

  <style>
    /* Base Styles */
    body {
      background-color: #0f172a;
      font-family: "Nunito", sans-serif;
      color: white;
      overflow-x: hidden;
    }

    /* Ambient Background */
    .ambient-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      background: #0f172a;
    }

    .blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.4;
      animation: blob 15s infinite alternate;
    }

    .blob-1 {
      top: -10%;
      left: -10%;
      width: 500px;
      height: 500px;
      background: rgba(41, 121, 255, 0.2);
    }

    .blob-2 {
      bottom: -10%;
      right: -10%;
      width: 500px;
      height: 500px;
      background: rgba(255, 107, 149, 0.15);
      animation-delay: -5s;
    }

    .blob-3 {
      top: 40%;
      left: 40%;
      width: 400px;
      height: 400px;
      background: rgba(0, 230, 118, 0.1);
      animation-delay: -10s;
    }

    /* Glass Panel */
    .glass-panel {
      background: rgba(30, 41, 59, 0.4);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }

    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-hover:hover {
      transform: translateY(-5px);
      background: rgba(30, 41, 59, 0.8);
      border-color: rgba(255, 255, 255, 0.25);
      box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.3);
    }

    /* Filter Pills */
    .filter-pill {
      transition: all 0.2s;
      cursor: pointer;
      user-select: none;
    }

    .filter-pill.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border-color: rgba(255, 255, 255, 0.3);
      font-weight: 700;
    }

    /* Modal & Loader */
    #game-modal {
      position: fixed;
      inset: 0;
      z-index: 100;
      background: #0f172a;
      display: none;
      flex-direction: column;
      animation: fadeIn 0.2s ease-out;
    }

    .loader {
      width: 48px;
      height: 48px;
      border: 5px solid #fff;
      border-bottom-color: transparent;
      border-radius: 50%;
      display: inline-block;
      box-sizing: border-box;
      animation: rotation 1s linear infinite;
    }

    @keyframes rotation {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Info Overlay */
    #info-overlay {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(8px);
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #0f172a;
    }

    ::-webkit-scrollbar-thumb {
      background: #334155;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #475569;
    }

    .loader {
      width: 32px;
      height: 32px;
      border: 3px solid #fff;
      border-bottom-color: transparent;
      border-radius: 50%;
      display: inline-block;
      box-sizing: border-box;
      animation: rotation 1s linear infinite;
    }

    @keyframes rotation {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body class="min-h-screen flex flex-col selection:bg-pink selection:text-white">
  <div class="ambient-bg">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <header class="sticky top-0 z-50 glass-panel border-b-0">
    <div class="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
      <div class="flex items-center gap-3 select-none cursor-pointer"
        onclick="window.location.hash=''; window.location.reload()">
        <div
          class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue to-green flex items-center justify-center shadow-lg shadow-green/20">
          <span class="text-xl">ðŸš€</span>
        </div>
        <div>
          <h1 class="text-2xl font-heading tracking-wider leading-none">
            English 1 Batam
          </h1>
          <p class="text-[10px] text-gray-400 font-bold tracking-[0.2em] uppercase">
            Teacher Hub
          </p>
        </div>
      </div>

      <div class="hidden md:block flex-1 max-w-md mx-8">
        <div class="relative group">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i data-lucide="search" class="h-4 w-4 text-gray-400 group-focus-within:text-blue transition-colors"></i>
          </div>
          <input type="text" id="search-input"
            class="block w-full pl-10 pr-3 py-2 bg-black/20 border border-white/10 rounded-lg text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:bg-black/40 focus:border-blue/50 transition-all"
            placeholder="Type to search activities" onkeyup="App.filterGames()" />
          <div class="absolute inset-y-0 right-0 pr-2 flex items-center">
            <kbd
              class="hidden group-focus-within:hidden lg:inline-block px-1.5 py-0.5 text-[10px] font-mono text-gray-500 border border-gray-700 rounded bg-gray-800/50">/</kbd>
          </div>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button class="p-2 text-gray-400 hover:text-white transition-colors" onclick="App.openFeedback()"
          aria-label="Feedback" title="Send Feedback">
          <i data-lucide="message-circle" class="w-6 h-6"></i>
        </button>
      </div>
    </div>
  </header>

  <main class="flex-grow max-w-7xl mx-auto px-4 py-8 w-full z-10 relative">
    <section class="mb-10 animate-slide-up">
      <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
        <div>
          <div
            class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue/10 border border-blue/20 text-blue text-xs font-bold mb-3">
            <span class="w-2 h-2 rounded-full bg-blue animate-pulse"></span>
            <span id="date-display">...</span>
          </div>
          <h2 id="greeting-display" class="text-4xl md:text-5xl font-heading tracking-wide text-white mb-1">
            Hello, Teacher!
          </h2>
          <p class="text-gray-400 text-sm md:text-base max-w-lg">
            Ready for class? Select a tool below or jump back into your last
            activity.
          </p>
        </div>

        <!-- REPLACED old recent-widget with container for up to 3 recently used tools -->
        <div id="recent-widget-container" class="hidden flex flex-col gap-2">
          <p class="text-[10px] text-gray-400 font-bold tracking-[0.2em] uppercase pl-1">
            Recently Used
          </p>
          <!-- MODIFIED: Changed flex-col to flex-row for horizontal stacking -->
          <div id="recent-list" class="flex flex-row gap-2">
            <!-- Recent buttons will be injected here by JavaScript -->
          </div>
        </div>
      </div>
    </section>

    <div class="flex flex-wrap items-center gap-2 mb-8 animate-slide-up" style="animation-delay: 0.1s">
      <button onclick="App.setFilter('all')"
        class="filter-pill active px-4 py-1.5 rounded-full border border-transparent text-sm text-gray-400 hover:text-white"
        data-filter="all">
        All
      </button>
      <button onclick="App.setFilter('tool')"
        class="filter-pill px-4 py-1.5 rounded-full border border-transparent text-sm text-gray-400 hover:text-white"
        data-filter="tool">
        Tools
      </button>
      <button onclick="App.setFilter('game')"
        class="filter-pill px-4 py-1.5 rounded-full border border-transparent text-sm text-gray-400 hover:text-white"
        data-filter="game">
        Games
      </button>
    </div>

    <div class="md:hidden mb-8">
      <input type="text"
        class="block w-full px-4 py-3 bg-dark/50 border border-white/10 rounded-xl text-gray-200 focus:outline-none focus:border-blue/50"
        placeholder="Search..." onkeyup="App.filterGames(this.value)" />
    </div>

    <section class="mb-12 animate-slide-up" id="featured-section" style="animation-delay: 0.1s">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="featured-grid"></div>
    </section>

    <section class="mb-12 animate-slide-up" style="animation-delay: 0.2s">
      <h3 id="section-title"
        class="text-xl font-heading tracking-wider text-white/50 mb-4 border-b border-white/5 pb-2">
        All Activities
      </h3>
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 md:gap-4" id="main-grid"></div>
    </section>

    <div id="no-results" class="hidden flex flex-col items-center justify-center py-20 text-gray-500 animate-fade-in">
      <div class="w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mb-4">
        <i data-lucide="search-x" class="w-8 h-8 opacity-50"></i>
      </div>
      <p class="text-lg font-bold">No results found</p>
      <p class="text-sm">Try searching for "timer" or "vocabulary"</p>
    </div>
  </main>

  <footer class="border-t border-white/5 mt-auto py-8 text-center">
    <p class="text-gray-500 text-sm font-mono">&copy; 2025 English 1 Batam. Made and maintained by Mr.Fahrul</p>
  </footer>

  <div id="game-modal">
    <div
      class="h-14 flex items-center justify-between px-4 md:px-6 bg-dark border-b border-white/10 shrink-0 select-none relative z-20">
      <div class="flex items-center gap-3">
        <button onclick="App.closeGame()" class="md:hidden p-2 -ml-2 text-gray-400 hover:text-white">
          <i data-lucide="chevron-left" class="w-6 h-6"></i>
        </button>
        <div class="flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-green animate-pulse"></span>
          <span id="active-game-title" class="text-gray-200 font-bold text-sm tracking-wide">ACTIVITY</span>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button onclick="App.toggleInfo()"
          class="p-2 text-blue hover:text-white hover:bg-blue/20 rounded-lg transition-colors" title="How to use">
          <i data-lucide="info" class="w-4 h-4"></i>
        </button>

        <button onclick="document.getElementById('game-frame').contentWindow.location.reload()"
          class="p-2 text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition-colors hidden md:block"
          title="Reload">
          <i data-lucide="refresh-cw" class="w-4 h-4"></i>
        </button>

        <button onclick="App.closeGame()"
          class="bg-white/5 hover:bg-red-500/20 text-gray-300 hover:text-red-400 px-3 py-1.5 rounded-lg flex items-center gap-2 transition-all group ml-2 border border-white/5 hover:border-red-500/30">
          <span class="font-bold text-xs hidden md:inline">CLOSE</span>
          <i data-lucide="x" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
        </button>
      </div>
    </div>

    <div id="info-overlay"
      class="absolute inset-0 top-14 z-30 hidden animate-fade-in flex-col items-center justify-center p-4">
      <div
        class="glass-panel w-full max-w-lg rounded-2xl p-8 animate-pop border border-white/10 shadow-2xl relative overflow-hidden">
        <div class="absolute -top-10 -right-10 w-40 h-40 bg-blue/20 rounded-full blur-3xl pointer-events-none"></div>
        <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-pink/20 rounded-full blur-3xl pointer-events-none"></div>

        <div class="relative z-10">
          <div class="flex items-start justify-between mb-6">
            <div class="flex items-center gap-3">
              <div id="info-icon-container"
                class="w-12 h-12 rounded-xl bg-blue/20 text-blue flex items-center justify-center"></div>
              <div>
                <h2 id="info-title" class="text-2xl font-heading tracking-wide text-white leading-none">
                  Title
                </h2>
                <span id="info-category"
                  class="text-xs font-bold text-gray-400 uppercase tracking-widest">Category</span>
              </div>
            </div>
            <button onclick="App.toggleInfo()"
              class="p-1 hover:bg-white/10 rounded-lg transition text-gray-400 hover:text-white">
              <i data-lucide="x" class="w-6 h-6"></i>
            </button>
          </div>

          <div class="bg-black/30 rounded-xl p-5 mb-6 border border-white/5">
            <h3 class="text-sm font-bold text-gray-300 uppercase tracking-wide mb-3 flex items-center gap-2">
              <i data-lucide="book-open" class="w-4 h-4 text-orange"></i> How
              to use
            </h3>
            <div id="info-guide" class="text-gray-300 space-y-2 text-sm leading-relaxed"></div>
          </div>

          <button onclick="App.toggleInfo()"
            class="w-full btn-3d bg-blue hover:bg-blue/80 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-blue/20">
            GOT IT!
          </button>
        </div>
      </div>
    </div>

    <div id="modal-loader" class="absolute inset-0 top-14 flex flex-col items-center justify-center bg-dark z-0">
      <span class="loader mb-4"></span>
      <span class="text-gray-500 text-sm font-mono animate-pulse">Loading Activity...</span>
    </div>

    <iframe id="game-frame" src=""
      class="w-full h-full border-none relative z-10 opacity-0 transition-opacity duration-300"
      onload="this.classList.remove('opacity-0'); document.getElementById('modal-loader').style.display='none';"></iframe>
  </div>

  <div id="feedback-modal"
    class="fixed inset-0 z-[110] bg-black/80 backdrop-blur-sm hidden flex-col items-center justify-center p-4 animate-fade-in"
    style="display: none">
    <div
      class="glass-panel w-full max-w-2xl h-[80vh] rounded-2xl flex flex-col overflow-hidden shadow-2xl relative border border-white/10">
      <div class="flex items-center justify-between p-4 border-b border-white/10 bg-dark/90">
        <h3 class="text-lg font-heading tracking-wide text-white flex items-center gap-2">
          <i data-lucide="message-circle" class="text-blue"></i> Feedback
        </h3>
        <button onclick="App.closeFeedback()"
          class="text-gray-400 hover:text-white transition bg-white/5 hover:bg-white/10 p-1.5 rounded-lg">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <div class="flex-grow bg-white relative">
        <div class="absolute inset-0 flex flex-col items-center justify-center text-gray-500 z-0">
          <span class="loader border-gray-400 border-b-transparent mb-2"></span>
          <span class="text-xs font-mono uppercase tracking-widest">Loading Form...</span>
        </div>
        <iframe id="feedback-frame" class="w-full h-full relative z-10" src="" frameborder="0" marginheight="0"
          marginwidth="0">Loadingâ€¦</iframe>
      </div>
    </div>
  </div>

  <script>
    /**
     * ENGLISH 1 BATAM - DASHBOARD CONTROLLER
     */

    const Config = { helpUrl: "https://forms.gle/VRqg4f3KFHoJXFUu9" };

    // Generic Guide Text
    const Guides = {
      tool: "<ul class='list-disc pl-4 space-y-1'><li>Adjust settings using the on-screen controls.</li><li>Use fullscreen mode for better visibility.</li><li>Use 'Reset' to clear current data.</li></ul>",
      game: "<ul class='list-disc pl-4 space-y-1'><li>Follow the on-screen prompts to start.</li><li>Use the 'Setup' button (if available) to customize words.</li><li>Click the 'Sound' icon to toggle audio.</li></ul>",
      card: "<ul class='list-disc pl-4 space-y-1'><li>Click 'Setup' to add your own words/images.</li><li>Click cards to flip them.</li><li>Find all matching pairs to win!</li></ul>",
    };

    // Data Definition
    // NOTE: This data is internally sorted by title in App.renderGrid()
    const GameData = [
      // --- TOOLS ---
      {
        id: "clockcalendar",
        title: "Clock",
        category: "tool",
        path: "./clock/index.html",
        icon: "clock",
        color: "text-pink",
        description: "Time & Calendar",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Modes:</strong> Switch between a clock, timer, stopwatch or a calender.</li><li><strong>Timer:</strong> Use the built-in stopwatch/timer.</li><li><strong>Display:</strong> Toggle Full Screen for visibility.</li></ul>",
      },
      {
        id: "whiteboard",
        title: "Whiteboard",
        category: "tool",
        path: "./whiteboard/index.html",
        icon: "pen-tool",
        color: "text-blue",
        description: "Draw & Explain",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Draw:</strong> Select colors from the toolbar.</li><li><strong>Undo:Click the undo button to reverse the action</strong> .</li><li><strong>Clear:</strong> Trash icon erases the board.</li></ul>",
      },
      {
        id: "scoreboard",
        title: "Scoreboard",
        category: "tool",
        path: "./scorecounter/index.html",
        icon: "trophy",
        color: "text-blue",
        description: "Track Points",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Team:</strong> Add the team through the team name box and add.</li><li><strong>Points:</strong> Tap numbers or +/- to adjust scores.</li><li><strong>Reset:</strong> Use the refresh button to start over.</li></ul>",
      },
      {
        id: "classtally",
        title: "Class Tally",
        category: "tool",
        path: "./class-tally/index.html",
        icon: "star",
        color: "text-yellow-400",
        description: "Behavior Tracker",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Setup:</strong> Add student names in settings.</li><li><strong>Reward/Warn:</strong> Click a name to add a Star/Warning.</li><li><strong>Rule:</strong> Clik the sign button on the panel and create your own costum rule for your class.</li></ul>",
      },
      {
        id: "teampicker",
        title: "Team Picker",
        category: "tool",
        path: "./team-picker/index.html",
        icon: "users",
        color: "text-green",
        description: "Random Groups",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Input:</strong> Paste list of student names.</li><li><strong>Config:</strong> Choose number of teams.</li><li><strong>Go:</strong> Click 'Pick Teams' to randomize.</li></ul>",
      },
      {
        id: "taskassigner",
        title: "Task Assigner",
        category: "tool",
        path: "./task-assigner/index.html",
        icon: "clipboard-list",
        color: "text-orange",
        description: "Assign Roles",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Lists:</strong> Enter Names and Tasks.</li><li><strong>Assign:</strong> Randomly pairs students with tasks.</li><li><strong>Redo:</strong> Click again to shuffle the roles.</li></ul>",
      },
      {
        id: "lessonnotes",
        title: "Notes",
        category: "tool",
        path: "./lesson-note/index.html",
        icon: "notebook-pen",
        color: "text-orange",
        description: "Lesson Plans",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Type:</strong> Write lesson notes/reminders.</li><li><strong>Save:</strong> Auto-saves to local storage.</li><li><strong>Edit:</strong> Text stays until deleted.</li></ul>",
      },
      {
        id: "wordlist",
        title: "Word List",
        category: "tool",
        path: "./random-word-list/index.html",
        icon: "list",
        color: "text-pink",
        description: "Random Picker",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Setup:</strong> Input a list of words or names.</li><li><strong>Randomize:</strong> Click generate to generate a random list.</li><li><strong>Option:</strong> Pick the number of list you want to generate.</li></ul>",
      },
      {
        id: "presentations",
        title: "Slides",
        category: "tool",
        path: "./presentation-maker/index.html",
        icon: "monitor-play",
        color: "text-purple-400",
        description: "Quick Slides",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Input:</strong> Write down the text you want to put in a slide.</li><li><strong>Seperation:</strong> Seperate the slide using a semicolon ':'.</li><li><strong>Navigation:</strong> Arrow keys to change slides.</li></ul>",
      },
      {
        id: "scrambler",
        title: "Scrambler",
        category: "tool",
        path: "./word-scrambler/index.html",
        icon: "shuffle",
        color: "text-orange",
        description: "Word Mixer",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Enter:</strong> Type a word to scramble.</li><li><strong>Show:</strong> Displays mixed letters for students.</li><li><strong>Solve:</strong> Students guess the original spelling.</li></ul>",
      },
      {
        id: "spinwheel",
        title: "Spin Wheel",
        category: "tool",
        path: "./spin-the-wheel/index.html",
        icon: "pie-chart",
        color: "text-pink",
        description: "Randomizer",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Edit:</strong> Customize wheel segments with names.</li><li><strong>Spin:</strong> Click center or Spacebar.</li><li><strong>Sound:</strong> Toggle audio on/off.</li></ul>",
      },

      // --- GAMES ---
      {
        id: "cardmatch",
        title: "Card Match",
        category: "game",
        path: "./card-match/index.html",
        icon: "layers",
        color: "text-blue",
        description: "Memory Game",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Setup:</strong> Create pairs (Word/Def).</li><li><strong>Play:</strong> Flip cards to match.</li><li><strong>Goal:</strong> Clear board in fewest moves.</li></ul>",
      },
      {
        id: "findball",
        title: "Magic Cups",
        category: "game",
        path: "./find-the-ball/index.html",
        icon: "help-circle",
        color: "text-orange",
        description: "Find the hidden ball.",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Setup:</strong> Label cups with words (e.g., 'Verb').</li><li><strong>Shuffle:</strong> Watch the cups closely.</li><li><strong>Pick:</strong> Use the cup label (e.g., 'Verb') to make your final choice.</li></ul>",
      },
      {
        id: "guessemoji",
        title: "Guess the Emoji",
        category: "game",
        path: "./emoji-game/index.html",
        icon: "smile",
        color: "text-green",
        description: "Guess the English word or phrase represented by the emojis.",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Read:</strong> Look at the sequence of emojis.</li><li><strong>Infer:</strong> Figure out the corresponding word, phrase, or idiom.</li><li><strong>Input:</strong> Type your answer into the console and press Enter.</li></ul>",
      },
      {
        id: "freezedance",
        title: "Freeze Dance",
        category: "game",
        path: "./freeze-dance/index.html",
        icon: "music",
        color: "text-green",
        description: "Movement",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Start:</strong> Play music for dancing.</li><li><strong>Stop:</strong> Music pauses randomly (Auto-Freeze).</li><li><strong>Rule:</strong> Moving during quiet = Out.</li></ul>",
      },
      {
        id: "crossword",
        title: "Crossword",
        category: "game",
        path: "./crossword/index.html",
        icon: "pencil",
        color: "text-gray-400",
        description: "Puzzle Maker",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Data:</strong> Enter words and clues.</li><li><strong>Grid:</strong> Auto-generates a puzzle layout.</li><li><strong>Use:</strong> Solve on board or print.</li></ul>",
      },
      {
        id: "wordsearch",
        title: "Word Search",
        category: "game",
        path: "./word-search/index.html",
        icon: "grid",
        color: "text-pink",
        description: "Find Words",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Words:</strong> Enter vocabulary list to hide.</li><li><strong>Size:</strong> Choose grid size (Easy to Hard).</li><li><strong>Find:</strong> Highlight words in the grid.</li></ul>",
      },
      {
        id: "worddisplay",
        title: "Word Display",
        category: "game",
        path: "./random-word-display/index.html",
        icon: "tv",
        color: "text-teal-400",
        description: "Flash Words",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>List:</strong> Paste vocabulary list.</li><li><strong>Show:</strong> Shows one big word at a time.</li><li><strong>Auto:</strong> Cycle words automatically for drills.</li></ul>",
      },
      {
        id: "hotseat",
        title: "Hot Seat",
        category: "game",
        path: "./hot-seat/index.html",
        icon: "flame",
        color: "text-orange",
        description: "Guessing",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Sit:</strong> Student faces away from board.</li><li><strong>Clue:</strong> Class describes hidden word.</li><li><strong>Guess:</strong> Seated student must guess the word.</li></ul>",
      },
      {
        id: "storydice",
        title: "Story Dice",
        category: "game",
        path: "./story-dice/index.html",
        icon: "dices",
        color: "text-pink",
        description: "Story Prompts",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Roll:</strong> Generate random story icons.</li><li><strong>Tell:</strong> Make sentence connecting icons.</li><li><strong>Add:</strong> Increase dice count for difficulty.</li></ul>",
      },
      {
        id: "hangman",
        title: "Hangman",
        category: "game",
        path: "./hangman/index.html",
        icon: "skull",
        color: "text-red-400",
        description: "Vocab Game",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Secret:</strong> Type word to hide it.</li><li><strong>Play:</strong> Students guess letters.</li><li><strong>Risk:</strong> Wrong guesses build drawing.</li></ul>",
      },
      //  {
      //    id: "detective-game",
      //    title: "Detective",
      //    category: "game",
      //    path: "./detective-game/index.html",
      //    icon: "search",
      //    color: "text-yellow-400",
      //    description: "Mystery Reading",
      //    guide:
      //      "<ul class='list-disc pl-4 space-y-1'><li><strong>Story:</strong> Read the case intro to class.</li><li><strong>Clues:</strong> Reveal evidence one by one.</li><li><strong>Solve:</strong> Deduce answer from clues.</li></ul>",
      //  },
      {
        id: "reveal-picture-game",
        title: "Reveal Pic",
        category: "game",
        path: "./reveal-picture-game/index.html",
        icon: "image",
        color: "text-green",
        description: "Image Guess",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Load:</strong> Upload image to hide.</li><li><strong>Click:</strong> Remove tiles to reveal.</li><li><strong>Guess:</strong> Identify image with least reveals.</li></ul>",
      },
      {
        id: "secret-code",
        title: "Secret Code",
        category: "game",
        path: "./secret-code/index.html",
        icon: "lock-keyhole",
        color: "text-yellow-500",
        description: "Decryption",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Type:</strong> Enter message to encrypt.</li><li><strong>Key:</strong> Show cipher key to class.</li><li><strong>Task:</strong> Students decode message.</li></ul>",
      },
      {
        id: "unscramble",
        title: "Unscramble",
        category: "game",
        path: "./unscramble/index.html",
        icon: "type",
        color: "text-indigo-400",
        description: "Spelling Fix",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>List:</strong> Add words to settings.</li><li><strong>Mix:</strong> Shows scrambled word.</li><li><strong>Fix:</strong> Write correct spelling.</li></ul>",
      },
      {
        id: "sentence-unscrambler",
        title: "Sentence Fix",
        category: "game",
        path: "./sentence-unscrambler/index.html",
        icon: "align-left",
        color: "text-purple-400",
        description: "Grammar Order",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Input:</strong> Enter correct sentence.</li><li><strong>Mix:</strong> Words get shuffled.</li><li><strong>Sort:</strong> Drag words to fix order.</li></ul>",
      },
      {
        id: "story-ordering",
        title: "Story Order",
        category: "game",
        path: "./story-ordering/index.html",
        icon: "book-open",
        color: "text-teal-400",
        description: "Logic Sort",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Text:</strong> Input story paragraphs.</li><li><strong>Mix:</strong> Randomizes block order.</li><li><strong>Sort:</strong> Drag blocks to rebuild.</li></ul>",
      },
      {
        id: "word-flashcard",
        title: "Flashcards",
        category: "game",
        path: "./word-flashcard/index.html",
        icon: "copy",
        color: "text-indigo-400",
        description: "Review",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Flip:</strong> Click to see definition.</li><li><strong>Nav:</strong> Arrow keys for next card.</li><li><strong>Mix:</strong> Shuffle deck for review.</li></ul>",
      },
      {
        id: "random-card-shuffle",
        title: "Shuffle",
        category: "game",
        path: "./random-card-shuffle/index.html",
        icon: "box",
        color: "text-gray-400",
        description: "Utility",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>List:</strong> Enter items (names/topics).</li><li><strong>Mix:</strong> Randomizes order instantly.</li><li><strong>Use:</strong> Good for speaking turns.</li></ul>",
      },
      {
        id: "connects",
        title: "Connects",
        category: "game",
        path: "./connect-n/index.html",
        icon: "grid-3x3", // Reflects the game's theme
        color: "text-blue",
        description: "Variable grid size strategy game.",
        guide:
          "<ul class='list-disc pl-4 space-y-1'><li><strong>Setup:</strong> Select grid size (3x3, 5x5, or 7x7).</li><li><strong>Objective:</strong> Be the first to connect N marks horizontally, vertically, or diagonally.</li><li><strong>Win Condition:</strong> N = 3 for 3x3 grids; N = 4 for 5x5 grids; N = 5 for 7x7 grids.</li></ul>",
      }
    ];

    // --- Logic ---
    const App = {
      currentFilter: "all",
      // Removed lastId property, now using recentGameIds array
      activeGame: null,

      init: () => {
        App.updateGreeting();
        App.renderGrid();
        // Updated: Call renderRecentList to initialize the recent widget
        App.renderRecentList();

        // Hotkey for search
        document.addEventListener("keydown", (e) => {
          if (e.key === "/" && document.activeElement.tagName !== "INPUT") {
            e.preventDefault();
            document.getElementById("search-input").focus();
          }
          if (e.key === "Escape") {
            if (
              !document
                .getElementById("info-overlay")
                .classList.contains("hidden")
            )
              App.toggleInfo();
            else App.closeGame();
          }
        });

        // Check Hash
        const hash = window.location.hash.substring(1);
        if (hash) App.openGame(hash);
      },

      updateGreeting: () => {
        const hour = new Date().getHours();
        const greeting =
          hour < 12
            ? "Good Morning"
            : hour < 18
              ? "Good Afternoon"
              : "Good Evening";
        document.getElementById(
          "greeting-display"
        ).innerText = `${greeting}, Teacher!`;

        const options = { weekday: "long", month: "long", day: "numeric" };
        document.getElementById("date-display").innerText =
          new Date().toLocaleDateString("en-US", options);
      },

      // NEW: Function to load and manage the recent list from localStorage
      getRecentIds: () => {
        try {
          const recent = localStorage.getItem("recentGameIds");
          return recent ? JSON.parse(recent) : [];
        } catch (e) {
          console.error("Error loading recent IDs:", e);
          return [];
        }
      },

      // NEW: Renders the list of recently used tools (max 3)
      renderRecentList: () => {
        const recentIds = App.getRecentIds();
        const container = document.getElementById("recent-list");
        const widgetContainer = document.getElementById("recent-widget-container");

        if (!container || !widgetContainer) return;

        container.innerHTML = '';

        if (recentIds.length > 0) {
          widgetContainer.classList.remove("hidden");

          // Map IDs to GameData, filtering out any missing games
          const recentGames = recentIds
            .map(id => GameData.find(g => g.id === id))
            .filter(g => g);

          recentGames.forEach(game => {
            const card = `
                        <button
                            onclick="App.openGame('${game.id}')"
                            class="glass-panel hover:bg-white/10 px-4 py-2.5 rounded-xl flex items-center gap-3 transition-all group text-left border border-white/5 hover:border-white/20 flex-shrink-0 w-40"
                        >
                            <div class="w-8 h-8 rounded-lg bg-surface/50 flex items-center justify-center ${game.color}">
                                <i data-lucide="${game.icon}" class="w-4 h-4"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="font-bold text-sm text-white truncate">${game.title}</div>
                            </div>
                            <i
                                data-lucide="arrow-right"
                                class="w-4 h-4 text-gray-500 group-hover:text-green transition-transform group-hover:translate-x-0.5"
                            ></i>
                        </button>
                    `;
            container.innerHTML += card;
          });
        } else {
          widgetContainer.classList.add("hidden");
        }
        lucide.createIcons();
      },

      // REMOVED: checkRecent, resumeLast

      setFilter: (category) => {
        App.currentFilter = category;
        // Update Pills
        document.querySelectorAll(".filter-pill").forEach((btn) => {
          if (btn.dataset.filter === category) btn.classList.add("active");
          else btn.classList.remove("active");
        });
        App.renderGrid();
      },

      filterGames: (val) => {
        const query = (
          val || document.getElementById("search-input").value
        ).toLowerCase();
        App.renderGrid(query);
      },

      renderGrid: (searchQuery = "") => {
        const container = document.getElementById("main-grid");
        const featuredContainer = document.getElementById("featured-grid");
        container.innerHTML = "";

        // SORTING: Sort the GameData array alphabetically by title
        const sortedGameData = [...GameData].sort((a, b) =>
          a.title.localeCompare(b.title)
        );

        // If searching, hide Featured to reduce noise
        if (searchQuery) {
          document.getElementById("featured-section").classList.add("hidden");
          document.getElementById("section-title").innerText =
            "Search Results";
        } else {
          document
            .getElementById("featured-section")
            .classList.toggle("hidden", App.currentFilter !== "all");
          document.getElementById("section-title").innerText =
            App.currentFilter === "all"
              ? "All Activities"
              : App.currentFilter === "tool"
                ? "Classroom Tools"
                : "Learning Games";

          // Render Featured only if no search & filter is all
          if (App.currentFilter === "all") {
            featuredContainer.innerHTML = "";
            // Pick random featured (using original GameData for randomized picks)
            const tools = GameData.filter((g) => g.category === "tool")
              .sort(() => 0.5 - Math.random())
              .slice(0, 2);
            const games = GameData.filter((g) => g.category === "game")
              .sort(() => 0.5 - Math.random())
              .slice(0, 2);
            [...tools, ...games].forEach((item) => {
              featuredContainer.innerHTML += App.createCard(item, true);
            });
          }
        }

        let visibleCount = 0;
        // Use the sorted array for rendering the main grid
        sortedGameData.forEach((item) => {
          // Filter Logic
          if (
            App.currentFilter !== "all" &&
            item.category !== App.currentFilter
          )
            return;
          if (
            searchQuery &&
            !item.title.toLowerCase().includes(searchQuery) &&
            !item.description.toLowerCase().includes(searchQuery)
          )
            return;

          container.innerHTML += App.createCard(item, false);
          visibleCount++;
        });

        document
          .getElementById("no-results")
          .classList.toggle("hidden", visibleCount > 0);
        lucide.createIcons();
      },

      createCard: (item, isFeatured) => {
        if (isFeatured) {
          return `
                    <a href="${item.path}" onclick="App.openGame('${item.id}'); return false;" 
                       class="glass-panel rounded-2xl p-6 card-hover group block relative overflow-hidden cursor-pointer border border-white/5">
                        <div class="absolute -right-4 -top-4 opacity-10 group-hover:opacity-20 transition-opacity rotate-12">
                            <i data-lucide="${item.icon}" class="w-32 h-32 ${item.color}"></i>
                        </div>
                        <div class="relative z-10">
                            <div class="w-12 h-12 rounded-xl bg-surface/50 border border-white/10 flex items-center justify-center mb-4 ${item.color}">
                                <i data-lucide="${item.icon}" class="w-6 h-6"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-1 text-white">${item.title}</h3>
                            <p class="text-sm text-gray-400 font-medium">${item.description}</p>
                        </div>
                    </a>`;
        } else {
          return `
                    <a href="${item.path}" onclick="App.openGame('${item.id}'); return false;" 
                       class="glass-panel rounded-xl p-4 hover:bg-surface/60 transition-all flex flex-col items-center text-center gap-3 cursor-pointer group border border-white/5 hover:border-white/20">
                        <div class="w-10 h-10 rounded-lg bg-dark/50 group-hover:bg-dark group-hover:scale-110 transition-all flex items-center justify-center ${item.color} shadow-lg">
                            <i data-lucide="${item.icon}" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <span class="font-bold text-sm block text-gray-200 group-hover:text-white">${item.title}</span>
                            <span class="text-[10px] text-gray-500 uppercase tracking-wide group-hover:text-gray-400">${item.category}</span>
                        </div>
                    </a>`;
        }
      },

      openGame: (id) => {
        const game = GameData.find((g) => g.id === id);
        if (!game) return;

        App.activeGame = game;

        // START OF NEW RECENT LOGIC: Manage the array of recent IDs (max 3)
        let recentIds = App.getRecentIds();

        // 1. Remove ID if already exists to ensure it's moved to the front
        recentIds = recentIds.filter(recentId => recentId !== id);

        // 2. Add ID to the beginning
        recentIds.unshift(id);

        // 3. Keep only the top 3 items
        recentIds = recentIds.slice(0, 3);

        localStorage.setItem("recentGameIds", JSON.stringify(recentIds));
        App.renderRecentList(); // Refresh the recent widget
        // END OF NEW RECENT LOGIC

        document.getElementById("active-game-title").innerText =
          game.title.toUpperCase();
        document.getElementById("modal-loader").style.display = "flex";
        document.getElementById("game-frame").classList.add("opacity-0");

        const modal = document.getElementById("game-modal");
        modal.style.display = "flex";

        // Small timeout to allow UI to render before loading heavy iframe
        setTimeout(() => {
          document.getElementById("game-frame").src = game.path;
        }, 50);

        window.location.hash = id;
      },

      toggleInfo: () => {
        const overlay = document.getElementById("info-overlay");
        const isHidden = overlay.classList.contains("hidden");

        if (isHidden && App.activeGame) {
          // Populate Content
          document.getElementById("info-title").innerText =
            App.activeGame.title;
          document.getElementById("info-category").innerText =
            App.activeGame.category === "tool"
              ? "Classroom Tool"
              : "Learning Game";

          // Icon
          const iconContainer = document.getElementById(
            "info-icon-container"
          );
          iconContainer.innerHTML = `<i data-lucide="${App.activeGame.icon}" class="w-6 h-6"></i>`;
          iconContainer.className = `w-12 h-12 rounded-xl bg-surface/50 flex items-center justify-center ${App.activeGame.color}`;

          // Guide Text
          const guideText =
            App.activeGame.guide ||
            (App.activeGame.category === "tool" ? Guides.tool : Guides.game);
          document.getElementById("info-guide").innerHTML = guideText;

          overlay.classList.remove("hidden");
          lucide.createIcons();
        } else {
          overlay.classList.add("hidden");
        }
      },

      closeGame: () => {
        const modal = document.getElementById("game-modal");
        if (modal.style.display === "none") return;

        document.getElementById("info-overlay").classList.add("hidden");
        modal.style.display = "none";
        document.getElementById("game-frame").src = "";
        App.activeGame = null;

        // FIX: Wrap history.pushState in a try-catch block to prevent SecurityError
        // and fall back to setting the hash directly if pushState fails.
        try {
          history.pushState(
            "",
            document.title,
            window.location.pathname + window.location.search
          );
        } catch (e) {
          console.warn("Could not use history.pushState, falling back to location.hash=''");
          window.location.hash = ''; // Fallback for sandboxed environments
        }
      },

      openFeedback: () => {
        const modal = document.getElementById("feedback-modal");
        const frame = document.getElementById("feedback-frame");

        // Use the config URL.
        // TIP: For best results, use the long URL ending in 'viewform?embedded=true'
        frame.src = Config.helpUrl;

        modal.classList.remove("hidden");
        modal.style.display = "flex";
      },

      closeFeedback: () => {
        const modal = document.getElementById("feedback-modal");
        modal.classList.add("hidden");
        modal.style.display = "none";

        // Clear src to stop playing/loading
        document.getElementById("feedback-frame").src = "";
      },
    };

    window.onload = App.init;
  </script>
</body>

</html>