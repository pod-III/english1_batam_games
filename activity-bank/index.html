<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>English 1 Activity Bank</title>

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Nunito:wght@400;600;700;800&display=swap"
            rel="stylesheet"
        />

        <script src="https://cdn.tailwindcss.com"></script>

        <script src="https://unpkg.com/lucide@latest"></script>

        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            engPink: "#FF6B95",
                            engOrange: "#FF8C42",
                            engGreen: "#00E676",
                            engBlue: "#2979FF",
                            engDark: "#1e293b",
                            engChalk: "#f8fafc",
                        },
                        fontFamily: {
                            headings: ["Fredoka", "sans-serif"],
                            body: ["Nunito", "sans-serif"],
                        },
                        boxShadow: {
                            neo: "4px 4px 0px 0px rgba(30, 41, 59, 1)",
                            "neo-sm": "2px 2px 0px 0px rgba(30, 41, 59, 1)",
                            "neo-lg": "8px 8px 0px 0px rgba(30, 41, 59, 1)",
                        },
                    },
                },
            };
        </script>

        <script>
            if (
                localStorage.getItem("theme") === "dark" ||
                (!("theme" in localStorage) &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches)
            ) {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
        </script>

        <style>
            /* Graph Paper Background Pattern */
            .bg-graph {
                background-color: #f8fafc;
                background-image:
                    linear-gradient(#e2e8f0 1px, transparent 1px),
                    linear-gradient(90deg, #e2e8f0 1px, transparent 1px);
                background-size: 24px 24px;
            }

            .dark .bg-graph {
                background-color: #0f172a;
                background-image:
                    linear-gradient(#1e293b 1px, transparent 1px),
                    linear-gradient(90deg, #1e293b 1px, transparent 1px);
            }

            /* Interactive Elements */
            .btn-neo {
                transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .btn-neo:active:not(:disabled) {
                transform: translate(2px, 2px);
                box-shadow: 0px 0px 0px 0px rgba(30, 41, 59, 1);
            }
            .btn-neo:hover:not(:disabled) {
                transform: translate(-1px, -1px);
                box-shadow: 5px 5px 0px 0px rgba(30, 41, 59, 1);
            }

            /* Card Hover Effect */
            .card-hover {
                transition:
                    transform 0.2s ease,
                    box-shadow 0.2s ease;
            }
            .card-hover:hover {
                transform: translateY(-4px);
                box-shadow: 6px 6px 0px 0px rgba(30, 41, 59, 1);
            }

            /* Toast Animation */
            @keyframes slideUp {
                from {
                    transform: translate(-50%, 100%);
                    opacity: 0;
                }
                to {
                    transform: translate(-50%, 0);
                    opacity: 1;
                }
            }
            .toast-anim {
                animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
                    forwards;
            }

            /* Modal Animation */
            dialog[open] {
                animation: fadeIn 0.2s ease-out;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }
            dialog::backdrop {
                background: rgba(30, 41, 59, 0.5);
                backdrop-filter: blur(2px);
            }

            /* Staggered Entry for Cards */
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .card-enter {
                animation: fadeInUp 0.4s ease-out forwards;
            }

            /* Custom Scrollbar for Sidebar */
            .custom-scrollbar::-webkit-scrollbar {
                width: 8px;
            }
            .custom-scrollbar::-webkit-scrollbar-track {
                background: transparent;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 10px;
                border: 2px solid #f8fafc;
            }
            .dark .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #475569;
                border-color: #0f172a;
            }
        </style>
    </head>
    <body
        class="bg-graph text-engDark font-body min-h-screen p-4 md:p-8 selection:bg-engPink selection:text-white transition-colors duration-300"
    >
        <div
            class="max-w-[1600px] mx-auto flex flex-col xl:flex-row gap-8 items-start"
        >
            <aside
                id="lessonPanel"
                class="w-full xl:w-[400px] shrink-0 xl:sticky top-8 xl:h-[calc(100vh-4rem)] bg-engChalk dark:bg-slate-900 border-4 border-engDark rounded-3xl shadow-neo flex flex-col order-2 xl:order-1 overflow-hidden"
            >
                <div
                    class="p-6 border-b-4 border-engDark bg-white dark:bg-slate-800 flex justify-between items-center"
                >
                    <h2
                        class="font-headings text-2xl font-bold text-engDark dark:text-white flex items-center gap-2"
                    >
                        <i
                            data-lucide="bookmark"
                            class="w-6 h-6 text-engPink"
                        ></i>
                        Lesson Plan
                        <span
                            id="lessonCounter"
                            class="bg-engDark text-white text-xs font-bold px-2 py-1 rounded-full border-2 border-white hidden ml-2"
                            >0</span
                        >
                    </h2>
                </div>

                <div
                    class="flex-grow overflow-y-auto custom-scrollbar p-6 bg-graph"
                >
                    <div id="lessonEmptyState" class="text-center py-10">
                        <i
                            data-lucide="inbox"
                            class="w-12 h-12 text-slate-400 mx-auto mb-3"
                        ></i>
                        <p class="font-bold text-slate-500">
                            Your lesson plan is empty.
                        </p>
                        <p class="text-sm text-slate-400 mt-1">
                            Click the + button on any activity to add it here.
                        </p>
                    </div>
                    <ul id="lessonList" class="space-y-4"></ul>
                </div>

                <div
                    class="p-6 border-t-4 border-engDark bg-white dark:bg-slate-800"
                >
                    <button
                        onclick="openConfirmModal()"
                        id="clearLessonBtn"
                        class="w-full btn-neo bg-engDark text-white font-headings font-bold py-3 rounded-xl border-2 border-engDark shadow-neo disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none disabled:translate-y-0 disabled:active:transform-none flex justify-center items-center gap-2"
                        disabled
                    >
                        <i data-lucide="trash-2" class="w-5 h-5"></i> Clear Plan
                    </button>
                </div>
            </aside>

            <div class="flex-1 w-full flex flex-col gap-8 order-1 xl:order-2">
                <header
                    class="flex flex-col md:flex-row justify-between items-center gap-6"
                >
                    <div class="text-center md:text-left">
                        <h1
                            class="font-headings text-4xl md:text-6xl font-bold tracking-wide text-engDark"
                        >
                            <span
                                class="bg-engPink text-white px-6 py-2 rounded-2xl border-4 border-engDark shadow-neo inline-block -rotate-2 hover:rotate-0 transition-transform cursor-default"
                                >Activity</span
                            >
                            <span
                                class="bg-engBlue text-white px-6 py-2 rounded-2xl border-4 border-engDark shadow-neo inline-block rotate-2 hover:rotate-0 transition-transform cursor-default"
                                >Bank</span
                            >
                        </h1>
                    </div>

                    <div class="flex gap-4">
                        <button
                            onclick="toggleTheme()"
                            class="btn-neo bg-white dark:bg-slate-800 p-3 rounded-xl border-4 border-engDark shadow-neo"
                            aria-label="Toggle Dark Mode"
                        >
                            <i
                                data-lucide="moon"
                                class="w-6 h-6 text-engDark dark:hidden"
                            ></i>
                            <i
                                data-lucide="sun"
                                class="w-6 h-6 text-engOrange hidden dark:block"
                            ></i>
                        </button>
                    </div>
                </header>

                <section class="sticky top-4 z-20">
                    <div
                        class="bg-white/90 dark:bg-slate-800/90 backdrop-blur-md border-4 border-engDark rounded-2xl p-4 shadow-neo flex flex-col md:flex-row gap-4 items-center justify-between"
                    >
                        <div
                            class="flex flex-wrap justify-center gap-3 w-full md:w-auto"
                            id="filter-container"
                        >
                            <button
                                onclick="filterActivities('all')"
                                class="filter-btn active btn-neo font-headings font-bold bg-engDark text-white px-5 py-2 rounded-xl border-2 border-engDark shadow-neo-sm ring-offset-2 focus:ring-2"
                            >
                                All
                            </button>
                            <button
                                onclick="filterActivities('Stirrer')"
                                class="filter-btn btn-neo font-headings font-bold bg-engChalk text-engDark px-5 py-2 rounded-xl border-2 border-engDark shadow-neo-sm flex items-center gap-2 hover:bg-engOrange hover:text-white transition-colors"
                            >
                                <i data-lucide="zap" class="w-4 h-4"></i>
                                Stirrers
                            </button>
                            <button
                                onclick="filterActivities('Settler')"
                                class="filter-btn btn-neo font-headings font-bold bg-engChalk text-engDark px-5 py-2 rounded-xl border-2 border-engDark shadow-neo-sm flex items-center gap-2 hover:bg-engBlue hover:text-white transition-colors"
                            >
                                <i data-lucide="anchor" class="w-4 h-4"></i>
                                Settlers
                            </button>
                        </div>

                        <div class="relative w-full md:w-96 group">
                            <i
                                data-lucide="search"
                                class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-engPink transition-colors"
                            ></i>
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="Search skills, titles..."
                                class="w-full pl-12 pr-4 py-3 border-4 border-engDark rounded-xl font-bold bg-engChalk dark:bg-slate-700 dark:text-white focus:outline-none focus:border-engPink focus:shadow-[0_0_0_4px_rgba(255,107,149,0.3)] transition-all placeholder:font-semibold"
                            />
                        </div>
                    </div>
                </section>

                <main
                    id="activitiesGrid"
                    class="grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-8 pb-12"
                >
                    <div class="col-span-full text-center py-20 animate-pulse">
                        <div
                            class="inline-block p-4 rounded-full bg-slate-100 dark:bg-slate-800 mb-4"
                        >
                            <i
                                data-lucide="loader"
                                class="w-8 h-8 text-engBlue animate-spin"
                            ></i>
                        </div>
                        <p class="font-bold text-slate-400">
                            Loading your activities...
                        </p>
                    </div>
                </main>

                <div id="emptyState" class="hidden text-center py-20">
                    <div
                        class="inline-block p-6 rounded-full bg-slate-200 border-4 border-engDark mb-4"
                    >
                        <i
                            data-lucide="frown"
                            class="w-12 h-12 text-slate-500"
                        ></i>
                    </div>
                    <h3 class="font-headings text-2xl font-bold text-slate-600">
                        No activities found.
                    </h3>
                    <p class="text-slate-500 font-bold mt-2">
                        Try adjusting your filters or search terms.
                    </p>
                </div>
            </div>
        </div>

        <dialog
            id="guideModal"
            class="p-0 rounded-2xl border-4 border-engDark shadow-neo-lg bg-transparent backdrop:bg-slate-900/50 w-full max-w-2xl m-auto relative"
        >
            <div class="bg-white dark:bg-slate-800 flex flex-col max-h-[90vh]">
                <div
                    class="p-6 border-b-4 border-engDark flex justify-between items-center bg-engChalk dark:bg-slate-900"
                >
                    <h2
                        id="modalTitle"
                        class="font-headings text-3xl font-bold text-engDark dark:text-white"
                    >
                        Activity Title
                    </h2>
                    <button
                        onclick="closeModal()"
                        class="btn-neo bg-white dark:bg-slate-700 p-2 rounded-xl border-2 border-engDark hover:bg-slate-100"
                    >
                        <i
                            data-lucide="x"
                            class="w-6 h-6 text-engDark dark:text-white"
                        ></i>
                    </button>
                </div>

                <div class="p-8 overflow-y-auto custom-scrollbar">
                    <div class="flex gap-4 mb-6">
                        <span
                            id="modalType"
                            class="px-3 py-1 rounded-lg border-2 border-engDark font-bold text-sm bg-slate-200"
                            >Type</span
                        >
                        <span
                            id="modalTime"
                            class="px-3 py-1 rounded-lg border-2 border-engDark font-bold text-sm bg-slate-200"
                            >Time</span
                        >
                        <span
                            id="modalDiff"
                            class="px-3 py-1 rounded-lg border-2 border-engDark font-bold text-sm bg-slate-200"
                            >Diff</span
                        >
                    </div>

                    <div class="mb-8">
                        <h3
                            class="font-headings text-xl font-bold text-engBlue mb-3 flex items-center gap-2"
                        >
                            <i data-lucide="list-checks" class="w-5 h-5"></i>
                            Steps
                        </h3>
                        <ul
                            id="modalSteps"
                            class="space-y-3 text-slate-700 dark:text-slate-300 font-medium list-none"
                        ></ul>
                    </div>

                    <div
                        class="bg-engOrange/10 border-l-4 border-engOrange p-4 rounded-r-xl"
                    >
                        <h3
                            class="font-headings text-lg font-bold text-engOrange mb-2 flex items-center gap-2"
                        >
                            <i data-lucide="lightbulb" class="w-5 h-5"></i>
                            Teacher Tip / Variation
                        </h3>
                        <p
                            id="modalVariation"
                            class="text-slate-700 dark:text-slate-300 text-sm italic"
                        ></p>
                    </div>
                </div>

                <div
                    class="p-6 border-t-4 border-engDark bg-slate-50 dark:bg-slate-900 flex justify-between items-center gap-4 flex-wrap"
                >
                    <button
                        id="modalCopyBtn"
                        class="btn-neo bg-white dark:bg-slate-800 text-engDark dark:text-white font-headings font-bold px-5 py-3 rounded-xl border-2 border-engDark shadow-neo flex items-center gap-2 hover:bg-slate-100 dark:hover:bg-slate-700"
                    >
                        <i data-lucide="copy" class="w-5 h-5"></i> Copy Steps
                    </button>
                    <button
                        onclick="closeModal()"
                        class="btn-neo bg-engDark text-white font-headings font-bold px-8 py-3 rounded-xl border-2 border-engDark shadow-neo"
                    >
                        Got it!
                    </button>
                </div>
            </div>
        </dialog>

        <dialog
            id="confirmModal"
            class="p-0 rounded-2xl border-4 border-engDark shadow-neo-lg bg-transparent backdrop:bg-slate-900/50 w-full max-w-sm m-auto relative"
        >
            <div
                class="bg-white dark:bg-slate-800 flex flex-col p-6 text-center"
            >
                <div
                    class="inline-block p-4 rounded-full bg-red-100 border-4 border-engDark mx-auto mb-4"
                >
                    <i
                        data-lucide="alert-triangle"
                        class="w-8 h-8 text-red-500"
                    ></i>
                </div>
                <h3
                    class="font-headings text-2xl font-bold text-engDark dark:text-white mb-2"
                >
                    Clear Lesson Plan?
                </h3>
                <p class="text-slate-600 dark:text-slate-300 font-medium mb-6">
                    This will remove all activities from your current plan. You
                    cannot undo this.
                </p>
                <div class="flex gap-4 w-full">
                    <button
                        onclick="closeConfirmModal()"
                        class="flex-1 btn-neo bg-white dark:bg-slate-700 text-engDark dark:text-white font-bold py-2 rounded-xl border-2 border-engDark"
                    >
                        Cancel
                    </button>
                    <button
                        onclick="confirmClearLessonPlan()"
                        class="flex-1 btn-neo bg-engPink text-white font-bold py-2 rounded-xl border-2 border-engDark shadow-neo"
                    >
                        Yes, Clear It
                    </button>
                </div>
            </div>
        </dialog>

        <div
            id="toast"
            class="fixed bottom-10 left-1/2 transform -translate-x-1/2 hidden bg-engDark text-white px-6 py-3 rounded-xl border-2 border-engDark shadow-neo font-bold z-[100] flex items-center gap-2 w-max"
        >
            <i
                id="toastIcon"
                data-lucide="check-circle"
                class="w-5 h-5 text-engGreen"
            ></i>
            <span id="toastMsg">Action successful!</span>
        </div>

        <script>
            let activities = [];
            // Initialize Lesson Plan from LocalStorage
            let lessonPlan =
                JSON.parse(localStorage.getItem("lessonPlan")) || [];

            // --- FETCH LOGIC ---
            async function fetchActivities() {
                const grid = document.getElementById("activitiesGrid");
                try {
                    const response = await fetch("activities.json");
                    if (!response.ok)
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    activities = await response.json();
                    renderActivities(activities);
                    updateLessonPlanUI();
                    lucide.createIcons();
                } catch (error) {
                    console.error("Error loading activities:", error);
                    grid.innerHTML = `
                    <div class="col-span-full text-center py-10 bg-red-50 dark:bg-red-900/20 rounded-2xl border-2 border-red-200">
                        <i data-lucide="alert-triangle" class="w-10 h-10 text-red-500 mx-auto mb-2"></i>
                        <p class="font-bold text-red-600 dark:text-red-400">Failed to load activities.</p>
                        <p class="text-sm text-red-400 mt-1">Make sure 'activities.json' is in the same folder.</p>
                    </div>`;
                    lucide.createIcons();
                }
            }

            // --- RENDER LOGIC ---
            const grid = document.getElementById("activitiesGrid");
            const emptyState = document.getElementById("emptyState");
            const searchInput = document.getElementById("searchInput");
            const modal = document.getElementById("guideModal");

            function getDifficultyInfo(level) {
                switch (level) {
                    case "Easy":
                        return {
                            class: "bg-engGreen/20 text-engGreen border-engGreen",
                        };
                    case "Medium":
                        return {
                            class: "bg-engOrange/20 text-engOrange border-engOrange",
                        };
                    case "Hard":
                        return {
                            class: "bg-engPink/20 text-engPink border-engPink",
                        };
                    default:
                        return {
                            class: "bg-slate-200 text-slate-600 border-slate-400",
                        };
                }
            }

            function renderActivities(data) {
                grid.innerHTML = "";
                if (data.length === 0) {
                    emptyState.classList.remove("hidden");
                    return;
                } else {
                    emptyState.classList.add("hidden");
                }

                data.forEach((activity, index) => {
                    const isStirrer = activity.type === "Stirrer";
                    const headerColor = isStirrer
                        ? "bg-engOrange"
                        : "bg-engBlue";
                    const iconType = isStirrer ? "zap" : "anchor";
                    const isInLesson = lessonPlan.some(
                        (item) => item.id === activity.id,
                    );

                    const addBtnIcon = isInLesson ? "check" : "plus";
                    const addBtnClass = isInLesson
                        ? "bg-engGreen text-engDark"
                        : "bg-white text-engDark hover:bg-slate-100";

                    const card = document.createElement("article");
                    card.style.animationDelay = `${index * 50}ms`;
                    card.className =
                        "card-enter card-hover bg-white dark:bg-slate-800 rounded-2xl border-4 border-engDark shadow-neo overflow-hidden flex flex-col h-full relative group";

                    const skillsHtml = activity.skills
                        .map(
                            (skill) =>
                                `<span class="px-2 py-1 rounded-md border-2 border-engDark/10 bg-slate-100 dark:bg-slate-700 text-engDark dark:text-slate-300 font-bold text-[11px] uppercase tracking-wider">${skill}</span>`,
                        )
                        .join("");

                    card.innerHTML = `
                    <div class="${headerColor} p-4 border-b-4 border-engDark flex justify-between items-center relative overflow-hidden">
                        <span class="font-headings font-bold text-white text-lg flex items-center gap-2 relative z-10">
                            <i data-lucide="${iconType}" class="w-5 h-5"></i> ${activity.type.toUpperCase()}
                        </span>

                        <div class="flex items-center gap-2 relative z-10">
                             <span class="bg-white/20 text-white text-xs font-bold px-2 py-1 rounded-lg border-2 border-transparent flex items-center hidden sm:flex">
                                ${activity.time}
                            </span>
                            <button onclick="toggleLessonActivity(${activity.id})" class="btn-neo ${addBtnClass} w-8 h-8 rounded-lg border-2 border-engDark shadow-sm flex items-center justify-center transition-colors" title="${isInLesson ? "Remove from Lesson" : "Add to Lesson"}">
                                <i data-lucide="${addBtnIcon}" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    <div class="p-6 flex-grow flex flex-col relative">
                        <div class="mb-4 flex items-start justify-between">
                            <h2 class="font-headings text-2xl font-bold text-engDark dark:text-white leading-tight mr-2">${activity.title}</h2>
                            <div class="p-2 rounded-xl bg-slate-50 dark:bg-slate-700 border-2 border-engDark/10">
                                <i data-lucide="${activity.icon}" class="w-6 h-6 text-slate-400 dark:text-slate-300"></i>
                            </div>
                        </div>
                        <p class="text-slate-600 dark:text-slate-300 font-medium mb-6 text-sm leading-relaxed flex-grow">
                            ${activity.desc}
                        </p>
                        <div class="mt-auto pt-4 border-t-2 border-dashed border-slate-200 dark:border-slate-700">
                            <div class="flex flex-wrap gap-2">
                                ${skillsHtml}
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-slate-50 dark:bg-slate-900 border-t-4 border-engDark flex">
                        <button onclick="openModal(${activity.id})" class="w-full btn-neo bg-engDark text-white font-headings font-bold py-2 rounded-xl border-2 border-engDark shadow-neo flex justify-center items-center gap-2 group/btn">
                            View Guide <i data-lucide="arrow-right" class="w-4 h-4 group-hover/btn:translate-x-1 transition-transform"></i>
                        </button>
                    </div>
                `;
                    grid.appendChild(card);
                });
                lucide.createIcons();
            }

            // --- LESSON PLAN LOGIC ---
            function toggleLessonActivity(id) {
                const activity = activities.find((a) => a.id === id);
                if (!activity) return;

                const index = lessonPlan.findIndex((item) => item.id === id);

                if (index > -1) {
                    // Remove it
                    lessonPlan.splice(index, 1);
                    showToast("Removed from lesson plan", "info");
                } else {
                    // Add it
                    lessonPlan.push(activity);
                    showToast("Added to lesson plan", "check-circle");
                }

                // Save and update UI
                localStorage.setItem("lessonPlan", JSON.stringify(lessonPlan));
                applyFilters(); // Re-render main grid to update buttons
                updateLessonPlanUI();
            }

            function updateLessonPlanUI() {
                const counter = document.getElementById("lessonCounter");
                const list = document.getElementById("lessonList");
                const emptyState = document.getElementById("lessonEmptyState");
                const clearBtn = document.getElementById("clearLessonBtn");

                // Update Counter
                if (lessonPlan.length > 0) {
                    counter.innerText = lessonPlan.length;
                    counter.classList.remove("hidden");
                    emptyState.classList.add("hidden");
                    clearBtn.disabled = false;
                } else {
                    counter.classList.add("hidden");
                    emptyState.classList.remove("hidden");
                    clearBtn.disabled = true;
                }

                // Update Sidebar List
                list.innerHTML = lessonPlan
                    .map(
                        (act, index) => `
                    <li class="bg-white dark:bg-slate-800 p-4 rounded-xl border-2 border-engDark shadow-neo-sm flex flex-col gap-2">
                        <div class="flex justify-between items-start">
                            <h4 class="font-headings font-bold text-engDark dark:text-white leading-tight">${index + 1}. ${act.title}</h4>
                            <button onclick="toggleLessonActivity(${act.id})" class="text-slate-400 hover:text-red-500 transition-colors p-1">
                                <i data-lucide="trash" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded border border-engDark ${act.type === "Stirrer" ? "bg-engOrange text-white" : "bg-engBlue text-white"}">${act.type}</span>
                            <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded border border-engDark bg-slate-100 text-engDark"><i data-lucide="clock" class="w-3 h-3 inline pb-[2px]"></i> ${act.time}</span>
                        </div>
                    </li>
                `,
                    )
                    .join("");

                lucide.createIcons();
            }

            // --- CUSTOM MODALS ---
            const confirmModal = document.getElementById("confirmModal");

            function openConfirmModal() {
                confirmModal.showModal();
            }

            function closeConfirmModal() {
                confirmModal.close();
            }

            function confirmClearLessonPlan() {
                lessonPlan = [];
                localStorage.setItem("lessonPlan", JSON.stringify(lessonPlan));
                updateLessonPlanUI();
                applyFilters(); // refresh grid buttons
                closeConfirmModal();
                showToast("Lesson plan cleared", "trash");
            }

            // --- GUIDE MODAL LOGIC ---
            function openModal(id) {
                const act = activities.find((a) => a.id === id);
                if (!act) return;

                document.getElementById("modalTitle").innerText = act.title;
                document.getElementById("modalVariation").innerText =
                    act.variation;

                const typeBadge = document.getElementById("modalType");
                typeBadge.innerText = act.type;
                typeBadge.className = `px-3 py-1 rounded-lg border-2 border-engDark font-bold text-sm text-white ${act.type === "Stirrer" ? "bg-engOrange" : "bg-engBlue"}`;

                document.getElementById("modalTime").innerText = act.time;

                const diffInfo = getDifficultyInfo(act.difficulty);
                const diffBadge = document.getElementById("modalDiff");
                diffBadge.innerText = act.difficulty;
                diffBadge.className = `px-3 py-1 rounded-lg border-2 border-engDark font-bold text-sm ${diffInfo.class}`;

                const stepsList = document.getElementById("modalSteps");
                stepsList.innerHTML = act.steps
                    .map(
                        (step, i) => `
                <li class="flex gap-3 items-start">
                    <span class="flex-shrink-0 w-8 h-8 rounded-full bg-engDark text-white flex items-center justify-center font-bold text-sm border-2 border-engDark">${i + 1}</span>
                    <span class="mt-1">${step}</span>
                </li>`,
                    )
                    .join("");

                const copyBtn = document.getElementById("modalCopyBtn");
                copyBtn.onclick = () => {
                    const numberedText = act.steps
                        .map((step, index) => `${index + 1}. ${step}`)
                        .join("\\n");
                    copyToClipboard(numberedText);
                };

                modal.showModal();
            }

            function closeModal() {
                modal.close();
            }

            modal.addEventListener("click", (e) => {
                const rect = modal.getBoundingClientRect();
                const isInDialog =
                    rect.top <= e.clientY &&
                    e.clientY <= rect.top + rect.height &&
                    rect.left <= e.clientX &&
                    e.clientX <= rect.left + rect.width;
                if (!isInDialog) modal.close();
            });

            confirmModal.addEventListener("click", (e) => {
                const rect = confirmModal.getBoundingClientRect();
                const isInDialog =
                    rect.top <= e.clientY &&
                    e.clientY <= rect.top + rect.height &&
                    rect.left <= e.clientX &&
                    e.clientX <= rect.left + rect.width;
                if (!isInDialog) confirmModal.close();
            });

            // --- UTILS & FILTERS ---
            async function copyToClipboard(text) {
                const formattedText = text.replace(/\\n/g, "\n");
                try {
                    await navigator.clipboard.writeText(formattedText);
                    showToast("Steps copied!", "check-circle");
                } catch (err) {
                    const textarea = document.createElement("textarea");
                    textarea.value = formattedText;
                    textarea.setAttribute("readonly", "");
                    textarea.style.position = "fixed";
                    textarea.style.left = "-9999px";
                    document.body.appendChild(textarea);
                    textarea.select();
                    try {
                        document.execCommand("copy");
                        showToast("Steps copied!", "check-circle");
                    } catch (fallbackErr) {
                        console.error("Clipboard failed", fallbackErr);
                    } finally {
                        document.body.removeChild(textarea);
                    }
                }
            }

            function showToast(message, iconName) {
                const toast = document.getElementById("toast");
                document.getElementById("toastMsg").innerText = message;

                const iconElement = document.getElementById("toastIcon");
                let colorClass = "text-engGreen";
                if (iconName === "trash" || iconName === "info")
                    colorClass = "text-engOrange";

                iconElement.setAttribute("data-lucide", iconName);
                iconElement.className = `w-5 h-5 ${colorClass}`;
                lucide.createIcons();

                toast.classList.remove("hidden");
                toast.classList.add("toast-anim");

                if (window.toastTimeout) clearTimeout(window.toastTimeout);

                window.toastTimeout = setTimeout(() => {
                    toast.classList.add("hidden");
                    toast.classList.remove("toast-anim");
                }, 2500);
            }

            let currentFilter = "all";
            let currentSearch = "";

            function applyFilters() {
                const filtered = activities.filter((act) => {
                    const matchesCategory =
                        currentFilter === "all" || act.type === currentFilter;
                    const searchLower = currentSearch.toLowerCase();
                    const matchesSearch =
                        act.title.toLowerCase().includes(searchLower) ||
                        act.skills.some((s) =>
                            s.toLowerCase().includes(searchLower),
                        );
                    return matchesCategory && matchesSearch;
                });
                renderActivities(filtered);
            }

            function filterActivities(category) {
                currentFilter = category;
                const buttons = document.querySelectorAll(".filter-btn");
                buttons.forEach((btn) => {
                    btn.classList.remove("bg-engDark", "text-white");
                    btn.classList.add("bg-engChalk", "text-engDark");
                    if (
                        (category === "all" &&
                            btn.innerText.trim() === "All") ||
                        (category !== "all" &&
                            btn.innerText.includes(category + "s"))
                    ) {
                        btn.classList.remove("bg-engChalk", "text-engDark");
                        btn.classList.add("bg-engDark", "text-white");
                    }
                });
                applyFilters();
            }

            searchInput.addEventListener("input", (e) => {
                currentSearch = e.target.value;
                applyFilters();
            });

            function toggleTheme() {
                document.documentElement.classList.toggle("dark");
                const isDark =
                    document.documentElement.classList.contains("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
            }

            // --- INIT ---
            window.onload = () => {
                fetchActivities();
            };
        </script>
    </body>
</html>
