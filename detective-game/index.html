<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DETECTIVE: COLD CASE UNIT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Permanent+Marker&family=Special+Elite&family=Abril+Fatface&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* REFINED NOIR PALETTE */
            --noir-red: #8a0b0b;      /* Blood / Danger */
            --noir-amber: #d4af37;    /* Whiskey / Gold light */
            --noir-steel: #5f6e7c;    /* Cold / Metal */
            --noir-paper: #f0e6d2;    /* Aged Paper (Lighter) */
            --noir-folder: #c2b280;   /* Manila Folder */
            --noir-ink: #111111;      /* Deep Ink */
            
            --bg-night: #050505;
            --desk-dark: #1a120b;
            --desk-light: #3e2b1f;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }

        body {
            font-family: 'Courier Prime', monospace;
            background-color: var(--bg-night);
            color: var(--noir-ink);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            background: 
                radial-gradient(circle at 50% 30%, transparent 20%, #000 85%),
                repeating-linear-gradient(45deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.05) 2px, transparent 2px, transparent 6px),
                linear-gradient(to bottom, var(--desk-light), var(--desk-dark));
        }

        /* --- CINEMATIC FX --- */
        .fx-layer {
            position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; z-index: 1000;
        }
        
        .rain {
            width: 100%; height: 100%; position: absolute;
            opacity: 0.6;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.1'/%3E%3C/svg%3E");
        }
        .drop {
            position: absolute; width: 2px; height: 120px;
            background: linear-gradient(to bottom, transparent, rgba(200,200,255,0.2));
            animation: fall 0.6s linear infinite;
        }
        @keyframes fall { from { transform: translateY(-120px); } to { transform: translateY(110vh); } }

        .overlay {
            background: radial-gradient(circle at 50% 40%, transparent 10%, rgba(0,0,0,0.4) 60%, rgba(0,0,0,0.95) 100%);
            width: 100%; height: 100%; position: absolute;
            mix-blend-mode: multiply;
        }
        .grain {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            opacity: 0.5;
            animation: grainShift 0.2s steps(4) infinite;
        }
        @keyframes grainShift { 
            0% { transform: translate(0,0); } 
            25% { transform: translate(-2px,2px); }
            50% { transform: translate(2px,-2px); }
            75% { transform: translate(-2px,-2px); }
        }

        /* --- HEADER --- */
        header {
            background: linear-gradient(to bottom, #111, #080808);
            padding: 0 40px; height: 60px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333; z-index: 200;
            box-shadow: 0 5px 20px #000;
        }
        
        .brand {
            font-family: 'Abril Fatface', cursive; font-size: 1.6rem; letter-spacing: 2px;
            color: #ccc; text-shadow: 0 2px 5px #000;
        }
        .brand span { color: var(--noir-red); text-shadow: 0 0 10px rgba(138, 11, 11, 0.4); }

        .btn-nav {
            background: rgba(255,255,255,0.05); 
            border: 1px solid #444; color: #888;
            padding: 6px 14px; font-family: 'Courier Prime'; text-transform: uppercase; font-size: 0.8rem;
            cursor: pointer; transition: 0.3s;
            border-radius: 2px;
        }
        .btn-nav:hover { 
            border-color: var(--noir-amber); color: var(--noir-amber); 
            background: rgba(204, 164, 59, 0.1);
        }

        /* --- DESK LAYOUT --- */
        .desk {
            flex: 1; padding: 40px; display: flex; justify-content: center;
            position: relative; z-index: 50; perspective: 1200px;
            overflow: hidden;
        }

        .folder-wrapper {
            width: 100%; max-width: 950px; height: 95%;
            display: flex; flex-direction: column; position: relative;
            transform-style: preserve-3d;
        }

        /* Tabs */
        .tabs { display: flex; padding-left: 30px; z-index: 50; position: relative; }
        .tab {
            background: #4a3e32; color: #aaa;
            padding: 12px 25px; margin-right: -2px; border-radius: 8px 8px 0 0;
            cursor: pointer; font-family: 'Special Elite';
            border: 1px solid rgba(0,0,0,0.5); border-bottom: none;
            box-shadow: inset 0 2px 5px rgba(255,255,255,0.05), 5px 0 10px rgba(0,0,0,0.3);
            transition: transform 0.2s, background 0.2s, padding 0.2s;
            position: relative;
            z-index: 1;
        }
        .tab:hover { transform: translateY(-4px); background: #5a4e42; }
        .tab.active {
            background: var(--noir-paper); color: #111; font-weight: bold;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.2);
            padding-bottom: 20px; transform: translateY(-2px);
            z-index: 10;
            border-top: 2px solid rgba(255,255,255,0.4);
        }

        /* The File */
        .file {
            background: var(--noir-paper); flex: 1;
            border-radius: 4px; position: relative;
            box-shadow: 
                0 1px 2px rgba(0,0,0,0.1), 
                0 10px 40px rgba(0,0,0,0.5),
                inset 0 0 60px rgba(61, 44, 25, 0.15);
            border: 1px solid #bba; overflow: hidden; padding: 50px;
            background-image: 
                linear-gradient(rgba(255,255,255,0.2), rgba(255,255,255,0) 20%), 
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            z-index: 5;
            margin-top: -2px; /* Pull up to join tabs */
        }
        
        .file::before {
            content: ''; position: absolute; top:0; left: 30px; width: 2px; height: 100%;
            border-left: 2px dashed rgba(0,0,0,0.1);
        }
        
        .stain {
            position: absolute; border-radius: 50%; pointer-events: none;
            border: 15px solid rgba(60, 40, 10, 0.04);
            width: 140px; height: 140px; bottom: 80px; right: 60px; filter: blur(2px);
            transform: scale(1.2) rotate(30deg);
        }

        .view { display: none; height: 100%; overflow-y: auto; padding-right: 15px; }
        .view::-webkit-scrollbar { width: 8px; }
        .view::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
        .view::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 4px; }
        
        .view.active { display: block; animation: fade 0.4s ease-out; }
        @keyframes fade { from { opacity:0; transform: translateY(5px); } to { opacity:1; transform: translateY(0); } }

        /* Typography */
        h1 { 
            font-family: 'Special Elite'; font-size: 2.8rem; color: #0a0a0a;
            border-bottom: 3px double #aaa; padding-bottom: 15px; margin-bottom: 25px;
            text-transform: uppercase; letter-spacing: 2px;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
        }
        h2 { 
            font-family: 'Special Elite'; color: var(--noir-steel); 
            border-bottom: 1px solid #aaa; margin-bottom: 25px; 
            padding-bottom: 5px;
        }

        /* --- CARDS --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 35px; padding: 10px; }

        .doc {
            background: #fff; padding: 25px; 
            box-shadow: 1px 2px 4px rgba(0,0,0,0.1), 3px 6px 12px rgba(0,0,0,0.1);
            position: relative; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            border: 1px solid #e0e0e0;
            transform-origin: center;
        }
        .doc:hover { transform: scale(1.05) rotate(0deg) !important; z-index: 20; box-shadow: 0 15px 30px rgba(0,0,0,0.25); }

        .tape {
            position: absolute; top: -12px; left: 50%; transform: translateX(-50%) rotate(-2deg);
            width: 80px; height: 25px;
            background: rgba(255,255,255,0.3);
            border-left: 1px dashed rgba(0,0,0,0.1);
            border-right: 1px dashed rgba(0,0,0,0.1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            opacity: 0.6;
        }

        .polaroid {
            background: #fff; padding: 12px 12px 50px 12px;
            box-shadow: 1px 3px 6px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .polaroid:hover {
            transform: scale(1.05) !important; z-index: 25;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .photo {
            background: #1a1a1a; height: 180px; width: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 4rem; color: #444; 
            filter: grayscale(100%) contrast(1.2) sepia(20%);
            position: relative; overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }
        .photo::after {
            content:''; position:absolute; top:0; left:0; width:100%; height:100%;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.8) 150%);
        }
        
        .name-tag {
            font-family: 'Permanent Marker'; font-size: 1.2rem;
            text-align: center; margin-top: 15px; color: #222;
            transform: rotate(-2deg);
        }

        .censored {
            background: #111; color: #111; font-family: 'Courier Prime';
            padding: 6px; margin-top: 10px; cursor: pointer; transition: 0.4s;
            position: relative; overflow: hidden; border-radius: 2px;
        }
        .censored::after {
            content: "CLASSIFIED"; color: #444; font-size: 0.6rem; letter-spacing: 3px; font-weight: bold;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
            opacity: 0.5;
        }
        .revealed .censored {
            background: rgba(138, 11, 11, 0.05); color: var(--noir-red);
            font-weight: bold; border-bottom: 2px solid var(--noir-red);
        }
        .revealed .censored::after { display: none; }

        .actions { margin-top: 15px; display: flex; flex-direction: column; gap: 8px; }
        .stamp-btn {
            border: 2px solid #555; background: transparent; color: #444;
            font-family: 'Special Elite'; font-size: 0.9rem; padding: 8px;
            cursor: pointer; transition: 0.2s; text-transform: uppercase; opacity: 0.7;
            position: relative;
        }
        .stamp-btn:hover { 
            opacity: 1; border-color: var(--noir-red); color: var(--noir-red); 
            transform: scale(1.02); background: rgba(255,255,255,0.5);
        }
        .revealed .btn-reveal { display: none; }

        /* --- HUD --- */
        .timer-stamp {
            position: absolute; top: -25px; right: 20px;
            font-family: 'Special Elite'; font-size: 2.2rem;
            color: var(--noir-red); transform: rotate(-3deg);
            border: 5px solid var(--noir-red); padding: 5px 20px;
            background: rgba(240, 230, 230, 0.95); z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: 0.5s;
            mix-blend-mode: multiply;
        }
        .critical { animation: pulse 1s infinite; background: #300; color: #f00; border-color: #f00; mix-blend-mode: normal; }
        @keyframes pulse { 0% { transform: rotate(-3deg) scale(1); } 50% { transform: rotate(-3deg) scale(1.05); } 100% { transform: rotate(-3deg) scale(1); } }

        .strike-panel {
            position: absolute; top: -20px; left: 40px;
            display: flex; gap: 15px; z-index: 100;
        }
        .x-mark {
            font-family: 'Permanent Marker'; font-size: 4rem; color: rgba(0,0,0,0.1);
            transform: rotate(-10deg);
        }
        .x-mark.active { color: #800; text-shadow: 2px 2px 0 rgba(0,0,0,0.5); }

        /* --- PAGER --- */
        .pager {
            position: fixed; bottom: 30px; right: 30px; width: 320px;
            background: #111; border: 4px solid #333;
            border-top: 15px solid #333;
            border-radius: 6px; z-index: 300;
            box-shadow: 0 0 0 1px #000, 0 20px 50px rgba(0,0,0,0.8);
            transform: rotate(-1deg);
        }
        .screen {
            background: #0d1a14; height: 110px; border: 4px inset #222;
            padding: 12px; font-family: 'Courier Prime'; color: var(--noir-amber);
            text-shadow: 0 0 8px rgba(204, 164, 59, 0.6); font-size: 0.9rem;
            display: flex; flex-direction: column-reverse; overflow: hidden;
            position: relative;
        }
        .screen::before {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(rgba(255,255,255,0.03) 50%, transparent 50%);
            background-size: 100% 4px; pointer-events: none;
        }
        .log-entry { 
            border-bottom: 1px dotted #353; padding: 4px 0; 
            opacity: 0; animation: typeIn 0.3s forwards;
        }
        @keyframes typeIn { from { opacity:0; margin-left: -10px; } to { opacity:1; margin-left:0; } }

        /* --- MODALS --- */
        .modal {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(5,5,5,0.95); z-index: 2000;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(2px);
        }
        .paper-modal {
            background: #f4f1ea; padding: 50px; width: 90%; max-width: 800px;
            transform: rotate(1deg); box-shadow: 0 0 100px #000;
            max-height: 90vh; overflow-y: auto;
            border: 1px solid #999;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
        }
        
        .case-list { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .case-btn {
            background: #fff; padding: 25px; border: 1px solid #aaa;
            text-align: left; cursor: pointer; transition: 0.2s; position: relative;
        }
        .case-btn:hover { 
            border-color: var(--noir-red); transform: scale(1.02) rotate(-1deg); 
            z-index: 10; box-shadow: 5px 5px 15px rgba(0,0,0,0.2); 
        }
        .case-btn strong { font-family: 'Special Elite'; font-size: 1.1rem; }
        
        .level { 
            position: absolute; top: -8px; right: 10px; 
            font-weight: bold; font-size: 0.7rem; color: #fff; padding: 4px 8px; 
            text-transform: uppercase; letter-spacing: 1px;
        }
        .lvl-1 { background: var(--noir-steel); }
        .lvl-2 { background: var(--noir-amber); }
        .lvl-3 { background: var(--noir-red); }

        .stamp {
            font-family: 'Permanent Marker'; font-size: 6rem;
            border: 12px double; padding: 10px 40px;
            transform: rotate(-15deg); display: inline-block;
            margin: 30px; opacity: 0; animation: smash 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards 0.5s;
        }
        @keyframes smash { 0% { opacity:0; transform: scale(3) rotate(0deg); } 100% { opacity:0.85; transform: scale(1) rotate(-15deg); } }
        
        .s-solved { color: #2a5c32; border-color: #2a5c32; mix-blend-mode: multiply; }
        .s-failed { color: #8a0b0b; border-color: #8a0b0b; mix-blend-mode: multiply; }

        @media(max-width: 600px) { .case-list { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="fx-layer">
        <div class="rain" id="rain"></div>
        <div class="grain"></div>
        <div class="overlay"></div>
    </div>

    <header>
        <div class="brand">NOIR <span>DETECTIVE</span></div>
        <div>
            <button class="btn-nav" onclick="showArchives()">Archives</button>
            <button class="btn-nav" id="soundBtn" onclick="toggleMute()">SND: ON</button>
        </div>
    </header>

    <div class="desk">
        <div class="folder-wrapper" id="shaker">
            
            <div class="timer-stamp" id="timer">10:00</div>
            <div class="strike-panel">
                <div class="x-mark" id="x1">X</div>
                <div class="x-mark" id="x2">X</div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="tab(this, 'brief')">CASE BRIEF</div>
                <div class="tab" onclick="tab(this, 'evidence')">EVIDENCE</div>
                <div class="tab" onclick="tab(this, 'suspects')">SUSPECTS</div>
            </div>

            <div class="file">
                <div class="stain"></div>
                
                <div class="view active" id="brief">
                    <h1>CASE FILE: <span id="cTitle" style="color:#444">UNASSIGNED</span></h1>
                    <div style="font-size: 1.1rem; line-height: 1.8;">
                        <p><strong>DIFFICULTY:</strong> <span id="cDiff">--</span></p>
                        <p><strong>STATUS:</strong> OPEN INVESTIGATION</p>
                        <hr style="border:0; border-top:2px dashed #888; margin:25px 0;">
                        <p id="cBrief">No active investigation loaded.</p>
                    </div>
                    <div style="margin-top:40px; border:2px solid var(--noir-red); padding:20px; background:rgba(138,11,11,0.05); position:relative;">
                        <div style="position:absolute; top:-12px; left:20px; background:var(--noir-paper); padding:0 10px; color:var(--noir-red); font-weight:bold;">DEPARTMENT PROTOCOL</div>
                        <ul style="margin-left:20px; margin-top:10px; line-height:1.6;">
                            <li>Wait for <strong>AUTO-DECRYPT</strong> (Every 60s).</li>
                            <li>Use <strong>FORCE DECRYPT</strong> for instant data (-90s Penalty).</li>
                            <li>Identify the culprit and <strong>ISSUE WARRANT</strong>.</li>
                            <li><strong style="color:var(--noir-red)">WARNING:</strong> Two incorrect warrants result in immediate dismissal.</li>
                        </ul>
                    </div>
                </div>

                <div class="view" id="evidence">
                    <h2>EVIDENCE COLLECTION</h2>
                    <div class="grid" id="evGrid"></div>
                </div>

                <div class="view" id="suspects">
                    <h2>SUSPECT LINEUP</h2>
                    <div class="grid" id="susGrid"></div>
                </div>

            </div>
        </div>

        <div class="pager">
            <div style="font-size:0.7rem; color:#666; display:flex; justify-content:space-between; margin-bottom:5px; padding: 0 5px;">
                <span>ENCRYPTED CHANNEL</span> <span>V.9.0</span>
            </div>
            <div class="screen" id="log">
                <div class="log-entry">SYSTEM STANDBY...</div>
            </div>
        </div>
    </div>

    <!-- START MODAL -->
    <div class="modal" id="startModal">
        <div class="paper-modal">
            <h1 style="text-align:center;">ARCHIVES</h1>
            <p style="text-align:center; color:#666; margin-bottom:30px;">Select a cold case file to reopen.</p>
            <div class="case-list">
                <div class="case-btn" onclick="loadCase('trophy')">
                    <strong>THE MISSING TROPHY</strong><br><small>Theft / School</small>
                    <div class="level lvl-1">EASY</div>
                </div>
                <div class="case-btn" onclick="loadCase('stream')">
                    <strong>THE SILENT STREAM</strong><br><small>Murder / Cyber</small>
                    <div class="level lvl-1">EASY</div>
                </div>
                <div class="case-btn" onclick="loadCase('poison')">
                    <strong>THE POISONED DINER</strong><br><small>Murder / Poison</small>
                    <div class="level lvl-2">MED</div>
                </div>
                <div class="case-btn" onclick="loadCase('curtain')">
                    <strong>THE FINAL CURTAIN</strong><br><small>Murder / Theater</small>
                    <div class="level lvl-2">MED</div>
                </div>
                <div class="case-btn" onclick="loadCase('jogger')">
                    <strong>THE FROZEN JOGGER</strong><br><small>Forensics / Snow</small>
                    <div class="level lvl-3">HARD</div>
                </div>
                <div class="case-btn" onclick="loadCase('express')">
                    <strong>THE MIDNIGHT EXPRESS</strong><br><small>Murder / Train</small>
                    <div class="level lvl-3">HARD</div>
                </div>
            </div>
        </div>
    </div>

    <!-- END MODAL -->
    <div class="modal" id="endModal" style="display:none;">
        <div class="paper-modal" style="text-align:center;">
            <div id="endStamp" class="stamp s-solved">SOLVED</div>
            <h2 style="border:none;">FINAL REPORT</h2>
            <div style="text-align:left; background:#fff; padding:40px; border:1px solid #aaa; font-family:'Courier Prime'; line-height:1.6; box-shadow:inset 0 0 20px rgba(0,0,0,0.1);" id="endText">
                ...
            </div>
            <button class="stamp-btn" style="margin-top:30px; width:100%; font-size:1.4rem; padding: 15px;" onclick="showArchives()">FILE AWAY</button>
        </div>
    </div>

    <script>
        const rain = document.getElementById('rain');
        for(let i=0; i<60; i++){
            let d = document.createElement('div');
            d.className = 'drop';
            d.style.left = Math.random()*100+'%';
            d.style.animationDuration = (Math.random()*0.5 + 0.5)+'s';
            d.style.animationDelay = Math.random()+'s';
            rain.appendChild(d);
        }

        const DB = {
            trophy: {
                title: "THE MISSING TROPHY", diff: "LEVEL 1", culprit: "carmen",
                brief: "The Westfield Trophy was stolen between 16:15 and 06:00. The lock was picked. CCTV deleted.",
                text: "Carmen's uniform matched the **Blue Fabric** found on the lock. Her background as a **Locksmith** explains the picked lock, and the forged **Logbook** covered her tracks.",
                ev: [
                    {id:"e1", name:"Blue Fabric", desc:"Snagged on lock.", hidden:"LAB: Match to Security Uniform."},
                    {id:"e2", name:"Muddy Prints", desc:"Size 9 boot prints.", hidden:"MATCH: Heavy boots from garden."},
                    {id:"e3", name:"Logbook", desc:"Sign-in sheet.", hidden:"ANOMALY: 16:30 entry forged."}
                ],
                sus: [
                    {id:"s1", name:"Jake", role:"Athlete", hidden:"ALIBI: In gym until 17:00."},
                    {id:"s2", name:"Carmen", role:"Security", hidden:"MOTIVE: Financial debt. Ex-locksmith."},
                    {id:"s3", name:"Wells", role:"Coach", hidden:"ALIBI: Meeting with Principal."}
                ]
            },
            poison: {
                title: "THE POISONED DINER", diff: "LEVEL 2", culprit: "leo",
                brief: "Victim died of Cyanide poisoning at midnight. No one entered or left the diner.",
                text: "The poison was in the **Ice Cubes**, not the drink. Leo, the waiter, was the only one with access to the ice machine. His chemistry background allowed him to prepare the toxin.",
                ev: [
                    {id:"e1", name:"Glass", desc:"Lemonade with ice.", hidden:"TOX: Cyanide in ice only."},
                    {id:"e2", name:"Receipt", desc:"Time: 23:55.", hidden:"DATA: Served by Leo."},
                    {id:"e3", name:"Pie", desc:"Half eaten.", hidden:"ANALYSIS: Safe to eat."}
                ],
                sus: [
                    {id:"s1", name:"Maya", role:"Friend", hidden:"SEARCH: Clean."},
                    {id:"s2", name:"Leo", role:"Waiter", hidden:"BG: Chemistry dropout. Theft record."},
                    {id:"s3", name:"Harlan", role:"Owner", hidden:"ALIBI: On phone call."}
                ]
            },
            stream: {
                title: "THE SILENT STREAM", diff: "LEVEL 1", culprit: "alex",
                brief: "Streamer died live on camera. Room locked from inside. Lights flickered before death.",
                text: "The murder weapon was the **Smart Lights**, triggering a seizure. Only Alex (Admin) had the remote access credentials to hack the home router.",
                ev: [
                    {id:"e1", name:"Router Log", desc:"Network history.", hidden:"HACK: Remote Admin login detected."},
                    {id:"e2", name:"Chat Log", desc:"Twitch chat.", hidden:"THREAT: 'Lights out' posted by Admin."},
                    {id:"e3", name:"Autopsy", desc:"Medical report.", hidden:"CAUSE: Induced seizure."}
                ],
                sus: [
                    {id:"s1", name:"Alex", role:"Mod", hidden:"CHECK: IP match found."},
                    {id:"s2", name:"Ben", role:"Roommate", hidden:"ALIBI: Seen in video background."},
                    {id:"s3", name:"Zack", role:"Troll", hidden:"CHECK: Banned. No access."}
                ]
            },
            curtain: {
                title: "THE FINAL CURTAIN", diff: "LEVEL 2", culprit: "marcus",
                brief: "Actor collapsed on stage. Prop goblet contained slow-acting Wolfsbane poison.",
                text: "Wolfsbane takes **15 minutes** to work. CCTV proves Marcus filled the cup exactly 15 minutes before the collapse, using his role as Prop Master to plant the trap.",
                ev: [
                    {id:"e1", name:"Goblet", desc:"Prop cup.", hidden:"TOX: Wolfsbane found."},
                    {id:"e2", name:"Script", desc:"Scene notes.", hidden:"TIMING: Cup used 15m before death."},
                    {id:"e3", name:"CCTV", desc:"Backstage cam.", hidden:"VID: Marcus handled cup 15m prior."}
                ],
                sus: [
                    {id:"s1", name:"Lucas", role:"Understudy", hidden:"CHECK: Held cup for 30s only."},
                    {id:"s2", name:"Marcus", role:"Prop Master", hidden:"MOTIVE: Revenge for firing."},
                    {id:"s3", name:"Ms. V", role:"Director", hidden:"ALIBI: Arguing with crew."}
                ]
            },
            jogger: {
                title: "THE FROZEN JOGGER", diff: "LEVEL 3", culprit: "kyle",
                brief: "Body found in snow. Only ONE set of prints leads to body. None leading away.",
                text: "Kyle walked **backward** carrying the victim, stepping in his own tracks. The deep footprints prove he was carrying a heavy load. He is the only suspect strong enough.",
                ev: [
                    {id:"e1", name:"Prints", desc:"Deep snow prints.", hidden:"PHYSICS: 2x depth = Heavy load carried."},
                    {id:"e2", name:"Temp Log", desc:"Weather data.", hidden:"DATA: -5C at time of death."},
                    {id:"e3", name:"Puddle", desc:"Water near body.", hidden:"LAB: Melted icicle (Weapon)."}
                ],
                sus: [
                    {id:"s1", name:"Kyle", role:"Ex", hidden:"SIZE: 6'4 Rugby Player. Boots match."},
                    {id:"s2", name:"Gary", role:"Rival", hidden:"MED: Broken leg. Cannot walk."},
                    {id:"s3", name:"Sam", role:"Gardener", hidden:"CHECK: Wrong shoe size."}
                ]
            },
            express: {
                title: "MIDNIGHT EXPRESS", diff: "LEVEL 3", culprit: "alfred",
                brief: "Murder on a moving train. Body found in cabin. Killer is still on board.",
                text: "The watch was smashed to fake the time of death. The train was in a pitch black **Tunnel** at the alleged time. Alfred admitted to being there earlier, the only possible time for the crime.",
                ev: [
                    {id:"e1", name:"Watch", desc:"Smashed at 11:45.", hidden:"FAKE: Smashed intentionally."},
                    {id:"e2", name:"Log", desc:"Train Route.", hidden:"FACT: Tunnel (Darkness) at 11:45."},
                    {id:"e3", name:"Tea Set", desc:"Used cup.", hidden:"PRINT: Butler's prints found."}
                ],
                sus: [
                    {id:"s1", name:"Alfred", role:"Butler", hidden:"NOTE: Admitted being there at 11:30."},
                    {id:"s2", name:"Dr. Green", role:"Passenger", hidden:"CHECK: Asleep in cabin."},
                    {id:"s3", name:"Heir", role:"Son", hidden:"ALIBI: In Bar at 11:45."}
                ]
            }
        };

        let activeCase = null;
        let time = 600;
        let strikes = 0;
        let gameOn = false;
        let timerInt, autoInt;
        let sound = true;

        const SFX = {
            ctx: null,
            init() { if(!this.ctx) this.ctx = new (window.AudioContext||window.webkitAudioContext)(); },
            play(f,t,l) {
                if(!sound || !this.ctx) return;
                let o=this.ctx.createOscillator(), g=this.ctx.createGain();
                o.type=t; o.frequency.value=f;
                o.connect(g); g.connect(this.ctx.destination);
                o.start(); g.gain.exponentialRampToValueAtTime(0.0001, this.ctx.currentTime+l);
                o.stop(this.ctx.currentTime+l);
            },
            warn() { this.play(100,'sawtooth',0.4); },
            click() { this.play(800,'sine',0.05); },
            beep() { this.play(2000,'square',0.1); },
            win() { this.play(600,'sine',0.2); setTimeout(()=>this.play(900,'sine',0.4),150); }
        };
        
        function toggleMute() { sound=!sound; document.getElementById('soundBtn').innerText = sound?"SND: ON":"SND: OFF"; }

        function loadCase(id) {
            SFX.init();
            if (SFX.ctx.state === 'suspended') SFX.ctx.resume();
            
            activeCase = DB[id];
            gameOn = true;
            time = 600; strikes = 0;
            
            document.getElementById('startModal').style.display = 'none';
            document.getElementById('endModal').style.display = 'none';
            document.getElementById('cTitle').innerText = activeCase.title;
            document.getElementById('cDiff').innerText = activeCase.diff;
            document.getElementById('cBrief').innerText = activeCase.brief;
            
            // Reset Tabs
            tab(document.querySelector('.tabs .tab'), 'brief');
            
            log("CASE LOADED: " + activeCase.title);

            let evH = '';
            activeCase.ev.forEach(e => {
                let r = (Math.random()*4-2).toFixed(1);
                evH += `<div class="doc" id="${e.id}" style="transform:rotate(${r}deg)">
                    <div class="tape"></div><h3>${e.name}</h3><p>${e.desc}</p>
                    <div class="censored">${e.hidden}</div>
                    <div class="actions"><button class="stamp-btn btn-reveal" onclick="force('${e.id}','${e.name}')">FORCE DECRYPT (-90s)</button></div>
                </div>`;
            });
            document.getElementById('evGrid').innerHTML = evH;

            let susH = '';
            activeCase.sus.forEach(s => {
                let r = (Math.random()*4-2).toFixed(1);
                susH += `<div class="polaroid" id="${s.id}" style="transform:rotate(${r}deg)">
                    <div class="tape"></div><div class="photo">?</div>
                    <div class="name-tag">${s.name} <small>(${s.role})</small></div>
                    <div class="censored">${s.hidden}</div>
                    <div class="actions">
                        <button class="stamp-btn btn-reveal" onclick="force('${s.id}','${s.name}')">BG CHECK (-90s)</button>
                        <button class="stamp-btn" onclick="accuse('${s.name}')" style="color:#8a0b0b; border-color:#8a0b0b">ISSUE WARRANT</button>
                    </div>
                </div>`;
            });
            document.getElementById('susGrid').innerHTML = susH;

            updateHUD();
            if(timerInt) clearInterval(timerInt);
            timerInt = setInterval(tick, 1000);
            if(autoInt) clearInterval(autoInt);
            autoInt = setInterval(autoReveal, 60000);
        }

        function tick() {
            if(!gameOn) return;
            time--;
            updateHUD();
            if(time <= 0) gameOver(false, "TIME EXPIRED");
        }

        function updateHUD() {
            let m = Math.floor(time/60).toString().padStart(2,'0');
            let s = (time%60).toString().padStart(2,'0');
            let tEl = document.getElementById('timer');
            tEl.innerText = m+":"+s;
            tEl.className = time<60 ? "timer-stamp critical" : "timer-stamp";
            
            document.getElementById('x1').className = strikes>=1 ? "x-mark active" : "x-mark";
            document.getElementById('x2').className = strikes>=2 ? "x-mark active" : "x-mark";
        }

        function force(id, name) {
            if(!gameOn) return;
            let el = document.getElementById(id);
            if(el.classList.contains('revealed')) return;
            
            time -= 90;
            updateHUD();
            shake();
            SFX.warn();
            log("PENALTY: -90s");
            reveal(id, name, false);
        }

        function reveal(id, name, auto) {
            let el = document.getElementById(id);
            if(!el) return;
            el.classList.add('revealed');
            log(auto ? "NEW INTEL: "+name : "DECRYPTED: "+name);
            if(auto) SFX.beep();
        }

        function autoReveal() {
            if(!gameOn) return;
            let hidden = document.querySelectorAll('.doc:not(.revealed), .polaroid:not(.revealed)');
            if(hidden.length>0) {
                let t = hidden[Math.floor(Math.random()*hidden.length)];
                let n = t.querySelector('h3') ? t.querySelector('h3').innerText : t.querySelector('.name-tag').innerText;
                reveal(t.id, n, true);
            }
        }

        function accuse(name) {
            if(!gameOn) return;
            if(name.toLowerCase().includes(activeCase.culprit)) {
                gameOver(true);
            } else {
                strikes++;
                shake();
                SFX.warn();
                updateHUD();
                if(strikes >= 2) gameOver(false, "EXCESSIVE ERRORS. FIRED.");
                else {
                    time -= 60;
                    updateHUD();
                    log("WARRANT DENIED. STRIKE "+strikes);
                }
            }
        }

        function gameOver(win, reason) {
            gameOn = false;
            clearInterval(timerInt);
            clearInterval(autoInt);
            
            let modal = document.getElementById('endModal');
            let stamp = document.getElementById('endStamp');
            let text = document.getElementById('endText');
            
            if(win) {
                SFX.win();
                stamp.innerText = "SOLVED";
                stamp.className = "stamp s-solved";
                text.innerHTML = activeCase.text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            } else {
                SFX.warn();
                stamp.innerText = "COLD CASE";
                stamp.className = "stamp s-failed";
                text.innerHTML = `<strong style="color:#a00">FAILURE REPORT:</strong><br>${reason}`;
            }
            modal.style.display = 'flex';
        }

        function log(msg) {
            let d = document.createElement('div');
            d.className = 'log-entry';
            d.innerText = "> "+msg;
            document.getElementById('log').prepend(d);
        }

        function shake() {
            let b = document.getElementById('shaker');
            b.style.transform = "translate(4px, 4px)";
            setTimeout(()=>b.style.transform="translate(-4px, -4px)", 50);
            setTimeout(()=>b.style.transform="translate(4px, -4px)", 100);
            setTimeout(()=>b.style.transform="none", 150);
        }

        function tab(el, id) {
            if(!el) return;
            document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
            
            const targetView = document.getElementById(id);
            if(targetView) targetView.classList.add('active');
            el.classList.add('active');
            
            SFX.init();
            SFX.click();
        }

        function showArchives() {
            gameOn = false;
            document.getElementById('endModal').style.display='none';
            document.getElementById('startModal').style.display='flex';
        }
    </script>
</body>
</html>