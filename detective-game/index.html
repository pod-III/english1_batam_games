<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DETECTIVE: COLD CASE UNIT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Permanent+Marker&family=Special+Elite&family=Abril+Fatface&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* TRUE NOIR PALETTE */
            --noir-red: #8a0b0b;      /* Blood / Danger */
            --noir-amber: #cca43b;    /* Whiskey / Light */
            --noir-steel: #5f6e7c;    /* Cold / Metal */
            --noir-paper: #e6dcc3;    /* Aged Paper */
            --noir-ink: #1a1a1a;      /* Typewriter Ink */
            
            --bg-night: #050505;
            --desk-wood: #2a1d15;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }

        body {
            font-family: 'Courier Prime', monospace;
            background-color: var(--bg-night);
            color: var(--noir-ink);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* --- CINEMATIC FX --- */
        .fx-layer {
            position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; z-index: 100;
        }
        
        /* Rain */
        .rain {
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0.05));
            width: 100%; height: 100%; position: absolute;
        }
        .drop {
            position: absolute; width: 1px; height: 100px;
            background: rgba(255,255,255,0.05);
            animation: fall 0.6s linear infinite;
        }
        @keyframes fall { from { transform: translateY(-100px); } to { transform: translateY(110vh); } }

        /* Film Grain & Vignette */
        .overlay {
            background: radial-gradient(circle, transparent 40%, #000 120%);
            mix-blend-mode: multiply; opacity: 0.9;
            width: 100%; height: 100%; position: absolute;
        }
        .grain {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.07'/%3E%3C/svg%3E");
            opacity: 0.4;
        }

        /* --- HEADER --- */
        header {
            background: rgba(10,5,5,0.95);
            padding: 0 40px; height: 70px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333; z-index: 200;
            box-shadow: 0 5px 30px #000;
        }
        
        .brand {
            font-family: 'Abril Fatface', cursive; font-size: 1.8rem; letter-spacing: 2px;
            color: #ddd; text-shadow: 0 2px 10px #000;
        }
        .brand span { color: var(--noir-red); }

        .btn-nav {
            background: transparent; border: 1px solid #444; color: #888;
            padding: 8px 16px; font-family: 'Courier Prime'; text-transform: uppercase;
            cursor: pointer; transition: 0.3s;
        }
        .btn-nav:hover { border-color: var(--noir-amber); color: var(--noir-amber); }

        /* --- DESK LAYOUT --- */
        .desk {
            flex: 1; padding: 30px; display: flex; justify-content: center;
            position: relative; z-index: 50; perspective: 1000px;
        }

        .folder-wrapper {
            width: 100%; max-width: 1000px; height: 100%;
            display: flex; flex-direction: column; position: relative;
        }

        /* Tabs */
        .tabs { display: flex; padding-left: 20px; z-index: 5; }
        .tab {
            background: #3d342b; color: #999;
            padding: 12px 30px; margin-right: 4px; border-radius: 6px 6px 0 0;
            cursor: pointer; font-family: 'Special Elite';
            border: 1px solid #222; border-bottom: none;
            box-shadow: inset 0 -10px 20px rgba(0,0,0,0.5);
        }
        .tab.active {
            background: var(--noir-paper); color: #111; font-weight: bold;
            box-shadow: 0 -5px 10px rgba(0,0,0,0.2);
            padding-bottom: 15px; margin-bottom: -2px; z-index: 10;
        }

        /* The File */
        .file {
            background: var(--noir-paper); flex: 1;
            border-radius: 2px; position: relative;
            box-shadow: 0 20px 60px #000, inset 0 0 100px rgba(61, 44, 25, 0.2);
            border: 1px solid #888; overflow: hidden; padding: 40px;
            /* Paper Texture */
            background-image: linear-gradient(rgba(255,255,255,0.4), rgba(255,255,255,0) 80%), url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
        }
        
        /* Stains & Grime */
        .stain {
            position: absolute; border-radius: 50%; pointer-events: none;
            border: 10px solid rgba(60, 40, 10, 0.08);
            width: 120px; height: 120px; bottom: 50px; right: 50px; filter: blur(1px);
        }

        .view { display: none; height: 100%; overflow-y: auto; padding-right: 15px; }
        .view.active { display: block; animation: fade 0.6s; }
        @keyframes fade { from { opacity:0; } to { opacity:1; } }

        /* Typography */
        h1 { 
            font-family: 'Special Elite'; font-size: 2.5rem; color: #111;
            border-bottom: 4px double #333; padding-bottom: 15px; margin-bottom: 25px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        h2 { font-family: 'Special Elite'; color: var(--noir-steel); border-bottom: 1px solid #aaa; margin-bottom: 20px; }

        /* --- CARDS --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 30px; }

        .doc {
            background: #fff; padding: 20px; box-shadow: 2px 5px 10px rgba(0,0,0,0.2);
            position: relative; transition: 0.2s; border: 1px solid #ccc;
        }
        .doc:hover { transform: scale(1.02) rotate(0deg) !important; z-index: 20; box-shadow: 10px 20px 30px rgba(0,0,0,0.3); }

        .polaroid {
            background: #fff; padding: 12px 12px 50px 12px;
            box-shadow: 2px 5px 15px rgba(0,0,0,0.3);
        }
        .photo {
            background: #222; height: 180px; width: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 4rem; color: #555; filter: grayscale(100%) contrast(1.2);
            position: relative; overflow: hidden;
        }
        .photo::after {
            content:''; position:absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(rgba(255,255,255,0.1), transparent);
        }
        
        /* Redacted Text */
        .censored {
            background: #000; color: #000; font-family: 'Courier Prime';
            padding: 4px; margin-top: 10px; cursor: pointer; transition: 0.4s;
            position: relative; overflow: hidden;
        }
        .censored::after {
            content: "CLASSIFIED"; color: #333; font-size: 0.6rem; letter-spacing: 2px;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
        }
        .revealed .censored {
            background: transparent; color: var(--noir-red);
            font-weight: bold; border-bottom: 2px solid var(--noir-red);
        }
        .revealed .censored::after { display: none; }

        /* Action Buttons */
        .actions { margin-top: 15px; display: flex; flex-direction: column; gap: 8px; }
        .stamp-btn {
            border: 2px solid #555; background: transparent; color: #333;
            font-family: 'Special Elite'; font-size: 1rem; padding: 10px;
            cursor: pointer; transition: 0.2s; text-transform: uppercase; opacity: 0.7;
        }
        .stamp-btn:hover { opacity: 1; border-color: var(--noir-red); color: var(--noir-red); transform: rotate(-1deg); }
        .revealed .btn-reveal { display: none; }

        /* --- HUD --- */
        .timer-stamp {
            position: absolute; top: -20px; right: 30px;
            font-family: 'Special Elite'; font-size: 2.5rem;
            color: var(--noir-red); transform: rotate(-5deg);
            border: 4px solid var(--noir-red); padding: 5px 20px;
            background: rgba(255, 240, 240, 0.9); z-index: 50;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
            transition: 0.5s;
        }
        .critical { animation: pulse 1s infinite; background: #300; color: #f00; border-color: #f00; }
        @keyframes pulse { 0% { transform: rotate(-5deg) scale(1); } 50% { transform: rotate(-5deg) scale(1.1); } 100% { transform: rotate(-5deg) scale(1); } }

        .strike-panel {
            position: absolute; top: -15px; left: 30px;
            display: flex; gap: 15px; z-index: 50;
        }
        .x-mark {
            font-family: 'Permanent Marker'; font-size: 3.5rem; color: rgba(0,0,0,0.1);
        }
        .x-mark.active { color: #800; text-shadow: 2px 2px 0 #000; }

        /* --- PAGER --- */
        .pager {
            position: fixed; bottom: 30px; right: 30px; width: 300px;
            background: #151515; border: 2px solid #333;
            padding: 15px; border-radius: 8px; z-index: 300;
            box-shadow: 0 10px 40px #000;
        }
        .screen {
            background: #08100c; height: 100px; border: 3px inset #333;
            padding: 10px; font-family: 'Courier Prime'; color: var(--noir-amber);
            text-shadow: 0 0 5px var(--noir-amber); font-size: 0.85rem;
            display: flex; flex-direction: column-reverse; overflow: hidden;
        }
        .log-entry { border-bottom: 1px dotted #333; padding: 2px 0; }

        /* --- MODALS --- */
        .modal {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.92); z-index: 500;
            display: flex; justify-content: center; align-items: center;
        }
        .paper-modal {
            background: #f0f0f0; padding: 50px; width: 90%; max-width: 800px;
            transform: rotate(1deg); box-shadow: 0 0 100px #000;
            max-height: 90vh; overflow-y: auto;
        }
        
        .case-list { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .case-btn {
            background: #fff; padding: 20px; border: 1px solid #999;
            text-align: left; cursor: pointer; transition: 0.2s; position: relative;
        }
        .case-btn:hover { border-color: var(--noir-red); transform: scale(1.02); z-index: 10; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        
        /* Tags */
        .level { position: absolute; top: 10px; right: 10px; font-weight: bold; font-size: 0.7rem; color: #fff; padding: 2px 6px; }
        .lvl-1 { background: var(--noir-steel); }
        .lvl-2 { background: var(--noir-amber); }
        .lvl-3 { background: var(--noir-red); }

        /* Outcome Stamps */
        .stamp {
            font-family: 'Permanent Marker'; font-size: 5rem;
            border: 10px solid; padding: 10px 30px;
            transform: rotate(-15deg); display: inline-block;
            margin: 30px; opacity: 0; animation: smash 0.4s forwards 0.5s;
        }
        @keyframes smash { 0% { opacity:0; transform: scale(3) rotate(0deg); } 100% { opacity:0.8; transform: scale(1) rotate(-15deg); } }
        
        .s-solved { color: #006633; border-color: #006633; }
        .s-failed { color: #800; border-color: #800; }

        @media(max-width: 600px) { .case-list { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <!-- FX LAYERS -->
    <div class="fx-layer">
        <div class="rain" id="rain"></div>
        <div class="grain"></div>
        <div class="overlay"></div>
    </div>

    <header>
        <div class="brand">NOIR <span>DETECTIVE</span></div>
        <div>
            <button class="btn-nav" onclick="showArchives()">Archives</button>
            <button class="btn-nav" id="soundBtn" onclick="toggleMute()">SND: ON</button>
        </div>
    </header>

    <div class="desk">
        <div class="folder-wrapper" id="shaker">
            
            <!-- HUD -->
            <div class="timer-stamp" id="timer">10:00</div>
            <div class="strike-panel">
                <div class="x-mark" id="x1">X</div>
                <div class="x-mark" id="x2">X</div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="tab('brief')">CASE BRIEF</div>
                <div class="tab" onclick="tab('evidence')">EVIDENCE</div>
                <div class="tab" onclick="tab('suspects')">SUSPECTS</div>
            </div>

            <div class="file">
                <div class="stain"></div>
                
                <!-- Briefing -->
                <div class="view active" id="brief">
                    <h1>CASE FILE: <span id="cTitle" style="color:#555">UNASSIGNED</span></h1>
                    <div style="font-size: 1.1rem; line-height: 1.8;">
                        <p><strong>DIFFICULTY:</strong> <span id="cDiff">--</span></p>
                        <p><strong>STATUS:</strong> OPEN INVESTIGATION</p>
                        <hr style="border:0; border-top:1px dashed #333; margin:20px 0;">
                        <p id="cBrief">No active investigation loaded.</p>
                    </div>
                    <div style="margin-top:40px; border:2px solid var(--noir-red); padding:20px; background:rgba(255,0,0,0.03);">
                        <strong style="color:var(--noir-red)">DEPARTMENT PROTOCOL:</strong>
                        <ul style="margin-left:20px; margin-top:10px; line-height:1.6;">
                            <li>Wait for <strong>AUTO-DECRYPT</strong> (Every 60s).</li>
                            <li>Use <strong>FORCE DECRYPT</strong> for instant data (-90s Penalty).</li>
                            <li>Identify the culprit and <strong>ISSUE WARRANT</strong>.</li>
                            <li><strong style="color:var(--noir-red)">WARNING:</strong> Two incorrect warrants result in immediate dismissal.</li>
                        </ul>
                    </div>
                </div>

                <!-- Evidence -->
                <div class="view" id="evidence">
                    <h2>EVIDENCE COLLECTION</h2>
                    <div class="grid" id="evGrid"></div>
                </div>

                <!-- Suspects -->
                <div class="view" id="suspects">
                    <h2>SUSPECT LINEUP</h2>
                    <div class="grid" id="susGrid"></div>
                </div>

            </div>
        </div>

        <!-- Pager -->
        <div class="pager">
            <div style="font-size:0.7rem; color:#666; display:flex; justify-content:space-between; margin-bottom:5px;">
                <span>ENCRYPTED CHANNEL</span> <span>V.9.0</span>
            </div>
            <div class="screen" id="log">
                <div class="log-entry">SYSTEM STANDBY...</div>
            </div>
        </div>
    </div>

    <!-- START MODAL -->
    <div class="modal" id="startModal">
        <div class="paper-modal">
            <h1 style="text-align:center;">ARCHIVES</h1>
            <p style="text-align:center; color:#666; margin-bottom:30px;">Select a cold case file to reopen.</p>
            <div class="case-list">
                <div class="case-btn" onclick="loadCase('trophy')">
                    <strong>THE MISSING TROPHY</strong><br><small>Theft / School</small>
                    <div class="level lvl-1">EASY</div>
                </div>
                <div class="case-btn" onclick="loadCase('stream')">
                    <strong>THE SILENT STREAM</strong><br><small>Murder / Cyber</small>
                    <div class="level lvl-1">EASY</div>
                </div>
                <div class="case-btn" onclick="loadCase('poison')">
                    <strong>THE POISONED DINER</strong><br><small>Murder / Poison</small>
                    <div class="level lvl-2">MED</div>
                </div>
                <div class="case-btn" onclick="loadCase('curtain')">
                    <strong>THE FINAL CURTAIN</strong><br><small>Murder / Theater</small>
                    <div class="level lvl-2">MED</div>
                </div>
                <div class="case-btn" onclick="loadCase('jogger')">
                    <strong>THE FROZEN JOGGER</strong><br><small>Forensics / Snow</small>
                    <div class="level lvl-3">HARD</div>
                </div>
                <div class="case-btn" onclick="loadCase('express')">
                    <strong>THE MIDNIGHT EXPRESS</strong><br><small>Murder / Train</small>
                    <div class="level lvl-3">HARD</div>
                </div>
            </div>
        </div>
    </div>

    <!-- END MODAL -->
    <div class="modal" id="endModal" style="display:none;">
        <div class="paper-modal" style="text-align:center;">
            <div id="endStamp" class="stamp s-solved">SOLVED</div>
            <h2 style="border:none;">FINAL REPORT</h2>
            <div style="text-align:left; background:#fff; padding:30px; border:1px solid #aaa; font-family:'Courier Prime'; line-height:1.6;" id="endText">
                ...
            </div>
            <button class="stamp-btn" style="margin-top:30px; width:100%; font-size:1.2rem;" onclick="showArchives()">FILE AWAY</button>
        </div>
    </div>

    <script>
        /* --- RAIN FX --- */
        const rain = document.getElementById('rain');
        for(let i=0; i<60; i++){
            let d = document.createElement('div');
            d.className = 'drop';
            d.style.left = Math.random()*100+'%';
            d.style.animationDuration = (Math.random()*0.5 + 0.5)+'s';
            d.style.animationDelay = Math.random()+'s';
            rain.appendChild(d);
        }

        /* --- DATA --- */
        const DB = {
            trophy: {
                title: "THE MISSING TROPHY", diff: "LEVEL 1", culprit: "carmen",
                brief: "The Westfield Trophy was stolen between 16:15 and 06:00. The lock was picked. CCTV deleted.",
                text: "Carmen's uniform matched the **Blue Fabric** found on the lock. Her background as a **Locksmith** explains the picked lock, and the forged **Logbook** covered her tracks.",
                ev: [
                    {id:"e1", name:"Blue Fabric", desc:"Snagged on lock.", hidden:"LAB: Match to Security Uniform."},
                    {id:"e2", name:"Muddy Prints", desc:"Size 9 boot prints.", hidden:"MATCH: Heavy boots from garden."},
                    {id:"e3", name:"Logbook", desc:"Sign-in sheet.", hidden:"ANOMALY: 16:30 entry forged."}
                ],
                sus: [
                    {id:"s1", name:"Jake", role:"Athlete", hidden:"ALIBI: In gym until 17:00."},
                    {id:"s2", name:"Carmen", role:"Security", hidden:"MOTIVE: Financial debt. Ex-locksmith."},
                    {id:"s3", name:"Wells", role:"Coach", hidden:"ALIBI: Meeting with Principal."}
                ]
            },
            poison: {
                title: "THE POISONED DINER", diff: "LEVEL 2", culprit: "leo",
                brief: "Victim died of Cyanide poisoning at midnight. No one entered or left the diner.",
                text: "The poison was in the **Ice Cubes**, not the drink. Leo, the waiter, was the only one with access to the ice machine. His chemistry background allowed him to prepare the toxin.",
                ev: [
                    {id:"e1", name:"Glass", desc:"Lemonade with ice.", hidden:"TOX: Cyanide in ice only."},
                    {id:"e2", name:"Receipt", desc:"Time: 23:55.", hidden:"DATA: Served by Leo."},
                    {id:"e3", name:"Pie", desc:"Half eaten.", hidden:"ANALYSIS: Safe to eat."}
                ],
                sus: [
                    {id:"s1", name:"Maya", role:"Friend", hidden:"SEARCH: Clean."},
                    {id:"s2", name:"Leo", role:"Waiter", hidden:"BG: Chemistry dropout. Theft record."},
                    {id:"s3", name:"Harlan", role:"Owner", hidden:"ALIBI: On phone call."}
                ]
            },
            stream: {
                title: "THE SILENT STREAM", diff: "LEVEL 1", culprit: "alex",
                brief: "Streamer died live on camera. Room locked from inside. Lights flickered before death.",
                text: "The murder weapon was the **Smart Lights**, triggering a seizure. Only Alex (Admin) had the remote access credentials to hack the home router.",
                ev: [
                    {id:"e1", name:"Router Log", desc:"Network history.", hidden:"HACK: Remote Admin login detected."},
                    {id:"e2", name:"Chat Log", desc:"Twitch chat.", hidden:"THREAT: 'Lights out' posted by Admin."},
                    {id:"e3", name:"Autopsy", desc:"Medical report.", hidden:"CAUSE: Induced seizure."}
                ],
                sus: [
                    {id:"s1", name:"Alex", role:"Mod", hidden:"CHECK: IP match found."},
                    {id:"s2", name:"Ben", role:"Roommate", hidden:"ALIBI: Seen in video background."},
                    {id:"s3", name:"Zack", role:"Troll", hidden:"CHECK: Banned. No access."}
                ]
            },
            curtain: {
                title: "THE FINAL CURTAIN", diff: "LEVEL 2", culprit: "marcus",
                brief: "Actor collapsed on stage. Prop goblet contained slow-acting Wolfsbane poison.",
                text: "Wolfsbane takes **15 minutes** to work. CCTV proves Marcus filled the cup exactly 15 minutes before the collapse, using his role as Prop Master to plant the trap.",
                ev: [
                    {id:"e1", name:"Goblet", desc:"Prop cup.", hidden:"TOX: Wolfsbane found."},
                    {id:"e2", name:"Script", desc:"Scene notes.", hidden:"TIMING: Cup used 15m before death."},
                    {id:"e3", name:"CCTV", desc:"Backstage cam.", hidden:"VID: Marcus handled cup 15m prior."}
                ],
                sus: [
                    {id:"s1", name:"Lucas", role:"Understudy", hidden:"CHECK: Held cup for 30s only."},
                    {id:"s2", name:"Marcus", role:"Prop Master", hidden:"MOTIVE: Revenge for firing."},
                    {id:"s3", name:"Ms. V", role:"Director", hidden:"ALIBI: Arguing with crew."}
                ]
            },
            jogger: {
                title: "THE FROZEN JOGGER", diff: "LEVEL 3", culprit: "kyle",
                brief: "Body found in snow. Only ONE set of prints leads to body. None leading away.",
                text: "Kyle walked **backward** carrying the victim, stepping in his own tracks. The deep footprints prove he was carrying a heavy load. He is the only suspect strong enough.",
                ev: [
                    {id:"e1", name:"Prints", desc:"Deep snow prints.", hidden:"PHYSICS: 2x depth = Heavy load carried."},
                    {id:"e2", name:"Temp Log", desc:"Weather data.", hidden:"DATA: -5C at time of death."},
                    {id:"e3", name:"Puddle", desc:"Water near body.", hidden:"LAB: Melted icicle (Weapon)."}
                ],
                sus: [
                    {id:"s1", name:"Kyle", role:"Ex", hidden:"SIZE: 6'4 Rugby Player. Boots match."},
                    {id:"s2", name:"Gary", role:"Rival", hidden:"MED: Broken leg. Cannot walk."},
                    {id:"s3", name:"Sam", role:"Gardener", hidden:"CHECK: Wrong shoe size."}
                ]
            },
            express: {
                title: "MIDNIGHT EXPRESS", diff: "LEVEL 3", culprit: "alfred",
                brief: "Murder on a moving train. Body found in cabin. Killer is still on board.",
                text: "The watch was smashed to fake the time of death. The train was in a pitch black **Tunnel** at the alleged time. Alfred admitted to being there earlier, the only possible time for the crime.",
                ev: [
                    {id:"e1", name:"Watch", desc:"Smashed at 11:45.", hidden:"FAKE: Smashed intentionally."},
                    {id:"e2", name:"Log", desc:"Train Route.", hidden:"FACT: Tunnel (Darkness) at 11:45."},
                    {id:"e3", name:"Tea Set", desc:"Used cup.", hidden:"PRINT: Butler's prints found."}
                ],
                sus: [
                    {id:"s1", name:"Alfred", role:"Butler", hidden:"NOTE: Admitted being there at 11:30."},
                    {id:"s2", name:"Dr. Green", role:"Passenger", hidden:"CHECK: Asleep in cabin."},
                    {id:"s3", name:"Heir", role:"Son", hidden:"ALIBI: In Bar at 11:45."}
                ]
            }
        };

        /* --- STATE --- */
        let activeCase = null;
        let time = 600;
        let strikes = 0;
        let gameOn = false;
        let timerInt, autoInt;
        let sound = true;

        /* --- AUDIO MOCK --- */
        const SFX = {
            ctx: new (window.AudioContext||window.webkitAudioContext)(),
            play(f,t,l) {
                if(!sound) return;
                let o=this.ctx.createOscillator(), g=this.ctx.createGain();
                o.type=t; o.frequency.value=f;
                o.connect(g); g.connect(this.ctx.destination);
                o.start(); g.gain.exponentialRampToValueAtTime(0.0001, this.ctx.currentTime+l);
                o.stop(this.ctx.currentTime+l);
            },
            warn() { this.play(100,'sawtooth',0.4); },
            click() { this.play(800,'sine',0.05); },
            beep() { this.play(2000,'square',0.1); },
            win() { this.play(600,'sine',0.2); setTimeout(()=>this.play(900,'sine',0.4),150); }
        };
        
        function toggleMute() { sound=!sound; document.getElementById('soundBtn').innerText = sound?"SND: ON":"SND: OFF"; }

        /* --- LOGIC --- */
        function loadCase(id) {
            SFX.ctx.resume();
            activeCase = DB[id];
            gameOn = true;
            time = 600; strikes = 0;
            
            // Render UI
            document.getElementById('startModal').style.display = 'none';
            document.getElementById('endModal').style.display = 'none';
            document.getElementById('cTitle').innerText = activeCase.title;
            document.getElementById('cDiff').innerText = activeCase.diff;
            document.getElementById('cBrief').innerText = activeCase.brief;
            log("CASE LOADED: " + activeCase.title);

            // Evidence
            let h = '';
            activeCase.ev.forEach(e => {
                let r = (Math.random()*4-2).toFixed(1);
                h += `<div class="doc" id="${e.id}" style="transform:rotate(${r}deg)">
                    <div class="tape"></div><h3>${e.name}</h3><p>${e.desc}</p>
                    <div class="censored">${e.hidden}</div>
                    <div class="actions"><button class="stamp-btn btn-reveal" onclick="force('${e.id}','${e.name}')">FORCE DECRYPT (-90s)</button></div>
                </div>`;
            });
            document.getElementById('evGrid').innerHTML = h;

            // Suspects
            h = '';
            activeCase.sus.forEach(s => {
                let r = (Math.random()*4-2).toFixed(1);
                h += `<div class="polaroid" id="${s.id}" style="transform:rotate(${r}deg)">
                    <div class="tape"></div><div class="photo">?</div>
                    <div class="name-tag">${s.name} <small>(${s.role})</small></div>
                    <div class="censored">${s.hidden}</div>
                    <div class="actions">
                        <button class="stamp-btn btn-reveal" onclick="force('${s.id}','${s.name}')">BG CHECK (-90s)</button>
                        <button class="stamp-btn" onclick="accuse('${s.name}')" style="color:#a00; border-color:#a00">ISSUE WARRANT</button>
                    </div>
                </div>`;
            });
            document.getElementById('susGrid').innerHTML = h;

            // Timers
            updateHUD();
            if(timerInt) clearInterval(timerInt);
            timerInt = setInterval(tick, 1000);
            if(autoInt) clearInterval(autoInt);
            autoInt = setInterval(autoReveal, 60000);
        }

        function tick() {
            if(!gameOn) return;
            time--;
            updateHUD();
            if(time <= 0) gameOver(false, "TIME EXPIRED");
        }

        function updateHUD() {
            let m = Math.floor(time/60).toString().padStart(2,'0');
            let s = (time%60).toString().padStart(2,'0');
            let tEl = document.getElementById('timer');
            tEl.innerText = m+":"+s;
            tEl.className = time<60 ? "timer-stamp critical" : "timer-stamp";
            
            document.getElementById('x1').className = strikes>=1 ? "x-mark active" : "x-mark";
            document.getElementById('x2').className = strikes>=2 ? "x-mark active" : "x-mark";
        }

        function force(id, name) {
            if(!gameOn) return;
            let el = document.getElementById(id);
            if(el.classList.contains('revealed')) return;
            
            time -= 90;
            updateHUD();
            shake();
            SFX.warn();
            log("PENALTY: -90s");
            reveal(id, name, false);
        }

        function reveal(id, name, auto) {
            let el = document.getElementById(id);
            if(!el) return;
            el.classList.add('revealed');
            log(auto ? "NEW INTEL: "+name : "DECRYPTED: "+name);
            if(auto) SFX.beep();
        }

        function autoReveal() {
            if(!gameOn) return;
            let hidden = document.querySelectorAll('.doc:not(.revealed), .polaroid:not(.revealed)');
            if(hidden.length>0) {
                let t = hidden[Math.floor(Math.random()*hidden.length)];
                let n = t.querySelector('h3') ? t.querySelector('h3').innerText : t.querySelector('.name-tag').innerText;
                reveal(t.id, n, true);
            }
        }

        function accuse(name) {
            if(!gameOn) return;
            if(name.toLowerCase().includes(activeCase.culprit)) {
                gameOver(true);
            } else {
                strikes++;
                shake();
                SFX.warn();
                updateHUD();
                if(strikes >= 2) gameOver(false, "EXCESSIVE ERRORS. FIRED.");
                else {
                    time -= 60;
                    updateHUD();
                    log("WARRANT DENIED. STRIKE "+strikes);
                }
            }
        }

        function gameOver(win, reason) {
            gameOn = false;
            clearInterval(timerInt);
            clearInterval(autoInt);
            
            let modal = document.getElementById('endModal');
            let stamp = document.getElementById('endStamp');
            let text = document.getElementById('endText');
            
            if(win) {
                SFX.win();
                stamp.innerText = "SOLVED";
                stamp.className = "stamp s-solved";
                text.innerHTML = activeCase.text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            } else {
                SFX.warn();
                stamp.innerText = "COLD CASE";
                stamp.className = "stamp s-failed";
                text.innerHTML = `<strong style="color:#a00">FAILURE REPORT:</strong><br>${reason}`;
            }
            modal.style.display = 'flex';
        }

        function log(msg) {
            let d = document.createElement('div');
            d.className = 'log-entry';
            d.innerText = "> "+msg;
            document.getElementById('log').prepend(d);
        }

        function shake() {
            let b = document.getElementById('shaker');
            b.style.transform = "translate(5px, 5px)";
            setTimeout(()=>b.style.transform="translate(-5px, -5px)", 50);
            setTimeout(()=>b.style.transform="translate(5px, -5px)", 100);
            setTimeout(()=>b.style.transform="none", 150);
        }

        function tab(id) {
            document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
            SFX.click();
        }

        function showArchives() {
            gameOn = false;
            document.getElementById('endModal').style.display='none';
            document.getElementById('startModal').style.display='flex';
        }

        // Boot
        document.getElementById('startModal').style.display='flex';
    </script>
</body>
</html>