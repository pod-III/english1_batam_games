<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detective OS v2.1 - Academy Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Fahrul's Requested Palette */
            --pink: #FF6B95;
            --orange: #FF8C42;
            --green: #00E676;
            --blue: #2979FF;
            
            /* Dark Mode UI Colors */
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --bg-input: #020617;
            --text-light: #f8fafc;
            --text-dim: #94a3b8;
            
            --border-color: rgba(255,255,255,0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid var(--blue);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            z-index: 10;
        }

        .brand {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .brand span { color: var(--blue); }

        .header-controls { display: flex; gap: 15px; align-items: center; }
        
        .control-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-dim);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        .control-btn:hover { border-color: var(--green); color: var(--green); background: rgba(255,255,255,0.05); }

        /* --- Main Layout --- */
        .main-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 70px);
            position: relative;
        }

        /* LEFT PANEL: Visual Data (GUI) */
        .gui-panel {
            flex: 1.2;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* RIGHT PANEL: Terminal (CLI) */
        .cli-panel {
            flex: 1;
            background-color: #0d1117;
            display: flex;
            flex-direction: column;
            font-family: 'JetBrains Mono', monospace;
            border-left: 1px solid #30363d;
        }

        /* --- GUI Components --- */
        .case-header {
            background: linear-gradient(145deg, var(--bg-panel), #232d42);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: background 0.5s ease;
        }
        .case-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 4px; height: 100%;
            background: var(--orange);
        }

        .timer-badge {
            position: absolute;
            right: 20px;
            top: 20px;
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid var(--green);
            color: var(--green);
            font-family: 'JetBrains Mono', monospace;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 0 10px rgba(0, 230, 118, 0.2);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .nav-btn {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            color: var(--text-dim);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
        }
        .nav-btn:hover { background: #2d3748; }
        .nav-btn.active {
            background: var(--blue);
            color: white;
            border-color: var(--blue);
            box-shadow: 0 4px 12px rgba(41, 121, 255, 0.3);
        }

        .view-section { display: none; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .view-section.active { display: block; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Grid for Cards */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .data-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .data-card:hover {
            transform: translateY(-2px);
            border-color: var(--blue);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .data-card h3 { color: var(--pink); margin-bottom: 5px; display: flex; justify-content: space-between; }
        .data-card .type-badge { font-size: 0.7em; background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; color: var(--text-dim); }
        
        .locked-overlay {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            border: 1px dashed var(--text-dim);
            color: var(--text-dim);
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .unlocked-content {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 230, 118, 0.1);
            border-radius: 6px;
            border-left: 3px solid var(--green);
            color: #e2e8f0;
            font-size: 0.9em;
            display: none; /* Hidden by default */
        }

        .data-card.revealed .locked-overlay { display: none; }
        .data-card.revealed .unlocked-content { display: block; animation: fadeIn 0.5s; }

        /* --- Terminal Components --- */
        .cli-header {
            padding: 10px 15px;
            background: #010409;
            color: var(--text-dim);
            font-size: 0.8rem;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: space-between;
        }

        .cli-output {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .cli-input-wrapper {
            background: var(--bg-input);
            padding: 15px;
            border-top: 1px solid #30363d;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prompt { color: var(--green); font-weight: bold; }
        
        #cliInput {
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            flex: 1;
            outline: none;
        }

        /* Terminal Text Styles */
        .log-line { margin-bottom: 6px; }
        .log-success { color: var(--green); }
        .log-error { color: var(--pink); }
        .log-warn { color: var(--orange); }
        .log-info { color: var(--blue); }
        .log-user { color: var(--text-dim); border-left: 2px solid var(--text-dim); padding-left: 8px; margin: 8px 0; }

        /* Modal/Overlay */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s ease;
        }
        
        .modal-content {
            background: var(--bg-panel);
            padding: 40px;
            border-radius: 16px;
            border: 1px solid var(--blue);
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .modal-title { font-size: 2rem; margin-bottom: 10px; color: var(--blue); }
        .modal-btn {
            margin-top: 20px;
            padding: 15px 30px;
            background: var(--blue);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.3s;
            width: 100%;
            font-family: 'JetBrains Mono', monospace;
            text-align: left;
        }
        .modal-btn:hover { background: var(--green); color: #000; transform: translateX(5px); }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; height: auto; }
            .gui-panel { height: 50vh; }
            .cli-panel { height: 50vh; }
            body { overflow: auto; }
        }

        /* Typing Cursor Animation */
        .typing-cursor::after {
            content: '‚ñã';
            animation: blink 1s infinite;
            color: var(--green);
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        
    </style>
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="brand">
            <span>//</span> DETECTIVE_OS <span>v2.1</span>
        </div>
        <div class="header-controls">
            <button class="control-btn" onclick="showMainMenu()" title="Switch Case / Main Menu">üìÇ</button>
            <button class="control-btn" id="soundToggle" onclick="toggleSound()" title="Toggle Sound">üîä</button>
            <div style="color: var(--text-dim); font-size: 0.9rem; margin-left: 10px;">Classroom Mode</div>
        </div>
    </header>

    <!-- MAIN INTERFACE -->
    <div class="main-container">
        
        <!-- LEFT: VISUAL DATA -->
        <div class="gui-panel">
            
            <!-- Case Status Header -->
            <div class="case-header">
                <h2 style="color: var(--text-light); margin-bottom: 5px;" id="caseTitle">Waiting for Input...</h2>
                <p style="color: var(--text-dim);" id="caseDifficulty">System Standby</p>
                <div class="timer-badge" id="timerDisplay">00:00</div>
            </div>

            <!-- Navigation -->
            <div class="nav-tabs">
                <button class="nav-btn active" onclick="switchView('brief')">üìÅ Brief</button>
                <button class="nav-btn" onclick="switchView('evidence')">üîç Evidence</button>
                <button class="nav-btn" onclick="switchView('suspects')">üë• Suspects</button>
            </div>

            <!-- View: Brief -->
            <div id="brief" class="view-section active">
                <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 8px; line-height: 1.6;">
                    <h3 style="color: var(--orange); margin-bottom: 10px;">Incident Report</h3>
                    <p id="briefText">No active investigation. Please initialize a case from the terminal.</p>
                    <div style="margin-top: 20px; padding: 10px; background: rgba(41, 121, 255, 0.1); border-radius: 6px; font-size: 0.9rem; color: var(--blue);">
                        ‚ÑπÔ∏è <strong>Teacher's Note:</strong> Instruct students to look at the right-hand terminal to start.
                    </div>
                </div>
            </div>

            <!-- View: Evidence -->
            <div id="evidence" class="view-section">
                <div class="grid-container" id="evidenceGrid">
                    <!-- Injected via JS -->
                </div>
            </div>

            <!-- View: Suspects -->
            <div id="suspects" class="view-section">
                <div class="grid-container" id="suspectGrid">
                    <!-- Injected via JS -->
                </div>
            </div>

        </div>

        <!-- RIGHT: TERMINAL -->
        <div class="cli-panel">
            <div class="cli-header">
                <span>root@detective-academy:~</span>
                <span>BASH v5.2</span>
            </div>
            <div class="cli-output" id="cliOutput">
                <!-- Logs go here -->
            </div>
            <div class="cli-input-wrapper">
                <span class="prompt">‚ûú</span>
                <input type="text" id="cliInput" placeholder="Type command here..." autocomplete="off" spellcheck="false">
            </div>
        </div>

    </div>

    <!-- CASE SELECTION MODAL -->
    <div class="modal-overlay" id="startModal">
        <div class="modal-content">
            <div class="modal-title">üïµÔ∏è DETECTIVE OS</div>
            <p style="color: var(--text-dim); margin-bottom: 30px;">Select an investigation to begin class.</p>
            
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button class="modal-btn" onclick="initGame('trophy')"><strong>[EASY]</strong> Case 1: The Missing Trophy</button>
                <button class="modal-btn" onclick="initGame('poison')" style="border-color: var(--orange); color: var(--orange);"><strong>[MED]</strong> Case 2: The Poisoned Diner</button>
                <button class="modal-btn" onclick="initGame('library')" style="border-color: var(--pink); color: var(--pink);"><strong>[HARD]</strong> Case 3: The Library Mystery</button>
            </div>
        </div>
    </div>

    <script>
        /* --- GAME DATA --- */
        const cases = {
            trophy: {
                title: "The Missing Championship Trophy",
                difficulty: "EASY // TIME: 10:00",
                brief: "The Westfield High Golden Trophy vanished from the locked case between 3:30 PM and 6:00 AM. The lock was picked, not broken. Security cameras were disabled specifically between 4:15 PM and 4:45 PM.",
                culprit: "carmen",
                evidence: [
                    { id: "fabric", name: "Blue Fabric", type: "Physical", desc: "Torn fabric caught on the case latch.", hidden: "Material Analysis: Synthetic blend used in Security Guard uniforms." },
                    { id: "prints", name: "Muddy Prints", type: "Trace", desc: "Size 9 boot prints near the exit.", hidden: "Forensic Match: Heavy duty work boots. Soil matches the school garden." },
                    { id: "logbook", name: "Security Log", type: "Document", desc: "Daily patrol sign-in sheet.", hidden: "Anomaly Detected: The 4:30 PM patrol check is completely missing." }
                ],
                suspects: [
                    { id: "jake", name: "Jake", role: "Star Player", desc: "Failing grades. Needs scholarship.", hidden: "Alibi Verified: Was at math tutoring until 5:00 PM." },
                    { id: "carmen", name: "Carmen", role: "Security Guard", desc: "Shift started at 4:00 PM.", hidden: "Motive Found: Complained about low pay. Has master keys and camera access." },
                    { id: "wells", name: "Ms. Wells", role: "Rival Coach", desc: "Spotted in parking lot at 4:20 PM.", hidden: "Alibi Verified: Was arguing with the Principal in his office." }
                ]
            },
            poison: {
                title: "The Poisoned Diner",
                difficulty: "MEDIUM // TIME: 10:00",
                brief: "Elena collapsed at 'The Rusty Spoon' diner at midnight. The air smelled of bitter almonds (Cyanide). Four friends were at the table.",
                culprit: "leo",
                evidence: [
                    { id: "glass", name: "Lemonade Glass", type: "Physical", desc: "Elena's glass is half full.", hidden: "Toxicology Report: High concentration of Cyanide found in the ice cubes." },
                    { id: "receipt", name: "Order Receipt", type: "Document", desc: "Time: 11:55 PM. Server: Leo.", hidden: "Note: The drinks were ordered and served exclusively by Leo." },
                    { id: "pie", name: "Apple Pie", type: "Food", desc: "Half eaten slice on table.", hidden: "Analysis: Pie is non-toxic. Sugar content normal." }
                ],
                suspects: [
                    { id: "maya", name: "Maya", role: "Best Friend", desc: "Sat next to Elena.", hidden: "Check: Bag contained only personal items. No chemical traces." },
                    { id: "leo", name: "Leo", role: "Waiter", desc: "Served the table.", hidden: "Background Check: Former chemistry student. Recently fired from pharmacy for theft." },
                    { id: "harlan", name: "Harlan", role: "Owner", desc: "In the kitchen.", hidden: "Alibi: Was on a phone call with suppliers from 11:40 to 12:10." }
                ]
            },
            library: {
                title: "The Library Mystery",
                difficulty: "HARD // TIME: 08:00",
                brief: "A rare First Edition book ($75,000) was stolen from the vault. The digital lock was opened with a valid code, but no entry was logged in the main system.",
                culprit: "sarah",
                evidence: [
                    { id: "gloves", name: "Cotton Gloves", type: "Physical", desc: "Found on the floor.", hidden: "DNA Result: Traces of nervous sweat. Size Small." },
                    { id: "server", name: "Server Logs", type: "Digital", desc: "Network activity report.", hidden: "Hack Detected: The main log was suppressed by a bypass script at 7:20 PM." },
                    { id: "coffee", name: "Coffee Cup", type: "Trace", desc: "Expensive brand, still warm.", hidden: "Fingerprint: Matches Sarah Kim." }
                ],
                suspects: [
                    { id: "harper", name: "Dr. Harper", role: "Librarian", desc: "Has vault code.", hidden: "Alibi: Was at a budget meeting downtown." },
                    { id: "sarah", name: "Sarah", role: "Grad Student", desc: "Computer Science major.", hidden: "Motive: Deep debt. Tech skills confirm ability to hack logs." },
                    { id: "davis", name: "Prof. Davis", role: "English Dept", desc: "Last person seen.", hidden: "Check: Arthritis prevents him from typing fast enough for the hack." }
                ]
            }
        };

        /* --- STATE MANAGEMENT --- */
        let currentCase = null;
        let timeLeft = 600;
        let timerInterval = null;
        let soundEnabled = true;
        let gameActive = false;

        /* --- AUDIO ENGINE --- */
        const AudioEngine = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            playTone: function(freq, type, duration) {
                if (!soundEnabled) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.value = freq;
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                gain.gain.exponentialRampToValueAtTime(0.00001, this.ctx.currentTime + duration);
                osc.stop(this.ctx.currentTime + duration);
            },
            type: function() { this.playTone(800, 'sine', 0.05); },
            error: function() { this.playTone(150, 'sawtooth', 0.3); },
            success: function() { 
                this.playTone(600, 'sine', 0.1);
                setTimeout(() => this.playTone(1200, 'sine', 0.2), 100);
            },
            scan: function() {
                if (!soundEnabled) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.frequency.setValueAtTime(200, this.ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(800, this.ctx.currentTime + 0.3);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.3);
            }
        };

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').innerText = soundEnabled ? 'üîä' : 'üîá';
            document.getElementById('cliInput').focus();
        }

        /* --- INITIALIZATION --- */
        function initGame(caseKey) {
            currentCase = cases[caseKey];
            gameActive = true;
            timeLeft = caseKey === 'library' ? 480 : 600; // 8 mins for hard, 10 for others
            
            // Clear Terminal for new game
            const cli = document.getElementById('cliOutput');
            cli.innerHTML = '';
            
            // UI Setup
            document.getElementById('startModal').style.display = 'none';
            document.getElementById('caseTitle').innerText = currentCase.title;
            document.getElementById('caseDifficulty').innerText = currentCase.difficulty;
            document.getElementById('briefText').innerText = currentCase.brief;
            
            // Reset visual styles
            document.querySelector('.case-header').style.background = "linear-gradient(145deg, var(--bg-panel), #232d42)";
            
            // Populate Grids
            renderGrid('evidenceGrid', currentCase.evidence, 'scan');
            renderGrid('suspectGrid', currentCase.suspects, 'check');
            
            // Start Terminal
            writeLog("INITIALIZING DETECTIVE OS...", "log-info");
            setTimeout(() => writeLog("CONNECTING TO POLICE DATABASE... [OK]", "log-success"), 500);
            setTimeout(() => {
                writeLog("CASE DATA LOADED.", "log-success");
                writeLog("Type 'help' for available commands.", "log-warn");
            }, 1000);
            
            // Start Timer
            startTimer();
            document.getElementById('cliInput').focus();
        }

        function showMainMenu() {
            gameActive = false;
            clearInterval(timerInterval);
            document.getElementById('startModal').style.display = 'flex';
            // Optional: write to log if key is still visible
            writeLog("SESSION INTERRUPTED. RETURNED TO MENU.", "log-warn");
        }

        function renderGrid(elementId, dataArray, commandPrefix) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            dataArray.forEach(item => {
                const card = document.createElement('div');
                card.className = 'data-card';
                card.id = `card-${item.id}`;
                card.innerHTML = `
                    <h3>${item.name} <span class="type-badge">${item.type || item.role}</span></h3>
                    <p style="color: #cbd5e1; font-size: 0.9em; margin-bottom: 8px;">${item.desc}</p>
                    <div class="locked-overlay">
                        <span>üîí LOCKED</span>
                        <span style="font-size: 0.8em; opacity: 0.7;">Use '${commandPrefix} ${item.name.split(' ')[0].toLowerCase()}'</span>
                    </div>
                    <div class="unlocked-content">${item.hidden}</div>
                `;
                container.appendChild(card);
            });
        }

        /* --- GAME LOGIC --- */
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                if (!gameActive) return;
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    gameOver(false);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            const display = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            const badge = document.getElementById('timerDisplay');
            badge.innerText = display;
            
            if (timeLeft < 60) {
                badge.style.color = 'var(--pink)';
                badge.style.borderColor = 'var(--pink)';
                badge.style.boxShadow = '0 0 15px rgba(255, 107, 149, 0.3)';
            } else {
                badge.style.color = 'var(--green)';
                badge.style.borderColor = 'var(--green)';
                badge.style.boxShadow = '0 0 10px rgba(0, 230, 118, 0.2)';
            }
        }

        function gameOver(win) {
            gameActive = false;
            clearInterval(timerInterval);
            if (win) {
                writeLog("üéâ CONGRATULATIONS! CASE SOLVED!", "log-success");
                writeLog("The culprit has been apprehended.", "log-info");
                AudioEngine.success();
                document.querySelector('.case-header').style.background = "linear-gradient(145deg, #064e3b, #065f46)"; // Victory Green
                writeLog("Type 'menu' to start a new case.", "log-warn");
            } else {
                writeLog("üíÄ CRITICAL FAILURE. TIME EXPIRED.", "log-error");
                writeLog("The suspect has escaped jurisdiction.", "log-error");
                AudioEngine.error();
                document.querySelector('.case-header').style.background = "linear-gradient(145deg, #881337, #9f1239)"; // Defeat Red
                writeLog("Type 'menu' to retry.", "log-warn");
            }
        }

        /* --- TERMINAL ENGINE --- */
        const cliInput = document.getElementById('cliInput');
        const cliOutput = document.getElementById('cliOutput');

        cliInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const cmd = this.value.trim();
                this.value = '';
                processCommand(cmd);
            } else {
                AudioEngine.type();
            }
        });

        function writeLog(text, className = '') {
            const line = document.createElement('div');
            line.className = `log-line ${className}`;
            cliOutput.appendChild(line);
            cliOutput.scrollTop = cliOutput.scrollHeight;

            // Typewriter effect for the content
            let i = 0;
            line.innerHTML = ''; // Clear initially
            const typeInterval = setInterval(() => {
                line.textContent += text.charAt(i);
                i++;
                if (i > text.length) clearInterval(typeInterval);
            }, 10);
        }

        function processCommand(input) {
            // Allow 'menu' or 'exit' even if game is inactive/over
            if (!gameActive && input !== 'restart' && input !== 'exit' && input !== 'menu') {
                writeLog("System offline. Type 'menu' to select a new case.", "log-error");
                return;
            }

            // Log user input
            const userLine = document.createElement('div');
            userLine.className = 'log-user';
            userLine.textContent = `‚ûú ${input}`;
            cliOutput.appendChild(userLine);

            const parts = input.toLowerCase().split(' ');
            const command = parts[0];
            const args = parts.slice(1).join(' ');

            switch(command) {
                case 'help':
                    writeLog("AVAILABLE COMMANDS:", "log-info");
                    writeLog("  scan [item]   : Analyze evidence (e.g. 'scan gloves')");
                    writeLog("  check [name]  : Background check (e.g. 'check sarah')");
                    writeLog("  accuse [name] : Submit final verdict");
                    writeLog("  status        : Show case timer");
                    writeLog("  menu          : Return to case selection");
                    writeLog("  clear         : Clear terminal");
                    break;

                case 'clear':
                    cliOutput.innerHTML = '';
                    break;

                case 'status':
                    const m = Math.floor(timeLeft / 60);
                    const s = timeLeft % 60;
                    writeLog(`TIME REMAINING: ${m}:${s}`, "log-warn");
                    writeLog(`CASE: ${currentCase.title}`, "log-info");
                    break;

                case 'scan':
                case 'analyze':
                    handleInteraction(args, currentCase.evidence, 'scan');
                    break;

                case 'check':
                case 'investigate':
                    handleInteraction(args, currentCase.suspects, 'check');
                    break;

                case 'accuse':
                    handleAccusation(args);
                    break;
                    
                case 'exit':
                case 'menu':
                case 'quit':
                    showMainMenu();
                    break;

                default:
                    writeLog(`Command not found: '${command}'. Type 'help'.`, "log-error");
                    AudioEngine.error();
            }
        }

        function handleInteraction(targetName, dataArray, type) {
            if (!targetName) {
                writeLog(`Error: Missing target. Usage: ${type} [name]`, "log-error");
                return;
            }

            // Find item by partial match
            const item = dataArray.find(i => 
                i.name.toLowerCase().includes(targetName) || 
                targetName.includes(i.name.toLowerCase().split(' ')[0])
            );

            if (item) {
                const card = document.getElementById(`card-${item.id}`);
                if (card) {
                    if (!card.classList.contains('revealed')) {
                        card.classList.add('revealed');
                        writeLog(`PROCESSING ${item.name.toUpperCase()}...`, "log-warn");
                        setTimeout(() => {
                            writeLog(`‚úÖ ANALYSIS COMPLETE. DATA UPDATED.`, "log-success");
                            AudioEngine.scan();
                            // Auto switch view
                            switchView(type === 'scan' ? 'evidence' : 'suspects');
                        }, 800);
                    } else {
                        writeLog(`Info: ${item.name} already analyzed.`, "log-info");
                    }
                }
            } else {
                writeLog(`Error: Subject '${targetName}' not found in database. Check spelling.`, "log-error");
                AudioEngine.error();
            }
        }

        function handleAccusation(suspectName) {
            if (!suspectName) {
                writeLog("Error: Usage 'accuse [suspect name]'", "log-error");
                return;
            }

            writeLog("‚ö†Ô∏è SUBMITTING FINAL VERDICT...", "log-warn");
            setTimeout(() => {
                if (suspectName.toLowerCase().includes(currentCase.culprit)) {
                    gameOver(true);
                } else {
                    writeLog("‚ùå INCORRECT VERDICT.", "log-error");
                    writeLog("DNA does not match. 60 seconds penalty.", "log-error");
                    timeLeft -= 60;
                    AudioEngine.error();
                    updateTimerDisplay();
                }
            }, 1500);
        }

        /* --- VIEW CONTROLLER --- */
        function switchView(viewId) {
            // Update Tabs
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = Array.from(document.querySelectorAll('.nav-btn')).find(b => b.getAttribute('onclick').includes(viewId));
            if(activeBtn) activeBtn.classList.add('active');

            // Update Sections
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            // Sound effect
            AudioEngine.type();
        }

    </script>
</body>
</html>