<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Animator: Classroom Edition</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@400;700&family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        pink: '#FF6B95',
                        orange: '#FF8C42',
                        green: '#00E676',
                        blue: '#2979FF',
                        dark: '#0f172a',
                        panel: '#1e293b',
                        surface: '#334155'
                    },
                    fontFamily: {
                        heading: ['Bebas Neue', 'sans-serif'],
                        body: ['Nunito', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0f172a;
            background-image: 
                radial-gradient(at 0% 0%, rgba(41, 121, 255, 0.15) 0px, transparent 50%), 
                radial-gradient(at 100% 100%, rgba(255, 107, 149, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            overflow: hidden; /* Crucial for full screen app */
        }

        /* --- Word Animation --- */
        .moving-word {
            position: absolute;
            cursor: default;
            user-select: none;
            transition: opacity 1s, font-size 0.5s; 
            text-shadow: 0 4px 15px rgba(0,0,0,0.5);
            white-space: nowrap;
            will-change: transform;
            top: 0;
            left: 0;
        }

        /* --- UI Animations --- */
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .animate-slide { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        
        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #00E676;
            margin-top: -6px;
            box-shadow: 0 0 10px rgba(0, 230, 118, 0.5);
            cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #334155;
            border-radius: 2px;
        }

        /* Scrollbar for textarea */
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #0f172a; }
        textarea::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body class="text-white h-screen w-screen flex overflow-hidden font-body">

    <!-- LEFT PANEL: CONTROLS (Auto-open: removed absolute, hidden, translate classes) -->
    <aside id="controls" class="w-full md:w-96 bg-panel/90 backdrop-blur-xl border-r border-white/10 h-full flex flex-col shadow-2xl z-50 transition-transform duration-300 relative transform">
        
        <!-- Header -->
        <div class="p-6 border-b border-white/10 bg-black/20">
            <h1 class="text-3xl font-heading tracking-wider text-white flex items-center gap-2">
                <span class="text-blue">///</span> WORD ANIMATOR
            </h1>
            <p class="text-xs text-gray-400 font-mono mt-1">VISUAL VOCABULARY TOOL v2.2</p>
        </div>

        <!-- Controls Body -->
        <div class="flex-1 p-6 overflow-y-auto space-y-6">
            
            <!-- Instructions -->
            <div class="bg-blue/10 border border-blue/20 p-4 rounded-lg">
                <p class="text-sm text-blue-200 leading-relaxed">
                    <strong class="text-blue">DVD Bounce Mode:</strong><br>
                    Words bounce off screen edges. Use the slider in the top-right to adjust difficulty.
                </p>
            </div>

            <!-- Input -->
            <div class="space-y-2">
                <label class="text-xs font-bold text-gray-400 uppercase tracking-widest">Word Data Source (Auto-Saved)</label>
                <textarea id="word-input" spellcheck="false"
                    class="w-full h-64 p-4 bg-dark text-gray-200 font-mono text-sm border border-white/10 rounded-xl focus:border-blue focus:ring-1 focus:ring-blue outline-none resize-none shadow-inner"
                    placeholder="Example:
Apple, Banana, Cherry
Dog, Cat, Elephant
Red, Blue, Green"
                >Apple, Banana, Cheery
A,P,P,L,E
She,likes,to,eat,pizza</textarea>
            </div>

            <!-- Action Buttons -->
            <div class="space-y-3">
                <button onclick="parseAndLoadRounds()" 
                    class="w-full bg-gradient-to-r from-blue to-green hover:brightness-110 text-black font-bold py-3 px-4 rounded-xl shadow-lg transform active:scale-95 transition-all flex items-center justify-center gap-2 font-heading text-xl tracking-wide">
                    <span>‚ñ∂</span> LOAD & START
                </button>
                
                <button onclick="toggleControls()" 
                    class="w-full bg-surface hover:bg-white/20 text-white font-semibold py-3 px-4 rounded-xl border border-white/5 transition-all text-sm">
                    Hide Panel (Fullscreen)
                </button>
            </div>

        </div>

        <!-- Status Footer -->
        <div class="p-4 border-t border-white/10 bg-black/20">
            <div id="round-counter" class="text-center font-mono text-orange font-bold text-lg">
                STATUS: READY
            </div>
        </div>
    </aside>

    <!-- MAIN DISPLAY AREA -->
    <main id="display-area" class="flex-1 relative h-full w-full bg-transparent overflow-hidden">
        
        <!-- SPEED CONTROLLER (Top Right) -->
        <div class="absolute top-6 right-6 z-50 flex items-center gap-4 bg-panel/80 backdrop-blur-md px-5 py-3 rounded-full border border-white/10 shadow-2xl animate-slide">
            <div class="flex flex-col">
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Speed</span>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-blue">üê¢</span>
                    <input type="range" id="speed-slider" min="0.5" max="5" step="0.1" value="1.5" oninput="updateSpeed(this.value)" class="w-32">
                    <span class="text-xs text-pink">üêá</span>
                </div>
            </div>
            <div class="border-l border-white/10 pl-4">
                <span id="speed-display" class="font-mono text-green font-bold text-lg">1.5x</span>
            </div>
        </div>

        <!-- Canvas for words -->
        <div id="word-display" class="w-full h-full relative overflow-hidden">
            <div id="initial-message" class="absolute inset-0 flex flex-col items-center justify-center text-gray-500 animate-pulse space-y-4">
                <div class="w-16 h-16 rounded-full border-4 border-gray-700 flex items-center justify-center text-3xl">‚ú®</div>
                <p class="font-heading text-2xl tracking-widest opacity-50">WAITING FOR DATA...</p>
            </div>
        </div>

        <!-- Floating Controls (Bottom Right) -->
        <div class="absolute bottom-8 right-8 flex gap-4 z-40">
             <!-- Show Controls Button (Hidden by default) -->
            <button id="show-controls-btn" onclick="toggleControls()" 
                class="hidden bg-surface hover:bg-white/20 text-white p-4 rounded-full shadow-xl border border-white/10 transition-all hover:scale-110 group">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="9" x2="9" y1="3" y2="21"/></svg>
            </button>

            <!-- Next Round Button -->
            <button id="next-round-btn" onclick="loadNextRound()" 
                class="bg-pink hover:bg-pink/90 text-white px-8 py-4 rounded-full shadow-xl shadow-pink/20 font-heading text-xl tracking-wide transition-all hover:scale-105 hover:-translate-y-1 flex items-center gap-2 border border-white/10">
                NEXT ROUND <span class="text-2xl">‚Üí</span>
            </button>
        </div>

    </main>

    <script>
        // --- LOCAL STORAGE KEY ---
        const LS_KEY_WORDS = 'wordAnimatorData';

        let roundsData = [];
        let currentRoundIndex = -1;
        let activeBouncingWords = [];
        let animationFrameId;
        let globalSpeedMultiplier = 1.5; // Default speed

        // Palette colors from Tailwind config
        const textClasses = [
            "text-pink",
            "text-orange",
            "text-green",
            "text-blue",
            "text-white"
        ];
        
        const fontSizes = ["text-4xl", "text-5xl", "text-6xl", "text-7xl"];
        
        const wordInput = document.getElementById("word-input");
        const controlsPanel = document.getElementById("controls");

        // --- AUTOSAVE/LOAD FUNCTIONS ---

        function saveWords(wordsString) {
             try {
                localStorage.setItem(LS_KEY_WORDS, wordsString);
            } catch (e) {
                console.error("Could not save words to local storage:", e);
            }
        }

        function loadWords() {
            try {
                const savedWords = localStorage.getItem(LS_KEY_WORDS);
                // Only load saved content if it exists. Otherwise, the default HTML content is used.
                if (savedWords) {
                    wordInput.value = savedWords;
                }
            } catch (e) {
                console.error("Could not load words from local storage:", e);
            }
        }

        // --- CORE LOGIC ---

        // Update speed from slider
        function updateSpeed(val) {
            globalSpeedMultiplier = parseFloat(val);
            document.getElementById('speed-display').innerText = globalSpeedMultiplier.toFixed(1) + 'x';
        }

        // Class to manage individual word physics
        class BouncingWord {
            constructor(text, containerWidth, containerHeight) {
                this.element = document.createElement("div");
                this.element.textContent = text;
                
                // Styling
                const colorClass = textClasses[Math.floor(Math.random() * textClasses.length)];
                const sizeClass = fontSizes[Math.floor(Math.random() * fontSizes.length)];
                this.element.className = `moving-word font-heading font-bold opacity-90 hover:opacity-100 ${colorClass} ${sizeClass}`;
                
                // Initial hidden state for measurement
                this.element.style.opacity = '0';
                document.getElementById("word-display").appendChild(this.element);
                
                // Measurements
                this.width = this.element.offsetWidth;
                this.height = this.element.offsetHeight;
                
                // Random Position (Safe within bounds)
                this.x = Math.random() * (containerWidth - this.width);
                this.y = Math.random() * (containerHeight - this.height);
                
                // Base Velocity Vector (Normalized direction roughly)
                // We store base vector and apply globalSpeedMultiplier during update
                const angle = Math.random() * Math.PI * 2;
                this.vx = Math.cos(angle);
                this.vy = Math.sin(angle);

                // Set initial pos
                this.updatePosition();
                
                // Reveal
                requestAnimationFrame(() => { this.element.style.opacity = '1'; });
            }

            update(containerWidth, containerHeight) {
                // Move based on Global Speed Multiplier
                this.x += this.vx * globalSpeedMultiplier;
                this.y += this.vy * globalSpeedMultiplier;

                // Bounce X
                if (this.x <= 0) {
                    this.x = 0;
                    this.vx *= -1;
                } else if (this.x + this.width >= containerWidth) {
                    this.x = containerWidth - this.width;
                    this.vx *= -1;
                }

                // Bounce Y
                if (this.y <= 0) {
                    this.y = 0;
                    this.vy *= -1;
                } else if (this.y + this.height >= containerHeight) {
                    this.y = containerHeight - this.height;
                    this.vy *= -1;
                }

                this.updatePosition();
            }

            updatePosition() {
                this.element.style.transform = `translate(${this.x}px, ${this.y}px)`;
            }
        }

        function gameLoop() {
            const container = document.getElementById("word-display");
            if (!container) return; 
            
            const w = container.clientWidth;
            const h = container.clientHeight;

            activeBouncingWords.forEach(word => word.update(w, h));
            
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function loadRound(index) {
            // Cleanup previous
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            document.getElementById("word-display").innerHTML = "";
            activeBouncingWords = [];
            
            if (!roundsData.length) return;
            
            // Loop back to start if finished
            if (index >= roundsData.length) index = 0;
            currentRoundIndex = index;

            const words = roundsData[currentRoundIndex];
            const display = document.getElementById("word-display");
            const w = display.clientWidth;
            const h = display.clientHeight;
            
            // Update Status
            const status = document.getElementById("round-counter");
            status.innerHTML = `ROUND <span class="text-white text-2xl">${index + 1}</span> / ${roundsData.length}`;
            status.className = "text-center font-mono text-green font-bold text-lg animate-pulse";

            // Create Words
            words.forEach((text) => {
                activeBouncingWords.push(new BouncingWord(text, w, h));
            });

            // Start Loop
            gameLoop();
        }

        function parseAndLoadRounds() {
            const input = wordInput.value;
            // Clear any error messages from previous attempt
            const status = document.getElementById("round-counter");
            status.className = "text-center font-mono text-orange font-bold text-lg";

            const lines = input.split("\n").map((l) => l.trim()).filter((l) => l.length > 0);
            
            roundsData = lines.map((line) =>
                line.split(",").map((w) => w.trim()).filter((w) => w.length > 0)
            ).filter((r) => r.length > 0);

            if (!roundsData.length) {
                // Using alert() is forbidden, so we update the status footer instead.
                status.innerHTML = "STATUS: <span class='text-pink'>ERROR - NO WORDS!</span>";
                return;
            }

            // Switch UI state
            if(window.innerWidth < 768) {
                 toggleControls(); // Auto hide on mobile
            }
            
            currentRoundIndex = -1;
            loadNextRound();
        }

        function loadNextRound() {
            if (!roundsData.length) return;
            loadRound(currentRoundIndex + 1);
        }

        function toggleControls() {
            const controls = document.getElementById("controls");
            const showBtn = document.getElementById("show-controls-btn");
            
            // On desktop, the controls panel is relative and always visible. 
            // We use different classes for the two layout states.
            if (controls.classList.contains("relative")) {
                // Transition to hidden (fullscreen view)
                controls.classList.remove("relative");
                controls.classList.add("absolute", "-translate-x-full");
                showBtn.classList.remove("hidden");
            } else {
                 // Transition to visible (setup view)
                controls.classList.remove("absolute", "-translate-x-full");
                controls.classList.add("relative");
                showBtn.classList.add("hidden");
            }
        }

        // Handle window resize to keep physics accurate
        window.addEventListener('resize', () => {
            // The loop handles boundaries dynamically, no reset needed
        });
        
        // --- INITIALIZATION ---
        
        function initializeApplication() {
            // 1. Load words from storage into the input field
            loadWords();
            
            // 2. Attach Auto-Save Hook
            wordInput.addEventListener('input', (e) => {
                saveWords(e.target.value);
            });

            // 3. Auto-open Setup: The controls panel is already visible by default (no 'hidden' class).
            // We just ensure it's in the correct starting state for desktop/mobile.
            controlsPanel.classList.remove("absolute", "-translate-x-full", "hidden");
            controlsPanel.classList.add("relative");
        }
        
        initializeApplication();

    </script>
</body>
</html>