<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English 1 Resource Hub</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'e1-pink': '#FF6B95', 'e1-orange': '#FF8C42',
                        'e1-green': '#00E676', 'e1-blue': '#2979FF',
                        'e1-dark': '#1e293b', 'e1-chalk': '#f8fafc',
                    },
                    fontFamily: {
                        heading: ['Fredoka', 'sans-serif'],
                        body: ['Nunito', 'sans-serif'],
                    },
                    boxShadow: {
                        'neo': '4px 4px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-sm': '2px 2px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-lg': '8px 8px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-xl': '12px 12px 0px 0px rgba(30, 41, 59, 1)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Base Settings */
        body {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.05) 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 12px; height: 12px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; border-left: 2px solid #1e293b; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border: 2px solid #1e293b; border-radius: 6px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Utilities */
        .btn-neo { transition: all 0.1s ease; }
        .btn-neo:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px 0px rgba(30, 41, 59, 1) !important; }
        
        .input-neo { transition: all 0.2s ease; }
        .input-neo:focus { box-shadow: 4px 4px 0px 0px #2979FF; transform: translate(-2px, -2px); border-color: #1e293b; }

        /* Animations */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-card { animation: fadeUp 0.3s ease-out forwards; }
        
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-pop { animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body class="text-e1-dark font-body min-h-screen flex flex-col overflow-hidden selection:bg-e1-pink selection:text-white">

    <nav class="bg-white border-b-4 border-e1-dark px-6 py-4 flex justify-between items-center z-30 shadow-sm sticky top-0">
        <div class="flex items-center gap-4">
            <div class="bg-e1-pink p-2.5 rounded-xl border-2 border-e1-dark shadow-neo-sm rotate-3 hover:rotate-6 transition-transform">
                <i data-lucide="library" class="w-7 h-7 text-white"></i>
            </div>
            <div>
                <h1 class="font-heading font-bold text-3xl tracking-wide leading-none">English 1 <span class="text-e1-blue">Hub</span></h1>
                <p class="text-xs font-bold text-slate-400 tracking-wider uppercase mt-1">Teacher Dashboard</p>
            </div>
        </div>

        <div class="flex gap-4 absolute left-1/2 -translate-x-1/2">
            <button onclick="switchTab('wordbank')" id="tab-wordbank" class="btn-neo bg-e1-orange text-white px-8 py-2.5 rounded-2xl border-2 border-e1-dark shadow-neo font-heading font-bold text-xl flex items-center gap-2 hover:-translate-y-1">
                <i data-lucide="layers" class="w-5 h-5"></i> Topic Decks
            </button>
            <button onclick="switchTab('posters')" id="tab-posters" class="btn-neo bg-white text-e1-dark px-8 py-2.5 rounded-2xl border-2 border-e1-dark shadow-neo font-heading font-bold text-xl flex items-center gap-2 hover:-translate-y-1 hover:bg-slate-50">
                <i data-lucide="image" class="w-5 h-5"></i> Posters
            </button>
        </div>

        <div class="flex items-center gap-2">
            <button id="add-btn" onclick="openCreateModal()" class="btn-neo bg-e1-green text-white px-5 py-2.5 rounded-xl border-2 border-e1-dark shadow-neo font-heading font-bold flex items-center gap-2 hover:-translate-y-1 hover:brightness-105">
                <i data-lucide="plus" class="w-6 h-6 stroke-[3]"></i> 
                <span class="hidden xl:inline">New Deck</span>
            </button>
        </div>
    </nav>

    <main class="flex-1 p-8 overflow-hidden relative">
        <div id="view-wordbank" class="h-full flex flex-col gap-6 max-w-7xl mx-auto">
            <div class="relative group">
                <div class="absolute inset-y-0 left-4 flex items-center pointer-events-none">
                    <i data-lucide="search" class="w-6 h-6 text-slate-400 group-focus-within:text-e1-blue transition-colors"></i>
                </div>
                <input type="text" id="topic-search" onkeyup="filterTopics()" placeholder="Search your topic decks..." class="input-neo w-full bg-white border-2 border-e1-dark rounded-2xl px-6 py-4 pl-14 shadow-neo-sm font-bold text-xl placeholder:text-slate-300 outline-none">
            </div>
            <div id="topic-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 overflow-y-auto pb-32 pr-2"></div>
        </div>

        <div id="view-posters" class="hidden h-full flex-col gap-6 max-w-7xl mx-auto">
            <input type="file" id="poster-input" accept="image/*" class="hidden" onchange="handlePosterUpload(this)">
            <div id="poster-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 overflow-y-auto pb-32 pr-2">
                 <div onclick="document.getElementById('poster-input').click()" class="h-full min-h-[300px] bg-white p-12 rounded-3xl border-4 border-dashed border-e1-dark flex flex-col items-center justify-center text-center gap-4 group cursor-pointer hover:border-e1-blue hover:bg-blue-50 transition-all">
                    <div class="bg-slate-100 p-6 rounded-full group-hover:bg-white group-hover:shadow-neo-sm border-2 border-transparent group-hover:border-e1-blue transition-all">
                        <i data-lucide="upload-cloud" class="w-12 h-12 text-slate-400 group-hover:text-e1-blue"></i>
                    </div>
                    <div>
                        <h3 class="font-heading font-bold text-2xl text-e1-dark group-hover:text-e1-blue">Upload Poster</h3>
                        <p class="text-sm font-bold text-slate-400">Click to select image</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="system-modal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-[60] p-4 backdrop-blur-sm">
        <div class="animate-pop bg-white w-full max-w-md rounded-2xl border-4 border-e1-dark shadow-neo-xl overflow-hidden">
            <div id="sys-header" class="bg-e1-orange border-b-4 border-e1-dark px-6 py-4 flex items-center gap-3">
                <i id="sys-icon" data-lucide="alert-triangle" class="w-8 h-8 text-white stroke-[3]"></i>
                <h3 id="sys-title" class="font-heading font-bold text-2xl text-white tracking-wide">Warning</h3>
            </div>
            <div class="p-6">
                <p id="sys-msg" class="font-bold text-e1-dark text-lg leading-relaxed">Are you sure you want to do this?</p>
            </div>
            <div class="bg-slate-50 border-t-4 border-e1-dark p-4 flex justify-end gap-3">
                <button id="sys-btn-cancel" onclick="closeSystemModal()" class="btn-neo bg-white text-e1-dark px-6 py-2 rounded-xl border-2 border-e1-dark font-heading font-bold text-lg shadow-neo hidden">Cancel</button>
                <button id="sys-btn-confirm" class="btn-neo bg-e1-green text-white px-6 py-2 rounded-xl border-2 border-e1-dark font-heading font-bold text-lg shadow-neo">OK</button>
            </div>
        </div>
    </div>

    <div id="poster-modal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 p-4 backdrop-blur-md">
        <div class="relative max-h-full max-w-full flex flex-col items-center animate-card">
            <button onclick="closeModal('poster-modal')" class="absolute -top-16 right-0 text-white hover:text-e1-pink transition hover:rotate-90">
                <i data-lucide="x-circle" class="w-12 h-12 stroke-[2]"></i>
            </button>
            <img id="poster-focus-img" src="" class="max-h-[85vh] max-w-[90vw] rounded-2xl border-4 border-white shadow-[0px_0px_50px_rgba(0,0,0,0.5)] bg-black object-contain">
            <h2 id="poster-focus-title" class="mt-6 text-white font-heading font-bold text-3xl tracking-wider text-center drop-shadow-md">Title</h2>
        </div>
    </div>

    <div id="set-modal" class="fixed inset-0 bg-slate-900/60 hidden items-center justify-center z-40 p-4 backdrop-blur-md">
        <div class="bg-white w-full max-w-[95vw] h-[92vh] rounded-[2rem] border-4 border-e1-dark shadow-2xl flex flex-col overflow-hidden animate-card">
            <div class="bg-e1-chalk border-b-4 border-e1-dark px-8 py-6 flex justify-between items-center shrink-0">
                <div class="flex items-center gap-5">
                    <div id="modal-icon" class="w-16 h-16 rounded-2xl border-2 border-e1-dark bg-white shadow-neo flex items-center justify-center"></div>
                    <div>
                        <h2 id="modal-set-title" class="font-heading font-bold text-5xl text-e1-dark tracking-tight">Title</h2>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="w-2 h-2 rounded-full bg-e1-green animate-pulse"></span>
                            <p id="modal-set-desc" class="text-slate-500 font-bold text-lg">Description</p>
                        </div>
                    </div>
                </div>
                <button onclick="closeModal('set-modal')" class="btn-neo bg-e1-pink text-white px-8 py-3 rounded-xl border-2 border-e1-dark font-heading font-bold text-xl shadow-neo flex items-center gap-3">
                    <i data-lucide="x" class="w-6 h-6 stroke-[3]"></i> Close
                </button>
            </div>
            <div class="flex-1 bg-slate-50/50 p-8 overflow-y-auto">
                <div id="modal-word-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"></div>
            </div>
        </div>
    </div>

    <div id="create-modal" class="fixed inset-0 bg-slate-900/60 hidden items-center justify-center z-50 p-6 backdrop-blur-md">
        <div class="bg-white w-full max-w-4xl h-[90vh] rounded-[2rem] border-4 border-e1-dark shadow-2xl flex flex-col overflow-hidden animate-card">
            <div class="bg-e1-blue border-b-4 border-e1-dark px-8 py-6 flex justify-between items-center shrink-0">
                <h2 id="form-title" class="font-heading font-bold text-3xl text-white tracking-wide">Create New Deck</h2>
                <button onclick="closeModal('create-modal')" class="text-white/80 hover:text-white"><i data-lucide="x-circle" class="w-10 h-10"></i></button>
            </div>
            <div class="flex-1 p-8 overflow-y-auto flex flex-col gap-8 bg-white">
                <div class="grid grid-cols-12 gap-6">
                    <div class="col-span-8">
                        <label class="font-bold text-xs uppercase text-slate-400 mb-2 block">Deck Title</label>
                        <input type="text" id="new-deck-title" class="input-neo w-full border-2 border-e1-dark rounded-xl px-4 py-3 shadow-neo-sm font-bold text-xl outline-none">
                    </div>
                    <div class="col-span-2">
                        <label class="font-bold text-xs uppercase text-slate-400 mb-2 block">Color</label>
                        <select id="new-deck-color" class="input-neo w-full border-2 border-e1-dark rounded-xl px-3 py-3 shadow-neo-sm font-bold bg-white outline-none">
                            <option value="bg-e1-pink">Pink</option>
                            <option value="bg-e1-orange">Orange</option>
                            <option value="bg-e1-green">Green</option>
                            <option value="bg-e1-blue">Blue</option>
                        </select>
                    </div>
                    <div class="col-span-2">
                        <label class="font-bold text-xs uppercase text-slate-400 mb-2 block">Icon</label>
                        <select id="new-deck-icon" class="input-neo w-full border-2 border-e1-dark rounded-xl px-3 py-3 shadow-neo-sm font-bold bg-white outline-none">
                            <option value="book">Book</option>
                            <option value="star">Star</option>
                            <option value="zap">Zap</option>
                            <option value="smile">Smile</option>
                            <option value="globe">Globe</option>
                        </select>
                    </div>
                </div>
                <div class="bg-blue-50 p-6 rounded-2xl border-2 border-dashed border-e1-blue flex flex-col gap-3">
                    <label class="font-bold text-sm text-e1-blue flex items-center gap-2"><i data-lucide="sparkles" class="w-4 h-4"></i> Quick Add</label>
                    <div class="flex gap-3">
                        <textarea id="quick-input-text" placeholder="Word, Word, Word..." class="w-full border-2 border-e1-blue/30 rounded-xl px-4 py-3 font-bold text-sm h-16 resize-none focus:outline-none focus:border-e1-blue bg-white"></textarea>
                        <button onclick="processQuickInput()" class="btn-neo bg-e1-blue text-white px-6 rounded-xl border-2 border-e1-dark font-bold shadow-neo hover:-translate-y-1 text-sm whitespace-nowrap">Auto Fill</button>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between items-end mb-4 border-b-2 border-slate-100 pb-2">
                        <label class="font-heading font-bold text-2xl text-e1-dark">Word List</label>
                        <button onclick="addWordRow()" class="text-xs bg-white text-e1-dark px-4 py-2 rounded-lg border-2 border-e1-dark font-bold shadow-neo-sm">+ Add Row</button>
                    </div>
                    <div id="word-input-container" class="flex flex-col gap-3"></div>
                </div>
            </div>
            <div class="bg-slate-50 border-t-4 border-e1-dark p-6 flex justify-end shrink-0">
                <button onclick="saveDeck()" class="btn-neo bg-e1-green text-white px-10 py-4 rounded-xl border-2 border-e1-dark font-heading font-bold text-xl shadow-neo hover:-translate-y-1">Save Deck</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // SYSTEM MODAL LOGIC (New!)
        // ==========================================
        let confirmCallback = null;

        function showDialog(type, title, msg, onConfirm = null) {
            const modal = document.getElementById('system-modal');
            const header = document.getElementById('sys-header');
            const titleEl = document.getElementById('sys-title');
            const msgEl = document.getElementById('sys-msg');
            const icon = document.getElementById('sys-icon');
            const cancelBtn = document.getElementById('sys-btn-cancel');
            const confirmBtn = document.getElementById('sys-btn-confirm');

            // Reset Styles
            header.className = "border-b-4 border-e1-dark px-6 py-4 flex items-center gap-3";
            confirmBtn.className = "btn-neo text-white px-6 py-2 rounded-xl border-2 border-e1-dark font-heading font-bold text-lg shadow-neo";
            confirmCallback = onConfirm;

            titleEl.innerText = title;
            msgEl.innerText = msg;

            if (type === 'error' || type === 'delete') {
                header.classList.add('bg-red-500');
                confirmBtn.classList.add('bg-red-500');
                icon.innerHTML = '<path d="M12 9v4"/><path d="M12 17h.01"/><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>'; // Alert Triangle
            } else if (type === 'alert') {
                header.classList.add('bg-e1-orange');
                confirmBtn.classList.add('bg-e1-orange');
                icon.innerHTML = '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>'; // Info
            } else {
                header.classList.add('bg-e1-blue');
                confirmBtn.classList.add('bg-e1-blue');
                icon.innerHTML = '<circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/>'; // Question
            }

            if (onConfirm) {
                // Confirm Mode
                cancelBtn.classList.remove('hidden');
                confirmBtn.innerText = type === 'delete' ? 'Delete' : 'Yes';
                confirmBtn.onclick = () => { if(confirmCallback) confirmCallback(); closeSystemModal(); };
            } else {
                // Alert Mode
                cancelBtn.classList.add('hidden');
                confirmBtn.innerText = "OK";
                confirmBtn.onclick = closeSystemModal;
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeSystemModal() {
            document.getElementById('system-modal').classList.add('hidden');
            document.getElementById('system-modal').classList.remove('flex');
            confirmCallback = null;
        }


        // ==========================================
        // INDEXED DB SETUP
        // ==========================================
        const DB_NAME = 'English1_Resources';
        const DB_VERSION = 1;
        let db;

        const initDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('posters')) db.createObjectStore('posters', { keyPath: 'id', autoIncrement: true });
                };
                request.onsuccess = (event) => { db = event.target.result; resolve(db); };
                request.onerror = () => reject('Error opening DB');
            });
        };

        const dbAction = (storeName, mode, callback) => {
            const transaction = db.transaction([storeName], mode);
            const store = transaction.objectStore(storeName);
            return callback(store);
        };

        // ==========================================
        // APP LOGIC
        // ==========================================
        let wordSets = [];
        let editingId = null;

        async function initApp() {
            const stored = localStorage.getItem('e1_wordSets');
            wordSets = stored ? JSON.parse(stored) : [{id: 1, title: "Demo Deck", color: "bg-e1-blue", icon: "star", words: [{text: "Welcome", type: "Noun"}]}];
            if(!stored) localStorage.setItem('e1_wordSets', JSON.stringify(wordSets));
            renderTopics(wordSets);
            await initDB();
            loadPosters();
            lucide.createIcons();
        }

        // --- POSTER LOGIC ---
        function handlePosterUpload(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const posterData = { title: file.name.split('.')[0], file: file, date: new Date() };
                const request = dbAction('posters', 'readwrite', (store) => store.add(posterData));
                request.onsuccess = () => { loadPosters(); input.value = ''; };
            };
            reader.readAsArrayBuffer(file);
        }

        function loadPosters() {
            const request = dbAction('posters', 'readonly', (store) => store.getAll());
            request.onsuccess = () => { renderPosters(request.result); };
        }

        function renderPosters(posters) {
            const grid = document.getElementById('poster-grid');
            const uploadBtn = grid.firstElementChild; grid.innerHTML = ''; grid.appendChild(uploadBtn);
            posters.forEach(poster => {
                const imgUrl = URL.createObjectURL(poster.file);
                const card = document.createElement('div');
                card.className = "animate-card bg-white p-3 rounded-3xl border-4 border-e1-dark shadow-neo hover:-translate-y-2 hover:shadow-neo-lg transition-all relative group";
                card.innerHTML = `
                    <div onclick="openPosterModal('${imgUrl}', '${poster.title}')" class="bg-slate-100 rounded-2xl overflow-hidden border-2 border-e1-dark cursor-pointer aspect-[3/4] relative">
                        <img src="${imgUrl}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center">
                            <i data-lucide="maximize-2" class="w-10 h-10 text-white opacity-0 group-hover:opacity-100 drop-shadow-md"></i>
                        </div>
                    </div>
                    <div class="mt-3 flex justify-between items-center px-1">
                        <h3 class="font-heading font-bold text-xl text-e1-dark truncate max-w-[70%]">${poster.title}</h3>
                        <button onclick="deletePoster(${poster.id})" class="text-slate-300 hover:text-red-500 transition-colors">
                            <i data-lucide="trash-2" class="w-6 h-6 stroke-[2.5]"></i>
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        function deletePoster(id) {
            // Updated to use System Modal
            showDialog('delete', 'Delete Poster?', 'Are you sure you want to permanently delete this poster?', () => {
                const request = dbAction('posters', 'readwrite', (store) => store.delete(id));
                request.onsuccess = () => loadPosters();
            });
        }

        function openPosterModal(url, title) {
            document.getElementById('poster-focus-img').src = url;
            document.getElementById('poster-focus-title').innerText = title;
            document.getElementById('poster-modal').classList.remove('hidden');
            document.getElementById('poster-modal').classList.add('flex');
        }

        // --- WORD BANK LOGIC ---
        function renderTopics(data) {
            const grid = document.getElementById('topic-grid');
            grid.innerHTML = '';
            const addCard = `
            <div onclick="openCreateModal()" class="group h-64 bg-slate-100/50 rounded-3xl border-4 border-dashed border-slate-300 hover:border-e1-green hover:bg-green-50 transition-all cursor-pointer flex flex-col items-center justify-center gap-4 relative">
                 <div class="bg-white p-5 rounded-2xl border-2 border-slate-300 group-hover:border-e1-green group-hover:scale-110 group-hover:shadow-neo-sm transition-all"><i data-lucide="plus" class="w-10 h-10 text-slate-300 group-hover:text-e1-green stroke-[3]"></i></div>
                <span class="font-heading font-bold text-xl text-slate-400 group-hover:text-e1-green">Create Deck</span>
            </div>`;
            grid.innerHTML += addCard;

            data.forEach((set) => {
                const card = `
                <div onclick="openSetModal(${set.id})" class="animate-card group h-64 bg-white rounded-3xl border-4 border-e1-dark shadow-neo hover:-translate-y-2 hover:shadow-neo-lg transition-all cursor-pointer flex flex-col justify-between p-6 relative overflow-hidden">
                    <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                        <button onclick="editDeck(event, ${set.id})" class="p-2 rounded-lg bg-white border-2 border-e1-dark hover:bg-e1-blue hover:text-white shadow-sm"><i data-lucide="pencil" class="w-4 h-4 stroke-[3]"></i></button>
                        <button onclick="deleteDeck(event, ${set.id})" class="p-2 rounded-lg bg-white border-2 border-e1-dark hover:bg-red-500 hover:text-white shadow-sm"><i data-lucide="trash-2" class="w-4 h-4 stroke-[3]"></i></button>
                    </div>
                    <div class="flex justify-between items-start">
                        <div class="${set.color} w-16 h-16 rounded-2xl border-2 border-e1-dark flex items-center justify-center text-white shadow-neo-sm transform group-hover:rotate-6 transition-transform"><i data-lucide="${set.icon}" class="w-8 h-8 stroke-[2.5]"></i></div>
                        <span class="bg-slate-100 text-e1-dark text-xs font-black uppercase tracking-wider px-3 py-1.5 rounded-lg border-2 border-e1-dark mt-1">${set.words.length} Items</span>
                    </div>
                    <div class="mt-4"><h3 class="font-heading font-bold text-3xl text-e1-dark leading-tight truncate pr-2 group-hover:text-e1-blue transition-colors">${set.title}</h3><p class="text-slate-400 font-bold text-sm mt-1 truncate">${set.description || 'No description'}</p></div>
                    <div class="absolute bottom-0 left-0 w-full h-2 ${set.color}"></div>
                </div>`;
                grid.innerHTML += card;
            });
            lucide.createIcons();
        }

        function switchTab(tab) {
            document.getElementById('view-wordbank').classList.toggle('hidden', tab !== 'wordbank');
            document.getElementById('view-wordbank').classList.toggle('flex', tab === 'wordbank');
            document.getElementById('view-posters').classList.toggle('hidden', tab !== 'posters');
            document.getElementById('view-posters').classList.toggle('flex', tab === 'posters');
            const btnW = document.getElementById('tab-wordbank');
            const btnP = document.getElementById('tab-posters');
            const addBtn = document.getElementById('add-btn');
            if(tab === 'posters') addBtn.classList.add('invisible'); else addBtn.classList.remove('invisible');
            if(tab === 'wordbank') { btnW.classList.replace('bg-white','bg-e1-orange'); btnW.classList.replace('text-e1-dark','text-white'); btnP.classList.replace('bg-e1-blue','bg-white'); btnP.classList.replace('text-white','text-e1-dark'); } 
            else { btnP.classList.replace('bg-white','bg-e1-blue'); btnP.classList.replace('text-e1-dark','text-white'); btnW.classList.replace('bg-e1-orange','bg-white'); btnW.classList.replace('text-white','text-e1-dark'); loadPosters(); }
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); document.getElementById(id).classList.remove('flex'); }
        function openSetModal(id) {
            const set = wordSets.find(s => s.id === id); if(!set) return;
            document.getElementById('modal-set-title').innerText = set.title; document.getElementById('modal-set-desc').innerText = `${set.words.length} Cards in this deck`;
            const iconContainer = document.getElementById('modal-icon'); iconContainer.className = `w-16 h-16 rounded-2xl border-2 border-e1-dark ${set.color} shadow-neo flex items-center justify-center`; iconContainer.innerHTML = `<i data-lucide="${set.icon}" class="w-8 h-8 text-white stroke-[3]"></i>`;
            const grid = document.getElementById('modal-word-grid'); grid.innerHTML = '';
            set.words.forEach((word) => { let tagColor = word.type === 'Verb' ? 'bg-e1-orange' : word.type === 'Noun' ? 'bg-e1-pink' : word.type === 'Adj' ? 'bg-e1-blue' : 'bg-e1-green'; grid.innerHTML += `<div class="animate-card bg-white p-6 rounded-2xl border-2 border-e1-dark shadow-neo hover:-translate-y-1 transition-transform flex flex-col justify-between h-40"><div class="flex justify-between items-start"><span class="${tagColor} text-white text-[10px] font-black uppercase tracking-widest px-2 py-1 rounded border border-e1-dark shadow-sm">${word.type}</span></div><div><h4 class="font-heading font-bold text-3xl text-e1-dark leading-none break-words">${word.text}</h4><p class="text-slate-400 text-sm font-bold mt-2 leading-tight">${word.sub || ''}</p></div></div>`; });
            document.getElementById('set-modal').classList.remove('hidden'); document.getElementById('set-modal').classList.add('flex'); lucide.createIcons();
        }

        function openCreateModal() { editingId = null; document.getElementById('form-title').innerText = "Create New Deck"; document.getElementById('create-modal').classList.remove('hidden'); document.getElementById('create-modal').classList.add('flex'); document.getElementById('new-deck-title').value = ''; document.getElementById('quick-input-text').value = ''; document.getElementById('word-input-container').innerHTML = ''; addWordRow(); addWordRow(); }
        function editDeck(e, id) { e.stopPropagation(); editingId = id; const set = wordSets.find(s => s.id === id); document.getElementById('form-title').innerText = "Edit Deck"; document.getElementById('new-deck-title').value = set.title; document.getElementById('new-deck-color').value = set.color; document.getElementById('new-deck-icon').value = set.icon; document.getElementById('word-input-container').innerHTML = ''; set.words.forEach(w => addWordRow(w.text, w.type, w.sub)); document.getElementById('create-modal').classList.remove('hidden'); document.getElementById('create-modal').classList.add('flex'); }
        
        // Updated Delete with Modal
        function deleteDeck(e, id) { 
            e.stopPropagation(); 
            showDialog('delete', 'Delete Deck?', 'Are you sure you want to delete this deck? This cannot be undone.', () => {
                wordSets = wordSets.filter(s => s.id !== id); 
                localStorage.setItem('e1_wordSets', JSON.stringify(wordSets)); 
                renderTopics(wordSets);
            });
        }
        
        // Updated Save with Modal
        function saveDeck() { 
            const title = document.getElementById('new-deck-title').value; 
            if(!title) return showDialog('alert', 'Missing Title', 'Please give your deck a title before saving.'); 
            
            const words = []; 
            document.querySelectorAll('.word-row').forEach(row => { 
                const text = row.querySelector('.inp-word').value; 
                if(text) words.push({text, type: row.querySelector('.inp-type').value, sub: row.querySelector('.inp-sub').value}); 
            }); 
            
            if(!words.length) return showDialog('alert', 'Empty Deck', 'Please add at least one word to your deck.'); 
            
            const deck = {title, color: document.getElementById('new-deck-color').value, icon: document.getElementById('new-deck-icon').value, words, description: `${words.length} items`}; 
            if(editingId) { wordSets[wordSets.findIndex(s => s.id === editingId)] = {id: editingId, ...deck}; } 
            else { wordSets.push({id: Date.now(), ...deck}); } 
            
            localStorage.setItem('e1_wordSets', JSON.stringify(wordSets)); 
            renderTopics(wordSets); 
            closeModal('create-modal'); 
        }

        function addWordRow(t='', ty='Noun', s='') { const div = document.createElement('div'); div.className = "grid grid-cols-12 gap-3 word-row animate-card"; div.innerHTML = `<div class="col-span-5"><input value="${t}" class="inp-word input-neo w-full border-2 border-e1-dark rounded-xl px-3 py-2 font-bold text-lg outline-none"></div><div class="col-span-3"><select class="inp-type input-neo w-full border-2 border-e1-dark rounded-xl px-3 py-2 font-bold bg-white outline-none"><option value="Noun" ${ty==='Noun'?'selected':''}>Noun</option><option value="Verb" ${ty==='Verb'?'selected':''}>Verb</option><option value="Adj" ${ty==='Adj'?'selected':''}>Adj</option><option value="Other" ${ty==='Other'?'selected':''}>Other</option></select></div><div class="col-span-4 flex gap-2"><input value="${s}" class="inp-sub input-neo w-full border-2 border-e1-dark rounded-xl px-3 py-2 font-bold outline-none text-slate-500"><button onclick="this.closest('.word-row').remove()" class="text-slate-300 hover:text-red-500"><i data-lucide="trash-2" class="w-6 h-6"></i></button></div>`; document.getElementById('word-input-container').appendChild(div); lucide.createIcons(); }
        function processQuickInput() { const raw = document.getElementById('quick-input-text').value; document.getElementById('word-input-container').innerHTML = ''; raw.split(/[\n,]+/).map(s=>s.trim()).filter(s=>s).forEach(w => addWordRow(w)); document.getElementById('quick-input-text').value = ''; }
        function filterTopics() { const q = document.getElementById('topic-search').value.toLowerCase(); renderTopics(wordSets.filter(s => s.title.toLowerCase().includes(q))); }

        initApp();
    </script>
</body>
</html>