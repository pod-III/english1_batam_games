<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>This or That - English 1 Batam</title>

        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap"
            rel="stylesheet"
        />
        <script src="https://unpkg.com/lucide@latest"></script>

        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        fontFamily: {
                            display: ["Fredoka", "sans-serif"],
                            body: ["Nunito", "sans-serif"],
                        },
                        colors: {
                            e1pink: "#FF6B95",
                            e1orange: "#FF8C42",
                            e1green: "#00E676",
                            e1blue: "#2979FF",
                            e1yellow: "#FFD600",
                            e1dark: "#1e293b",
                            e1chalk: "#f8fafc",
                        },
                        boxShadow: {
                            hard: "4px 4px 0px 0px rgba(30, 41, 59, 1)",
                            "hard-sm": "2px 2px 0px 0px rgba(30, 41, 59, 1)",
                            "hard-lg": "8px 8px 0px 0px rgba(30, 41, 59, 1)",
                            "hard-xl": "12px 12px 0px 0px rgba(30, 41, 59, 1)",
                        },
                        animation: {
                            "float-slow": "float 6s ease-in-out infinite",
                            "float-medium": "float 4s ease-in-out infinite",
                            "float-fast": "float 3s ease-in-out infinite",
                        },
                    },
                },
            };
        </script>

        <style>
            body {
                font-family: "Nunito", sans-serif;
                background-color: #f8fafc;
                background-image:
                    linear-gradient(rgba(30, 41, 59, 0.1) 1px, transparent 1px),
                    linear-gradient(
                        90deg,
                        rgba(30, 41, 59, 0.1) 1px,
                        transparent 1px
                    );
                background-size: 40px 40px;
                overflow: hidden;
            }

            @keyframes popIn {
                0% {
                    transform: scale(0.5);
                    opacity: 0;
                }
                70% {
                    transform: scale(1.05);
                    opacity: 1;
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }
            @keyframes slideUp {
                from {
                    transform: translateY(100%);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
            @keyframes float {
                0% {
                    transform: translateY(0px) rotate(0deg);
                }
                50% {
                    transform: translateY(-10px) rotate(5deg);
                }
                100% {
                    transform: translateY(0px) rotate(0deg);
                }
            }

            .animate-pop {
                animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)
                    forwards;
            }
            .animate-slide-up {
                animation: slideUp 0.5s cubic-bezier(0.2, 1, 0.3, 1) forwards;
            }

            .custom-scrollbar::-webkit-scrollbar {
                width: 12px;
            }
            .custom-scrollbar::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-left: 2px solid #e2e8f0;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border: 3px solid #f1f5f9;
                border-radius: 99px;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
            }

            .btn-push {
                transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
            }
            .btn-push:hover:not(:disabled) {
                transform: translateY(-2px);
            }
            .btn-push:active:not(:disabled) {
                transform: translateY(4px);
                box-shadow: 0px 0px 0px 0px rgba(30, 41, 59, 1) !important;
            }
            .btn-push:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .option-panel {
                transition:
                    width 0.3s ease,
                    flex-grow 0.3s ease;
            }
            .option-panel:hover .panel-icon {
                transform: scale(1.1) rotate(5deg);
            }

            .text-stroke-3 {
                -webkit-text-stroke: 3px #1e293b;
                paint-order: stroke fill;
            }
            .text-stroke-2 {
                -webkit-text-stroke: 2px #1e293b;
                paint-order: stroke fill;
            }

            .bg-dots {
                background-image: radial-gradient(
                    rgba(255, 255, 255, 0.4) 2px,
                    transparent 2px
                );
                background-size: 24px 24px;
            }
        </style>
    </head>
    <body class="h-screen w-screen flex flex-col text-e1dark select-none">
        <header
            class="bg-white border-b-4 border-e1dark px-4 py-3 flex justify-between items-center z-50 shadow-md"
        >
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 md:w-12 md:h-12 bg-e1pink rounded-xl border-4 border-e1dark flex items-center justify-center shadow-hard-sm"
                >
                    <i data-lucide="layers" class="text-white w-6 h-6"></i>
                </div>
                <div>
                    <h1
                        class="font-display font-bold text-xl md:text-2xl tracking-wide leading-none text-e1dark"
                    >
                        THIS OR <span class="text-e1blue">THAT</span>
                    </h1>
                </div>
            </div>
            <div class="flex gap-2 md:gap-3">
                <button
                    onclick="toggleSound()"
                    id="soundBtn"
                    class="btn-push bg-white w-10 h-10 md:w-12 md:h-12 rounded-xl border-4 border-e1dark shadow-hard-sm flex items-center justify-center"
                >
                    <i data-lucide="volume-2" class="w-6 h-6"></i>
                </button>
                <button
                    onclick="location.reload()"
                    class="btn-push bg-e1orange text-white px-4 md:px-6 py-1 md:py-2 rounded-xl border-4 border-e1dark shadow-hard-sm font-display font-bold text-sm md:text-lg uppercase"
                >
                    Exit
                </button>
            </div>
        </header>

        <main
            class="flex-grow relative flex flex-col overflow-hidden w-full bg-e1chalk"
        >
            <div
                id="startScreen"
                class="absolute inset-0 flex flex-col items-center justify-center z-20 overflow-hidden"
            >
                <div class="absolute inset-0 pointer-events-none opacity-20">
                    <i
                        data-lucide="help-circle"
                        class="w-32 h-32 text-e1blue absolute top-10 left-10 animate-float-slow"
                    ></i>
                    <i
                        data-lucide="gamepad-2"
                        class="w-32 h-32 text-e1pink absolute bottom-20 right-10 animate-float-medium"
                    ></i>
                    <i
                        data-lucide="zap"
                        class="w-24 h-24 text-e1yellow absolute top-20 right-1/4 animate-float-fast"
                    ></i>
                    <i
                        data-lucide="star"
                        class="w-20 h-20 text-e1green absolute bottom-10 left-1/4 animate-float-slow"
                        style="animation-delay: 1s"
                    ></i>
                </div>

                <div class="relative z-10 w-full max-w-lg px-4">
                    <div class="mb-8 text-center animate-pop relative">
                        <div
                            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-white rounded-full border-4 border-e1dark shadow-hard-lg -z-10"
                        ></div>

                        <h1
                            class="font-display font-bold text-8xl md:text-9xl leading-none text-white text-stroke-3 drop-shadow-[6px_6px_0_rgba(30,41,59,1)] transform -rotate-3"
                        >
                            THIS
                        </h1>
                        <h1
                            class="font-display font-bold text-8xl md:text-9xl leading-none text-e1yellow text-stroke-3 drop-shadow-[6px_6px_0_rgba(30,41,59,1)] transform rotate-2 -mt-4"
                        >
                            THAT
                        </h1>

                        <div class="mt-6 flex justify-center gap-2">
                            <span
                                class="bg-e1pink text-white font-bold px-3 py-1 rounded-lg border-2 border-e1dark shadow-hard-sm rotate-2"
                                >2 Options</span
                            >
                            <span
                                class="bg-e1blue text-white font-bold px-3 py-1 rounded-lg border-2 border-e1dark shadow-hard-sm -rotate-2"
                                >3 Options</span
                            >
                            <span
                                class="bg-e1green text-white font-bold px-3 py-1 rounded-lg border-2 border-e1dark shadow-hard-sm rotate-1"
                                >Up to 5!</span
                            >
                        </div>
                    </div>

                    <div
                        class="bg-white rounded-3xl border-[6px] border-e1dark shadow-hard-xl overflow-hidden animate-slide-up"
                        style="animation-delay: 0.2s"
                    >
                        <div
                            class="bg-e1chalk border-b-4 border-e1dark p-3 flex justify-between items-center"
                        >
                            <div class="flex gap-2">
                                <div
                                    class="w-4 h-4 rounded-full bg-red-400 border-2 border-e1dark"
                                ></div>
                                <div
                                    class="w-4 h-4 rounded-full bg-yellow-400 border-2 border-e1dark"
                                ></div>
                                <div
                                    class="w-4 h-4 rounded-full bg-green-400 border-2 border-e1dark"
                                ></div>
                            </div>
                            <div
                                class="font-bold text-gray-400 text-xs tracking-widest uppercase"
                            >
                                MAIN MENU
                            </div>
                            <div class="w-10"></div>
                        </div>

                        <div class="p-6 md:p-8 flex flex-col gap-4">
                            <button
                                onclick="startGame()"
                                class="btn-push w-full bg-e1blue text-white text-2xl md:text-3xl py-5 rounded-2xl border-4 border-e1dark shadow-hard font-display font-bold flex items-center justify-center gap-4 group"
                            >
                                <span
                                    class="bg-white text-e1blue w-10 h-10 rounded-full flex items-center justify-center border-2 border-e1dark group-hover:scale-110 transition-transform"
                                >
                                    <i
                                        data-lucide="play"
                                        class="w-5 h-5 ml-1"
                                    ></i>
                                </span>
                                PLAY NOW
                            </button>

                            <button
                                onclick="openSetupModal()"
                                class="btn-push w-full bg-white text-e1dark text-xl py-4 rounded-2xl border-4 border-e1dark shadow-hard font-bold flex items-center justify-center gap-3"
                            >
                                <i
                                    data-lucide="settings-2"
                                    class="w-6 h-6 text-e1orange"
                                ></i>
                                CUSTOMIZE
                            </button>
                        </div>

                        <div
                            class="bg-gray-50 p-3 text-center border-t-4 border-e1dark"
                        >
                            <p
                                class="text-xs font-bold text-gray-400 uppercase"
                            >
                                English 1 Batam
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="gameScreen" class="hidden absolute inset-0 flex flex-col">
                <div
                    class="absolute top-6 left-1/2 transform -translate-x-1/2 z-40 w-full px-4 text-center pointer-events-none"
                >
                    <div class="inline-block animate-pop">
                        <div
                            class="bg-white px-6 md:px-10 py-3 md:py-4 rounded-2xl border-4 border-e1dark shadow-hard transform -rotate-1"
                        >
                            <h3
                                id="questionText"
                                class="font-display font-bold text-xl md:text-4xl text-e1dark uppercase tracking-wide leading-tight"
                            >
                                Ready?
                            </h3>
                        </div>
                    </div>
                </div>

                <div
                    id="optionsContainer"
                    class="w-full h-full flex flex-col md:flex-row bg-e1dark"
                ></div>

                <div
                    class="absolute bottom-6 left-0 w-full flex justify-center items-center z-50 pointer-events-none"
                >
                    <div
                        class="pointer-events-auto flex gap-3 items-center bg-white p-2 md:p-3 rounded-2xl border-4 border-e1dark shadow-hard transform scale-90 md:scale-100"
                    >
                        <button
                            onclick="prevSlide()"
                            class="btn-push bg-gray-100 w-12 h-12 rounded-xl border-4 border-gray-200 text-gray-400 hover:text-e1dark hover:border-e1dark flex items-center justify-center"
                        >
                            <i data-lucide="chevron-left" class="w-8 h-8"></i>
                        </button>

                        <div
                            class="font-display font-bold text-xl min-w-[60px] text-center text-e1dark"
                        >
                            <span id="slideCounter">1/1</span>
                        </div>

                        <button
                            onclick="nextSlide()"
                            class="btn-push bg-e1blue w-14 h-14 rounded-xl border-4 border-e1dark text-white shadow-sm flex items-center justify-center"
                        >
                            <i data-lucide="chevron-right" class="w-8 h-8"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div
                id="endScreen"
                class="hidden absolute inset-0 z-30 bg-e1chalk flex flex-col items-center justify-center p-6"
            >
                <div class="animate-pop text-center">
                    <i
                        data-lucide="trophy"
                        class="w-32 h-32 text-e1yellow drop-shadow-[4px_4px_0_#1e293b] mx-auto mb-6 transform -rotate-6"
                    ></i>
                    <h2
                        class="font-display font-bold text-6xl md:text-8xl mb-2 text-e1pink drop-shadow-[4px_4px_0_#1e293b] stroke-black text-stroke-2"
                    >
                        FINISH
                    </h2>
                    <div
                        class="bg-white px-8 py-4 rounded-2xl border-4 border-e1dark shadow-hard mb-10 inline-block"
                    >
                        <p class="text-2xl font-bold text-gray-700">
                            Class dismissed!
                        </p>
                    </div>
                </div>

                <div
                    class="flex flex-col md:flex-row gap-4 w-full max-w-md animate-slide-up"
                    style="animation-delay: 0.2s"
                >
                    <button
                        onclick="resetGame()"
                        class="btn-push flex-1 bg-e1blue text-white text-xl py-4 rounded-xl border-4 border-e1dark shadow-hard font-display font-bold"
                    >
                        REPLAY
                    </button>
                    <button
                        onclick="openSetupModal()"
                        class="btn-push flex-1 bg-e1orange text-white text-xl py-4 rounded-xl border-4 border-e1dark shadow-hard font-display font-bold"
                    >
                        NEW SETUP
                    </button>
                </div>
            </div>
        </main>

        <div
            id="setupModal"
            class="fixed inset-0 bg-slate-900/90 z-[100] hidden flex items-center justify-center backdrop-blur-sm p-4"
        >
            <div
                class="bg-white w-full max-w-6xl h-[90vh] rounded-3xl border-[6px] border-e1dark shadow-hard-lg flex flex-col overflow-hidden animate-pop"
            >
                <div
                    class="bg-e1chalk border-b-4 border-e1dark p-4 md:p-6 flex justify-between items-center shrink-0"
                >
                    <div class="flex items-center gap-3">
                        <div
                            class="bg-e1orange text-white p-2 rounded-xl border-4 border-e1dark shadow-sm"
                        >
                            <i data-lucide="hammer" class="w-6 h-6"></i>
                        </div>
                        <h2
                            class="font-display font-bold text-2xl md:text-3xl text-e1dark uppercase"
                        >
                            Game Builder
                        </h2>
                    </div>
                    <button
                        onclick="closeSetupModal()"
                        class="btn-push w-10 h-10 bg-white border-4 border-e1dark rounded-xl flex items-center justify-center hover:bg-red-50 hover:text-red-500 shadow-[2px_2px_0_#1e293b]"
                    >
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>

                <div class="flex flex-col md:flex-row h-full overflow-hidden">
                    <div
                        class="w-full md:w-64 bg-gray-50 border-b-4 md:border-b-0 md:border-r-4 border-e1dark p-4 overflow-y-auto custom-scrollbar flex-shrink-0"
                    >
                        <h3
                            class="font-black text-gray-400 text-xs uppercase tracking-widest mb-4"
                        >
                            Quick Presets
                        </h3>
                        <div class="flex flex-col gap-3">
                            <button
                                onclick="loadBlank()"
                                class="btn-push text-left p-3 rounded-xl border-4 border-e1dark bg-white hover:bg-slate-100 font-bold text-sm text-gray-700 shadow-[2px_2px_0_#1e293b] flex items-center gap-3 mb-2"
                            >
                                <span
                                    class="bg-e1dark text-white w-6 h-6 rounded-lg border-2 border-e1dark flex items-center justify-center text-xs"
                                    ><i
                                        data-lucide="file-plus"
                                        class="w-4 h-4"
                                    ></i
                                ></span>
                                Start from Scratch
                            </button>

                            <button
                                onclick="loadPreset('standard2')"
                                class="btn-push text-left p-3 rounded-xl border-4 border-e1dark bg-white hover:bg-pink-50 font-bold text-sm text-gray-700 shadow-[2px_2px_0_#1e293b] flex items-center gap-3"
                            >
                                <span
                                    class="bg-e1pink text-white w-6 h-6 rounded-lg border-2 border-e1dark flex items-center justify-center text-xs font-display"
                                    >2</span
                                >
                                This or That
                            </button>
                            <button
                                onclick="loadPreset('standard3')"
                                class="btn-push text-left p-3 rounded-xl border-4 border-e1dark bg-white hover:bg-blue-50 font-bold text-sm text-gray-700 shadow-[2px_2px_0_#1e293b] flex items-center gap-3"
                            >
                                <span
                                    class="bg-e1blue text-white w-6 h-6 rounded-lg border-2 border-e1dark flex items-center justify-center text-xs font-display"
                                    >3</span
                                >
                                Trio Mode
                            </button>
                            <button
                                onclick="loadPreset('standard4')"
                                class="btn-push text-left p-3 rounded-xl border-4 border-e1dark bg-white hover:bg-green-50 font-bold text-sm text-gray-700 shadow-[2px_2px_0_#1e293b] flex items-center gap-3"
                            >
                                <span
                                    class="bg-e1green text-white w-6 h-6 rounded-lg border-2 border-e1dark flex items-center justify-center text-xs font-display"
                                    >4</span
                                >
                                Quad Row
                            </button>
                            <button
                                onclick="loadPreset('animals')"
                                class="btn-push text-left p-3 rounded-xl border-4 border-e1dark bg-white hover:bg-yellow-50 font-bold text-sm text-gray-700 shadow-[2px_2px_0_#1e293b] flex items-center gap-3"
                            >
                                <span
                                    class="bg-e1yellow text-dark w-6 h-6 rounded-lg border-2 border-e1dark flex items-center justify-center text-xs"
                                    ><i
                                        data-lucide="paw-print"
                                        class="w-4 h-4"
                                    ></i
                                ></span>
                                Animals
                            </button>
                        </div>
                    </div>

                    <div
                        class="flex-grow bg-slate-100 overflow-y-auto custom-scrollbar p-4 md:p-6"
                        id="builderScrollArea"
                    >
                        <div class="max-w-3xl mx-auto flex flex-col gap-6">
                            <div
                                id="builderContainer"
                                class="flex flex-col gap-6"
                            ></div>

                            <button
                                onclick="addNewSlide()"
                                class="btn-push w-full bg-white text-e1blue py-4 rounded-2xl border-4 border-e1dark shadow-hard font-display font-bold text-lg flex items-center justify-center gap-2 hover:bg-blue-50 transition-colors"
                            >
                                <i
                                    data-lucide="plus-circle"
                                    class="w-6 h-6"
                                ></i>
                                ADD NEW SLIDE
                            </button>
                        </div>
                    </div>
                </div>

                <div
                    class="p-4 md:p-6 border-t-4 border-e1dark bg-white flex justify-end gap-4 shrink-0 z-10"
                >
                    <button
                        onclick="closeSetupModal()"
                        class="btn-push px-6 py-3 rounded-xl font-bold text-gray-500 hover:text-e1dark border-4 border-transparent hover:border-gray-200 transition-colors"
                    >
                        Cancel
                    </button>
                    <button
                        onclick="saveAndStart()"
                        class="btn-push bg-e1green text-e1dark px-8 py-3 rounded-xl border-4 border-e1dark shadow-hard font-display font-bold text-lg tracking-wide hover:brightness-105 flex items-center gap-2"
                    >
                        SAVE & PLAY
                        <i data-lucide="arrow-right" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>

        <script>
            const COLORS = [
                "bg-e1pink",
                "bg-e1blue",
                "bg-e1green",
                "bg-e1orange",
                "bg-e1yellow",
            ];
            const STORAGE_KEY = "e1_thisorthat_data_v4";

            const ICON_MAP = {
                coffee: "coffee",
                tea: "leaf",
                water: "droplets",
                drink: "glass-water",
                beach: "umbrella",
                mountain: "mountain",
                city: "building-2",
                forest: "trees",
                cat: "cat",
                dog: "dog",
                bird: "bird",
                fish: "fish",
                lion: "paw-print",
                tiger: "paw-print",
                pizza: "pizza",
                burger: "sandwich",
                fries: "utensils",
                apple: "apple",
                food: "utensils",
                car: "car",
                bus: "bus",
                bike: "bike",
                train: "train-front",
                walk: "footprints",
                math: "calculator",
                english: "book-open",
                science: "flask-conical",
                art: "palette",
                summer: "sun",
                winter: "snowflake",
                rain: "cloud-rain",
                snow: "snowflake",
                happy: "smile",
                sad: "frown",
                angry: "angry",
                sleepy: "bed",
                soccer: "dribbble",
                game: "gamepad-2",
                book: "book",
                music: "music",
                money: "coins",
                time: "clock",
                love: "heart",
                star: "star",
                morning: "sun",
                night: "moon",
                hot: "flame",
                cold: "snowflake",
                video: "gamepad-2",
                board: "grid",
                pc: "monitor",
                mobile: "smartphone",
            };

            const PRESETS = {
                standard2: [
                    { question: "Which drink?", options: ["Coffee", "Tea"] },
                    { question: "Best Pet?", options: ["Cat", "Dog"] },
                    { question: "Best Time?", options: ["Morning", "Night"] },
                    { question: "Vacation?", options: ["Beach", "Mountain"] },
                    { question: "Food?", options: ["Pizza", "Burger"] },
                ],
                standard3: [
                    {
                        question: "Rock Paper Scissors",
                        options: ["Rock", "Paper", "Scissors"],
                    },
                    {
                        question: "Traffic Light",
                        options: ["Red", "Yellow", "Green"],
                    },
                    {
                        question: "Meals",
                        options: ["Breakfast", "Lunch", "Dinner"],
                    },
                    { question: "Transport", options: ["Car", "Bus", "Train"] },
                    {
                        question: "Fruits",
                        options: ["Apple", "Banana", "Orange"],
                    },
                ],
                standard4: [
                    {
                        question: "Seasons",
                        options: ["Spring", "Summer", "Autumn", "Winter"],
                    },
                    {
                        question: "Elements",
                        options: ["Fire", "Water", "Earth", "Air"],
                    },
                    {
                        question: "Math",
                        options: [
                            "Add (+)",
                            "Subtract (-)",
                            "Multiply (x)",
                            "Divide (/)",
                        ],
                    },
                    {
                        question: "Directions",
                        options: ["North", "South", "East", "West"],
                    },
                    {
                        question: "Cards",
                        options: ["Hearts", "Diamonds", "Clubs", "Spades"],
                    },
                ],
                animals: [
                    {
                        question: "Wild Animals",
                        options: ["Lion", "Tiger", "Bear", "Wolf"],
                    },
                    {
                        question: "Farm Animals",
                        options: ["Cow", "Pig", "Sheep", "Chicken", "Horse"],
                    },
                    {
                        question: "Pets",
                        options: ["Cat", "Dog", "Hamster", "Fish"],
                    },
                    {
                        question: "Sea Creatures",
                        options: ["Shark", "Whale", "Dolphin", "Crab"],
                    },
                    {
                        question: "Birds",
                        options: ["Eagle", "Parrot", "Owl", "Penguin"],
                    },
                ],
            };

            let questions = [];
            let editorData = [];
            let currentIndex = 0;
            let isMuted = localStorage.getItem("e1_mute") === "true";

            const audioCtx = new (
                window.AudioContext || window.webkitAudioContext
            )();

            function playSound(type) {
                if (isMuted) return;
                if (audioCtx.state === "suspended") audioCtx.resume();

                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const t = audioCtx.currentTime;

                if (type === "click") {
                    osc.type = "sine";
                    osc.frequency.setValueAtTime(400, t);
                    osc.frequency.exponentialRampToValueAtTime(100, t + 0.1);
                    gain.gain.setValueAtTime(0.1, t);
                    gain.gain.linearRampToValueAtTime(0, t + 0.1);
                    osc.start(t);
                    osc.stop(t + 0.1);
                } else if (type === "pop") {
                    osc.type = "triangle";
                    osc.frequency.setValueAtTime(200, t);
                    osc.frequency.linearRampToValueAtTime(400, t + 0.1);
                    gain.gain.setValueAtTime(0.1, t);
                    gain.gain.linearRampToValueAtTime(0, t + 0.15);
                    osc.start(t);
                    osc.stop(t + 0.15);
                }
            }

            function toggleSound() {
                isMuted = !isMuted;
                localStorage.setItem("e1_mute", isMuted);
                updateSoundIcon();
                if (!isMuted) playSound("click");
            }

            function updateSoundIcon() {
                const btn = document.getElementById("soundBtn");
                if (isMuted) {
                    btn.innerHTML =
                        '<i data-lucide="volume-x" class="w-6 h-6 text-gray-400"></i>';
                    btn.classList.add("bg-gray-100");
                } else {
                    btn.innerHTML =
                        '<i data-lucide="volume-2" class="w-6 h-6 text-e1dark"></i>';
                    btn.classList.remove("bg-gray-100");
                }
                lucide.createIcons();
            }

            // INIT: Defaults to empty game instead of forcing a preset
            function init() {
                updateSoundIcon();
                lucide.createIcons();

                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    questions = JSON.parse(savedData);
                    editorData = JSON.parse(savedData);
                } else {
                    // Initial empty state (Blank Slate)
                    questions = [];
                    editorData = [{ question: "", options: ["", ""] }];
                }
            }

            function getIcon(text) {
                const lower = text.toLowerCase();
                for (const key in ICON_MAP) {
                    if (lower.includes(key)) return ICON_MAP[key];
                }
                return "circle";
            }

            // BUILDER CONTROLLERS
            function openSetupModal() {
                playSound("click");
                // If the current game is entirely empty, provide at least one blank slide to edit
                if (questions.length === 0) {
                    editorData = [{ question: "", options: ["", ""] }];
                } else {
                    editorData = JSON.parse(JSON.stringify(questions));
                }
                renderBuilder();
                document
                    .getElementById("setupModal")
                    .classList.remove("hidden");
            }

            function closeSetupModal() {
                playSound("click");
                document.getElementById("setupModal").classList.add("hidden");
            }

            function loadPreset(key) {
                playSound("click");
                editorData = JSON.parse(JSON.stringify(PRESETS[key]));
                renderBuilder();
            }

            // Load a Blank Slate
            function loadBlank() {
                playSound("click");
                editorData = [{ question: "", options: ["", ""] }];
                renderBuilder();
            }

            function renderBuilder() {
                const container = document.getElementById("builderContainer");
                container.innerHTML = "";

                editorData.forEach((slide, sIdx) => {
                    const card = document.createElement("div");
                    card.className =
                        "bg-white p-5 rounded-2xl border-4 border-e1dark shadow-[4px_4px_0_#1e293b] relative group";

                    let html = `
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2 w-full">
                            <span class="bg-e1dark text-white font-display text-xs w-6 h-6 rounded flex items-center justify-center shrink-0">${sIdx + 1}</span>
                            <input type="text" value="${slide.question}" onchange="updateQuestion(${sIdx}, this.value)" placeholder="Enter Question or Category..." class="font-display text-lg w-full bg-transparent border-b-2 border-dashed border-gray-300 focus:border-e1blue outline-none px-2 py-1 text-e1dark">
                        </div>
                        <button onclick="deleteSlide(${sIdx})" class="btn-push shrink-0 ml-4 w-8 h-8 rounded-lg bg-red-50 text-red-500 border-2 border-red-200 hover:border-red-500 hover:bg-red-500 hover:text-white flex items-center justify-center transition-colors">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                `;

                    slide.options.forEach((opt, oIdx) => {
                        html += `
                        <div class="flex items-center relative">
                            <div class="absolute left-3 w-3 h-3 rounded-full ${COLORS[oIdx % COLORS.length]} border-2 border-e1dark"></div>
                            <input type="text" value="${opt}" onchange="updateOption(${sIdx}, ${oIdx}, this.value)" placeholder="Option ${oIdx + 1}" class="w-full bg-gray-50 border-2 border-e1dark rounded-xl pl-8 pr-10 py-2 font-bold text-sm focus:bg-white focus:border-e1blue outline-none text-gray-700">
                            ${slide.options.length > 2 ? `<button onclick="deleteOption(${sIdx}, ${oIdx})" class="absolute right-2 text-gray-400 hover:text-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>` : ""}
                        </div>
                    `;
                    });

                    if (slide.options.length < 5) {
                        html += `
                        <button onclick="addOption(${sIdx})" class="btn-push flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 rounded-xl py-2 text-gray-400 font-bold text-sm hover:border-e1blue hover:text-e1blue bg-gray-50 hover:bg-blue-50">
                            <i data-lucide="plus" class="w-4 h-4"></i> Add Option
                        </button>
                    `;
                    }

                    html += `</div>`;
                    card.innerHTML = html;
                    container.appendChild(card);
                });

                if (editorData.length === 0) {
                    container.innerHTML = `<div class="text-center py-10 text-gray-400 font-bold"><i data-lucide="folder-open" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>No slides added yet.</div>`;
                }

                lucide.createIcons();
            }

            function updateQuestion(sIdx, val) {
                editorData[sIdx].question = val;
            }
            function updateOption(sIdx, oIdx, val) {
                editorData[sIdx].options[oIdx] = val;
            }

            function addOption(sIdx) {
                if (editorData[sIdx].options.length < 5) {
                    editorData[sIdx].options.push("");
                    renderBuilder();
                }
            }

            function deleteOption(sIdx, oIdx) {
                if (editorData[sIdx].options.length > 2) {
                    editorData[sIdx].options.splice(oIdx, 1);
                    renderBuilder();
                }
            }

            function addNewSlide() {
                editorData.push({ question: "", options: ["", ""] });
                renderBuilder();

                const scrollContainer =
                    document.getElementById("builderScrollArea");
                setTimeout(() => {
                    scrollContainer.scrollTo({
                        top: scrollContainer.scrollHeight,
                        behavior: "smooth",
                    });
                }, 50);
            }

            function deleteSlide(sIdx) {
                if (confirm("Delete this slide?")) {
                    editorData.splice(sIdx, 1);
                    renderBuilder();
                }
            }

            function saveAndStart() {
                const validData = editorData.filter(
                    (s) =>
                        s.question.trim() !== "" &&
                        s.options.every((o) => o.trim() !== ""),
                );

                if (validData.length === 0) {
                    alert(
                        "Please add at least one valid slide with completed options before saving.",
                    );
                    return;
                }

                questions = validData;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(questions));

                closeSetupModal();
                startGame();
            }

            // GAMEPLAY CONTROLLERS
            function startGame() {
                // INTERCEPT: If the user hits Play Now without setting up a game
                if (questions.length === 0) {
                    alert("Your game is empty! Let's build one first.");
                    openSetupModal();
                    return;
                }

                currentIndex = 0;

                document.getElementById("startScreen").classList.add("hidden");
                document.getElementById("endScreen").classList.add("hidden");
                document
                    .getElementById("gameScreen")
                    .classList.remove("hidden");

                renderSlide();
            }

            function renderSlide() {
                const container = document.getElementById("optionsContainer");
                container.innerHTML = "";

                const data = questions[currentIndex];
                if (!data) {
                    endGame();
                    return;
                }

                document.getElementById("questionText").innerText =
                    data.question;
                document.getElementById("slideCounter").innerText =
                    `${currentIndex + 1}/${questions.length}`;

                data.options.forEach((optText, idx) => {
                    const colorClass = COLORS[idx % COLORS.length];
                    const iconClass = getIcon(optText);

                    const panel = document.createElement("div");

                    let borderClass =
                        "border-b-4 md:border-b-0 md:border-r-4 border-e1dark";
                    if (idx === data.options.length - 1) borderClass = "";

                    panel.className = `${colorClass} ${borderClass} option-panel flex-1 relative flex flex-col items-center justify-center p-2 md:p-6 overflow-hidden cursor-pointer`;

                    panel.style.animation = `slideUp 0.6s cubic-bezier(0.2, 1, 0.3, 1) forwards`;
                    panel.style.animationDelay = `${idx * 0.1}s`;
                    panel.style.opacity = "0";

                    panel.innerHTML = `
                    <div class="absolute inset-0 bg-dots opacity-20 pointer-events-none"></div>

                    <div class="relative z-10 flex flex-row md:flex-col items-center gap-4 md:gap-6 panel-icon transition-transform duration-300">
                        <div class="w-16 h-16 md:w-28 md:h-28 bg-white/20 rounded-full border-4 border-white/40 shadow-lg flex items-center justify-center backdrop-blur-sm flex-shrink-0">
                            <i data-lucide="${iconClass}" class="w-8 h-8 md:w-14 md:h-14 text-white drop-shadow-md"></i>
                        </div>
                        <h2 class="font-display font-bold text-2xl md:text-4xl text-white drop-shadow-[3px_3px_0_rgba(0,0,0,0.3)] uppercase tracking-wide text-center leading-tight">
                            ${optText}
                        </h2>
                    </div>
                `;

                    panel.onclick = () => {
                        playSound("pop");
                    };

                    container.appendChild(panel);
                });

                lucide.createIcons();
                playSound("pop");
            }

            function nextSlide() {
                if (currentIndex < questions.length - 1) {
                    currentIndex++;
                    renderSlide();
                } else {
                    endGame();
                }
            }

            function prevSlide() {
                if (currentIndex > 0) {
                    currentIndex--;
                    renderSlide();
                } else {
                    playSound("click");
                }
            }

            function endGame() {
                playSound("pop");
                document.getElementById("gameScreen").classList.add("hidden");
                document.getElementById("endScreen").classList.remove("hidden");
            }

            function resetGame() {
                playSound("click");
                document.getElementById("endScreen").classList.add("hidden");
                startGame();
            }

            document.addEventListener("keydown", (e) => {
                if (
                    document
                        .getElementById("gameScreen")
                        .classList.contains("hidden")
                )
                    return;
                if (
                    e.key === "ArrowRight" ||
                    e.key === " " ||
                    e.key === "Enter"
                )
                    nextSlide();
                if (e.key === "ArrowLeft") prevSlide();
            });

            init();
        </script>
    </body>
</html>
