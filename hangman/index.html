<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hangman</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        pink: '#FF6B95',
                        orange: '#FF8C42',
                        green: '#00E676',
                        blue: '#2979FF',
                        dark: '#0f172a',
                        panel: '#1e293b'
                    },
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0f172a; /* Dark background like Detective OS */
            color: #f8fafc;
        }

        /* --- Animations --- */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        .animate-pop { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .animate-shake { animation: shake 0.3s ease-in-out; }

        /* --- Custom Button Styles --- */
        .btn-3d {
            transition: all 0.1s;
            transform: translateY(0);
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        .btn-3d:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 0 0 rgba(0,0,0,0.2);
        }
        .btn-3d:disabled {
            opacity: 0.5;
            transform: translateY(2px);
            box-shadow: none;
            cursor: not-allowed;
        }

        /* --- Letter Tile --- */
        .letter-tile {
            perspective: 1000px;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .letter-tile.revealed { transform: rotateY(360deg); }
        
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- HEADER -->
    <header class="w-full max-w-4xl flex justify-between items-center mb-6 p-4 bg-panel rounded-2xl border border-white/10 shadow-xl">
        <div class="flex items-center gap-3">
            <div class="bg-blue/20 p-2 rounded-lg text-2xl">üéì</div>
            <div>
                <h1 class="font-black text-2xl tracking-tight text-white">HANGMAN</h1>
                <p class="text-xs text-slate-400 font-mono">ENGLISH 1 BATAM EDITION</p>
            </div>
        </div>
        <button onclick="toggleSound()" id="soundBtn" class="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center hover:bg-slate-600 transition">
            üîä
        </button>
    </header>

    <!-- TEACHER CONSOLE (Setup) -->
    <!-- Removed 'hidden' class here so it's visible by default -->
    <div id="teacher-console" class="w-full max-w-4xl bg-panel p-8 rounded-3xl border border-blue/30 shadow-2xl animate-pop">
        <div class="border-b border-white/10 pb-4 mb-6">
            <h2 class="text-2xl font-bold text-blue mb-1">Teacher Control Panel</h2>
            <p class="text-slate-400">Configure the lesson for today.</p>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
            <!-- Word Input -->
            <div class="space-y-4">
                <label class="block font-bold text-slate-200">1. Secret Words (Auto-Saved)</label>
                <div class="relative">
                    <textarea id="word-list-input" 
                        placeholder="e.g., PHOTOSYNTHESIS, GRAVITY, ECOSYSTEM" 
                        class="w-full h-40 bg-dark border-2 border-slate-600 rounded-xl p-4 text-lg focus:border-pink focus:ring-2 focus:ring-pink/20 outline-none transition font-mono resize-none"
                    ></textarea>
                    <div class="absolute bottom-4 right-4 text-xs text-slate-500 bg-dark/80 px-2 py-1 rounded">
                        Separate with commas
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div class="space-y-6">
                <div>
                    <label class="block font-bold text-slate-200 mb-2">2. Number of Players/Teams</label>
                    <div class="grid grid-cols-3 gap-3">
                        <button onclick="selectPlayers(2)" class="player-select-btn btn-3d bg-slate-700 p-3 rounded-xl font-bold hover:bg-blue hover:text-white transition" data-count="2">2</button>
                        <button onclick="selectPlayers(3)" class="player-select-btn btn-3d bg-slate-700 p-3 rounded-xl font-bold hover:bg-blue hover:text-white transition" data-count="3">3</button>
                        <button onclick="selectPlayers(4)" class="player-select-btn btn-3d bg-slate-700 p-3 rounded-xl font-bold hover:bg-blue hover:text-white transition" data-count="4">4</button>
                    </div>
                    <input type="hidden" id="player-count" value="2">
                </div>

                <div class="bg-orange/10 p-4 rounded-xl border border-orange/30">
                    <h3 class="text-orange font-bold text-sm mb-1">üí° How to play:</h3>
                    <ul class="text-slate-300 text-sm space-y-1 list-disc pl-4">
                        <li>Teams take turns guessing letters.</li>
                        <li>Correct guess = <span class="text-green font-bold">Safe (Pass Turn)</span>.</li>
                        <li>Wrong guess = <span class="text-pink font-bold">-20 Health (Pass Turn)</span>.</li>
                        <li><strong>NEW:</strong> Click <span class="bg-slate-700 px-1 rounded border border-slate-500 text-xs">üèÜ 0</span> to award points & reveal word!</li>
                    </ul>
                </div>

                <button onclick="startGame()" class="w-full btn-3d bg-gradient-to-r from-blue to-green py-4 rounded-xl font-black text-xl shadow-lg hover:brightness-110 transition">
                    START LESSON
                </button>
                <p id="error-msg" class="text-pink text-center text-sm font-bold hidden animate-shake">‚ö†Ô∏è Please enter at least one word!</p>
            </div>
        </div>
    </div>

    <!-- GAME AREA (Hidden by default) -->
    <div id="game-section" class="hidden w-full max-w-4xl flex-col items-center">
        
        <!-- Health Bars Area -->
        <div id="health-container" class="w-full grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <!-- Injected via JS -->
        </div>

        <!-- The Word Display -->
        <div class="bg-panel w-full p-8 rounded-3xl border border-white/5 shadow-2xl mb-6 text-center relative overflow-hidden">
            <!-- Background decoration -->
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-pink via-orange to-blue"></div>
            
            <div id="message-box" class="min-h-[2rem] text-orange font-bold mb-4"></div>
            
            <div id="word-display" class="flex flex-wrap justify-center gap-2 md:gap-4 min-h-[4rem]">
                <!-- Letters injected here -->
            </div>
        </div>

        <!-- Keyboard -->
        <div id="keyboard" class="w-full max-w-2xl grid grid-cols-7 gap-2 sm:gap-3">
            <!-- Injected via JS -->
        </div>

        <!-- Controls -->
        <div class="flex gap-4 mt-8">
            <button id="next-round-btn" onclick="nextRound()" class="hidden btn-3d bg-blue px-8 py-3 rounded-xl font-bold shadow-lg">
                Next Word ‚û°Ô∏è
            </button>
            <button onclick="returnToConsole()" class="btn-3d bg-slate-700 px-6 py-3 rounded-xl font-bold text-slate-300 hover:bg-slate-600">
                Exit Lesson
            </button>
        </div>
    </div>

    <script>
        // --- LOCAL STORAGE KEY ---
        const LS_KEY_WORDS = 'hangmanSecretWords'; 

        /* --- AUDIO SYSTEM (From Detective OS) --- */
        const AudioEngine = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            enabled: true,
            playTone: function(freq, type, duration, vol=0.1) {
                if (!this.enabled) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.value = freq;
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                gain.gain.exponentialRampToValueAtTime(0.00001, this.ctx.currentTime + duration);
                osc.stop(this.ctx.currentTime + duration);
            },
            click: function() { this.playTone(600, 'sine', 0.05, 0.05); },
            correct: function() { 
                this.playTone(600, 'sine', 0.1);
                setTimeout(() => this.playTone(900, 'sine', 0.2), 100);
            },
            wrong: function() { 
                this.playTone(200, 'sawtooth', 0.2);
                setTimeout(() => this.playTone(150, 'sawtooth', 0.2), 100);
            },
            win: function() {
                [440, 554, 659, 880].forEach((f, i) => setTimeout(() => this.playTone(f, 'triangle', 0.3), i * 100));
            },
            lose: function() {
                [400, 300, 200, 100].forEach((f, i) => setTimeout(() => this.playTone(f, 'sawtooth', 0.4), i * 150));
            }
        };

        function toggleSound() {
            AudioEngine.enabled = !AudioEngine.enabled;
            document.getElementById('soundBtn').innerText = AudioEngine.enabled ? 'üîä' : 'üîá';
        }

        /* --- GAME STATE --- */
        let words = [];
        let currentWordIndex = 0;
        let wordToGuess = "";
        let guessedLetters = new Set();
        let players = [];
        let currentPlayerIndex = 0;
        let gameActive = false;
        
        // --- DOM Elements ---
        const teacherConsole = document.getElementById('teacher-console');
        const wordListInput = document.getElementById('word-list-input');
        const gameSection = document.getElementById('game-section');

        /* --- SETUP FUNCTIONS --- */
        
        // ** AUTO-SAVE MECHANISM **
        function saveWords(wordsString) {
             try {
                localStorage.setItem(LS_KEY_WORDS, wordsString);
            } catch (e) {
                console.error("Could not save words to local storage:", e);
            }
        }
        
        function loadWords() {
            try {
                const savedWords = localStorage.getItem(LS_KEY_WORDS);
                if (savedWords) {
                    wordListInput.value = savedWords;
                }
            } catch (e) {
                console.error("Could not load words from local storage:", e);
            }
        }

        // Player Selection UI
        function selectPlayers(count) {
            document.getElementById('player-count').value = count;
            document.querySelectorAll('.player-select-btn').forEach(btn => {
                if(parseInt(btn.dataset.count) === count) {
                    btn.classList.add('bg-blue', 'text-white', 'ring-2', 'ring-blue/50');
                    btn.classList.remove('bg-slate-700');
                } else {
                    btn.classList.remove('bg-blue', 'text-white', 'ring-2', 'ring-blue/50');
                    btn.classList.add('bg-slate-700');
                }
            });
            AudioEngine.click();
        }
        // Init default selection
        selectPlayers(2);

        function startGame() {
            const rawInput = wordListInput.value;
            // The words list is saved automatically on input, but we ensure one final save here
            saveWords(rawInput); 

            words = rawInput.split(',').map(w => w.trim().toUpperCase()).filter(w => w.length > 0);
            
            if (words.length === 0) {
                const err = document.getElementById('error-msg');
                err.classList.remove('hidden');
                AudioEngine.wrong();
                return;
            }

            const playerCount = parseInt(document.getElementById('player-count').value);
            players = Array.from({ length: playerCount }, (_, i) => ({
                id: i,
                name: `Team ${i + 1}`,
                health: 100,
                score: 0,
                eliminated: false
            }));

            teacherConsole.classList.add('hidden');
            gameSection.classList.remove('hidden');
            gameSection.classList.add('flex');

            currentWordIndex = 0;
            initRound();
        }

        function initRound() {
            if (currentWordIndex >= words.length) {
                // All words done
                document.getElementById('message-box').innerHTML = "<span class='text-green text-2xl'>üéâ LESSON COMPLETE! üéâ</span>";
                document.getElementById('word-display').innerHTML = "";
                AudioEngine.win();
                return;
            }

            wordToGuess = words[currentWordIndex];
            guessedLetters.clear();
            gameActive = true;
            
            // Revive everyone for the new round
            players.forEach(p => {
                p.health = 100;
                p.eliminated = false;
            });
            currentPlayerIndex = 0;

            renderUI();
            renderKeyboard();
            updateMessage(`Round ${currentWordIndex + 1}: Start!`);
            document.getElementById('next-round-btn').classList.add('hidden');
        }

        /* --- RENDERING --- */

        function renderUI() {
            // Render Health Bars
            const container = document.getElementById('health-container');
            // Adjust grid layout based on player count
            const playerCount = players.length;
            container.className = `w-full grid gap-4 mb-8 ${playerCount <= 2 ? 'grid-cols-2' : playerCount === 3 ? 'grid-cols-3' : 'grid-cols-4'}`;
            container.innerHTML = '';

            players.forEach((p, idx) => {
                const isCurrent = idx === currentPlayerIndex && !p.eliminated;
                const card = document.createElement('div');
                card.className = `bg-panel p-4 rounded-2xl border-2 transition-all duration-300 relative overflow-hidden ${isCurrent ? 'border-orange scale-105 shadow-lg shadow-orange/20' : 'border-slate-700 opacity-80'}`;
                if(p.eliminated) card.classList.add('opacity-40', 'grayscale');

                let barColor = 'bg-green';
                if(p.health <= 50) barColor = 'bg-orange';
                if(p.health <= 20) barColor = 'bg-pink';

                card.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <div class="font-bold ${isCurrent ? 'text-orange' : 'text-slate-400'}">${p.name}</div>
                        <button onclick="claimWin(${idx})" title="Click to award win & reveal word" 
                                class="btn-3d bg-slate-700 hover:bg-green hover:text-white text-slate-300 text-xs font-bold py-1 px-2 rounded border border-slate-500 transition-colors z-10">
                            üèÜ ${p.score}
                        </button>
                    </div>
                    <div class="w-full h-3 bg-slate-700 rounded-full overflow-hidden">
                        <div class="h-full ${barColor} transition-all duration-500" style="width: ${p.health}%"></div>
                    </div>
                    ${isCurrent ? '<div class="mt-2 text-center text-xs font-bold text-orange uppercase tracking-widest">Your Turn</div>' : ''}
                `;
                container.appendChild(card);
            });

            // Render Word
            const wordDisplay = document.getElementById('word-display');
            wordDisplay.innerHTML = '';
            
            [...wordToGuess].forEach(char => {
                if (char === ' ') {
                    const space = document.createElement('div');
                    space.className = 'w-4 md:w-8';
                    wordDisplay.appendChild(space);
                } else {
                    const isRevealed = guessedLetters.has(char) || !char.match(/[A-Z]/);
                    const box = document.createElement('div');
                    box.className = `w-10 h-12 md:w-14 md:h-16 flex items-center justify-center text-2xl md:text-3xl font-bold rounded-lg border-b-4 transition-all duration-500 letter-tile ${isRevealed ? 'bg-white text-dark border-slate-300 revealed' : 'bg-slate-700 text-transparent border-slate-900'}`;
                    box.textContent = char;
                    wordDisplay.appendChild(box);
                }
            });
        }

        function renderKeyboard() {
            const kb = document.getElementById('keyboard');
            kb.innerHTML = '';
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

            [...alphabet].forEach(letter => {
                const btn = document.createElement('button');
                btn.textContent = letter;
                btn.className = `btn-3d h-12 rounded-lg font-bold text-lg transition-colors ${
                    guessedLetters.has(letter) 
                        ? 'bg-slate-800 text-slate-600 cursor-not-allowed shadow-none translate-y-1 border-none' 
                        : 'bg-blue text-white border-blue-800 hover:bg-blue/90'
                }`;
                if(guessedLetters.has(letter)) btn.disabled = true;
                
                btn.onclick = () => handleGuess(letter);
                kb.appendChild(btn);
            });
        }

        /* --- GAME LOGIC --- */

        function handleGuess(letter) {
            if (!gameActive || guessedLetters.has(letter)) return;

            guessedLetters.add(letter);
            
            const isCorrect = wordToGuess.includes(letter);
            
            if (isCorrect) {
                AudioEngine.correct();
                updateMessage("Correct! Next team's turn.", "text-green");
                checkWin();
            } else {
                AudioEngine.wrong();
                updateMessage("Oops! Not in the word.", "text-pink");
                damageCurrentPlayer();
            }

            // ALWAYS PASS TURN (if game is still active)
            if (gameActive) {
                advanceTurn();
            }

            renderUI();
            renderKeyboard();
        }

        function damageCurrentPlayer() {
            const p = players[currentPlayerIndex];
            p.health -= 20;
            if (p.health <= 0) {
                p.health = 0;
                p.eliminated = true;
                updateMessage(`${p.name} is eliminated!`, "text-pink");
            }
        }

        function claimWin(playerIndex) {
            if (!gameActive) return;
            
            // Award Point
            players[playerIndex].score++;
            
            // Reveal Word
            [...wordToGuess].forEach(l => guessedLetters.add(l));
            
            // End Game State
            gameActive = false;
            AudioEngine.win();
            updateMessage(`üéâ ${players[playerIndex].name} wins the round!`, "text-green");
            
            // Show Next Button
            document.getElementById('next-round-btn').classList.remove('hidden');
            
            // Re-render to show updated score and revealed word
            renderUI();
        }

        function advanceTurn() {
            let attempts = 0;
            do {
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                attempts++;
            } while (players[currentPlayerIndex].eliminated && attempts < players.length);

            // Check if everyone is dead
            if (players.every(p => p.eliminated)) {
                gameActive = false;
                updateMessage(`GAME OVER! The word was ${wordToGuess}`, "text-pink");
                document.getElementById('next-round-btn').classList.remove('hidden');
                AudioEngine.lose();
                
                // Reveal word
                [...wordToGuess].forEach(l => guessedLetters.add(l));
                renderUI();
            }
        }

        function checkWin() {
            const remainingLetters = [...wordToGuess].filter(char => char.match(/[A-Z]/) && !guessedLetters.has(char));
            if (remainingLetters.length === 0) {
                gameActive = false;
                updateMessage("üéâ VICTORY! Well done!", "text-green");
                document.getElementById('next-round-btn').classList.remove('hidden');
                AudioEngine.win();
            }
        }

        function updateMessage(msg, colorClass = "text-orange") {
            const box = document.getElementById('message-box');
            box.textContent = msg;
            box.className = `min-h-[2rem] font-bold mb-4 text-xl animate-pop ${colorClass}`;
        }

        function nextRound() {
            currentWordIndex++;
            initRound();
        }

        function returnToConsole() {
            gameSection.classList.add('hidden');
            teacherConsole.classList.remove('hidden');
        }

        // --- APPLICATION INITIALIZATION ---
        function initializeApplication() {
            // 1. Load words from storage into the input field
            loadWords();
            
            // 2. We now ALWAYS show the Teacher Console first, 
            // regardless of whether words were loaded.
            teacherConsole.classList.remove('hidden');
        }

        // Keyboard Listener
        document.addEventListener('keydown', (e) => {
            if(!gameActive) return;
            const key = e.key.toUpperCase();
            if (key.match(/^[A-Z]$/)) handleGuess(key);
        });
        
        // ** AUTO-SAVE HOOK **
        wordListInput.addEventListener('input', (e) => {
            saveWords(e.target.value);
        });
        
        // Run initialization
        initializeApplication();

    </script>
</body>
</html>