<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hangman Teams - English 1</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <link rel="stylesheet" href="../styles.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        pink: '#FF6B95',
                        orange: '#FF8C42',
                        green: '#00E676',
                        blue: '#2979FF',
                        dark: '#1e293b',
                        surface: '#FFFFFF'
                    },
                    fontFamily: {
                        heading: ['Fredoka', 'sans-serif'],
                        body: ['Nunito', 'sans-serif'],
                    },
                    boxShadow: {
                        'hard': '4px 4px 0px 0px rgba(30, 41, 59, 1)',
                        'hard-sm': '2px 2px 0px 0px rgba(30, 41, 59, 1)',
                    },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'pulse-glow': 'pulse-glow 2s infinite',
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        'pulse-glow': {
                            '0%, 100%': { boxShadow: '0 0 0 0px rgba(255, 140, 66, 0.7)' },
                            '50%': { boxShadow: '0 0 0 10px rgba(255, 140, 66, 0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Fallback Grid Background */
        body {
            background-color: #F8FAFC;
            background-image:
                linear-gradient(#E2E8F0 1px, transparent 1px),
                linear-gradient(90deg, #E2E8F0 1px, transparent 1px);
            background-size: 24px 24px;
            color: #1e293b;
        }

        /* Chunky UI Elements */
        .panel-chunky {
            background: white;
            border: 4px solid #1e293b;
            border-radius: 1.5rem;
            box-shadow: 6px 6px 0px #1e293b;
        }

        .btn-chunky {
            border: 3px solid #1e293b;
            box-shadow: 0 4px 0 #1e293b;
            transition: all 0.1s;
        }
        .btn-chunky:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #1e293b;
        }
        .btn-chunky:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: translateY(4px);
            box-shadow: none;
        }

        /* Lined Paper for Textarea */
        .lined-paper {
            background-image: linear-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 100% 2rem;
            line-height: 2rem;
            background-attachment: local;
        }

        /* Removed all 3D flip CSS */
    </style>
</head>
<body class="min-h-screen flex flex-col font-body overflow-x-hidden selection:bg-pink selection:text-white pb-20">

    <header class="max-w-6xl mx-auto w-full mt-6 px-4 z-50">
        <div class="bg-white border-4 border-dark rounded-3xl p-4 shadow-hard flex flex-col md:flex-row justify-between items-center gap-4">
            
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 rounded-xl bg-pink border-3 border-dark flex items-center justify-center text-white shadow-hard-sm transform rotate-[-2deg]">
                    <i data-lucide="swords" class="w-8 h-8"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-heading text-dark leading-none">HANGMAN</h1>
                    <p class="text-sm font-bold text-slate-400 tracking-wider">ENGLISH 1 BATAM</p>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button onclick="toggleSound()" id="soundBtn" class="btn-chunky bg-white w-10 h-10 flex items-center justify-center rounded-xl text-dark hover:bg-slate-100">
                    <i data-lucide="volume-2" class="w-5 h-5"></i>
            </div>
        </div>
    </header>

    <main id="teacher-console" class="flex-grow flex items-center justify-center p-4">
        <div class="panel-chunky w-full max-w-3xl p-8 md:p-10 animate-pop relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-4 bg-blue border-b-4 border-dark"></div>

            <h2 class="text-3xl font-heading mb-8 flex items-center gap-3 mt-4">
                <i data-lucide="settings" class="w-8 h-8 text-blue"></i> SETUP GAME
            </h2>

            <div class="grid md:grid-cols-2 gap-10">
                <div class="space-y-4">
                    <label class="block font-heading font-bold text-dark text-xl flex items-center gap-2">
                        <span class="bg-pink text-white w-8 h-8 rounded-full flex items-center justify-center text-sm border-2 border-dark shadow-sm">1</span>
                        Secret Words
                    </label>
                    <div class="relative group">
                        <textarea id="word-list-input" 
                            placeholder="PHOTOSYNTHESIS, GRAVITY, ECOSYSTEM" 
                            class="w-full h-56 p-5 rounded-2xl border-3 border-slate-300 bg-white text-xl font-bold text-dark focus:border-pink focus:outline-none transition-colors resize-none lined-paper group-hover:border-slate-400"
                            spellcheck="false"
                        ></textarea>
                        <div class="absolute bottom-4 right-4 text-xs font-bold text-slate-400 bg-white px-2 py-1 rounded border border-slate-200 shadow-sm">
                            Comma Separated
                        </div>
                    </div>
                </div>

                <div class="flex flex-col justify-between">
                    <div class="space-y-6">
                        <div>
                            <label class="block font-heading font-bold text-dark text-xl mb-3 flex items-center gap-2">
                                <span class="bg-orange text-white w-8 h-8 rounded-full flex items-center justify-center text-sm border-2 border-dark shadow-sm">2</span>
                                Teams
                            </label>
                            
                            <div class="bg-slate-100 p-1.5 rounded-xl border-2 border-slate-200 flex">
                                <button onclick="selectPlayers(2)" class="player-select-btn flex-1 py-3 rounded-lg font-heading text-lg font-bold transition-all border-2 border-transparent" data-count="2">2</button>
                                <button onclick="selectPlayers(3)" class="player-select-btn flex-1 py-3 rounded-lg font-heading text-lg font-bold transition-all border-2 border-transparent" data-count="3">3</button>
                                <button onclick="selectPlayers(4)" class="player-select-btn flex-1 py-3 rounded-lg font-heading text-lg font-bold transition-all border-2 border-transparent" data-count="4">4</button>
                            </div>
                            <input type="hidden" id="player-count" value="2">
                        </div>

                        <div class="bg-blue/5 p-5 rounded-xl border-2 border-blue/20">
                            <h3 class="font-heading font-bold text-blue mb-2 flex items-center gap-2">
                                <i data-lucide="info" class="w-4 h-4"></i> HOW TO PLAY
                            </h3>
                            <ul class="text-slate-500 text-sm font-bold space-y-2">
                                <li class="flex items-center gap-3">
                                    <span class="w-6 h-6 rounded bg-green text-white flex items-center justify-center text-xs border border-dark"><i data-lucide="check" class="w-3 h-3"></i></span>
                                    <span>Correct guess = Safe</span>
                                </li>
                                <li class="flex items-center gap-3">
                                    <span class="w-6 h-6 rounded bg-pink text-white flex items-center justify-center text-xs border border-dark"><i data-lucide="x" class="w-3 h-3"></i></span>
                                    <span>Wrong guess = -20 HP</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="mt-6">
                        <button onclick="startGame()" class="w-full btn-chunky bg-green text-white py-4 rounded-xl font-heading text-2xl tracking-wider hover:brightness-110 shadow-hard flex items-center justify-center gap-3">
                            START BATTLE <i data-lucide="play" class="w-6 h-6 fill-current"></i>
                        </button>
                        <p id="error-msg" class="text-pink text-center text-sm font-bold mt-2 hidden animate-shake">‚ö†Ô∏è Please enter at least one word!</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <main id="game-section" class="hidden flex-grow flex flex-col items-center justify-start p-4 w-full max-w-6xl mx-auto">
        
        <div id="health-container" class="w-full grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            </div>

        <div class="panel-chunky w-full p-8 md:p-12 mb-6 text-center relative overflow-hidden flex flex-col items-center justify-center min-h-[240px]">
            <div class="absolute top-4 left-4 flex gap-2">
                <div class="w-3 h-3 rounded-full bg-pink border border-dark"></div>
                <div class="w-3 h-3 rounded-full bg-orange border border-dark"></div>
            </div>
            
            <div id="message-box" class="h-8 font-heading font-bold text-2xl mb-8 text-slate-400">
                </div>
            
            <div id="word-display" class="flex flex-wrap justify-center gap-3 md:gap-4">
                </div>
        </div>

        <div class="bg-white border-4 border-dark rounded-3xl p-6 shadow-hard w-full max-w-4xl">
            <div id="keyboard" class="grid grid-cols-7 md:grid-cols-10 gap-2 md:gap-3">
                </div>
        </div>

        <div class="flex gap-4 mt-8 pb-8">
            <button id="next-round-btn" onclick="nextRound()" class="hidden btn-chunky bg-blue text-white px-8 py-3 rounded-xl font-heading text-xl shadow-hard hover:brightness-110 flex items-center gap-2">
                NEXT WORD <i data-lucide="arrow-right" class="w-5 h-5"></i>
            </button>
            <button onclick="returnToConsole()" class="btn-chunky bg-white text-slate-500 px-6 py-3 rounded-xl font-bold hover:bg-slate-100 flex items-center gap-2">
                <i data-lucide="log-out" class="w-4 h-4"></i> EXIT
            </button>
        </div>
    </main>

    <script>
        // --- CONFIG ---
        const LS_KEY_WORDS = 'english1_hangman_words'; 

        // --- AUDIO ENGINE ---
        const AudioEngine = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            enabled: true,
            playTone: function(freq, type, duration, vol=0.1) {
                if (!this.enabled) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.value = freq;
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                gain.gain.exponentialRampToValueAtTime(0.00001, this.ctx.currentTime + duration);
                osc.stop(this.ctx.currentTime + duration);
            },
            click: function() { this.playTone(600, 'sine', 0.05, 0.05); },
            correct: function() { 
                this.playTone(600, 'sine', 0.1);
                setTimeout(() => this.playTone(900, 'sine', 0.2), 100);
            },
            wrong: function() { 
                this.playTone(200, 'sawtooth', 0.2);
                setTimeout(() => this.playTone(150, 'sawtooth', 0.2), 100);
            },
            win: function() {
                [440, 554, 659, 880].forEach((f, i) => setTimeout(() => this.playTone(f, 'triangle', 0.3), i * 100));
            },
            lose: function() {
                [400, 300, 200, 100].forEach((f, i) => setTimeout(() => this.playTone(f, 'sawtooth', 0.4), i * 150));
            }
        };

        function toggleSound() {
            AudioEngine.enabled = !AudioEngine.enabled;
            const btn = document.getElementById('soundBtn');
            if(AudioEngine.enabled) {
                btn.innerHTML = '<i data-lucide="volume-2" class="w-5 h-5"></i>';
                btn.classList.remove('text-red-500');
            } else {
                btn.innerHTML = '<i data-lucide="volume-x" class="w-5 h-5"></i>';
                btn.classList.add('text-red-500');
            }
            lucide.createIcons();
        }

        // --- GAME STATE ---
        let words = [];
        let currentWordIndex = 0;
        let wordToGuess = "";
        let guessedLetters = new Set();
        let players = [];
        let currentPlayerIndex = 0;
        let gameActive = false;
        
        // --- DOM Elements ---
        const teacherConsole = document.getElementById('teacher-console');
        const wordListInput = document.getElementById('word-list-input');
        const gameSection = document.getElementById('game-section');

        // --- FUNCTIONS ---
        
        function saveWords(wordsString) {
             try { localStorage.setItem(LS_KEY_WORDS, wordsString); } catch (e) {}
        }
        
        function loadWords() {
            try {
                const savedWords = localStorage.getItem(LS_KEY_WORDS);
                if (savedWords) wordListInput.value = savedWords;
            } catch (e) {}
        }

        function selectPlayers(count) {
            document.getElementById('player-count').value = count;
            document.querySelectorAll('.player-select-btn').forEach(btn => {
                if(parseInt(btn.dataset.count) === count) {
                    btn.classList.add('bg-white', 'text-dark', 'border-dark', 'shadow-hard-sm');
                    btn.classList.remove('border-transparent', 'text-slate-400', 'hover:bg-white');
                } else {
                    btn.classList.remove('bg-white', 'text-dark', 'border-dark', 'shadow-hard-sm');
                    btn.classList.add('border-transparent', 'text-slate-400', 'hover:bg-white');
                }
            });
            AudioEngine.click();
        }

        function startGame() {
            const rawInput = wordListInput.value;
            saveWords(rawInput); 

            words = rawInput.split(',').map(w => w.trim().toUpperCase()).filter(w => w.length > 0);
            
            if (words.length === 0) {
                const err = document.getElementById('error-msg');
                err.classList.remove('hidden');
                AudioEngine.wrong();
                return;
            }

            const playerCount = parseInt(document.getElementById('player-count').value);
            players = Array.from({ length: playerCount }, (_, i) => ({
                id: i,
                name: `Team ${i + 1}`,
                health: 100,
                score: 0,
                eliminated: false
            }));

            teacherConsole.classList.add('hidden');
            gameSection.classList.remove('hidden');
            gameSection.classList.add('flex');

            currentWordIndex = 0;
            initRound();
        }

        function initRound() {
            if (currentWordIndex >= words.length) {
                document.getElementById('message-box').innerHTML = "<span class='text-green text-3xl'>üéâ LESSON COMPLETE! üéâ</span>";
                document.getElementById('word-display').innerHTML = "";
                AudioEngine.win();
                confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
                return;
            }

            wordToGuess = words[currentWordIndex];
            guessedLetters.clear();
            gameActive = true;
            
            // Revive everyone for the new round
            players.forEach(p => {
                p.health = 100;
                p.eliminated = false;
            });
            currentPlayerIndex = 0;

            renderUI();
            renderKeyboard();
            updateMessage(`Round ${currentWordIndex + 1}: Start!`, 'text-dark');
            document.getElementById('next-round-btn').classList.add('hidden');
        }

        function renderUI() {
            const container = document.getElementById('health-container');
            const playerCount = players.length;
            container.className = `w-full grid gap-4 mb-6 ${playerCount <= 2 ? 'grid-cols-2' : playerCount === 3 ? 'grid-cols-3' : 'grid-cols-4'}`;
            container.innerHTML = '';

            players.forEach((p, idx) => {
                const isCurrent = idx === currentPlayerIndex && !p.eliminated;
                
                const card = document.createElement('div');
                card.id = `team-card-${idx}`;
                card.className = `bg-white p-4 rounded-2xl border-4 transition-all duration-300 relative overflow-hidden flex flex-col justify-between h-32 ${isCurrent ? 'border-orange shadow-hard scale-105 z-10' : 'border-dark shadow-sm opacity-90'}`;
                if(p.eliminated) card.classList.add('opacity-50', 'grayscale');

                let barColor = 'bg-green';
                let icon = 'heart';
                if(p.health <= 50) barColor = 'bg-orange';
                if(p.health <= 20) { barColor = 'bg-pink'; icon = 'alert-triangle'; }

                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-heading font-bold text-lg leading-none ${isCurrent ? 'text-orange' : 'text-dark'}">${p.name}</div>
                            <div class="text-xs font-bold text-slate-400 mt-1">${p.health}/100 HP</div>
                        </div>
                        <button onclick="claimWin(${idx})" title="Award Win" 
                                class="btn-chunky bg-white hover:bg-green hover:text-white text-dark text-xs font-bold py-1 px-2 rounded-lg border-2 border-slate-200 transition-colors z-20 flex items-center gap-1">
                            <i data-lucide="trophy" class="w-3 h-3"></i> ${p.score}
                        </button>
                    </div>
                    
                    <div>
                        <div class="w-full h-4 bg-slate-100 rounded-full overflow-hidden border-2 border-slate-200">
                            <div class="h-full ${barColor} transition-all duration-500" style="width: ${p.health}%">
                            </div>
                        </div>
                    </div>
                    ${isCurrent ? '<div class="absolute top-0 right-0 w-3 h-3 bg-orange rounded-bl-lg"></div>' : ''}
                `;
                container.appendChild(card);
            });
            lucide.createIcons();

            // Render Word (Non-Flip Logic)
            const wordDisplay = document.getElementById('word-display');
            wordDisplay.innerHTML = '';
            
            [...wordToGuess].forEach(char => {
                if (char === ' ') {
                    const space = document.createElement('div');
                    space.className = 'w-4 md:w-8';
                    wordDisplay.appendChild(space);
                } else {
                    const isRevealed = guessedLetters.has(char) || !char.match(/[A-Z]/);
                    const box = document.createElement('div');
                    
                    // Standard tile styling
                    box.className = `w-12 h-14 md:w-16 md:h-20 flex items-center justify-center text-3xl md:text-4xl font-heading font-bold rounded-xl border-b-8 transition-all duration-300`;
                    
                    if (isRevealed) {
                        // Revealed: white background, dark text
                        box.classList.add('bg-white', 'text-dark', 'border-slate-200', 'shadow-sm');
                        box.textContent = char;
                    } else {
                        // Hidden: light gray background, transparent text (for spacing)
                        box.classList.add('bg-slate-200', 'text-transparent', 'border-slate-300');
                        box.innerHTML = '&nbsp;';
                    }
                    
                    wordDisplay.appendChild(box);
                }
            });
        }

        function renderKeyboard() {
            const kb = document.getElementById('keyboard');
            kb.innerHTML = '';
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

            [...alphabet].forEach(letter => {
                const btn = document.createElement('button');
                btn.textContent = letter;
                
                const isGuessed = guessedLetters.has(letter);
                let stateClass = 'bg-white text-dark hover:bg-blue hover:text-white hover:border-dark'; // Default
                
                if (isGuessed) {
                    if (wordToGuess.includes(letter)) {
                        stateClass = 'bg-green text-white border-green border-opacity-50 shadow-none translate-y-1'; // Correct
                    } else {
                        stateClass = 'bg-slate-200 text-slate-400 border-slate-300 shadow-none translate-y-1'; // Wrong
                    }
                }

                btn.className = `btn-chunky h-12 rounded-xl font-heading font-bold text-lg transition-all ${stateClass}`;
                if(isGuessed) btn.disabled = true;
                
                btn.onclick = () => handleGuess(letter);
                kb.appendChild(btn);
            });
        }

        function handleGuess(letter) {
            if (!gameActive || guessedLetters.has(letter)) return;

            guessedLetters.add(letter);
            const isCorrect = wordToGuess.includes(letter);
            
            if (isCorrect) {
                AudioEngine.correct();
                updateMessage("Correct! Next team's turn.", "text-green");
                checkWin();
            } else {
                AudioEngine.wrong();
                updateMessage("Oops! -20 HP.", "text-pink");
                damageCurrentPlayer();
            }

            if (gameActive) advanceTurn();
            renderUI();
            renderKeyboard();
        }

        function damageCurrentPlayer() {
            const p = players[currentPlayerIndex];
            p.health -= 20;
            
            // Shake Effect on Card
            const card = document.getElementById(`team-card-${currentPlayerIndex}`);
            if(card) {
                card.classList.remove('animate-shake');
                void card.offsetWidth;
                card.classList.add('animate-shake');
            }

            if (p.health <= 0) {
                p.health = 0;
                p.eliminated = true;
                updateMessage(`${p.name} is eliminated!`, "text-pink");
            }
        }

        function claimWin(playerIndex) {
            if (!gameActive) return;
            players[playerIndex].score++;
            [...wordToGuess].forEach(l => guessedLetters.add(l));
            gameActive = false;
            AudioEngine.win();
            updateMessage(`üéâ ${players[playerIndex].name} wins the round!`, "text-green");
            document.getElementById('next-round-btn').classList.remove('hidden');
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            renderUI();
        }

        function advanceTurn() {
            let attempts = 0;
            do {
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                attempts++;
            } while (players[currentPlayerIndex].eliminated && attempts < players.length);

            if (players.every(p => p.eliminated)) {
                gameActive = false;
                updateMessage(`GAME OVER! The word was ${wordToGuess}`, "text-pink");
                document.getElementById('next-round-btn').classList.remove('hidden');
                AudioEngine.lose();
                [...wordToGuess].forEach(l => guessedLetters.add(l));
                renderUI();
            }
        }

        function checkWin() {
            const remainingLetters = [...wordToGuess].filter(char => char.match(/[A-Z]/) && !guessedLetters.has(char));
            if (remainingLetters.length === 0) {
                gameActive = false;
                updateMessage("üéâ VICTORY! Well done!", "text-green");
                document.getElementById('next-round-btn').classList.remove('hidden');
                AudioEngine.win();
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            }
        }

        function updateMessage(msg, colorClass) {
            const box = document.getElementById('message-box');
            box.textContent = msg;
            box.className = `h-8 font-heading font-bold text-2xl mb-8 animate-pop ${colorClass}`;
        }

        function nextRound() {
            currentWordIndex++;
            initRound();
        }

        function returnToConsole() {
            gameSection.classList.add('hidden');
            teacherConsole.classList.remove('hidden');
        }

        // Init
        window.onload = () => {
            loadWords();
            selectPlayers(2);
            lucide.createIcons();
            teacherConsole.classList.remove('hidden');
        };

        // Keyboard Listener
        document.addEventListener('keydown', (e) => {
            if(!gameActive) return;
            const key = e.key.toUpperCase();
            if (key.match(/^[A-Z]$/)) handleGuess(key);
        });
        
        // Auto Save
        wordListInput.addEventListener('input', (e) => saveWords(e.target.value));

    </script>
</body>
</html>
