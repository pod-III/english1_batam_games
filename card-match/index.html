<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Match</title>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        pink: '#FF6B95',
                        orange: '#FF8C42',
                        green: '#00E676',
                        blue: '#2979FF',
                        dark: '#0f172a',
                        panel: '#1e293b',
                        surface: '#334155'
                    },
                    fontFamily: {
                        heading: ['Bebas Neue', 'sans-serif'],
                        body: ['Nunito', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        'bounce-slight': 'bounce-slight 0.3s ease-in-out',
                        'pop': 'pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                    },
                    keyframes: {
                        'bounce-slight': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        pop: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@400;700&family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Nunito', sans-serif;
            background-color: #0f172a;
            background-image: 
                radial-gradient(at 0% 0%, rgba(41, 121, 255, 0.15) 0px, transparent 50%), 
                radial-gradient(at 100% 100%, rgba(255, 107, 149, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            color: white;
            overflow-x: hidden;
        }

        /* Glassmorphism Panels */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* 3D Button Style */
        .btn-3d {
            transition: all 0.1s;
            transform: translateY(0);
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
            border-bottom: 4px solid rgba(0,0,0,0.2);
        }
        .btn-3d:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 rgba(0,0,0,0.2);
            border-bottom: 0px solid transparent;
        }

        /* Card Flip Mechanics */
        .card {
            perspective: 1000px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        .card-inner {
            width: 100%;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            position: relative;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card.matched .card-front {
            border-color: #00E676;
            background: rgba(0, 230, 118, 0.2);
            color: #00E676;
            box-shadow: 0 0 15px rgba(0, 230, 118, 0.4);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            padding: 0.5rem;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .card-back {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: rgba(255,255,255,0.5);
            font-size: 2rem;
        }
        
        .card-front {
            background: #1e293b;
            color: white;
            transform: rotateY(180deg);
            font-weight: 700;
            overflow: hidden;
            word-wrap: break-word;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    
    <!-- Navbar / Header -->
    <header class="w-full glass-panel border-b border-white/10 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-blue to-pink w-10 h-10 rounded-lg flex items-center justify-center text-xl shadow-lg">
                    üß©
                </div>
                <div>
                    <h1 class="text-2xl font-heading tracking-wider text-white leading-none">CARD MATCH</h1>
                    <div class="text-[10px] font-mono text-gray-400 tracking-widest">ENGLISH 1 BATAM</div>
                </div>
            </div>

            <!-- Game Stats (Hidden initially) -->
            <div id="game-stats" class="hidden md:flex items-center gap-6">
                <div class="flex flex-col items-center">
                    <span class="text-[10px] uppercase text-gray-400 font-bold tracking-wider">Time</span>
                    <span id="timer-display" class="font-mono text-xl text-blue font-bold">00:00</span>
                </div>
                <div class="flex flex-col items-center">
                    <span class="text-[10px] uppercase text-gray-400 font-bold tracking-wider">Moves</span>
                    <span id="moves-display" class="font-mono text-xl text-orange font-bold">0</span>
                </div>
                <div class="flex flex-col items-center">
                    <span class="text-[10px] uppercase text-gray-400 font-bold tracking-wider">Pairs</span>
                    <span id="pairs-display" class="font-mono text-xl text-green font-bold">0/0</span>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button id="sound-toggle" class="p-2 rounded-full hover:bg-white/10 transition-colors text-gray-400" title="Toggle Sound">
                    <i data-lucide="volume-2" class="w-5 h-5"></i>
                </button>
                <button id="restart-btn" class="p-2 rounded-full hover:bg-white/10 transition-colors text-pink" title="Restart Game">
                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                </button>
                <button id="settings-btn" class="btn-3d bg-blue text-white px-4 py-2 rounded-lg font-bold text-sm tracking-wide">
                    SETUP
                </button>
            </div>
        </div>
    </header>

    <!-- Main Game Area -->
    <main class="flex-grow flex flex-col items-center justify-center p-4 w-full max-w-7xl mx-auto">
        
        <!-- Mobile Stats (Visible only on small screens) -->
        <div id="mobile-stats" class="md:hidden flex justify-between w-full mb-4 px-4 glass-panel py-3 rounded-xl hidden">
             <div class="flex items-center gap-2">
                <i data-lucide="clock" class="w-4 h-4 text-blue"></i>
                <span id="mobile-timer" class="font-mono font-bold">00:00</span>
            </div>
             <div class="flex items-center gap-2">
                <i data-lucide="hash" class="w-4 h-4 text-orange"></i>
                <span id="mobile-moves" class="font-mono font-bold">0</span>
            </div>
        </div>

        <!-- The Grid -->
        <div id="game-grid" class="grid gap-4 w-full max-w-5xl mx-auto perspective-1000 transition-all duration-500">
            <!-- Cards injected here -->
            <div class="col-span-full py-20 text-center animate-pop">
                <div class="text-6xl mb-4">üéÆ</div>
                <h2 class="text-3xl font-heading text-white mb-2">Ready to Play?</h2>
                <p class="text-gray-400 mb-8">Click "SETUP" to create your vocabulary list.</p>
                <button onclick="document.getElementById('settings-btn').click()" class="btn-3d bg-gradient-to-r from-pink to-orange text-white px-8 py-4 rounded-xl font-bold text-xl shadow-lg">
                    CREATE NEW GAME
                </button>
            </div>
        </div>

    </main>

    <!-- SETUP MODAL -->
    <div id="setup-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-pop">
        <div class="glass-panel w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            
            <div class="p-6 border-b border-white/10 flex justify-between items-center bg-black/20">
                <h2 class="text-2xl font-heading text-white tracking-wide">GAME SETUP</h2>
                <button id="close-setup" class="text-gray-400 hover:text-white transition">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="p-6 overflow-y-auto space-y-6">
                
                <!-- Presets -->
                <div class="space-y-2">
                    <label class="text-xs font-bold text-blue uppercase tracking-widest">Quick Load Preset</label>
                    <div class="flex flex-wrap gap-2">
                        <button class="preset-btn px-3 py-1 bg-surface hover:bg-blue/20 border border-white/10 rounded-full text-xs transition" data-words="Cat, Dog, Bird, Fish, Lion, Tiger, Bear, Wolf">animals</button>
                        <button class="preset-btn px-3 py-1 bg-surface hover:bg-blue/20 border border-white/10 rounded-full text-xs transition" data-words="Red, Blue, Green, Yellow, Pink, Purple, Orange, Black">colors</button>
                        <button class="preset-btn px-3 py-1 bg-surface hover:bg-blue/20 border border-white/10 rounded-full text-xs transition" data-words="Head, Shoulders, Knees, Toes, Eyes, Ears, Mouth, Nose">body parts</button>
                        <button class="preset-btn px-3 py-1 bg-surface hover:bg-blue/20 border border-white/10 rounded-full text-xs transition" data-words="Run, Jump, Swim, Eat, Sleep, Read, Write, Speak">verbs</button>
                    </div>
                </div>

                <!-- Input -->
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-widest">Vocabulary List (Comma Separated)</label>
                    <textarea id="word-input" 
                        class="w-full h-40 bg-dark border border-white/10 rounded-xl p-4 text-white focus:border-blue focus:ring-1 focus:ring-blue outline-none resize-none font-mono text-sm shadow-inner"
                        placeholder="e.g. Apple, Banana, Cherry, Date..."></textarea>
                    <p class="text-xs text-gray-500">Tip: Use 6-12 words for the best grid layout.</p>
                </div>

                <!-- Error Msg -->
                <div id="setup-error" class="hidden p-3 bg-pink/10 border border-pink/30 rounded-lg text-pink text-sm font-bold flex items-center gap-2">
                    <i data-lucide="alert-circle" class="w-4 h-4"></i>
                    <span>Please enter at least 3 words.</span>
                </div>

            </div>

            <div class="p-6 border-t border-white/10 bg-black/20 flex justify-end gap-3">
                <button id="start-game-btn" class="btn-3d bg-gradient-to-r from-green to-blue text-white px-8 py-3 rounded-xl font-bold text-lg shadow-lg w-full md:w-auto">
                    START GAME
                </button>
            </div>
        </div>
    </div>

    <!-- WIN MODAL -->
    <div id="win-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
        <div class="glass-panel w-full max-w-md rounded-2xl shadow-2xl p-8 text-center animate-pop relative overflow-hidden">
            <!-- Glow effect behind -->
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-green/20 blur-[100px] rounded-full pointer-events-none"></div>

            <div class="relative z-10">
                <div class="text-6xl mb-4 animate-bounce-slight">üèÜ</div>
                <h2 class="text-4xl font-heading text-transparent bg-clip-text bg-gradient-to-r from-green to-blue mb-2">FANTASTIC!</h2>
                <p class="text-gray-300 mb-6">You cleared the board!</p>

                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-surface/50 p-3 rounded-xl border border-white/5">
                        <div class="text-xs text-gray-400 uppercase font-bold">Time</div>
                        <div id="final-time" class="text-xl font-mono text-white font-bold">00:00</div>
                    </div>
                    <div class="bg-surface/50 p-3 rounded-xl border border-white/5">
                        <div class="text-xs text-gray-400 uppercase font-bold">Moves</div>
                        <div id="final-moves" class="text-xl font-mono text-white font-bold">0</div>
                    </div>
                </div>

                <div class="flex flex-col gap-3">
                    <button onclick="restartGame()" class="btn-3d bg-blue text-white py-3 rounded-xl font-bold">PLAY AGAIN</button>
                    <button onclick="document.getElementById('settings-btn').click(); document.getElementById('win-modal').classList.add('hidden')" class="py-3 text-gray-400 hover:text-white font-bold text-sm">CHANGE WORDS</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- AUDIO ENGINE (Tone.js) ---
        let audioEnabled = true;
        const AudioEngine = {
            init: async () => { await Tone.start(); },
            playFlip: () => {
                if(!audioEnabled) return;
                const synth = new Tone.MembraneSynth().toDestination();
                synth.triggerAttackRelease("C2", "32n", Tone.now(), 0.1);
            },
            playMatch: () => {
                if(!audioEnabled) return;
                const synth = new Tone.PolySynth(Tone.Synth).toDestination();
                synth.triggerAttackRelease(["C4", "E4", "G4"], "16n");
            },
            playError: () => {
                if(!audioEnabled) return;
                const synth = new Tone.PluckSynth().toDestination();
                synth.triggerAttackRelease("C2", "16n");
            },
            playWin: () => {
                if(!audioEnabled) return;
                const synth = new Tone.PolySynth(Tone.Synth).toDestination();
                const now = Tone.now();
                synth.triggerAttackRelease(["C4", "E4", "G4", "C5"], "8n", now);
                synth.triggerAttackRelease(["E4", "G4", "B4", "E5"], "8n", now + 0.15);
                synth.triggerAttackRelease(["G4", "B4", "D5", "G5"], "4n", now + 0.3);
            }
        };

        // --- GAME STATE ---
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let totalPairs = 0;
        let moves = 0;
        let timerSeconds = 0;
        let timerInterval = null;
        let isLocked = false;
        let currentWords = [];

        // --- DOM ELEMENTS ---
        const gameGrid = document.getElementById('game-grid');
        const setupModal = document.getElementById('setup-modal');
        const winModal = document.getElementById('win-modal');
        const wordInput = document.getElementById('word-input');
        const setupError = document.getElementById('setup-error');
        const timerDisplays = [document.getElementById('timer-display'), document.getElementById('mobile-timer')];
        const moveDisplays = [document.getElementById('moves-display'), document.getElementById('mobile-moves')];
        const pairsDisplay = document.getElementById('pairs-display');

        // --- INITIALIZATION ---
        lucide.createIcons();

        // --- CORE FUNCTIONS ---
        
        function formatTime(secs) {
            const mins = Math.floor(secs / 60);
            const s = secs % 60;
            return `${mins.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            stopTimer();
            timerSeconds = 0;
            updateUI();
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateUI();
            }, 1000);
        }

        function stopTimer() {
            if(timerInterval) clearInterval(timerInterval);
        }

        function updateUI() {
            const timeStr = formatTime(timerSeconds);
            timerDisplays.forEach(el => el.innerText = timeStr);
            moveDisplays.forEach(el => el.innerText = moves);
            pairsDisplay.innerText = `${matchedPairs}/${totalPairs}`;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initGame(words) {
            stopTimer();
            currentWords = words;
            matchedPairs = 0;
            moves = 0;
            totalPairs = words.length;
            cards = [];
            flippedCards = [];
            isLocked = false;
            
            // Show stats
            document.getElementById('game-stats').classList.remove('hidden');
            document.getElementById('mobile-stats').classList.remove('hidden');
            
            // Create pairs
            const deck = [...words, ...words];
            shuffle(deck);

            // Determine Grid Size
            // Try to keep it rectangular or square
            let cols = 4;
            if (deck.length > 12) cols = 5;
            if (deck.length > 20) cols = 6;
            
            gameGrid.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
            gameGrid.innerHTML = '';

            deck.forEach((word, index) => {
                const card = document.createElement('div');
                card.className = 'card aspect-square relative';
                card.dataset.word = word;
                card.dataset.index = index;
                
                // Adjust font size based on length
                const fontSize = word.length > 8 ? 'text-xs md:text-sm' : 'text-sm md:text-xl';

                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-face card-front ${fontSize}">
                            ${word}
                        </div>
                        <div class="card-face card-back">
                            ?
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', () => flipCard(card));
                gameGrid.appendChild(card);
                cards.push(card);
            });

            startTimer();
            updateUI();
        }

        function flipCard(card) {
            if (isLocked || card.classList.contains('flipped') || card.classList.contains('matched')) return;

            // Start Audio Context on first user interaction if needed
            if (Tone.context.state !== 'running') Tone.start();

            card.classList.add('flipped');
            flippedCards.push(card);
            AudioEngine.playFlip();

            if (flippedCards.length === 2) {
                moves++;
                updateUI();
                checkForMatch();
            }
        }

        function checkForMatch() {
            isLocked = true;
            const [card1, card2] = flippedCards;
            const match = card1.dataset.word === card2.dataset.word;

            if (match) {
                setTimeout(() => {
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    AudioEngine.playMatch();
                    matchedPairs++;
                    updateUI();
                    resetTurn();
                    checkWin();
                }, 500);
            } else {
                setTimeout(() => {
                    AudioEngine.playError();
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    resetTurn();
                }, 1000);
            }
        }

        function resetTurn() {
            flippedCards = [];
            isLocked = false;
        }

        function checkWin() {
            if (matchedPairs === totalPairs) {
                stopTimer();
                AudioEngine.playWin();
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#FF6B95', '#FF8C42', '#00E676', '#2979FF']
                });
                
                document.getElementById('final-time').innerText = formatTime(timerSeconds);
                document.getElementById('final-moves').innerText = moves;
                
                setTimeout(() => {
                    winModal.classList.remove('hidden');
                }, 1000);
            }
        }

        function restartGame() {
            winModal.classList.add('hidden');
            if(currentWords.length > 0) initGame(currentWords);
            else document.getElementById('settings-btn').click();
        }

        // --- EVENT LISTENERS ---

        // Setup Modal Controls
        document.getElementById('settings-btn').addEventListener('click', () => {
            setupModal.classList.remove('hidden');
            winModal.classList.add('hidden');
        });

        document.getElementById('close-setup').addEventListener('click', () => {
            setupModal.classList.add('hidden');
        });

        // Start Game
        document.getElementById('start-game-btn').addEventListener('click', () => {
            const raw = wordInput.value;
            const words = raw.split(',').map(w => w.trim()).filter(w => w.length > 0);
            
            // Unique words only
            const uniqueWords = [...new Set(words)];

            if (uniqueWords.length < 3) {
                setupError.classList.remove('hidden');
                return;
            }

            setupError.classList.add('hidden');
            setupModal.classList.add('hidden');
            initGame(uniqueWords);
        });

        // Presets
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                wordInput.value = e.target.dataset.words;
            });
        });

        // Header Controls
        document.getElementById('restart-btn').addEventListener('click', restartGame);
        
        document.getElementById('sound-toggle').addEventListener('click', (e) => {
            audioEnabled = !audioEnabled;
            const icon = audioEnabled ? 'volume-2' : 'volume-x';
            e.currentTarget.innerHTML = `<i data-lucide="${icon}" class="w-5 h-5"></i>`;
            lucide.createIcons();
        });

        // Init
        document.getElementById('settings-btn').click(); // Open setup on load

    </script>
</body>
</html>
