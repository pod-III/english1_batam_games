<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spin the Pencil - English 1 Batam</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        e1pink: '#FF6B95',
                        e1orange: '#FF8C42',
                        e1green: '#00E676',
                        e1blue: '#2979FF',
                        e1dark: '#1e293b',
                        e1chalk: '#f8fafc',
                    },
                    fontFamily: {
                        fredoka: ['Fredoka', 'sans-serif'],
                        nunito: ['Nunito', 'sans-serif'],
                    },
                    boxShadow: {
                        'neo': '5px 5px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-sm': '3px 3px 0px 0px rgba(30, 41, 59, 1)',
                    },
                    animation: {
                        'bounce-in': 'bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)',
                    },
                    keyframes: {
                        bounceIn: {
                            '0%': { transform: 'scale(0.3)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)' },
                            '70%': { transform: 'scale(0.9)' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.07) 2px, transparent 2px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.07) 2px, transparent 2px);
            background-size: 32px 32px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
        }

        .neo-btn:active {
            transform: translate(3px, 3px);
            box-shadow: 0px 0px 0px 0px rgba(30, 41, 59, 1);
        }

        /* The wrapper is square and centered.
           The SVG inside is drawn so the pencil's center of mass 
           is exactly at 50% 50% of the SVG.
        */
        #pencil-wrapper {
            transform-origin: center center;
            filter: drop-shadow(8px 8px 0px rgba(30,41,59,0.2));
            will-change: transform;
        }
    </style>
</head>
<body class="font-nunito text-e1dark h-[100dvh] w-screen overflow-hidden flex flex-col items-center justify-between py-6 px-4">

    <header class="flex-none z-10">
        <div class="inline-flex items-center gap-3 bg-white border-4 border-e1dark rounded-2xl px-5 py-2 shadow-neo transform -rotate-1">
            <i data-lucide="pencil" class="w-6 h-6 md:w-8 md:h-8 text-e1orange"></i>
            <h1 class="font-fredoka text-2xl md:text-4xl font-bold text-e1dark tracking-wide uppercase">Spin It</h1>
        </div>
    </header>

    <div class="flex-grow flex items-center justify-center w-full relative">
        <div id="game-board" class="relative w-[85vmin] h-[85vmin] max-w-[600px] max-h-[600px]">
            
            <div class="absolute inset-0 rounded-full border-4 border-e1dark bg-white shadow-neo opacity-90"></div>
            
            <div id="players-container" class="absolute inset-0 w-full h-full pointer-events-none z-10"></div>

            <div class="absolute inset-0 flex items-center justify-center z-20 pointer-events-none">
                <div id="pencil-wrapper" class="w-full h-full flex items-center justify-center">
                    
                    <svg viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-[80%] h-[80%]">
                        <defs>
                            <linearGradient id="barrelGrad" x1="0" y1="0" x2="1" y2="0">
                                <stop offset="0%" stop-color="#FFB300"/>
                                <stop offset="40%" stop-color="#FFD54F"/>
                                <stop offset="60%" stop-color="#FFD54F"/>
                                <stop offset="100%" stop-color="#FFB300"/>
                            </linearGradient>
                            <linearGradient id="metalGrad" x1="0" y1="0" x2="1" y2="0">
                                <stop offset="0%" stop-color="#90A4AE"/>
                                <stop offset="50%" stop-color="#CFD8DC"/> 
                                <stop offset="100%" stop-color="#90A4AE"/>
                            </linearGradient>
                             <linearGradient id="woodGrad" x1="0" y1="0" x2="1" y2="0">
                                <stop offset="0%" stop-color="#D7CCC8"/>
                                <stop offset="50%" stop-color="#EFEBE9"/>
                                <stop offset="100%" stop-color="#D7CCC8"/>
                            </linearGradient>
                        </defs>

                        <path d="M175 340 H225 V360 C225 375 175 375 175 360 V340 Z" fill="#F48FB1" stroke="#1E293B" stroke-width="4"/>

                        <rect x="173" y="310" width="54" height="30" fill="url(#metalGrad)" stroke="#1E293B" stroke-width="4"/>
                        <path d="M175 320 H225" stroke="#1E293B" stroke-width="2" opacity="0.4"/>
                        <path d="M175 330 H225" stroke="#1E293B" stroke-width="2" opacity="0.4"/>

                        <rect x="175" y="90" width="50" height="220" fill="url(#barrelGrad)" stroke="#1E293B" stroke-width="4"/>
                        <path d="M187 90 V310" stroke="#1E293B" stroke-width="2" opacity="0.2"/>
                        <path d="M213 90 V310" stroke="#1E293B" stroke-width="2" opacity="0.2"/>

                        <path d="M175 90 L200 40 L225 90 H175 Z" fill="url(#woodGrad)" stroke="#1E293B" stroke-width="4"/>

                        <path d="M200 40 L192 56 H208 L200 40 Z" fill="#37474F"/>

                        <circle cx="200" cy="200" r="8" fill="#CFD8DC" stroke="#1E293B" stroke-width="3"/>
                        <circle cx="200" cy="200" r="3" fill="#90A4AE"/>

                    </svg>
                </div>
            </div>
        </div>
    </div>

    <div class="flex-none flex flex-row gap-4 z-20 w-full max-w-lg justify-center mb-4 md:mb-8">
        <button onclick="spinBottle()" id="spin-btn" class="neo-btn flex-1 bg-e1pink text-white font-fredoka text-xl md:text-2xl py-4 rounded-2xl border-4 border-e1dark shadow-neo flex items-center justify-center gap-2">
            <i data-lucide="rotate-cw" class="stroke-[3]"></i> SPIN
        </button>
        <button onclick="openModal()" class="neo-btn bg-e1chalk text-e1dark font-fredoka text-xl md:text-2xl px-6 py-4 rounded-2xl border-4 border-e1dark shadow-neo flex items-center justify-center">
            <i data-lucide="settings-2" class="stroke-[3]"></i>
        </button>
    </div>

    <div id="config-modal" class="fixed inset-0 bg-slate-900/60 hidden items-center justify-center z-50 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-lg border-4 border-e1dark rounded-3xl shadow-neo p-6 relative animate-bounce-in">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-fredoka text-2xl font-bold">Who is playing?</h2>
                <button onclick="closeModal()" class="p-2 hover:bg-slate-100 rounded-xl transition-colors">
                    <i data-lucide="x" class="w-8 h-8 text-e1dark"></i>
                </button>
            </div>
            <textarea id="player-input" class="w-full h-48 border-4 border-e1dark rounded-2xl p-4 font-nunito font-bold text-xl text-slate-700 focus:outline-none focus:ring-4 focus:ring-e1blue/20 resize-none" placeholder="Name 1, Name 2, Name 3..."></textarea>
            <div class="mt-6">
                <button onclick="savePlayers()" class="neo-btn w-full bg-e1green text-e1dark font-fredoka text-xl py-3 rounded-xl border-4 border-e1dark shadow-neo-sm">
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <div id="winner-modal" class="fixed inset-0 hidden items-center justify-center z-50 pointer-events-none">
        <div class="absolute inset-0 bg-slate-900/20 backdrop-blur-[2px]"></div>
        <div class="bg-white border-4 border-e1dark rounded-3xl p-8 shadow-neo text-center relative animate-bounce-in pointer-events-auto max-w-sm mx-4 w-full">
            <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 bg-e1green border-4 border-e1dark text-white font-fredoka font-bold px-6 py-1 rounded-full shadow-neo-sm">
                WINNER
            </div>
            <h3 id="winner-name" class="font-fredoka text-4xl font-bold text-e1dark mt-6 mb-2 break-words"></h3>
            <button onclick="closeWinnerModal()" class="neo-btn mt-6 bg-e1blue text-white font-fredoka text-xl px-8 py-3 rounded-xl border-4 border-e1dark w-full shadow-neo-sm">
                Okay!
            </button>
        </div>
    </div>

    <script>
        lucide.createIcons();

        const palette = ['bg-e1pink', 'bg-e1orange', 'bg-e1green', 'bg-e1blue'];
        let players = ["Ready", "To", "Spin"];
        let currentRotation = 0;
        let isSpinning = false;

        const pencilWrapper = document.getElementById('pencil-wrapper'); 
        const board = document.getElementById('game-board');
        const container = document.getElementById('players-container');
        const modal = document.getElementById('config-modal');
        const input = document.getElementById('player-input');
        const spinBtn = document.getElementById('spin-btn');
        const winnerModal = document.getElementById('winner-modal');
        const winnerNameDisplay = document.getElementById('winner-name');

        renderPlayers();

        function renderPlayers() {
            container.innerHTML = '';
            const count = players.length;
            const boardSize = board.clientWidth; 
            // Radius calculation: half width * 0.85 to keep text inside circle
            const radius = (boardSize / 2) * 0.85; 
            
            players.forEach((player, index) => {
                const angleDeg = (360 / count) * index;
                const angleRad = (angleDeg - 90) * (Math.PI / 180);

                const x = Math.cos(angleRad) * radius;
                const y = Math.sin(angleRad) * radius;
                const colorClass = palette[index % palette.length];

                const label = document.createElement('div');
                label.className = `absolute flex flex-col items-center justify-center transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300`;
                label.style.left = `calc(50% + ${x}px)`;
                label.style.top = `calc(50% + ${y}px)`;
                
                label.innerHTML = `
                    <div class="${colorClass} text-white border-2 border-e1dark px-3 py-1.5 rounded-xl shadow-neo-sm font-bold text-sm md:text-xl max-w-[120px] md:max-w-[180px] truncate">
                        ${player}
                    </div>
                `;
                container.appendChild(label);
            });
        }

        function spinBottle() {
            if (isSpinning) return;
            isSpinning = true;
            spinBtn.classList.add('opacity-50', 'pointer-events-none');
            closeWinnerModal();

            const extraSpins = 4 + Math.random() * 3; 
            const randomAngle = Math.random() * 360;
            const totalDegrees = (extraSpins * 360) + randomAngle;
            
            currentRotation += totalDegrees;
            
            pencilWrapper.style.transition = "transform 4s cubic-bezier(0.1, 0.7, 0.1, 1)";
            pencilWrapper.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                const normalizedAngle = currentRotation % 360;
                determineWinner(normalizedAngle);
                isSpinning = false;
                spinBtn.classList.remove('opacity-50', 'pointer-events-none');
            }, 4000);
        }

        function determineWinner(angle) {
            const count = players.length;
            const segmentSize = 360 / count;
            
            // Logic: 0deg = Pencil Tip Points UP (North).
            // Rotation is Clockwise.
            // Therefore, angle corresponds directly to index starting at 12 o'clock.
            let winningIndex = Math.round(angle / segmentSize);
            if (winningIndex >= count) winningIndex = 0;
            
            showWinner(players[winningIndex]);
        }

        function showWinner(name) {
            winnerNameDisplay.innerText = name;
            winnerModal.classList.remove('hidden');
            winnerModal.classList.add('flex');
        }

        function closeWinnerModal() {
            winnerModal.classList.add('hidden');
            winnerModal.classList.remove('flex');
        }

        function openModal() {
            input.value = players.join(', ');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeModal() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function savePlayers() {
            const text = input.value;
            if (text.trim()) {
                const rawList = text.split(',').map(s => s.trim()).filter(s => s.length > 0);
                if (rawList.length > 1) players = rawList;
                currentRotation = 0;
                pencilWrapper.style.transition = "none";
                pencilWrapper.style.transform = `rotate(0deg)`;
                renderPlayers();
            }
            closeModal();
        }

        window.addEventListener('resize', renderPlayers);
    </script>
</body>
</html>