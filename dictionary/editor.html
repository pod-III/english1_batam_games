<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Bank Manager | English 1 Batam</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            pink: '#FF6B95',
                            orange: '#FF8C42',
                            green: '#00E676',
                            blue: '#2979FF',
                            dark: '#1e293b',
                            chalk: '#f8fafc',
                            yellow: '#FACC15',
                        }
                    },
                    fontFamily: {
                        heading: ['Fredoka', 'sans-serif'],
                        body: ['Nunito', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.05) 1px, transparent 1px);
            background-size: 24px 24px;
        }

        .neo-border { border: 3px solid #1e293b; }
        .neo-shadow { box-shadow: 4px 4px 0px 0px rgba(30, 41, 59, 1); }
        .neo-shadow-sm { box-shadow: 2px 2px 0px 0px rgba(30, 41, 59, 1); }
        
        .neo-btn { transition: all 0.1s ease; }
        .neo-btn:hover { transform: translate(-1px, -1px); box-shadow: 6px 6px 0px 0px rgba(30, 41, 59, 1); }
        .neo-btn:active { transform: translate(2px, 2px); box-shadow: 0px 0px 0px 0px rgba(30, 41, 59, 1); }

        input, select, textarea {
            border: 2px solid #1e293b !important;
            box-shadow: 2px 2px 0px 0px rgba(30, 41, 59, 1);
            transition: all 0.1s ease;
        }
        input:focus, select:focus { outline: none; box-shadow: 4px 4px 0px 0px rgba(30, 41, 59, 1); transform: translate(-1px, -1px); }

        .custom-scrollbar::-webkit-scrollbar { width: 10px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; border: 2px solid #f8fafc; }
        
        .active-cat { background-color: #2979FF !important; color: white !important; border-color: #1e293b !important; }
    </style>
</head>
<body class="text-brand-dark font-body min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-brand-blue border-b-4 border-brand-dark p-4 sticky top-0 z-40 neo-shadow">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 bg-brand-chalk border-2 border-brand-dark rounded-xl px-4 py-2 neo-shadow-sm">
                <i data-lucide="languages" class="w-6 h-6 text-brand-blue"></i>
                <h1 class="font-heading text-xl font-bold">Word Bank Manager</h1>
            </div>
            <div class="flex gap-3">
                 <button onclick="exportJson()" class="bg-brand-green border-2 border-brand-dark rounded-xl px-4 py-2 font-heading font-bold neo-shadow-sm neo-btn flex items-center gap-2">
                    <i data-lucide="download" class="w-4 h-4"></i> Export words.json
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow p-4 md:p-8">
        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Sidebar: Categories -->
            <div class="lg:col-span-4 space-y-6">
                
                <button onclick="addNewCategory()" class="w-full bg-brand-yellow border-4 border-brand-dark rounded-2xl py-4 font-heading text-xl font-bold neo-shadow neo-btn flex justify-center items-center gap-3">
                    <i data-lucide="folder-plus" class="w-6 h-6"></i> New Category
                </button>

                <div class="bg-brand-pink border-4 border-brand-dark rounded-2xl p-5 neo-shadow text-brand-dark">
                    <input type="file" id="importFile" accept=".json" class="hidden">
                    <button onclick="document.getElementById('importFile').click()" class="w-full bg-brand-chalk border-2 border-brand-dark rounded-xl py-3 font-heading font-bold neo-shadow-sm neo-btn flex justify-center items-center gap-2">
                        <i data-lucide="file-up" class="w-5 h-5"></i> Import JSON
                    </button>
                </div>

                <div class="bg-white border-4 border-brand-dark rounded-2xl neo-shadow flex flex-col h-[500px]">
                    <div class="p-4 border-b-4 border-brand-dark bg-brand-chalk font-heading font-bold flex justify-between items-center">
                        <span>Word Categories</span>
                        <span id="catCount" class="bg-brand-dark text-white px-2 py-1 rounded-lg text-xs">0</span>
                    </div>
                    <div id="categoryList" class="flex-grow overflow-y-auto p-2 space-y-2 custom-scrollbar">
                        <!-- Categories injected here -->
                    </div>
                </div>
            </div>

            <!-- Main Panel: Words in Category -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Category Settings -->
                <div id="categoryHeader" class="hidden bg-white border-4 border-brand-dark rounded-2xl p-6 neo-shadow space-y-4">
                    <div class="flex justify-between items-start">
                        <div class="space-y-4 flex-grow max-w-md">
                            <div class="space-y-1">
                                <label class="text-[10px] font-black uppercase text-slate-400">Category Label</label>
                                <input type="text" id="catLabelInput" oninput="updateCategoryMeta()" class="w-full px-4 py-2 rounded-xl font-bold text-xl">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-black uppercase text-slate-400">Category ID (Unique)</label>
                                <input type="text" id="catIdInput" oninput="updateCategoryMeta()" class="w-full px-4 py-2 rounded-xl font-bold text-sm bg-brand-chalk">
                            </div>
                        </div>
                        <button onclick="deleteCurrentCategory()" class="text-brand-pink p-2 hover:bg-brand-pink/10 rounded-xl transition-colors">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Word List -->
                <div id="wordPanel" class="hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="font-heading text-2xl font-bold">Vocabulary List</h3>
                        <button onclick="addWordToCategory()" class="bg-brand-orange border-2 border-brand-dark rounded-xl px-4 py-2 font-heading font-bold neo-shadow-sm neo-btn flex items-center gap-2">
                            <i data-lucide="plus"></i> Add Word
                        </button>
                    </div>

                    <div id="wordContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Word cards injected here -->
                    </div>
                </div>

                <!-- Empty State -->
                <div id="emptyPanel" class="bg-white border-4 border-brand-dark border-dashed rounded-2xl p-20 text-center flex flex-col items-center justify-center space-y-4">
                    <i data-lucide="book-open" class="w-16 h-16 text-slate-300"></i>
                    <p class="font-heading text-xl text-slate-400">Select a category to manage words</p>
                </div>
            </div>
        </div>
    </main>

    <!-- WORD EDIT MODAL -->
    <div id="wordModal" class="fixed inset-0 bg-brand-dark/80 backdrop-blur-sm z-50 hidden flex justify-center items-center p-4">
        <div class="bg-white w-full max-w-2xl border-4 border-brand-dark rounded-2xl neo-shadow overflow-hidden flex flex-col">
            <div class="bg-brand-green p-4 border-b-4 border-brand-dark flex justify-between items-center">
                <h3 class="font-heading text-xl font-bold">Word Details</h3>
                <button onclick="closeWordModal()" class="bg-white border-2 border-brand-dark rounded-lg p-1 shadow-hard-sm active:translate-y-0.5"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6 space-y-4 overflow-y-auto max-h-[70vh] custom-scrollbar">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="font-bold text-xs uppercase">The Word</label>
                        <input type="text" id="modalWord" class="w-full px-4 py-2 rounded-xl font-bold">
                    </div>
                    <div class="space-y-1">
                        <label class="font-bold text-xs uppercase">Pronunciation (IPA)</label>
                        <input type="text" id="modalPron" class="w-full px-4 py-2 rounded-xl font-bold" placeholder="/wɜːrd/">
                    </div>
                </div>
                <div class="space-y-1">
                    <label class="font-bold text-xs uppercase">Definition</label>
                    <textarea id="modalDef" rows="2" class="w-full px-4 py-2 rounded-xl font-bold resize-none"></textarea>
                </div>
                <div class="space-y-1">
                    <label class="font-bold text-xs uppercase">Example Sentence</label>
                    <textarea id="modalExample" rows="2" class="w-full px-4 py-2 rounded-xl font-bold resize-none"></textarea>
                </div>
                <div class="space-y-1">
                    <label class="font-bold text-xs uppercase">Audio URL (Optional)</label>
                    <input type="text" id="modalAudio" class="w-full px-4 py-2 rounded-xl font-bold" placeholder="https://...">
                </div>
            </div>
            <div class="p-4 bg-brand-chalk border-t-4 border-brand-dark flex justify-end gap-3">
                <button onclick="closeWordModal()" class="font-bold text-slate-500 px-4">Cancel</button>
                <button onclick="saveWordFromModal()" class="bg-brand-green border-2 border-brand-dark rounded-xl px-6 py-2 font-heading font-bold neo-shadow-sm neo-btn">Save Word</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 transform translate-y-32 opacity-0 transition-all duration-300">
        <div class="bg-brand-dark text-white neo-border rounded-2xl px-8 py-4 neo-shadow font-bold flex items-center gap-4">
            <i data-lucide="check-circle" class="text-brand-green"></i>
            <span id="toastMsg">Saved!</span>
        </div>
    </div>

    <script>
        let library = [];
        let activeCatId = null;
        let activeWordIdx = -1;

        // Init
        lucide.createIcons();

        // --- FILE OPS ---
        document.getElementById('importFile').addEventListener('change', function(e) {
            const file = e.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    let raw = event.target.result.trim();
                    if (raw.charCodeAt(0) === 0xFEFF) raw = raw.slice(1);
                    
                    // JSON Healer
                    const startArr = raw.indexOf('[');
                    const startObj = raw.indexOf('{');
                    let start = -1, end = -1, closer = '';
                    if (startArr !== -1 && (startObj === -1 || startArr < startObj)) { start = startArr; closer = ']'; }
                    else if (startObj !== -1) { start = startObj; closer = '}'; }
                    
                    if (start !== -1) {
                        let last = raw.lastIndexOf(closer);
                        while (last > start) {
                            try {
                                const data = JSON.parse(raw.substring(start, last + 1));
                                library = data.library || data;
                                updateCategoryList();
                                showToast("Library Imported!");
                                return;
                            } catch(e) { last = raw.lastIndexOf(closer, last - 1); }
                        }
                    }
                    throw new Error("Damaged JSON");
                } catch (err) { console.error(err); showToast("Invalid JSON File!", true); }
                e.target.value = '';
            };
            reader.readAsText(file);
        });

        function exportJson() {
            if (library.length === 0) return showToast("Nothing to export!", true);
            const output = { library: library };
            const blob = new Blob([JSON.stringify(output, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = "words.json"; a.click();
            URL.revokeObjectURL(url);
            showToast("File Exported!");
        }

        // --- CATEGORY OPS ---
        function updateCategoryList() {
            const list = document.getElementById('categoryList');
            document.getElementById('catCount').innerText = library.length;
            
            list.innerHTML = library.map(cat => `
                <button onclick="selectCategory('${cat.id}')" class="w-full text-left p-3 rounded-xl border-2 border-transparent hover:border-brand-dark hover:bg-slate-50 font-bold transition-all flex justify-between items-center group ${activeCatId === cat.id ? 'active-cat' : ''}">
                    <span class="truncate">${cat.label}</span>
                    <span class="text-[10px] bg-brand-dark/10 group-hover:bg-brand-dark/20 px-1.5 py-0.5 rounded">${cat.words.length}</span>
                </button>
            `).join('');
            
            if (!activeCatId && library.length > 0) selectCategory(library[0].id);
        }

        function selectCategory(id) {
            activeCatId = id;
            const cat = library.find(c => c.id === id);
            
            document.getElementById('emptyPanel').classList.add('hidden');
            document.getElementById('categoryHeader').classList.remove('hidden');
            document.getElementById('wordPanel').classList.remove('hidden');
            
            document.getElementById('catLabelInput').value = cat.label;
            document.getElementById('catIdInput').value = cat.id;
            
            updateWordList();
            updateCategoryList();
        }

        function addNewCategory() {
            const newId = "cat_" + Date.now();
            library.push({
                id: newId,
                label: "New Category",
                words: []
            });
            selectCategory(newId);
        }

        function updateCategoryMeta() {
            const cat = library.find(c => c.id === activeCatId);
            const newId = document.getElementById('catIdInput').value;
            cat.label = document.getElementById('catLabelInput').value;
            
            // If ID changed, update all words inside too if they follow a pattern
            if (newId !== cat.id) {
                cat.id = newId;
                activeCatId = newId;
            }
            updateCategoryList();
        }

        function deleteCurrentCategory() {
            if (!confirm("Delete this entire category and all its words?")) return;
            library = library.filter(c => c.id !== activeCatId);
            activeCatId = null;
            document.getElementById('emptyPanel').classList.remove('hidden');
            document.getElementById('categoryHeader').classList.add('hidden');
            document.getElementById('wordPanel').classList.add('hidden');
            updateCategoryList();
        }

        // --- WORD OPS ---
        function updateWordList() {
            const container = document.getElementById('wordContainer');
            const cat = library.find(c => c.id === activeCatId);
            
            if (cat.words.length === 0) {
                container.innerHTML = `<p class="col-span-full text-center py-10 opacity-30 font-bold">No words in this category yet.</p>`;
                return;
            }

            container.innerHTML = cat.words.map((w, idx) => `
                <div class="bg-white border-2 border-brand-dark rounded-xl p-4 neo-shadow-sm flex justify-between items-start group">
                    <div class="space-y-1 truncate">
                        <div class="flex items-center gap-2">
                            <p class="font-heading font-bold text-lg leading-none">${w.word}</p>
                            <span class="text-[10px] text-slate-400 font-mono italic">${w.pronunciation}</span>
                        </div>
                        <p class="text-xs text-slate-500 font-bold italic truncate">${w.definition}</p>
                    </div>
                    <div class="flex gap-1">
                        <button onclick="editWord(${idx})" class="p-2 border-2 border-brand-dark rounded-lg hover:bg-brand-blue hover:text-white transition-all"><i data-lucide="edit-3" class="w-4 h-4"></i></button>
                        <button onclick="deleteWord(${idx})" class="p-2 border-2 border-brand-dark rounded-lg hover:bg-brand-pink hover:text-white transition-all"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function addWordToCategory() {
            activeWordIdx = -1;
            document.getElementById('modalWord').value = '';
            document.getElementById('modalPron').value = '';
            document.getElementById('modalDef').value = '';
            document.getElementById('modalExample').value = '';
            document.getElementById('modalAudio').value = '';
            document.getElementById('wordModal').classList.remove('hidden');
        }

        function editWord(idx) {
            const cat = library.find(c => c.id === activeCatId);
            const w = cat.words[idx];
            activeWordIdx = idx;
            
            document.getElementById('modalWord').value = w.word;
            document.getElementById('modalPron').value = w.pronunciation;
            document.getElementById('modalDef').value = w.definition;
            document.getElementById('modalExample').value = w.example;
            document.getElementById('modalAudio').value = w.audio;
            
            document.getElementById('wordModal').classList.remove('hidden');
        }

        function saveWordFromModal() {
            const cat = library.find(c => c.id === activeCatId);
            const wordData = {
                id: activeWordIdx === -1 ? activeCatId + "_" + Date.now() : cat.words[activeWordIdx].id,
                word: document.getElementById('modalWord').value,
                category: activeCatId,
                pronunciation: document.getElementById('modalPron').value,
                definition: document.getElementById('modalDef').value,
                example: document.getElementById('modalExample').value,
                audio: document.getElementById('modalAudio').value
            };

            if (activeWordIdx === -1) {
                cat.words.push(wordData);
                showToast("Word Added!");
            } else {
                cat.words[activeWordIdx] = wordData;
                showToast("Word Updated!");
            }

            closeWordModal();
            updateWordList();
        }

        function deleteWord(idx) {
            if (!confirm("Remove this word?")) return;
            const cat = library.find(c => c.id === activeCatId);
            cat.words.splice(idx, 1);
            updateWordList();
            showToast("Word Removed.", true);
        }

        function closeWordModal() { document.getElementById('wordModal').classList.add('hidden'); }

        function showToast(msg, isError = false) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.classList.remove('translate-y-32', 'opacity-0');
            const inner = t.querySelector('div');
            inner.classList.toggle('border-brand-dark', !isError);
            inner.classList.toggle('border-red-500', isError);
            setTimeout(() => t.classList.add('translate-y-32', 'opacity-0'), 3000);
        }

        window.onload = () => {
            // Placeholder data if needed
            if (library.length === 0) {
                library = [{ id: 'actions', label: 'Actions (Verbs)', words: [] }];
            }
            updateCategoryList();
        };
    </script>
</body>
</html>