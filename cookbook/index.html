<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English 1: Cookbook OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        e1pink: '#FF6B95',
                        e1orange: '#FF8C42',
                        e1green: '#00E676',
                        e1blue: '#2979FF',
                        e1dark: '#1e293b',
                        e1chalk: '#f8fafc',
                    },
                    fontFamily: {
                        fredoka: ['Fredoka', 'sans-serif'],
                        nunito: ['Nunito', 'sans-serif'],
                    },
                    boxShadow: {
                        'neo': '6px 6px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-hover': '8px 8px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-sm': '3px 3px 0px 0px rgba(30, 41, 59, 1)',
                    },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                    },
                    keyframes: {
                        pop: {
                            '0%': { opacity: '0', transform: 'scale(0.9) translateY(10px)' },
                            '100%': { opacity: '1', transform: 'scale(1) translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* 1. GRAPH PAPER BACKGROUND */
        body {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.07) 2px, transparent 2px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.07) 2px, transparent 2px);
            background-size: 32px 32px; /* Bigger grid for chunkier look */
        }

        /* 2. CUSTOM SCROLLBAR */
        ::-webkit-scrollbar { width: 14px; }
        ::-webkit-scrollbar-track { background: #cbd5e1; border-left: 3px solid #1e293b; }
        ::-webkit-scrollbar-thumb { background: #FF6B95; border: 3px solid #1e293b; border-radius: 99px; }
        ::-webkit-scrollbar-thumb:hover { background: #ff477e; }

        /* 3. INTERACTIVE CLASSES */
        .card-neo {
            transition: all 0.2s ease-in-out;
        }
        .card-neo:hover {
            transform: translate(-2px, -2px);
            box-shadow: 8px 8px 0px 0px rgba(30, 41, 59, 1);
        }
        
        /* Physical Button Press Effect */
        .btn-neo {
            transition: all 0.1s;
        }
        .btn-neo:active {
            transform: translate(3px, 3px);
            box-shadow: 0px 0px 0px 0px rgba(30, 41, 59, 1);
        }

        /* Checkbox Logic for Ingredients */
        .ingredient-check:checked + label {
            text-decoration: line-through;
            color: #94a3b8;
        }
        
        /* Sticker Rotation Randomizer (applied via JS roughly, or CSS nth-child) */
        .sticker:nth-child(odd) { transform: rotate(-2deg); }
        .sticker:nth-child(even) { transform: rotate(2deg); }
    </style>
</head>
<body class="p-4 md:p-8 lg:p-12 font-nunito text-e1dark min-h-screen flex flex-col items-center">

    <nav class="w-full max-w-6xl mb-10 flex justify-between items-center bg-white border-4 border-e1dark shadow-neo rounded-2xl p-4 sticky top-4 z-50">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="renderHome()">
            <div class="bg-e1pink w-12 h-12 border-3 border-e1dark rounded-xl flex items-center justify-center text-white shadow-neo-sm group-hover:rotate-6 transition-transform">
                <i data-lucide="chef-hat" class="w-7 h-7"></i>
            </div>
            <div>
                <h1 class="font-fredoka text-2xl md:text-3xl font-bold tracking-wide leading-none">COOKBOOK OS</h1>
                <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">English 1 Batam</span>
            </div>
        </div>
        <button onclick="renderHome()" class="hidden md:flex items-center gap-2 bg-e1chalk hover:bg-white border-2 border-e1dark px-4 py-2 rounded-xl font-bold font-fredoka shadow-neo-sm btn-neo">
            <i data-lucide="home" class="w-4 h-4"></i> HOME
        </button>
    </nav>

    <div id="app-container" class="w-full max-w-6xl pb-20">
        <div class="flex flex-col items-center justify-center pt-20">
            <i data-lucide="loader" class="animate-spin w-12 h-12 text-e1blue mb-4"></i>
            <h2 class="text-2xl font-fredoka font-bold animate-pulse">Loading Kitchen...</h2>
        </div>
    </div>

    <script>
        // --- BACKUP DATA ---
        const BACKUP_RECIPES = [
            {
                "id": "apple-crumble",
                "title": "Mini Apple Crumble",
                "subtitle": "Dessert Mission",
                "desc": "A crunchy, sweet delight using fresh Fujis and cold butter.",
                "level": "Beginner",
                "color": "e1pink",
                "meta": [{ "label": "Prep", "value": "15m", "icon": "clock" }, { "label": "Bake", "value": "25m", "icon": "flame" }],
                "loadout": [
                    { "groupName": "The Base", "groupColor": "text-e1pink", "items": ["1 Apple (Fuji)", "1 tsp Sugar", "Cinnamon"] },
                    { "groupName": "The Crumble", "groupColor": "text-e1orange", "items": ["2 Tbsp Flour", "1.5 Tbsp Cold Butter", "1 Tbsp Oats"] }
                ],
                "vocab": [{ "word": "Dice", "def": "Cut into cubes", "color": "text-e1pink" }, { "word": "Rub-in", "def": "Mix butter into flour", "color": "text-e1orange" }],
                "steps": [
                    { "number": 1, "title": "Dice the Apple", "color": "e1blue", "desc": "Wash and cut the apple into small cubes.", "note": "Put cubes in the cup." },
                    { "number": 2, "title": "The Dry Mix", "color": "e1green", "desc": "Mix Flour, Sugar, and Oats in a bowl.", "note": "No butter yet!" },
                    { "number": 3, "title": "Rub-In", "color": "e1orange", "desc": "Rub cold butter into flour until it looks like sand.", "note": "Keep butter cold!", "icon": "lightbulb" },
                    { "number": 4, "title": "Bake", "color": "e1pink", "desc": "Cover apples with sand mix. Bake at 180Â°C.", "note": "Wait 25 mins." }
                ]
            }
        ];

        let recipes = [];

        // --- FETCH LOGIC ---
        async function initApp() {
            const possiblePaths = ['./recipes.json', 'recipes.json', '/cookbook/recipes.json'];
            let loaded = false;

            for (const path of possiblePaths) {
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        recipes = await response.json();
                        loaded = true;
                        break;
                    }
                } catch (e) { console.log(`Path failed: ${path}`); }
            }

            if (!loaded) {
                recipes = BACKUP_RECIPES;
                showToast();
            }
            renderHome();
        }

        function showToast() {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-6 right-6 bg-e1dark border-2 border-white text-white px-6 py-4 rounded-2xl shadow-neo font-fredoka flex items-center gap-3 z-50 animate-pop';
            toast.innerHTML = '<i data-lucide="wifi-off" class="text-e1pink"></i> <span>Offline Mode Active</span>';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
            lucide.createIcons();
        }

        // --- RENDERER: HOME ---
        function renderHome() {
            const container = document.getElementById('app-container');
            
            if(recipes.length === 0) {
                container.innerHTML = '<div class="text-center p-10 font-fredoka text-xl">No recipes found in database.</div>';
                return;
            }

            const cardsHTML = recipes.map((r, index) => {
                // Color mapping
                const colors = { e1pink: 'bg-e1pink', e1orange: 'bg-e1orange', e1green: 'bg-e1green', e1blue: 'bg-e1blue' };
                const btnClass = `${colors[r.color] || 'bg-e1dark'} hover:brightness-110`;
                const delay = index * 100; // Stagger animation

                return `
                <div class="bg-white border-4 border-e1dark rounded-3xl shadow-neo p-6 flex flex-col justify-between card-neo animate-pop h-full" style="animation-delay: ${delay}ms">
                    <div>
                        <div class="flex justify-between items-start mb-5">
                            <span class="bg-e1chalk border-2 border-e1dark px-3 py-1 rounded-lg font-bold text-xs uppercase tracking-wider text-slate-500 shadow-sm transform -rotate-2">${r.subtitle}</span>
                            <span class="text-xs font-black bg-e1dark text-white px-3 py-1 rounded-lg shadow-sm transform rotate-2">${r.level}</span>
                        </div>
                        
                        <h2 class="font-fredoka text-3xl md:text-4xl font-bold text-e1dark mb-3 leading-tight">${r.title}</h2>
                        <p class="font-nunito text-slate-600 mb-6 text-lg leading-relaxed font-semibold">${r.desc}</p>
                    </div>
                    
                    <div class="mt-auto pt-6 border-t-2 border-dashed border-slate-200 flex items-center justify-between">
                        <div class="flex items-center gap-2 text-sm font-bold text-slate-500 bg-slate-100 px-3 py-1 rounded-full border border-slate-300">
                            <i data-lucide="clock" class="w-4 h-4"></i> ${(r.meta && r.meta[0]) ? r.meta[0].value : '??'}
                        </div>
                        <button onclick="renderRecipe('${r.id}')" class="${btnClass} text-white font-fredoka font-bold px-6 py-3 rounded-xl border-b-4 border-r-4 border-e1dark active:border-0 btn-neo flex items-center gap-2 text-lg">
                            COOK <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                `;
            }).join('');

            container.innerHTML = `
                <div class="animate-pop">
                    <div class="text-center mb-12">
                        <span class="inline-block bg-e1green text-e1dark border-2 border-e1dark font-bold px-4 py-1 rounded-full mb-4 shadow-neo-sm transform -rotate-1">Select Your Mission</span>
                        <h2 class="font-fredoka text-5xl md:text-6xl font-bold text-e1dark mb-2">Class Menu</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-10">
                        ${cardsHTML}
                    </div>
                </div>
            `;
            
            window.scrollTo(0,0);
            lucide.createIcons();
        }

        // --- RENDERER: RECIPE DETAIL ---
        function renderRecipe(id) {
            const r = recipes.find(recipe => recipe.id === id);
            if (!r) return;

            const container = document.getElementById('app-container');

            // Header Meta Badges (Sticker style)
            let metaHTML = (r.meta || []).map((m, i) => `
                <div class="bg-e1chalk border-3 border-e1dark rounded-xl p-3 text-center shadow-neo-sm transform ${i % 2 === 0 ? 'rotate-2' : '-rotate-2'} transition-transform hover:rotate-0">
                    <i data-lucide="${m.icon}" class="mx-auto w-6 h-6 text-${r.color} mb-1"></i>
                    <span class="block font-bold text-xs uppercase text-slate-400 tracking-wider">${m.label}</span>
                    <span class="font-fredoka text-xl font-bold text-e1dark">${m.value}</span>
                </div>
            `).join('');

            // Ingredients (Interactive Checkboxes)
            let ingredientsHTML = (r.loadout || []).map(group => `
                <div class="mb-6 last:mb-0">
                    <h3 class="font-fredoka text-lg ${group.groupColor} uppercase tracking-wider mb-3 border-b-4 border-slate-200 inline-block pr-4">${group.groupName}</h3>
                    <ul class="space-y-3 font-bold text-slate-700">
                        ${group.items.map((item, idx) => `
                            <li class="flex items-start gap-3 group cursor-pointer select-none">
                                <input type="checkbox" id="${group.groupName}-${idx}" class="ingredient-check w-5 h-5 border-2 border-e1dark rounded-md text-e1green focus:ring-0 mt-0.5 cursor-pointer accent-e1green">
                                <label for="${group.groupName}-${idx}" class="cursor-pointer transition-colors">${item}</label>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');

            // Steps
            let stepsHTML = (r.steps || []).map((step, idx) => {
                let theme = { bg: 'bg-slate-50', border: 'border-slate-300', text: 'text-slate-600' };
                if(step.color === 'e1blue') theme = { bg: 'bg-blue-50', border: 'border-blue-300', text: 'text-blue-800' };
                if(step.color === 'e1orange') theme = { bg: 'bg-orange-50', border: 'border-orange-300', text: 'text-orange-800' };
                if(step.color === 'e1green') theme = { bg: 'bg-green-50', border: 'border-green-300', text: 'text-green-800' };
                if(step.color === 'e1pink') theme = { bg: 'bg-pink-50', border: 'border-pink-300', text: 'text-pink-800' };

                return `
                <div class="bg-white border-4 border-e1dark rounded-3xl shadow-neo p-6 md:p-8 flex gap-6 card-neo mb-6 animate-pop" style="animation-delay: ${idx * 150}ms">
                    <div class="hidden md:flex bg-e1chalk border-3 border-e1dark w-20 h-20 rounded-2xl items-center justify-center flex-shrink-0 shadow-neo-sm">
                        <span class="font-fredoka text-4xl font-bold text-e1dark">${step.number}</span>
                    </div>
                    <div class="w-full">
                        <div class="flex items-center gap-3 mb-2">
                             <span class="md:hidden font-fredoka text-xl font-bold bg-e1dark text-white w-8 h-8 rounded-lg flex items-center justify-center">${step.number}</span>
                             <h3 class="font-fredoka text-2xl md:text-3xl font-bold text-${step.color}">${step.title}</h3>
                        </div>
                        <p class="text-slate-700 text-lg md:text-xl font-semibold mb-4 leading-relaxed">${step.desc}</p>
                        <div class="${theme.bg} border-l-4 ${theme.border} p-4 rounded-r-xl text-base ${theme.text} flex items-start gap-3">
                            ${step.icon ? `<i data-lucide="${step.icon}" class="w-5 h-5 mt-0.5 flex-shrink-0"></i>` : ''}
                            <span class="font-bold">${step.note}</span>
                        </div>
                    </div>
                </div>`;
            }).join('');

            container.innerHTML = `
                <div class="animate-pop">
                    <button onclick="renderHome()" class="mb-8 flex items-center gap-2 font-bold text-slate-500 hover:text-e1dark transition-colors group">
                        <div class="bg-white border-2 border-slate-300 p-2 rounded-lg group-hover:border-e1dark group-hover:shadow-sm transition-all">
                            <i data-lucide="arrow-left" class="w-5 h-5"></i>
                        </div>
                        <span class="font-fredoka text-lg">Back to Menu</span>
                    </button>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12">
                        <div class="lg:col-span-12 bg-white border-4 border-e1dark shadow-neo rounded-3xl p-6 md:p-8 flex flex-col md:flex-row justify-between items-center gap-6 relative overflow-hidden">
                             <div class="absolute top-0 left-0 w-full h-4 bg-${r.color}"></div>

                            <div class="w-full relative z-10 pt-4">
                                <span class="bg-${r.color} text-white font-fredoka font-bold px-3 py-1 border-2 border-e1dark rounded-lg text-sm mb-3 inline-block uppercase shadow-sm transform -rotate-1">Recipe ID: ${r.id}</span>
                                <h1 class="font-fredoka text-4xl md:text-6xl font-bold text-e1dark mb-2">${r.title}</h1>
                                <p class="font-nunito text-xl text-slate-600 font-bold">${r.subtitle}</p>
                            </div>
                            <div class="flex gap-4 flex-wrap justify-center md:justify-end relative z-10">
                                ${metaHTML}
                            </div>
                        </div>

                        <div class="lg:col-span-4 space-y-8 h-fit lg:sticky lg:top-24">
                            <div class="bg-white border-4 border-e1dark rounded-3xl shadow-neo overflow-hidden transform rotate-1">
                                <div class="bg-e1dark p-5 flex justify-between items-center">
                                    <h2 class="font-fredoka text-2xl font-bold text-white flex items-center gap-2">
                                        <i data-lucide="shopping-bag"></i> Loadout
                                    </h2>
                                    <div class="h-3 w-3 rounded-full bg-red-400 border border-white"></div>
                                </div>
                                <div class="p-6 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmZmZmIi8+CjxyZWN0IHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiNmMmYyZjIiLz4KPC9zdmc+')]">
                                    ${ingredientsHTML}
                                </div>
                            </div>

                            <div class="bg-e1chalk border-4 border-slate-300 rounded-3xl shadow-neo p-6 text-e1dark transform -rotate-1 hover:rotate-0 transition-transform">
                                <h3 class="font-fredoka text-xl text-e1blue mb-4 flex items-center gap-2 border-b-2 border-slate-200 pb-2">
                                    <i data-lucide="book-open"></i> Vocab Check
                                </h3>
                                <ul class="space-y-4">
                                    ${(r.vocab || []).map(v => `
                                        <li class="bg-white border-2 border-slate-200 p-3 rounded-xl">
                                            <span class="${v.color} font-fredoka font-bold text-lg block">${v.word}</span> 
                                            <span class="text-sm font-bold text-slate-500">${v.def}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>

                        <div class="lg:col-span-8">
                            ${stepsHTML}
                            
                            <div class="mt-12 text-center p-8 border-4 border-dashed border-slate-300 rounded-3xl bg-slate-50/50">
                                <h3 class="font-fredoka text-2xl text-slate-400 font-bold mb-2">Mission Complete?</h3>
                                <p class="text-slate-500 font-bold">Show your result to the teacher!</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            window.scrollTo(0,0);
            lucide.createIcons();
        }

        initApp();
    </script>
</body>
</html>