<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English 1 Batam - Cookbook OS</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* ============================================
           1. CORE DESIGN TOKENS (Hub Style)
           ============================================ */
        :root {
            --color-pink: #FF6B95;
            --color-orange: #FF8C42;
            --color-green: #00E676;
            --color-blue: #2979FF;
            --color-dark: #1e293b;
            --color-chalk: #f8fafc;

            --bg-primary: #F8FAFC;
            --bg-card: #FFFFFF;
            --text-primary: #1e293b;
            --border-primary: #1e293b;
            
            --border-width: 3px;
            --shadow-hard: 4px 4px 0 var(--border-primary);
            --shadow-hover: 6px 6px 0 var(--border-primary);
            --shadow-active: 0px 0px 0 var(--border-primary);
            
            --grid-color: #E2E8F0;
            --grid-size: 24px;
        }

        /* ============================================
           2. GLOBAL RESETS
           ============================================ */
        body {
            background-color: var(--bg-primary);
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: var(--grid-size) var(--grid-size);
            color: var(--text-primary);
            font-family: 'Nunito', sans-serif;
        }

        h1, h2, h3, .font-heading {
            font-family: 'Fredoka', sans-serif;
        }

        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); border-left: 2px solid var(--border-primary); }
        ::-webkit-scrollbar-thumb { background: var(--color-pink); border: 2px solid var(--border-primary); border-radius: 99px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-orange); }

        /* ============================================
           3. COMPONENTS
           ============================================ */
        
        .btn-chunky {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Fredoka', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background-color: var(--bg-card);
            color: var(--text-primary);
            border: var(--border-width) solid var(--border-primary);
            box-shadow: var(--shadow-hard);
            border-radius: 0.75rem;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            user-select: none;
        }
        .btn-chunky:hover { transform: translate(-2px, -2px); box-shadow: var(--shadow-hover); }
        .btn-chunky:active { transform: translate(2px, 2px); box-shadow: var(--shadow-active); }

        .card-neo {
            background: var(--bg-card);
            border: var(--border-width) solid var(--border-primary);
            border-radius: 1rem;
            box-shadow: var(--shadow-hard);
            transition: all 0.2s ease;
        }
        .card-neo.interactive:hover { transform: translate(-2px, -2px); box-shadow: var(--shadow-hover); z-index: 10; }

        .input-chunky {
            width: 100%; padding: 0.75rem 1rem;
            border: var(--border-width) solid var(--border-primary);
            border-radius: 0.75rem;
            font-family: 'Nunito', sans-serif; font-weight: 700; outline: none;
            box-shadow: var(--shadow-hard); transition: all 0.2s;
        }
        .input-chunky:focus { box-shadow: var(--shadow-hover); border-color: var(--color-blue); transform: translate(-2px, -2px); }

        .checkbox-neo {
            appearance: none; width: 1.25rem; height: 1.25rem;
            border: 2px solid var(--border-primary); border-radius: 0.25rem; background: white; cursor: pointer; position: relative;
        }
        .checkbox-neo:checked { background: var(--color-green); }
        .checkbox-neo:checked::after {
            content: '✓'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--border-primary); font-weight: bold; font-size: 0.8rem;
        }

        .fade-in-up { animation: fadeInUp 0.3s ease-out forwards; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4 md:p-6 pb-20">

    <nav class="w-full max-w-6xl mb-8 flex justify-between items-center bg-white border-[3px] border-e1dark rounded-2xl p-3 md:p-4 shadow-[4px_4px_0_#1e293b] sticky top-4 z-50">
        <div class="flex items-center gap-3 cursor-pointer select-none" onclick="renderHome()">
            <div class="w-12 h-12 bg-[#FF6B95] border-[3px] border-e1dark rounded-xl flex items-center justify-center text-white shadow-sm">
                <i data-lucide="chef-hat" class="w-7 h-7"></i>
            </div>
            <div>
                <h1 class="text-2xl md:text-3xl font-heading font-bold leading-none text-[#1e293b]">COOKBOOK <span class="text-[#2979FF]">OS</span></h1>
                <span class="text-xs font-bold text-slate-400 uppercase tracking-widest pl-0.5">English 1 Hub</span>
            </div>
        </div>
        <button onclick="renderHome()" class="btn-chunky px-4 py-2 text-sm bg-slate-100">
            <i data-lucide="layout-grid" class="w-4 h-4 text-[#FF8C42]"></i> MENU
        </button>
    </nav>

    <main id="app-container" class="w-full max-w-6xl">
        <div class="flex flex-col items-center justify-center pt-24 opacity-50">
            <i data-lucide="loader-2" class="animate-spin w-10 h-10 text-[#2979FF] mb-3"></i>
            <h2 class="text-xl font-heading font-bold text-slate-400">Loading Ingredients...</h2>
        </div>
    </main>

    <script>
        // --- DATA: EXTENDED KID-FRIENDLY RECIPES ---
        const BACKUP_RECIPES = [
          { "id": "apple-crumble", "title": "Mini Apple Crumble", "subtitle": "Dessert Mission", "desc": "Learn texture! Soft, warm fruit meets crunchy, buttery topping.", "level": "Beginner", "color": "e1pink", "meta": [ { "label": "Prep", "value": "20m", "icon": "clock" }, { "label": "Bake", "value": "180°C", "icon": "flame" }, { "label": "Yield", "value": "1 Cup", "icon": "utensils" } ], "loadout": [ { "groupName": "The Core (Fruit)", "groupColor": "text-[#FF6B95]", "items": ["1 Fuji Apple (Firm)", "1 tsp Brown Sugar", "1/4 tsp Cinnamon"] }, { "groupName": "The Armor (Crumble)", "groupColor": "text-[#FF8C42]", "items": ["2 Tbsp Flour", "1.5 Tbsp Cold Butter", "1 Tbsp Sugar", "1 Tbsp Oats"] } ], "vocab": [ { "word": "Dice (v)", "def": "Cut into small cubes.", "color": "text-[#FF6B95]" }, { "word": "Rub-in (v)", "def": "Squish butter into flour.", "color": "text-[#FF8C42]" } ], "steps": [ { "number": 1, "title": "Safety Cutting", "color": "blue", "desc": "Wash the apple. Place it flat. Cut into 4 big pieces. Slice into strips, then turn to cut small cubes.", "note": "Use 'Claw Hand' to hide fingers!" }, { "number": 2, "title": "Flavor Coating", "color": "green", "desc": "Put apple cubes in foil cup. Sprinkle Brown Sugar and Cinnamon. Mix gently with a spoon.", "note": "Coat every cube." }, { "number": 3, "title": "Magic Sand", "color": "orange", "desc": "Mix Flour and Sugar. Drop in Cold Butter. Squish butter into flour with thumbs until it looks like wet sand.", "note": "Don't use hot palms!" }, { "number": 4, "title": "Crunch Factor", "color": "blue", "desc": "Pour Oats into your 'sand'. Stir gently. Keep oats whole for crunch.", "note": "Texture booster." }, { "number": 5, "title": "The Blanket", "color": "pink", "desc": "Pour crumble loosely over apples. Do not pack it down! Air gaps let juice bubble up.", "note": "Bake 25m." } ] },
          { "id": "power-sandwich", "title": "Power Sandwich", "subtitle": "Lunch Mission", "desc": "Build the ultimate stack. Learn layering and egg frying.", "level": "Intermediate", "color": "e1orange", "meta": [ { "label": "Prep", "value": "10m", "icon": "clock" }, { "label": "Heat", "value": "Med", "icon": "flame" }, { "label": "Yield", "value": "1 Unit", "icon": "utensils" } ], "loadout": [ { "groupName": "Hardware", "groupColor": "text-[#2979FF]", "items": ["2 Slices Bread", "1 Slice Cheese", "1 Egg"] }, { "groupName": "Software", "groupColor": "text-[#00E676]", "items": ["Lettuce Leaf", "2 Tomato Slices", "Mayo"] } ], "vocab": [ { "word": "Sizzle (v)", "def": "Hissing sound of cooking.", "color": "text-[#FF8C42]" }, { "word": "Assemble (v)", "def": "Build in order.", "color": "text-[#00E676]" } ], "steps": [ { "number": 1, "title": "Heat Check", "color": "orange", "desc": "Put pan on Medium Heat. Add tiny butter. When it stops foaming and goes quiet, it's ready.", "note": "Handle turned INWARD." }, { "number": 2, "title": "The Crack", "color": "blue", "desc": "Tap egg on counter to crack. Pull shell apart over pan. Let it slide in gently.", "note": "Don't break the yolk!" }, { "number": 3, "title": "Golden Toast", "color": "pink", "desc": "While egg cooks, toast bread. Spread Mayo on one side of each slice to protect from sogginess.", "note": "Mayo is a shield." }, { "number": 4, "title": "The Tower", "color": "green", "desc": "Order: Bread (Bottom) -> Lettuce -> Tomato -> Hot Egg -> Cheese -> Bread (Top).", "note": "Hot egg melts cheese!", "icon": "layers" }, { "number": 5, "title": "Triangle Cut", "color": "orange", "desc": "Press sandwich down with flat hand. Saw across with serrated knife from corner to corner.", "note": "Saw, don't push." } ] },
          { "id": "tropical-fizz", "title": "Tropical Fizz", "subtitle": "Chemistry Mission", "desc": "A density lesson. Create a refreshing, gradient-colored drink.", "level": "Easy", "color": "e1blue", "meta": [ { "label": "Time", "value": "5m", "icon": "clock" }, { "label": "Fizz", "value": "100%", "icon": "zap" }, { "label": "Yield", "value": "300ml", "icon": "utensils" } ], "loadout": [ { "groupName": "Liquids", "groupColor": "text-[#2979FF]", "items": ["Soda Water", "Orange Syrup"] }, { "groupName": "Solids", "groupColor": "text-[#00E676]", "items": ["Ice Cubes", "Mint", "Lemon"] } ], "vocab": [ { "word": "Density (n)", "def": "Why syrup sinks.", "color": "text-[#FF6B95]" }, { "word": "Garnish (v)", "def": "Decorate food.", "color": "text-[#00E676]" } ], "steps": [ { "number": 1, "title": "Ice Mountain", "color": "blue", "desc": "Fill glass to the very top with ice. Lots of ice keeps layers from mixing.", "note": "Use tongs/spoon." }, { "number": 2, "title": "Heavy Layer", "color": "pink", "desc": "Pour Orange Syrup over ice. Watch it sink. Sugar is heavier than water!", "note": "See the orange bottom?" }, { "number": 3, "title": "Bubble Protection", "color": "green", "desc": "Tilt glass sideways. Pour Soda Water slowly down the side. Don't kill the bubbles!", "note": "Go slow." }, { "number": 4, "title": "Gentle Wake Up", "color": "orange", "desc": "Insert straw. Stir ONE time gently. We want a sunrise gradient effect.", "note": "Don't mix it brown." }, { "number": 5, "title": "Slap the Mint", "color": "blue", "desc": "Put mint in hand. CLAP once to wake up the smell. Place on top.", "note": "Smell = Taste!", "icon": "lightbulb" } ] },
          { "id": "pancakes", "title": "Anti-Gravity Pancakes", "subtitle": "Breakfast Mission", "desc": "Master batter viscosity and the brave flip.", "level": "Intermediate", "color": "e1green", "meta": [ { "label": "Prep", "value": "15m", "icon": "clock" }, { "label": "Yield", "value": "4 pcs", "icon": "layers" } ], "loadout": [ { "groupName": "Dry", "groupColor": "text-[#FF8C42]", "items": ["1 Cup Flour", "Baking Powder", "Sugar"] }, { "groupName": "Wet", "groupColor": "text-[#2979FF]", "items": ["1 Cup Milk", "1 Egg", "Butter"] } ], "vocab": [ { "word": "Whisk (v)", "def": "Beat fast for air.", "color": "text-[#2979FF]" }, { "word": "Reaction (n)", "def": "Chemical bubbles.", "color": "text-[#00E676]" } ], "steps": [ { "number": 1, "title": "Dry Team", "color": "orange", "desc": "Whisk Flour, Powder, Sugar in big bowl. Remove all lumps.", "note": "Powder makes puff." }, { "number": 2, "title": "Wet Team", "color": "blue", "desc": "Mix Milk, Egg, Melted Butter in jug. Pour into flour bowl.", "note": "Butter not too hot!" }, { "number": 3, "title": "Lumpy is Good", "color": "green", "desc": "Stir gently. Stop when white flour disappears. It SHOULD be lumpy.", "note": "Over-mixing = tough." }, { "number": 4, "title": "Bubble Watch", "color": "pink", "desc": "Pour batter on hot pan. Wait. Look for bubbles popping and staying open like craters.", "note": "Open holes = Ready.", "icon": "eye" }, { "number": 5, "title": "Brave Flip", "color": "orange", "desc": "Slide spatula under. Flip fast! Cook 1 min on other side.", "note": "Aim for Gold." } ] },
          { "id": "spaghetti", "title": "Code Red Pasta", "subtitle": "Dinner Mission", "desc": "Handle boiling water safely. Learn 'Al Dente'.", "level": "Advanced", "color": "e1pink", "meta": [ { "label": "Boil", "value": "10m", "icon": "flame" }, { "label": "Yield", "value": "1 Bowl", "icon": "utensils" } ], "loadout": [ { "groupName": "Carbs", "groupColor": "text-[#FF8C42]", "items": ["100g Spaghetti", "Water", "Salt"] }, { "groupName": "Sauce", "groupColor": "text-[#FF6B95]", "items": ["Tomato Sauce", "Oregano", "Cheese"] } ], "vocab": [ { "word": "Al Dente", "def": "Firm bite.", "color": "text-[#FF8C42]" }, { "word": "Simmer", "def": "Gentle bubbles.", "color": "text-[#FF6B95]" } ], "steps": [ { "number": 1, "title": "Volcano Water", "color": "pink", "desc": "Boil water on High. Wait for big angry bubbles. Add pinch of Salt.", "note": "Salty like sea." }, { "number": 2, "title": "The Dive", "color": "orange", "desc": "Add spaghetti. Push it underwater with spoon as it softens. Stir now!", "note": "Don't break pasta." }, { "number": 3, "title": "Bite Test", "color": "blue", "desc": "Boil 9 mins. Fish one noodle out. Cool it. Bite it. Look for tiny white dot inside.", "note": "That is Al Dente." }, { "number": 4, "title": "Red Fusion", "color": "green", "desc": "Drain water. Pour in red sauce. Stir on low heat for 1 minute.", "note": "Watch for stains!" }, { "number": 5, "title": "Snowfall", "color": "pink", "desc": "Plate it. Make it snow with Parmesan Cheese. Add green basil leaf.", "note": "Chef's Kiss." } ] },
          { "id": "omelette", "title": "Golden Fold", "subtitle": "Egg Mission", "desc": "Fluffy, cheesy omelette. Learn pan control.", "level": "Intermediate", "color": "e1orange", "meta": [ { "label": "Prep", "value": "5m", "icon": "clock" }, { "label": "Yield", "value": "1 Unit", "icon": "utensils" } ], "loadout": [ { "groupName": "Base", "groupColor": "text-[#FF8C42]", "items": ["2 Eggs", "Milk", "Salt"] }, { "groupName": "Fill", "groupColor": "text-[#00E676]", "items": ["Cheese", "Ham", "Onion"] } ], "vocab": [ { "word": "Whisk (v)", "def": "Mix fast for air.", "color": "text-[#2979FF]" }, { "word": "Tilt (v)", "def": "Lean pan sideways.", "color": "text-[#FF8C42]" } ], "steps": [ { "number": 1, "title": "Muscle Power", "color": "orange", "desc": "Crack eggs. Add Milk/Salt. Whisk super fast until foamy yellow.", "note": "Bubbles = Fluffy." }, { "number": 2, "title": "Listen", "color": "pink", "desc": "Heat pan. Add butter. If it HISSES loud, it's too hot. Want a gentle whisper.", "note": "No burnt eggs." }, { "number": 3, "title": "Steering Wheel", "color": "blue", "desc": "Pour eggs. Pretend pan is steering wheel. Tilt left/right to fill gaps.", "note": "Keep moving." }, { "number": 4, "title": "Cheese Trap", "color": "green", "desc": "When top is wet but not runny, put Cheese on ONE HALF only.", "note": "Don't overfill." }, { "number": 5, "title": "Close Book", "color": "orange", "desc": "Slide spatula under empty half. Fold over cheese like a book.", "note": "Heat melts cheese.", "icon": "check-circle" } ] },
          { "id": "fruit-salad", "title": "Logic Salad", "subtitle": "Knife Skills", "desc": "Safe cutting techniques. No cooking required.", "level": "Beginner", "color": "e1green", "meta": [ { "label": "Prep", "value": "20m", "icon": "clock" }, { "label": "Cook", "value": "0m", "icon": "slash" } ], "loadout": [ { "groupName": "Spectrum", "groupColor": "text-[#FF6B95]", "items": ["Strawberry", "Kiwi", "Mango"] }, { "groupName": "Dressing", "groupColor": "text-[#FF8C42]", "items": ["Honey", "Lime", "Mint"] } ], "vocab": [ { "word": "Hull", "def": "Cut green top off.", "color": "text-[#FF6B95]" }, { "word": "Toss", "def": "Mix gently.", "color": "text-[#00E676]" } ], "steps": [ { "number": 1, "title": "Claw Hand", "color": "pink", "desc": "Curl fingers under (Claw). Hold strawberry. Cut into 4 pieces.", "note": "Protect fingers!" }, { "number": 2, "title": "Uniformity", "color": "green", "desc": "Peel Kiwi/Mango. Cut into pieces SAME SIZE as strawberries.", "note": "Looks pro." }, { "number": 3, "title": "Sweet & Sour", "color": "orange", "desc": "Mix Honey (Sweet) and Lime (Sour). Stir until thin syrup.", "note": "Taste test." }, { "number": 4, "title": "Drizzle", "color": "blue", "desc": "Fruit in bowl. Pour dressing all over.", "note": "Wait to eat." }, { "number": 5, "title": "The Toss", "color": "green", "desc": "Use two spoons. Lift fruit and drop gently to coat.", "note": "Don't mush banana." } ] },
          { "id": "cookies", "title": "Binary Cookies", "subtitle": "Baking Mission", "desc": "Turn dough into crispy-chewy discs.", "level": "Advanced", "color": "e1blue", "meta": [ { "label": "Bake", "value": "12m", "icon": "flame" }, { "label": "Yield", "value": "12 pcs", "icon": "layers" } ], "loadout": [ { "groupName": "Wet", "groupColor": "text-[#FF8C42]", "items": ["Butter", "Sugar", "Egg"] }, { "groupName": "Dry", "groupColor": "text-[#2979FF]", "items": ["Flour", "Soda", "Chips"] } ], "vocab": [ { "word": "Cream", "def": "Mash butter/sugar.", "color": "text-[#FF8C42]" }, { "word": "Cooling", "def": "Hardening time.", "color": "text-[#FF6B95]" } ], "steps": [ { "number": 1, "title": "Creaming", "color": "orange", "desc": "Smash soft butter/sugar against bowl side until yellow paste.", "note": "Use muscles!" }, { "number": 2, "title": "The Glue", "color": "blue", "desc": "Add Egg/Vanilla. Mix until gloopy.", "note": "Binds it all." }, { "number": 3, "title": "Disappearing Act", "color": "green", "desc": "Add Flour/Soda. Mix slowly. Stop when white powder disappears.", "note": "Add Chips now." }, { "number": 4, "title": "Social Distance", "color": "pink", "desc": "Scoop balls onto tray. Leave big gaps! They grow flat.", "note": "Don't let touch." }, { "number": 5, "title": "Patience", "color": "blue", "desc": "Bake 180°C 12 mins. They come out SOFT. Cool on tray to get HARD.", "note": "Don't touch hot.", "icon": "snowflake" } ] },
          { "id": "smoothie", "title": "Brain Freeze", "subtitle": "Blender Mission", "desc": "High-speed physics. Solids to liquids.", "level": "Easy", "color": "e1pink", "meta": [ { "label": "Blend", "value": "30s", "icon": "zap" }, { "label": "Yield", "value": "1 Glass", "icon": "utensils" } ], "loadout": [ { "groupName": "Base", "groupColor": "text-[#FF6B95]", "items": ["Frozen Banana", "Berries", "Milk"] }, { "groupName": "Boost", "groupColor": "text-[#00E676]", "items": ["Yogurt", "Honey"] } ], "vocab": [ { "word": "Pulse", "def": "Short bursts.", "color": "text-[#2979FF]" }, { "word": "Vortex", "def": "Tornado shape.", "color": "text-[#FF8C42]" } ], "steps": [ { "number": 1, "title": "Loading Dock", "color": "blue", "desc": "Liquid FIRST (Milk). Soft SECOND (Yogurt). Hard LAST (Banana).", "note": "Helps blades spin." }, { "number": 2, "title": "Monster Trap", "color": "orange", "desc": "Lid on tight. Hold hand on lid to trap monster inside.", "note": "No mess." }, { "number": 3, "title": "Pulse Power", "color": "pink", "desc": "Press Pulse 3 times. Vroom! Break ice chunks.", "note": "Crunchy sounds." }, { "number": 4, "title": "Tornado Time", "color": "green", "desc": "High speed. Look for Vortex tornado in middle. Count to 20.", "note": "One color." }, { "number": 5, "title": "Brain Freeze", "color": "blue", "desc": "Pour and drink immediately.", "note": "Drink slow!", "icon": "thermometer" } ] }
        ];

        // State
        let recipes = [];
        let activeFilter = 'All';
        let searchQuery = '';

        // --- INIT ---
        async function initApp() {
            const paths = ['./recipes.json', 'recipes.json'];
            let loaded = false;
            
            for (const p of paths) {
                try {
                    const res = await fetch(p);
                    if (res.ok) {
                        recipes = await res.json();
                        loaded = true;
                        break;
                    }
                } catch(e) {}
            }
            if (!loaded) recipes = BACKUP_RECIPES;
            
            renderHome();
        }

        // --- SEARCH/FILTER HANDLERS ---
        function setFilter(level) {
            activeFilter = level;
            renderHome();
        }

        function handleSearch(e) {
            searchQuery = e.target.value.toLowerCase();
            renderHome();
        }

        // --- VIEWS ---
        function renderHome() {
            const container = document.getElementById('app-container');
            
            // Filter logic
            const filtered = recipes.filter(r => {
                const matchLvl = activeFilter === 'All' || r.level === activeFilter;
                const matchTxt = (r.title + r.subtitle + r.desc).toLowerCase().includes(searchQuery);
                return matchLvl && matchTxt;
            });

            // Filter Buttons
            const levels = ['All', 'Beginner', 'Intermediate', 'Advanced'];
            const buttonsHTML = levels.map(l => {
                const isActive = activeFilter === l;
                const activeClasses = "bg-[#1e293b] text-white border-[#1e293b]";
                const inactiveClasses = "bg-white text-[#1e293b] hover:bg-slate-50";
                
                return `
                <button onclick="setFilter('${l}')" 
                    class="btn-chunky px-4 py-2 text-sm rounded-lg border-2 ${isActive ? activeClasses : inactiveClasses} shadow-none transform-none">
                    ${l}
                </button>`;
            }).join('');

            // Control Bar
            const controls = `
            <div class="flex flex-col md:flex-row gap-4 mb-8 justify-between items-start md:items-center fade-in-up">
                <div class="relative w-full md:w-80">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"></i>
                    <input type="text" placeholder="Find mission..." oninput="handleSearch(event)" value="${searchQuery}"
                        class="input-chunky pl-10">
                </div>
                <div class="flex flex-wrap gap-2">
                    ${buttonsHTML}
                </div>
            </div>`;

            // Cards Grid
            let grid = '';
            if (filtered.length === 0) {
                grid = `
                <div class="text-center p-12 border-[3px] border-dashed border-slate-300 rounded-2xl opacity-60">
                    <i data-lucide="search-x" class="mx-auto w-12 h-12 text-slate-400 mb-2"></i>
                    <p class="font-heading text-xl text-slate-500">No missions found.</p>
                </div>`;
            } else {
                grid = `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${filtered.map((r, i) => {
                        const colorMap = { e1pink: '#FF6B95', e1orange: '#FF8C42', e1green: '#00E676', e1blue: '#2979FF' };
                        const color = colorMap[r.color] || '#1e293b';
                        
                        return `
                        <div class="card-neo interactive p-5 flex flex-col h-full bg-white relative fade-in-up" style="animation-delay: ${i * 50}ms">
                            <div class="flex justify-between items-start mb-3">
                                <span class="bg-slate-100 border border-slate-200 px-2 py-1 rounded-md font-bold text-[10px] uppercase tracking-wider text-slate-500">${r.subtitle}</span>
                                <span class="text-[10px] font-bold text-white px-2 py-1 rounded-md" style="background:${color}">${r.level}</span>
                            </div>
                            
                            <h2 class="text-2xl font-heading font-bold text-[#1e293b] mb-2 leading-tight">${r.title}</h2>
                            <p class="font-nunito text-slate-600 mb-6 text-sm font-semibold leading-relaxed line-clamp-2 flex-grow">${r.desc}</p>
                            
                            <div class="pt-4 border-t border-dashed border-slate-200 flex items-center justify-between mt-auto">
                                <div class="flex items-center gap-1.5 text-xs font-bold text-slate-500">
                                    <i data-lucide="clock" class="w-3.5 h-3.5"></i> ${(r.meta && r.meta[0]) ? r.meta[0].value : '??'}
                                </div>
                                <button onclick="renderRecipe('${r.id}')" class="btn-chunky px-4 py-2 text-sm rounded-lg" style="background:${color}; color:white; border-color:#1e293b;">
                                    OPEN <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>`;
                    }).join('')}
                </div>`;
            }

            container.innerHTML = controls + grid;
            
            // Re-focus search if active
            const input = document.querySelector('input');
            if (input && searchQuery) {
                input.focus();
                const val = input.value; input.value = ''; input.value = val;
            }
            
            lucide.createIcons();
        }

        function renderRecipe(id) {
            const r = recipes.find(x => x.id === id);
            if (!r) return;
            const container = document.getElementById('app-container');
            const colorMap = { e1pink: '#FF6B95', e1orange: '#FF8C42', e1green: '#00E676', e1blue: '#2979FF' };
            const accent = colorMap[r.color] || '#1e293b';

            // Ingredients
            const ingredients = (r.loadout || []).map(g => `
                <div class="mb-5 last:mb-0">
                    <h3 class="font-heading text-sm uppercase tracking-wider mb-2 border-b-2 border-slate-200 inline-block pr-2" style="color:${accent}">${g.groupName}</h3>
                    <ul class="space-y-2 text-sm font-bold text-slate-700">
                        ${g.items.map((it, idx) => `
                            <li class="flex items-start gap-3 p-1 rounded hover:bg-slate-50 transition-colors">
                                <input type="checkbox" id="i-${idx}" class="checkbox-neo mt-0.5">
                                <label for="i-${idx}" class="cursor-pointer flex-1 select-none">${it}</label>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');

            // Steps
            const steps = (r.steps || []).map(s => {
                const sColor = { blue: '#2979FF', orange: '#FF8C42', green: '#00E676', pink: '#FF6B95' }[s.color] || accent;
                const bgClass = s.color === 'blue' ? 'bg-blue-50' : s.color === 'orange' ? 'bg-orange-50' : s.color === 'green' ? 'bg-green-50' : 'bg-pink-50';
                
                return `
                <div class="card-neo bg-white p-5 flex gap-4 mb-4 relative overflow-hidden">
                    <div class="hidden md:flex w-12 h-12 bg-slate-100 border-2 border-slate-800 rounded-xl items-center justify-center flex-shrink-0 font-heading font-bold text-xl">${s.number}</div>
                    <div class="w-full z-10">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="md:hidden w-6 h-6 bg-slate-800 text-white rounded flex items-center justify-center font-bold text-sm">${s.number}</span>
                            <h3 class="font-heading text-xl font-bold" style="color:${sColor}">${s.title}</h3>
                        </div>
                        <p class="text-slate-700 font-semibold mb-3 leading-relaxed">${s.desc}</p>
                        <div class="${bgClass} border-l-[3px] p-3 rounded-r-lg text-sm flex gap-2 border-slate-800">
                            ${s.icon ? `<i data-lucide="${s.icon}" class="w-4 h-4 mt-0.5 flex-shrink-0"></i>` : ''}
                            <span class="font-bold text-slate-700">${s.note}</span>
                        </div>
                    </div>
                </div>`;
            }).join('');

            // Full View
            container.innerHTML = `
            <div class="fade-in-up pb-12">
                <button onclick="renderHome()" class="mb-6 btn-chunky px-4 py-2 bg-white text-sm">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> BACK
                </button>
                
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    <div class="lg:col-span-12 card-neo bg-white p-6 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-3" style="background:${accent}"></div>
                        <div class="pt-2">
                            <span class="font-heading font-bold px-2 py-0.5 border border-slate-800 rounded text-xs uppercase bg-white shadow-sm inline-block mb-2">ID: ${r.id}</span>
                            <h1 class="text-4xl md:text-5xl font-heading font-bold text-[#1e293b] mb-1">${r.title}</h1>
                            <p class="text-xl text-slate-500 font-bold">${r.subtitle}</p>
                        </div>
                    </div>

                    <div class="lg:col-span-4 space-y-4">
                        <div class="card-neo bg-white overflow-hidden">
                            <div class="bg-[#1e293b] p-3 flex items-center gap-2 text-white font-heading font-bold">
                                <i data-lucide="shopping-bag" class="w-5 h-5"></i> Loadout
                            </div>
                            <div class="p-5 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmZmZmIi8+CjxyZWN0IHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiNmMmYyZjIiLz4KPC9zdmc+')]">
                                ${ingredients}
                            </div>
                        </div>
                        
                        <div class="card-neo bg-slate-50 p-4 border-slate-300">
                             <h3 class="font-heading text-lg text-[#2979FF] mb-3 flex items-center gap-2 border-b border-slate-200 pb-2">
                                <i data-lucide="book-open" class="w-5 h-5"></i> Vocab
                             </h3>
                             <div class="space-y-2">
                                ${(r.vocab || []).map(v => `<div class="bg-white border border-slate-200 p-2 rounded-lg text-sm shadow-sm"><strong class="${v.color.replace('text-', 'text-')}">${v.word}</strong>: ${v.def}</div>`).join('')}
                             </div>
                        </div>
                    </div>

                    <div class="lg:col-span-8">
                        ${steps}
                        <div class="text-center p-8 border-[3px] border-dashed border-slate-300 rounded-2xl bg-slate-50/50 mt-4">
                            <h3 class="font-heading text-xl text-slate-400 font-bold">Mission Complete?</h3>
                            <p class="text-slate-500 font-bold text-sm">Call the teacher for inspection!</p>
                        </div>
                    </div>
                </div>
            </div>`;

            window.scrollTo(0,0);
            lucide.createIcons();
        }

        initApp();
    </script>
</body>
</html>