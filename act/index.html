<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>English 1 Activity Bank</title>

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap"
            rel="stylesheet"
        />
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/lucide@latest"></script>

        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            engPink: "#FF6B95",
                            engOrange: "#FF8C42",
                            engGreen: "#00E676",
                            engBlue: "#2979FF",
                            engDark: "#1e293b",
                            engChalk: "#f8fafc",
                            engYellow: "#FACC15",
                        },
                        fontFamily: {
                            headings: ["Fredoka", "sans-serif"],
                            body: ["Nunito", "sans-serif"],
                        },
                        boxShadow: {
                            neo: "4px 4px 0px 0px rgba(30, 41, 59, 1)",
                            "neo-sm": "2px 2px 0px 0px rgba(30, 41, 59, 1)",
                            "neo-lg": "8px 8px 0px 0px rgba(30, 41, 59, 1)",
                            "tab-inactive":
                                "inset 0 -6px 0 0 rgba(30, 41, 59, 1)",
                        },
                    },
                },
            };
        </script>

        <script>
            if (
                localStorage.getItem("theme") === "dark" ||
                (!("theme" in localStorage) &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches)
            ) {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
        </script>

        <style>
            body {
                background-color: #f8fafc;
                background-image:
                    linear-gradient(#e2e8f0 2px, transparent 2px),
                    linear-gradient(90deg, #e2e8f0 2px, transparent 2px);
                background-size: 32px 32px;
                background-position: center center;
            }
            .dark body {
                background-color: #0f172a;
                background-image:
                    linear-gradient(#1e293b 2px, transparent 2px),
                    linear-gradient(90deg, #1e293b 2px, transparent 2px);
            }

            .btn-neo {
                transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .btn-neo:focus-visible {
                outline: none;
                box-shadow:
                    0 0 0 4px #ff6b95,
                    4px 4px 0px 0px rgba(30, 41, 59, 1);
            }
            .btn-neo:active:not(:disabled) {
                transform: translate(4px, 4px);
                box-shadow: 0px 0px 0px 0px rgba(30, 41, 59, 1) !important;
            }
            .btn-neo:hover:not(:disabled) {
                transform: translate(-2px, -2px);
                box-shadow: 6px 6px 0px 0px rgba(30, 41, 59, 1);
            }

            .card-hover {
                transition:
                    transform 0.2s ease,
                    box-shadow 0.2s ease;
            }
            .card-hover:hover {
                transform: translateY(-6px);
                box-shadow: 8px 8px 0px 0px rgba(30, 41, 59, 1);
            }
            .card-hover:focus-within {
                outline: none;
                box-shadow:
                    0 0 0 4px #ff6b95,
                    8px 8px 0px 0px rgba(30, 41, 59, 1);
            }

            /* Custom dropdown styling */
            select {
                appearance: none;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%231e293b' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right 1rem center;
                background-size: 1.2em;
            }
            .dark select {
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            }

            @keyframes slideUp {
                from {
                    transform: translate(-50%, 100%);
                    opacity: 0;
                }
                to {
                    transform: translate(-50%, 0);
                    opacity: 1;
                }
            }
            .toast-anim {
                animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
                    forwards;
            }
            dialog[open] {
                animation: fadeIn 0.2s ease-out;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }
            dialog::backdrop {
                background: rgba(30, 41, 59, 0.7);
                backdrop-filter: blur(4px);
            }
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .card-enter {
                animation: fadeInUp 0.4s ease-out forwards;
            }

            .custom-scrollbar::-webkit-scrollbar {
                width: 10px;
            }
            .custom-scrollbar::-webkit-scrollbar-track {
                background: transparent;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 99px;
                border: 3px solid #f8fafc;
            }
            .dark .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #475569;
                border-color: #0f172a;
            }
        </style>
    </head>

    <body
        class="text-engDark font-body min-h-screen p-4 md:p-8 selection:bg-engPink selection:text-white transition-colors duration-300"
    >
        <div
            class="max-w-[1600px] mx-auto flex flex-col xl:flex-row gap-8 items-start"
        >
            <aside
                id="lessonPanel"
                class="w-full xl:w-[420px] shrink-0 xl:sticky top-8 xl:h-[calc(100vh-4rem)] bg-engChalk dark:bg-slate-900 border-4 border-engDark rounded-2xl shadow-neo flex flex-col order-2 xl:order-1 overflow-hidden transition-all z-30"
            >
                <div
                    class="p-6 border-b-4 border-engDark bg-white dark:bg-slate-800 flex justify-between items-center z-10"
                >
                    <h2
                        class="font-headings text-3xl font-bold text-engDark dark:text-white flex items-center gap-3"
                    >
                        <i
                            data-lucide="bookmark"
                            class="w-8 h-8 text-engPink"
                        ></i>
                        Lesson Plan
                        <span
                            id="lessonCounter"
                            class="bg-engDark text-white font-body text-sm font-bold px-3 py-1 rounded-xl border-2 border-white hidden ml-2 shadow-sm"
                            >0</span
                        >
                    </h2>
                </div>

                <div
                    class="flex-grow overflow-y-auto custom-scrollbar p-6 bg-engChalk/50 dark:bg-slate-900/50"
                >
                    <div
                        id="lessonEmptyState"
                        class="text-center py-12 flex flex-col items-center justify-center h-full"
                    >
                        <div
                            class="p-4 bg-slate-200 dark:bg-slate-800 rounded-full border-4 border-engDark shadow-neo mb-6 inline-block"
                        >
                            <i
                                data-lucide="inbox"
                                class="w-10 h-10 text-slate-500 dark:text-slate-400"
                            ></i>
                        </div>
                        <h3
                            class="font-headings text-2xl font-bold text-engDark dark:text-white mb-2"
                        >
                            Plan is Empty
                        </h3>
                        <p
                            class="text-slate-600 dark:text-slate-400 font-medium max-w-[250px] mx-auto"
                        >
                            Click the
                            <i
                                data-lucide="plus"
                                class="w-4 h-4 inline bg-engDark text-white rounded p-[1px]"
                            ></i>
                            button on any activity to add it to your queue.
                        </p>
                        <p
                            class="text-xs text-slate-500 mt-6 font-bold border-2 border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 inline-block px-4 py-2 rounded-xl shadow-sm"
                        >
                            Press 'L' to toggle panel
                        </p>
                    </div>
                    <ul id="lessonList" class="space-y-4"></ul>
                </div>

                <div
                    class="p-6 border-t-4 border-engDark bg-white dark:bg-slate-800 z-10"
                >
                    <button
                        onclick="openConfirmModal()"
                        id="clearLessonBtn"
                        class="w-full btn-neo bg-slate-200 dark:bg-slate-700 text-engDark dark:text-white font-headings font-bold text-xl py-4 rounded-xl border-4 border-engDark shadow-neo disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none flex justify-center items-center gap-3 hover:bg-engPink hover:text-white hover:border-engDark transition-colors"
                        disabled
                    >
                        <i data-lucide="trash-2" class="w-6 h-6"></i> Clear Plan
                    </button>
                </div>
            </aside>

            <div class="flex-1 w-full flex flex-col gap-8 order-1 xl:order-2">
                <header
                    class="flex flex-col md:flex-row justify-between items-center gap-6 bg-white dark:bg-slate-800 p-6 md:px-8 border-4 border-engDark rounded-2xl shadow-neo"
                >
                    <div class="text-center md:text-left">
                        <h1
                            class="font-headings text-4xl md:text-5xl font-bold tracking-wide text-engDark"
                        >
                            <span
                                class="bg-engPink text-white px-5 py-2 rounded-xl border-4 border-engDark shadow-sm inline-block -rotate-2 cursor-default"
                                >Activity</span
                            >
                            <span
                                class="bg-engBlue text-white px-5 py-2 rounded-xl border-4 border-engDark shadow-sm inline-block rotate-2 cursor-default"
                                >Bank</span
                            >
                        </h1>
                        <p
                            class="text-slate-500 dark:text-slate-400 font-bold mt-3 text-sm tracking-widest uppercase"
                        >
                            English 1 Batam &bull; Toolkit
                        </p>
                    </div>

                    <div class="flex gap-4">
                        <button
                            onclick="toggleTheme()"
                            class="btn-neo bg-engChalk dark:bg-slate-700 p-4 rounded-xl border-4 border-engDark shadow-neo focus:outline-none"
                            aria-label="Toggle Dark Mode"
                        >
                            <i
                                data-lucide="moon"
                                class="w-6 h-6 text-engDark dark:hidden"
                            ></i>
                            <i
                                data-lucide="sun"
                                class="w-6 h-6 text-engOrange hidden dark:block"
                            ></i>
                        </button>
                    </div>
                </header>

                <section class="sticky top-4 z-20">
                    <div
                        class="bg-white/95 dark:bg-slate-800/95 backdrop-blur-md border-4 border-engDark rounded-2xl p-4 shadow-neo flex flex-col xl:flex-row gap-4 items-center justify-between"
                    >
                        <div
                            class="flex flex-wrap justify-center gap-3 w-full xl:w-auto items-center"
                        >
                            <button
                                onclick="filterActivities('all')"
                                class="filter-btn active btn-neo font-headings text-lg font-bold bg-engDark text-white px-6 py-3 rounded-xl border-4 border-engDark shadow-neo-sm focus:outline-none"
                            >
                                All
                            </button>
                            <button
                                onclick="filterActivities('Stirrer')"
                                class="filter-btn btn-neo font-headings text-lg font-bold bg-engChalk text-engDark px-6 py-3 rounded-xl border-4 border-engDark shadow-neo-sm flex items-center gap-2 hover:bg-engOrange hover:text-white transition-colors focus:outline-none"
                            >
                                <i data-lucide="zap" class="w-5 h-5"></i>
                                Stirrers
                            </button>
                            <button
                                onclick="filterActivities('Settler')"
                                class="filter-btn btn-neo font-headings text-lg font-bold bg-engChalk text-engDark px-6 py-3 rounded-xl border-4 border-engDark shadow-neo-sm flex items-center gap-2 hover:bg-engBlue hover:text-white transition-colors focus:outline-none"
                            >
                                <i data-lucide="anchor" class="w-5 h-5"></i>
                                Settlers
                            </button>

                            <div
                                class="h-8 w-1 bg-slate-200 dark:bg-slate-700 rounded-full mx-1 hidden md:block"
                            ></div>

                            <div class="relative shrink-0 w-full sm:w-auto">
                                <select
                                    id="ageFilter"
                                    onchange="filterByAge(this.value)"
                                    class="w-full sm:w-auto pl-5 pr-12 py-3 border-4 border-engDark rounded-xl font-headings font-bold bg-engYellow text-engDark shadow-neo-sm focus:outline-none focus:ring-4 focus:ring-engPink cursor-pointer text-lg hover:brightness-105 transition-all"
                                >
                                    <option value="all">üåç All Ages</option>
                                    <option value="3-6">üß∏ Ages 3-6</option>
                                    <option value="7-12">üéí Ages 7-12</option>
                                    <option value="13-18">üéì Ages 13-18</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex items-center gap-4 w-full xl:w-auto">
                            <div
                                class="flex border-4 border-engDark rounded-xl overflow-hidden shadow-neo-sm shrink-0"
                            >
                                <button
                                    id="btn-view-grid"
                                    onclick="setViewMode('grid')"
                                    class="bg-engDark text-white p-3 hover:bg-engDark/90 transition-colors focus:outline-none focus:bg-engPink"
                                >
                                    <i
                                        data-lucide="layout-grid"
                                        class="w-6 h-6"
                                    ></i>
                                </button>
                                <button
                                    id="btn-view-list"
                                    onclick="setViewMode('list')"
                                    class="bg-white text-engDark dark:bg-slate-700 dark:text-white p-3 hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors border-l-4 border-engDark focus:outline-none focus:bg-engPink"
                                >
                                    <i data-lucide="list" class="w-6 h-6"></i>
                                </button>
                            </div>

                            <div class="relative w-full xl:w-80 group">
                                <i
                                    data-lucide="search"
                                    class="absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-slate-400 group-focus-within:text-engPink transition-colors"
                                ></i>
                                <input
                                    type="text"
                                    id="searchInput"
                                    placeholder="Search... (Press '/')"
                                    class="w-full pl-12 pr-4 py-3 border-4 border-engDark rounded-xl font-bold bg-engChalk dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-4 focus:ring-engPink transition-all placeholder:font-semibold text-lg"
                                />
                            </div>
                        </div>
                    </div>
                </section>

                <main
                    id="activitiesContainer"
                    class="grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-8 pb-12"
                >
                    <div class="col-span-full text-center py-20 animate-pulse">
                        <div
                            class="inline-block p-4 rounded-full bg-slate-200 dark:bg-slate-800 border-4 border-engDark mb-4"
                        >
                            <i
                                data-lucide="loader"
                                class="w-10 h-10 text-engBlue animate-spin"
                            ></i>
                        </div>
                        <p
                            class="font-headings text-2xl font-bold text-slate-500"
                        >
                            Loading your activities...
                        </p>
                    </div>
                </main>

                <div
                    id="emptyState"
                    class="hidden text-center py-20 bg-white dark:bg-slate-800 border-4 border-engDark rounded-2xl shadow-neo"
                >
                    <div
                        class="inline-block p-6 rounded-full bg-slate-200 dark:bg-slate-700 border-4 border-engDark mb-6"
                    >
                        <i
                            data-lucide="frown"
                            class="w-12 h-12 text-slate-500 dark:text-slate-400"
                        ></i>
                    </div>
                    <h3
                        class="font-headings text-3xl font-bold text-engDark dark:text-white"
                    >
                        No activities found
                    </h3>
                    <p class="text-slate-500 font-bold mt-2 text-lg">
                        Try adjusting your filters or search terms.
                    </p>
                </div>
            </div>
        </div>

        <dialog
            id="guideModal"
            class="p-0 rounded-3xl border-4 border-engDark shadow-neo-lg bg-transparent backdrop:bg-slate-900/50 w-[95%] max-w-4xl m-auto relative"
        >
            <div
                class="bg-white dark:bg-slate-800 flex flex-col max-h-[90vh] overflow-hidden rounded-2xl"
            >
                <div
                    class="p-6 md:p-8 border-b-4 border-engDark flex justify-between items-center bg-engChalk dark:bg-slate-900 shrink-0"
                >
                    <h2
                        id="modalTitle"
                        class="font-headings text-3xl md:text-4xl font-bold text-engDark dark:text-white leading-tight pr-4"
                    >
                        Activity Title
                    </h2>
                    <button
                        onclick="closeModal()"
                        class="btn-neo shrink-0 bg-white dark:bg-slate-700 p-3 rounded-xl border-4 border-engDark hover:bg-slate-200 focus:outline-none"
                    >
                        <i
                            data-lucide="x"
                            class="w-6 h-6 text-engDark dark:text-white"
                        ></i>
                    </button>
                </div>

                <div
                    class="flex border-b-4 border-engDark bg-slate-200 dark:bg-slate-700 shrink-0 overflow-x-auto custom-scrollbar"
                >
                    <button
                        id="tab-btn-steps"
                        onclick="switchModalTab('steps')"
                        class="flex-1 min-w-[120px] py-4 font-headings font-bold text-lg md:text-xl border-r-4 border-engDark focus:outline-none transition-colors"
                    >
                        üìù Steps
                    </button>
                    <button
                        id="tab-btn-variations"
                        onclick="switchModalTab('variations')"
                        class="flex-1 min-w-[120px] py-4 font-headings font-bold text-lg md:text-xl border-r-4 border-engDark focus:outline-none transition-colors"
                    >
                        üí° Variations
                    </button>
                    <button
                        id="tab-btn-details"
                        onclick="switchModalTab('details')"
                        class="flex-1 min-w-[120px] py-4 font-headings font-bold text-lg md:text-xl focus:outline-none transition-colors"
                    >
                        ‚ÑπÔ∏è Details & Prep
                    </button>
                </div>

                <div
                    class="p-6 md:p-8 overflow-y-auto custom-scrollbar flex-grow bg-white dark:bg-slate-800"
                >
                    <div id="modal-panel-steps" class="block">
                        <ul
                            id="modalSteps"
                            class="space-y-5 text-slate-700 dark:text-slate-300 font-medium list-none"
                        ></ul>
                    </div>

                    <div id="modal-panel-variations" class="hidden h-full">
                        <div
                            class="bg-engOrange/10 border-4 border-engOrange p-8 rounded-2xl h-full shadow-neo-sm"
                        >
                            <h3
                                class="font-headings text-2xl font-bold text-engOrange mb-4 flex items-center gap-3"
                            >
                                <i data-lucide="lightbulb" class="w-8 h-8"></i>
                                Teacher Tip
                            </h3>
                            <p
                                id="modalVariation"
                                class="text-slate-800 dark:text-slate-200 text-xl font-medium leading-relaxed"
                            ></p>
                        </div>
                    </div>

                    <div id="modal-panel-details" class="hidden space-y-8">
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                            <div
                                class="p-6 rounded-2xl border-4 border-engDark bg-slate-50 dark:bg-slate-700 text-center shadow-neo-sm"
                            >
                                <p
                                    class="text-sm font-bold uppercase tracking-widest text-slate-400 mb-3"
                                >
                                    Energy
                                </p>
                                <span
                                    id="modalType"
                                    class="px-4 py-2 rounded-xl border-4 border-engDark font-headings text-lg font-bold text-white bg-engOrange inline-block shadow-sm"
                                    >Type</span
                                >
                            </div>
                            <div
                                class="p-6 rounded-2xl border-4 border-engDark bg-slate-50 dark:bg-slate-700 text-center shadow-neo-sm"
                            >
                                <p
                                    class="text-sm font-bold uppercase tracking-widest text-slate-400 mb-3"
                                >
                                    Duration
                                </p>
                                <span
                                    id="modalTime"
                                    class="px-4 py-2 rounded-xl border-4 border-engDark font-headings text-lg font-bold bg-white text-engDark inline-block shadow-sm"
                                    >Time</span
                                >
                            </div>
                            <div
                                class="p-6 rounded-2xl border-4 border-engDark bg-slate-50 dark:bg-slate-700 text-center shadow-neo-sm"
                            >
                                <p
                                    class="text-sm font-bold uppercase tracking-widest text-slate-400 mb-3"
                                >
                                    Challenge
                                </p>
                                <span
                                    id="modalDiff"
                                    class="px-4 py-2 rounded-xl border-4 border-engDark font-headings text-lg font-bold inline-block shadow-sm"
                                    >Diff</span
                                >
                            </div>
                            <div
                                class="p-6 rounded-2xl border-4 border-engDark bg-slate-50 dark:bg-slate-700 text-center shadow-neo-sm"
                            >
                                <p
                                    class="text-sm font-bold uppercase tracking-widest text-slate-400 mb-3"
                                >
                                    Grouping
                                </p>
                                <span
                                    id="modalGrouping"
                                    class="px-4 py-2 rounded-xl border-4 border-engDark font-headings text-lg font-bold bg-white text-engDark inline-block shadow-sm"
                                    >Group</span
                                >
                            </div>
                            <div
                                class="p-6 rounded-2xl border-4 border-engDark bg-slate-50 dark:bg-slate-700 text-center shadow-neo-sm"
                            >
                                <p
                                    class="text-sm font-bold uppercase tracking-widest text-slate-400 mb-3"
                                >
                                    Prep Time
                                </p>
                                <span
                                    id="modalPrep"
                                    class="px-4 py-2 rounded-xl border-4 border-engDark font-headings text-lg font-bold bg-white text-engDark inline-block shadow-sm"
                                    >Prep</span
                                >
                            </div>
                            <div
                                class="p-6 rounded-2xl border-4 border-engDark bg-slate-50 dark:bg-slate-700 text-center shadow-neo-sm col-span-2 md:col-span-1"
                            >
                                <p
                                    class="text-sm font-bold uppercase tracking-widest text-slate-400 mb-3"
                                >
                                    Target Ages
                                </p>
                                <span
                                    id="modalAges"
                                    class="px-4 py-2 rounded-xl border-4 border-engDark font-headings text-lg font-bold bg-engPink text-white inline-block shadow-sm"
                                    >Ages</span
                                >
                            </div>
                        </div>

                        <div
                            class="bg-engChalk dark:bg-slate-700 border-4 border-engDark p-6 md:p-8 rounded-2xl shadow-neo-sm"
                        >
                            <h3
                                class="font-headings text-2xl font-bold mb-4 flex items-center gap-3 text-engDark dark:text-white"
                            >
                                <i
                                    data-lucide="package"
                                    class="w-6 h-6 text-engBlue"
                                ></i>
                                Materials Needed
                            </h3>
                            <div
                                id="modalMaterials"
                                class="flex flex-wrap gap-3"
                            ></div>
                        </div>
                    </div>
                </div>

                <div
                    class="p-6 md:p-8 border-t-4 border-engDark bg-engChalk dark:bg-slate-900 flex justify-between items-center gap-4 flex-wrap shrink-0"
                >
                    <button
                        id="modalCopyBtn"
                        class="btn-neo bg-white dark:bg-slate-800 text-engDark dark:text-white font-headings font-bold text-lg px-6 py-4 rounded-xl border-4 border-engDark shadow-neo flex items-center gap-3 hover:bg-slate-100 focus:outline-none"
                    >
                        <i data-lucide="copy" class="w-6 h-6"></i> Copy Steps
                    </button>
                    <button
                        onclick="closeModal()"
                        class="btn-neo bg-engDark text-white font-headings font-bold text-xl px-10 py-4 rounded-xl border-4 border-engDark shadow-neo focus:outline-none hover:bg-slate-800"
                    >
                        Got it!
                    </button>
                </div>
            </div>
        </dialog>

        <dialog
            id="confirmModal"
            class="p-0 rounded-3xl border-4 border-engDark shadow-neo-lg bg-transparent backdrop:bg-slate-900/50 w-[90%] max-w-sm m-auto relative"
        >
            <div
                class="bg-white dark:bg-slate-800 flex flex-col p-8 text-center rounded-2xl"
            >
                <div
                    class="inline-block p-5 rounded-full bg-red-100 border-4 border-engDark mx-auto mb-6 shadow-neo-sm"
                >
                    <i
                        data-lucide="alert-triangle"
                        class="w-10 h-10 text-red-500"
                    ></i>
                </div>
                <h3
                    class="font-headings text-3xl font-bold text-engDark dark:text-white mb-3"
                >
                    Clear Plan?
                </h3>
                <p
                    class="text-slate-600 dark:text-slate-300 font-medium text-lg mb-8"
                >
                    This will remove all activities from your queue. Cannot be
                    undone.
                </p>
                <div class="flex gap-4 w-full">
                    <button
                        onclick="closeConfirmModal()"
                        class="flex-1 btn-neo bg-white dark:bg-slate-700 text-engDark dark:text-white font-headings font-bold text-xl py-3 rounded-xl border-4 border-engDark focus:outline-none"
                    >
                        Cancel
                    </button>
                    <button
                        onclick="confirmClearLessonPlan()"
                        class="flex-1 btn-neo bg-engPink text-white font-headings font-bold text-xl py-3 rounded-xl border-4 border-engDark shadow-neo focus:outline-none"
                    >
                        Clear It
                    </button>
                </div>
            </div>
        </dialog>

        <div
            id="toast"
            class="fixed bottom-10 left-1/2 transform -translate-x-1/2 hidden bg-engDark text-white px-8 py-4 rounded-2xl border-4 border-engDark shadow-neo-lg font-headings font-bold text-xl z-[100] flex items-center gap-3 w-max"
        >
            <i
                id="toastIcon"
                data-lucide="check-circle"
                class="w-6 h-6 text-engGreen"
            ></i>
            <span id="toastMsg">Action successful!</span>
        </div>

        <script>
            /**
             * 1. STATE MANAGEMENT
             */
            const AppState = {
                activities: [],
                lessonPlan:
                    JSON.parse(localStorage.getItem("lessonPlan")) || [],
                currentFilter: "all",
                currentAgeFilter: "all",
                currentSearch: "",
                currentView: localStorage.getItem("viewMode") || "grid",
                toastTimeout: null,
            };

            /**
             * 2. DOM ELEMENT CACHE
             */
            const DOM = {
                container: document.getElementById("activitiesContainer"),
                emptyState: document.getElementById("emptyState"),
                searchInput: document.getElementById("searchInput"),
                lessonCounter: document.getElementById("lessonCounter"),
                lessonList: document.getElementById("lessonList"),
                lessonEmptyState: document.getElementById("lessonEmptyState"),
                clearLessonBtn: document.getElementById("clearLessonBtn"),
                viewGridBtn: document.getElementById("btn-view-grid"),
                viewListBtn: document.getElementById("btn-view-list"),
                toast: document.getElementById("toast"),
                toastMsg: document.getElementById("toastMsg"),
                toastIcon: document.getElementById("toastIcon"),
            };

            /**
             * 3. INITIALIZATION
             */
            window.onload = async () => {
                setViewMode(AppState.currentView, true);
                await fetchActivities();
            };

            async function fetchActivities() {
                try {
                    const response = await fetch(
                        "./activities/activities.json?v=" +
                            new Date().getTime(),
                    );
                    if (!response.ok)
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    AppState.activities = await response.json();
                    renderActivities(AppState.activities);
                    updateLessonPlanUI();
                    lucide.createIcons();
                } catch (error) {
                    console.error("Data Fetch Failed:", error);
                    DOM.container.innerHTML = `
                        <div class="col-span-full text-center py-12 bg-white dark:bg-slate-800 rounded-2xl border-4 border-engDark shadow-neo">
                            <div class="inline-block p-4 bg-red-100 rounded-full border-4 border-engDark mb-4">
                                <i data-lucide="alert-triangle" class="w-10 h-10 text-red-500"></i>
                            </div>
                            <h3 class="font-headings text-2xl font-bold text-engDark dark:text-white">Failed to load activities</h3>
                            <p class="text-slate-500 font-bold mt-2">Ensure 'activities.json' is in the root directory.</p>
                        </div>`;
                    lucide.createIcons();
                }
            }

            /**
             * 4. VIEW & TEMPLATE RENDERING
             */
            function setViewMode(mode, isInit = false) {
                AppState.currentView = mode;
                localStorage.setItem("viewMode", mode);

                const isGrid = mode === "grid";

                DOM.viewGridBtn.className = `p-3 transition-colors focus:outline-none focus:bg-engPink ${
                    isGrid
                        ? "bg-engDark text-white hover:bg-engDark/90"
                        : "bg-white text-engDark dark:bg-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-600"
                }`;

                DOM.viewListBtn.className = `p-3 transition-colors border-l-4 border-engDark focus:outline-none focus:bg-engPink ${
                    !isGrid
                        ? "bg-engDark text-white hover:bg-engDark/90"
                        : "bg-white text-engDark dark:bg-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-600"
                }`;

                DOM.container.className = isGrid
                    ? "grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-8 pb-12"
                    : "flex flex-col gap-6 pb-12";

                if (!isInit) applyFilters();
            }

            function renderActivities(data) {
                DOM.container.innerHTML = "";

                if (data.length === 0) {
                    DOM.emptyState.classList.remove("hidden");
                    return;
                } else {
                    DOM.emptyState.classList.add("hidden");
                }

                data.forEach((activity, index) => {
                    const isStirrer = activity.type === "Stirrer";
                    const isInLesson = AppState.lessonPlan.some(
                        (item) => item.id === activity.id,
                    );

                    const theme = {
                        color: isStirrer ? "bg-engOrange" : "bg-engBlue",
                        icon: isStirrer ? "zap" : "anchor",
                    };

                    const addBtn = {
                        icon: isInLesson ? "check" : "plus",
                        class: isInLesson
                            ? "bg-engGreen text-engDark border-engDark"
                            : "bg-white text-engDark border-engDark hover:bg-slate-200",
                    };

                    // Process Skills & Ages for the cards
                    const ageText =
                        activity.target_ages && activity.target_ages.length > 0
                            ? activity.target_ages.join(", ")
                            : "All";
                    const ageHtml = `<span class="px-3 py-1 rounded-lg border-2 border-engDark bg-engYellow text-engDark font-bold text-xs uppercase tracking-widest shadow-sm"><i data-lucide="users" class="w-3 h-3 inline pb-[2px]"></i> ${ageText}</span>`;

                    const skillsHtml = activity.skills
                        .map(
                            (skill) =>
                                `<span class="px-3 py-1 rounded-lg border-2 border-engDark bg-engChalk dark:bg-slate-700 text-engDark dark:text-slate-200 font-bold text-xs uppercase tracking-widest shadow-sm">${skill}</span>`,
                        )
                        .join("");

                    const card = document.createElement("article");
                    card.style.animationDelay = `${index * 50}ms`;
                    card.setAttribute("tabindex", "0");
                    card.setAttribute("onclick", `openModal(${activity.id})`);
                    card.setAttribute(
                        "onkeydown",
                        `if(event.key==='Enter') openModal(${activity.id})`,
                    );

                    if (AppState.currentView === "grid") {
                        card.className =
                            "cursor-pointer card-enter card-hover bg-white dark:bg-slate-800 rounded-3xl border-4 border-engDark shadow-neo overflow-hidden flex flex-col h-full relative group focus:outline-none focus:ring-4 focus:ring-engPink";
                        card.innerHTML = `
                            <div class="${theme.color} p-5 border-b-4 border-engDark flex justify-between items-center relative z-10 shrink-0">
                                <span class="font-headings font-bold text-white text-xl flex items-center gap-2">
                                    <i data-lucide="${theme.icon}" class="w-6 h-6"></i> ${activity.type.toUpperCase()}
                                </span>
                                <div class="flex items-center gap-3">
                                    <span class="bg-black/20 text-white text-sm font-bold px-3 py-1 rounded-xl border-2 border-transparent flex items-center hidden sm:flex backdrop-blur-sm shadow-sm gap-2">
                                        <i data-lucide="clock" class="w-4 h-4"></i> ${activity.time}
                                    </span>
                                    <button onclick="event.stopPropagation(); toggleLessonActivity(${activity.id})" class="btn-neo ${addBtn.class} w-10 h-10 rounded-xl border-4 shadow-sm flex items-center justify-center transition-colors focus:outline-none" title="${isInLesson ? "Remove" : "Add"}">
                                        <i data-lucide="${addBtn.icon}" class="w-5 h-5 font-bold"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="p-6 md:p-8 flex-grow flex flex-col relative bg-white dark:bg-slate-800">
                                <div class="mb-4 flex items-start justify-between gap-4">
                                    <h2 class="font-headings text-3xl font-bold text-engDark dark:text-white leading-tight group-hover:text-engBlue transition-colors">${activity.title}</h2>
                                    <div class="p-3 shrink-0 rounded-2xl bg-slate-100 dark:bg-slate-700 border-4 border-engDark shadow-sm">
                                        <i data-lucide="${activity.icon}" class="w-6 h-6 text-slate-500 dark:text-slate-300 group-hover:text-engPink transition-colors"></i>
                                    </div>
                                </div>
                                <p class="text-slate-600 dark:text-slate-300 font-medium text-lg leading-relaxed mb-6 flex-grow">${activity.desc}</p>
                                <div class="mt-auto pt-5 border-t-4 border-engDark/10 dark:border-slate-700">
                                    <div class="flex flex-wrap gap-2">${ageHtml} ${skillsHtml}</div>
                                </div>
                            </div>
                        `;
                    } else {
                        // List View
                        card.className =
                            "cursor-pointer card-enter card-hover bg-white dark:bg-slate-800 rounded-3xl border-4 border-engDark shadow-neo overflow-hidden flex flex-col md:flex-row relative group focus:outline-none focus:ring-4 focus:ring-engPink";
                        card.innerHTML = `
                            <div class="${theme.color} p-5 border-b-4 md:border-b-0 md:border-r-4 border-engDark flex flex-row md:flex-col justify-between items-center md:items-start md:w-56 shrink-0 relative z-10">
                                <span class="font-headings font-bold text-white text-xl flex items-center gap-2">
                                    <i data-lucide="${theme.icon}" class="w-6 h-6"></i> ${activity.type.toUpperCase()}
                                </span>
                                <span class="bg-black/20 text-white text-sm font-bold px-3 py-1 rounded-xl border-2 border-transparent mt-0 md:mt-4 backdrop-blur-sm shadow-sm flex items-center gap-2">
                                    <i data-lucide="clock" class="w-4 h-4"></i> ${activity.time}
                                </span>
                            </div>
                            <div class="p-6 flex-grow flex flex-col justify-center relative bg-white dark:bg-slate-800">
                                <div class="flex items-center justify-between gap-4 mb-2">
                                    <h2 class="font-headings text-2xl md:text-3xl font-bold text-engDark dark:text-white leading-tight group-hover:text-engBlue transition-colors">${activity.title}</h2>
                                    <div class="p-2 shrink-0 rounded-xl bg-slate-100 dark:bg-slate-700 border-4 border-engDark shadow-sm md:hidden lg:block">
                                        <i data-lucide="${activity.icon}" class="w-5 h-5 text-slate-500 dark:text-slate-300 group-hover:text-engPink transition-colors"></i>
                                    </div>
                                </div>
                                <p class="text-slate-600 dark:text-slate-300 font-medium text-lg leading-relaxed mb-4 md:line-clamp-2">${activity.desc}</p>
                                <div class="flex flex-wrap gap-2">${ageHtml} ${skillsHtml}</div>
                            </div>
                            <div class="p-5 md:border-l-4 border-engDark flex items-center justify-center bg-engChalk dark:bg-slate-900 shrink-0 border-t-4 md:border-t-0">
                                <button onclick="event.stopPropagation(); toggleLessonActivity(${activity.id})" class="btn-neo ${addBtn.class} w-full md:w-16 h-12 md:h-16 rounded-xl border-4 shadow-sm flex items-center justify-center transition-colors focus:outline-none" title="${isInLesson ? "Remove" : "Add"}">
                                    <i data-lucide="${addBtn.icon}" class="w-6 h-6 font-bold"></i>
                                </button>
                            </div>
                        `;
                    }
                    DOM.container.appendChild(card);
                });
                lucide.createIcons();
            }

            /**
             * 5. LESSON PLAN CONTROLLER
             */
            function toggleLessonActivity(id) {
                const activity = AppState.activities.find((a) => a.id === id);
                if (!activity) return;

                const index = AppState.lessonPlan.findIndex(
                    (item) => item.id === id,
                );
                if (index > -1) {
                    AppState.lessonPlan.splice(index, 1);
                    showToast("Removed from plan", "info");
                } else {
                    AppState.lessonPlan.push(activity);
                    showToast("Added to plan", "check-circle");
                }

                localStorage.setItem(
                    "lessonPlan",
                    JSON.stringify(AppState.lessonPlan),
                );
                applyFilters();
                updateLessonPlanUI();
            }

            function updateLessonPlanUI() {
                const hasLessons = AppState.lessonPlan.length > 0;

                DOM.lessonCounter.innerText = AppState.lessonPlan.length;
                DOM.lessonCounter.classList.toggle("hidden", !hasLessons);
                DOM.lessonEmptyState.classList.toggle("hidden", hasLessons);
                DOM.clearLessonBtn.disabled = !hasLessons;

                DOM.lessonList.innerHTML = AppState.lessonPlan
                    .map(
                        (act, index) => `
                    <li onclick="openModal(${act.id})" tabindex="0" onkeydown="if(event.key==='Enter') openModal(${act.id})" class="cursor-pointer bg-white dark:bg-slate-800 p-5 rounded-2xl border-4 border-engDark shadow-neo-sm flex flex-col gap-3 hover:-translate-y-1 hover:shadow-neo transition-all group focus:outline-none focus:ring-4 focus:ring-engPink">
                        <div class="flex justify-between items-start gap-2">
                            <h4 class="font-headings text-xl font-bold text-engDark dark:text-white leading-tight group-hover:text-engBlue transition-colors"><span class="text-slate-400 mr-1">${index + 1}.</span> ${act.title}</h4>
                            <button onclick="event.stopPropagation(); toggleLessonActivity(${act.id})" class="btn-neo shrink-0 bg-slate-100 dark:bg-slate-700 p-2 rounded-xl border-2 border-engDark hover:bg-red-100 hover:text-red-500 hover:border-red-500 transition-colors focus:outline-none" aria-label="Remove">
                                <i data-lucide="trash" class="w-5 h-5 text-slate-500"></i>
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <span class="text-[11px] font-bold uppercase tracking-widest px-3 py-1 rounded-lg border-2 border-engDark ${act.type === "Stirrer" ? "bg-engOrange text-white" : "bg-engBlue text-white"} shadow-sm">${act.type}</span>
                            <span class="text-[11px] font-bold uppercase tracking-widest px-3 py-1 rounded-lg border-2 border-engDark bg-engChalk text-engDark shadow-sm"><i data-lucide="clock" class="w-3 h-3 inline pb-[2px]"></i> ${act.time}</span>
                        </div>
                    </li>
                `,
                    )
                    .join("");

                lucide.createIcons();
            }

            /**
             * 6. MODAL NAVIGATION & UI
             */
            function switchModalTab(tabId) {
                ["steps", "variations", "details"].forEach((t) => {
                    const btn = document.getElementById(`tab-btn-${t}`);
                    const panel = document.getElementById(`modal-panel-${t}`);
                    const isActive = t === tabId;

                    panel.classList.toggle("hidden", !isActive);
                    panel.classList.toggle("block", isActive);

                    if (isActive) {
                        btn.className =
                            "flex-1 min-w-[120px] py-4 font-headings font-bold text-lg md:text-xl border-r-4 border-engDark focus:outline-none transition-colors bg-white dark:bg-slate-800 text-engDark dark:text-white";
                    } else {
                        btn.className =
                            "flex-1 min-w-[120px] py-4 font-headings font-bold text-lg md:text-xl border-r-4 border-engDark focus:outline-none transition-colors bg-slate-200 dark:bg-slate-700 shadow-tab-inactive text-slate-500 dark:text-slate-400 hover:text-engDark";
                    }
                });
            }

            function getDifficultyInfo(level) {
                const map = {
                    Easy: "bg-engGreen text-engDark border-engDark",
                    Medium: "bg-engOrange text-engDark border-engDark",
                    Hard: "bg-engPink text-engDark border-engDark",
                };
                return (
                    map[level] || "bg-slate-200 text-slate-600 border-engDark"
                );
            }

            function openModal(id) {
                const act = AppState.activities.find((a) => a.id === id);
                if (!act) return;

                // 1. Save current scroll position before opening
                AppState.scrollPosition = window.scrollY;

                // Tab 1 & 2 Text
                document.getElementById("modalTitle").innerText = act.title;
                document.getElementById("modalVariation").innerText =
                    act.variation || "No specific variations provided.";

                // Details Tab Grid
                document.getElementById("modalType").innerText = act.type;
                document.getElementById("modalType").className =
                    `px-4 py-2 rounded-xl border-4 border-engDark font-headings text-lg font-bold text-white inline-block shadow-sm ${act.type === "Stirrer" ? "bg-engOrange" : "bg-engBlue"}`;
                document.getElementById("modalTime").innerText = act.time;
                document.getElementById("modalDiff").innerText = act.difficulty;
                document.getElementById("modalDiff").className =
                    `px-4 py-2 rounded-xl border-4 border-engDark font-headings text-lg font-bold inline-block shadow-sm ${getDifficultyInfo(act.difficulty)}`;

                // New Data Fields
                document.getElementById("modalGrouping").innerText =
                    act.grouping || "Whole Class";
                document.getElementById("modalPrep").innerText =
                    act.prep_time || "Zero Prep";
                document.getElementById("modalAges").innerText =
                    act.target_ages && act.target_ages.length
                        ? act.target_ages.join(", ")
                        : "All Ages";

                // Materials Generator
                const materialsContainer =
                    document.getElementById("modalMaterials");
                if (
                    act.materials &&
                    act.materials.length > 0 &&
                    act.materials[0].toLowerCase() !== "none"
                ) {
                    materialsContainer.innerHTML = act.materials
                        .map(
                            (m) =>
                                `<span class="bg-white dark:bg-slate-800 border-2 border-engDark text-engDark dark:text-white px-4 py-2 rounded-xl font-bold text-sm shadow-sm flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-engGreen"></i> ${m}</span>`,
                        )
                        .join("");
                } else {
                    materialsContainer.innerHTML = `<span class="bg-engGreen/20 border-2 border-engGreen text-engGreen px-4 py-2 rounded-xl font-bold text-sm shadow-sm flex items-center gap-2"><i data-lucide="smile" class="w-4 h-4"></i> No prep needed!</span>`;
                }

                // Steps Generator
                document.getElementById("modalSteps").innerHTML = act.steps
                    .map(
                        (step, i) => `
                                <li class="flex gap-5 items-start p-4 rounded-2xl bg-slate-50 dark:bg-slate-700/30 border-2 border-transparent hover:border-engDark/10 transition-colors">
                                    <span class="flex-shrink-0 w-10 h-10 rounded-xl bg-engPink text-white flex items-center justify-center font-headings font-bold text-lg border-4 border-engDark shadow-sm">${i + 1}</span>
                                    <span class="mt-1 text-lg leading-relaxed">${step}</span>
                                </li>
                            `,
                    )
                    .join("");

                document.getElementById("modalCopyBtn").onclick = () => {
                    const numberedText = act.steps
                        .map((step, index) => `${index + 1}. ${step}`)
                        .join("\n");
                    copyToClipboard(numberedText);
                };

                switchModalTab("steps");
                document.getElementById("guideModal").showModal();

                // 2. Lock the background scrolling
                document.body.style.overflow = "hidden";
                lucide.createIcons();
            }

            function closeModal() {
                document.getElementById("guideModal").close();
                // 3. Restore scrolling and exact position
                document.body.style.overflow = "auto";
                window.scrollTo(0, AppState.scrollPosition);
            }

            function openConfirmModal() {
                AppState.scrollPosition = window.scrollY;
                document.getElementById("confirmModal").showModal();
                document.body.style.overflow = "hidden";
            }

            function closeConfirmModal() {
                document.getElementById("confirmModal").close();
                document.body.style.overflow = "auto";
                window.scrollTo(0, AppState.scrollPosition);
            }

            function confirmClearLessonPlan() {
                AppState.lessonPlan = [];
                localStorage.setItem(
                    "lessonPlan",
                    JSON.stringify(AppState.lessonPlan),
                );
                updateLessonPlanUI();
                applyFilters();
                closeConfirmModal();
                showToast("Plan cleared", "trash-2");
            }

            // 4. Ensure clicking outside the modal also restores scroll
            document.querySelectorAll("dialog").forEach((dialog) => {
                dialog.addEventListener("click", (e) => {
                    if (e.target === dialog) {
                        dialog.close();
                        document.body.style.overflow = "auto";
                        if (AppState.scrollPosition !== undefined) {
                            window.scrollTo(0, AppState.scrollPosition);
                        }
                    }
                });
            });

            /**
             * 7. SEARCH & FILTERING CONTROLLER
             */
            function applyFilters() {
                const searchLower = AppState.currentSearch.toLowerCase();
                const filtered = AppState.activities.filter((act) => {
                    const matchesType =
                        AppState.currentFilter === "all" ||
                        act.type === AppState.currentFilter;
                    const matchesSearch =
                        act.title.toLowerCase().includes(searchLower) ||
                        (act.skills &&
                            act.skills.some((s) =>
                                s.toLowerCase().includes(searchLower),
                            ));
                    const matchesAge =
                        AppState.currentAgeFilter === "all" ||
                        (act.target_ages &&
                            act.target_ages.includes(
                                AppState.currentAgeFilter,
                            ));

                    return matchesType && matchesSearch && matchesAge;
                });
                renderActivities(filtered);
            }

            // Handles Energy/Type filter clicks
            function filterActivities(category) {
                AppState.currentFilter = category;
                document.querySelectorAll(".filter-btn").forEach((btn) => {
                    const text = btn.innerText.trim();
                    const isActive =
                        (category === "all" && text === "All") ||
                        (category !== "all" && text.includes(category + "s"));

                    if (isActive) {
                        btn.classList.replace("bg-engChalk", "bg-engDark");
                        btn.classList.replace("text-engDark", "text-white");
                    } else {
                        btn.classList.replace("bg-engDark", "bg-engChalk");
                        btn.classList.replace("text-white", "text-engDark");
                    }
                });
                applyFilters();
            }

            // Handles Age Dropdown changes
            function filterByAge(age) {
                AppState.currentAgeFilter = age;
                applyFilters();
            }

            DOM.searchInput.addEventListener("input", (e) => {
                AppState.currentSearch = e.target.value;
                applyFilters();
            });

            /**
             * 8. GLOBAL UTILITIES & EVENT LISTENERS
             */
            document.addEventListener("keydown", (e) => {
                const isTyping =
                    e.target.tagName === "INPUT" ||
                    e.target.tagName === "TEXTAREA";

                if (e.key === "Escape") {
                    if (isTyping) DOM.searchInput.blur();
                    return;
                }
                if (e.key === "/" && !isTyping) {
                    e.preventDefault();
                    DOM.searchInput.focus();
                }
                if (e.key.toLowerCase() === "l" && !isTyping) {
                    e.preventDefault();
                    const panel = document.getElementById("lessonPanel");
                    if (panel.classList.contains("hidden")) {
                        panel.classList.remove("hidden");
                    } else if (window.innerWidth < 1280) {
                        panel.classList.add("hidden");
                    }
                }
            });

            async function copyToClipboard(text) {
                try {
                    await navigator.clipboard.writeText(text);
                    showToast("Steps copied!", "check-circle");
                } catch (err) {
                    const textarea = document.createElement("textarea");
                    textarea.value = text;
                    textarea.style.position = "fixed";
                    textarea.style.left = "-9999px";
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand("copy");
                    document.body.removeChild(textarea);
                    showToast("Steps copied!", "check-circle");
                }
            }

            function showToast(message, iconName) {
                DOM.toastMsg.innerText = message;

                const isWarning = iconName === "trash-2" || iconName === "info";
                DOM.toastIcon.setAttribute("data-lucide", iconName);
                DOM.toastIcon.className = `w-6 h-6 ${isWarning ? "text-engOrange" : "text-engGreen"}`;
                lucide.createIcons();

                DOM.toast.classList.remove("hidden");
                DOM.toast.classList.add("toast-anim");

                clearTimeout(AppState.toastTimeout);
                AppState.toastTimeout = setTimeout(() => {
                    DOM.toast.classList.add("hidden");
                    DOM.toast.classList.remove("toast-anim");
                }, 2500);
            }

            function toggleTheme() {
                document.documentElement.classList.toggle("dark");
                localStorage.setItem(
                    "theme",
                    document.documentElement.classList.contains("dark")
                        ? "dark"
                        : "light",
                );
            }
        </script>
    </body>
</html>
