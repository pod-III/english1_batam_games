<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labeling Blitz - Class & Hallway Edition</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        e1pink: '#FF6B95',
                        e1orange: '#FF8C42',
                        e1green: '#00E676',
                        e1blue: '#2979FF',
                        e1dark: '#1e293b',
                        e1chalk: '#f8fafc',
                    },
                    fontFamily: {
                        fredoka: ['Fredoka', 'sans-serif'],
                        nunito: ['Nunito', 'sans-serif'],
                    },
                    boxShadow: {
                        'neo': '4px 4px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-lg': '8px 8px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-sm': '2px 2px 0px 0px rgba(30, 41, 59, 1)',
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        .dark body {
            background-color: #0f172a;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
        }

        .btn-neo { transition: all 0.1s ease-in-out; }
        .btn-neo:active { transform: translate(2px, 2px); box-shadow: 0px 0px 0px 0px rgba(30, 41, 59, 1); }

        .modal { transition: opacity 0.2s ease, visibility 0.2s ease; }
        .modal.hidden-modal { opacity: 0; visibility: hidden; pointer-events: none; }
        .modal.visible-modal { opacity: 1; visibility: visible; pointer-events: auto; }
        
        .timer-transition { transition: width 1s linear, background-color 0.5s ease; }
    </style>
</head>
<body class="font-nunito text-e1dark dark:text-white dark:bg-slate-900 min-h-screen flex flex-col overflow-hidden">

    <header class="p-4 flex justify-between items-center z-10">
        <div class="flex items-center gap-3">
            <div class="bg-e1orange border-4 border-e1dark p-2 rounded-xl shadow-neo">
                <i data-lucide="sticker" class="w-6 h-6 text-white"></i>
            </div>
            <h1 class="font-fredoka text-2xl font-bold hidden md:block">LABEL BLITZ</h1>
        </div>
        
        <div class="flex gap-3">
             <div class="flex items-center bg-white dark:bg-slate-800 border-4 border-e1dark rounded-xl shadow-neo overflow-hidden">
                <button onclick="adjustTime(-10)" class="px-3 py-2 hover:bg-slate-100 font-bold border-r-4 border-e1dark">-10</button>
                <span id="duration-display" class="px-4 font-fredoka font-bold text-xl">60s</span>
                <button onclick="adjustTime(10)" class="px-3 py-2 hover:bg-slate-100 font-bold border-l-4 border-e1dark">+10</button>
            </div>
            <button onclick="openSettings()" class="btn-neo bg-white dark:bg-slate-800 border-4 border-e1dark p-2 rounded-xl shadow-neo">
                <i data-lucide="settings" class="w-6 h-6"></i>
            </button>
        </div>
    </header>

    <main class="flex-grow flex flex-col items-center justify-center p-4 w-full max-w-6xl mx-auto">
        
        <div id="game-card" class="w-full bg-white dark:bg-slate-800 border-4 border-e1dark rounded-3xl shadow-neo-lg flex flex-col relative overflow-hidden transition-colors duration-300 min-h-[60vh]">
            
            <div class="absolute top-0 left-0 bg-e1dark text-white px-6 py-2 rounded-br-2xl z-10">
                <span class="font-fredoka font-bold tracking-wider">REMAINING: <span id="cards-left">0</span></span>
            </div>

            <div class="absolute top-4 right-4 animate-bounce-slow opacity-80 hidden" id="sticky-hint">
                <div class="bg-yellow-300 text-e1dark border-2 border-e1dark px-3 py-1 rounded-lg shadow-neo-sm transform rotate-3">
                    <span class="font-bold text-sm">STICK IT!</span>
                </div>
            </div>

            <div class="flex-grow flex flex-col items-center justify-center p-8 text-center z-0">
                <h2 id="prompt-display" class="font-fredoka text-5xl md:text-7xl font-bold leading-tight text-e1dark dark:text-white transition-all duration-300">
                    PRESS START
                </h2>
                <p id="sub-text" class="mt-4 text-xl text-slate-500 font-bold uppercase tracking-widest">TO BEGIN SESSION</p>
            </div>

            <div class="bg-slate-100 dark:bg-slate-900 border-t-4 border-e1dark p-0 relative h-24">
                <div class="absolute inset-0 w-full h-full bg-slate-200 dark:bg-slate-800"></div>
                <div id="timer-bar" class="absolute inset-0 h-full w-full bg-e1green timer-transition origin-left"></div>

                <div class="absolute inset-0 flex items-center justify-center z-20 px-4">
                    <button id="start-btn" onclick="startSession()" class="w-full h-full absolute inset-0 bg-e1green hover:bg-emerald-400 text-e1dark font-fredoka text-4xl font-bold tracking-wider flex items-center justify-center gap-4 transition-colors">
                        <i data-lucide="play" class="w-10 h-10"></i> START SESSION
                    </button>

                    <button id="next-btn" onclick="nextCard()" class="hidden w-full h-full absolute inset-0 bg-transparent hover:bg-white/10 active:bg-black/10 text-e1dark dark:text-white font-fredoka text-4xl font-bold tracking-wider flex items-center justify-center gap-4 group">
                        <span class="bg-white dark:bg-slate-800 border-4 border-e1dark px-8 py-2 rounded-xl shadow-neo group-hover:scale-105 transition-transform flex items-center gap-3">
                            NEXT CARD <i data-lucide="arrow-right" class="w-8 h-8"></i>
                        </span>
                    </button>

                    <div id="time-up-msg" class="hidden pointer-events-none flex flex-col items-center">
                        <span class="text-white font-black text-5xl drop-shadow-md stroke-black">TIME'S UP!</span>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <div id="settings-modal" class="modal hidden-modal fixed inset-0 bg-slate-900/80 z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 border-4 border-e1dark rounded-3xl shadow-neo-lg w-full max-w-2xl mx-4 p-6 flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-fredoka text-2xl font-bold">Edit Deck</h3>
                <button onclick="closeSettings()" class="bg-e1pink text-white border-4 border-e1dark p-2 rounded-xl shadow-neo"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <textarea id="custom-prompts-input" rows="10" class="w-full border-4 border-e1dark rounded-xl p-4 text-lg bg-slate-50 focus:ring-4 focus:ring-e1blue outline-none resize-y mb-4 font-nunito"></textarea>
            <div class="flex gap-4">
                <button onclick="saveSettings()" class="flex-grow btn-neo bg-e1blue text-white border-4 border-e1dark py-4 rounded-xl shadow-neo font-fredoka text-2xl font-bold">SAVE & SHUFFLE</button>
                <button onclick="resetDefaults()" class="btn-neo bg-e1orange text-white border-4 border-e1dark px-6 rounded-xl shadow-neo font-bold"><i data-lucide="rotate-ccw"></i></button>
            </div>
        </div>
    </div>

    <script>
        // --- EXPANDED B2 LIBRARY (Classroom + Hallway) ---
        const defaultPrompts = [
            // --- CLASSROOM OBJECTS ---
            "A device that projects images",
            "Something that requires electricity to function",
            "A container used for holding liquids",
            "An object made entirely of wood",
            "Something that is transparent but solid",
            "A tool used for measuring length",
            "Something that has a rough texture",
            "A surface used for writing on",
            "Something that creates artificial light",
            "An object with a hinge (opens and closes)",
            "Something that is lighter than a notebook",
            "A device used to control temperature",
            "Something that is made of fabric",
            "An object that connects to the internet",
            "Something that is used to store paper",
            
            // --- HALLWAY / OUTSIDE OBJECTS ---
            "A safety device used in emergencies (Red)",
            "A sign that gives a warning or instruction",
            "Something that guides people up or down (Stairs/Rail)",
            "A barrier that prevents falling",
            "A surface that is tiled or made of stone",
            "Something that dispenses water",
            "A receptacle for disposing of waste",
            "An entrance to another room or area",
            "Something that reflects your image",
            "A display board for public notices",
            "Something made of metal attached to a wall",
            "A source of natural light (Window/Skylight)",
            "Something that locks or secures an area",
            "A number indicating the floor or room",
            "Something that is permanently fixed to the floor"
        ];

        // --- STATE & DOM ---
        let deck = [];
        let gameDuration = 60;
        let timeLeft;
        let timerInterval;
        let isSessionActive = false;

        const els = {
            card: document.getElementById('game-card'),
            prompt: document.getElementById('prompt-display'),
            sub: document.getElementById('sub-text'),
            timerBar: document.getElementById('timer-bar'),
            startBtn: document.getElementById('start-btn'),
            nextBtn: document.getElementById('next-btn'),
            timeUpMsg: document.getElementById('time-up-msg'),
            cardsLeft: document.getElementById('cards-left'),
            durationDisplay: document.getElementById('duration-display'),
            settings: document.getElementById('settings-modal'),
            input: document.getElementById('custom-prompts-input'),
            stickyHint: document.getElementById('sticky-hint')
        };

        // --- INIT ---
        function init() {
            const savedData = localStorage.getItem('e1_blitz_data_v2');
            const savedTime = localStorage.getItem('e1_blitz_time');
            
            if (savedData) {
                deck = JSON.parse(savedData);
            } else {
                deck = [...defaultPrompts];
            }
            
            if (savedTime) gameDuration = parseInt(savedTime);
            
            shuffleDeck();
            updateUI();
            lucide.createIcons();
        }

        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // --- GAME LOGIC ---
        function startSession() {
            isSessionActive = true;
            els.startBtn.classList.add('hidden');
            els.nextBtn.classList.remove('hidden');
            els.stickyHint.classList.remove('hidden');
            nextCard();
        }

        function nextCard() {
            if (deck.length === 0) {
                // Reload defaults if empty
                deck = [...defaultPrompts]; 
                // Or if user had custom ones, we might need a backup variable, 
                // but for simplicity we reload defaults or current storage
                const savedData = localStorage.getItem('e1_blitz_data_v2');
                if(savedData) deck = JSON.parse(savedData);
                shuffleDeck();
            }

            const cardText = deck.pop();
            els.prompt.innerText = cardText;
            els.sub.innerText = "FIND AND LABEL IT!";
            els.cardsLeft.innerText = deck.length;

            // Visual Reset
            els.card.className = "w-full bg-white dark:bg-slate-800 border-4 border-e1dark rounded-3xl shadow-neo-lg flex flex-col relative overflow-hidden transition-colors duration-300 min-h-[60vh]";
            els.prompt.className = "font-fredoka text-5xl md:text-7xl font-bold leading-tight text-e1dark dark:text-white transition-all duration-300";
            els.sub.className = "mt-4 text-xl text-slate-500 font-bold uppercase tracking-widest";
            els.timeUpMsg.classList.add('hidden');

            resetTimer();
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timeLeft = gameDuration;
            updateTimerBar();

            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerBar();
                if (timeLeft <= 0) timeIsUp();
            }, 1000);
        }

        function updateTimerBar() {
            const pct = (timeLeft / gameDuration) * 100;
            els.timerBar.style.width = `${pct}%`;
            
            if (pct > 50) els.timerBar.className = 'absolute inset-0 h-full w-full bg-e1green timer-transition';
            else if (pct > 20) els.timerBar.className = 'absolute inset-0 h-full w-full bg-e1orange timer-transition';
            else els.timerBar.className = 'absolute inset-0 h-full w-full bg-e1pink timer-transition';
        }

        function timeIsUp() {
            clearInterval(timerInterval);
            els.card.className = "w-full bg-e1pink border-4 border-e1dark rounded-3xl shadow-neo-lg flex flex-col relative overflow-hidden transition-colors duration-300 min-h-[60vh]";
            els.prompt.className = "font-fredoka text-5xl md:text-7xl font-bold leading-tight text-white transition-all duration-300";
            els.sub.className = "mt-4 text-xl text-white font-bold uppercase tracking-widest";
            els.sub.innerText = "TIME IS UP";
            els.timeUpMsg.classList.remove('hidden');
        }

        // --- CONTROLS ---
        function adjustTime(val) {
            gameDuration += val;
            if (gameDuration < 5) gameDuration = 5;
            localStorage.setItem('e1_blitz_time', gameDuration);
            updateUI();
        }

        function updateUI() {
            els.durationDisplay.innerText = `${gameDuration}s`;
            els.cardsLeft.innerText = deck.length;
        }

        // --- SETTINGS ---
        function openSettings() {
            // Load current prompts (either from storage or defaults if storage empty)
            const currentData = localStorage.getItem('e1_blitz_data_v2');
            const dataToLoad = currentData ? JSON.parse(currentData) : defaultPrompts;
            
            els.input.value = dataToLoad.join('\n');
            els.settings.classList.remove('hidden-modal');
            els.settings.classList.add('visible-modal');
        }

        function closeSettings() {
            els.settings.classList.remove('visible-modal');
            els.settings.classList.add('hidden-modal');
        }

        function saveSettings() {
            const lines = els.input.value.split('\n').filter(l => l.trim() !== '');
            localStorage.setItem('e1_blitz_data_v2', JSON.stringify(lines));
            
            // Only update deck if we are NOT in middle of session to avoid jarring changes, 
            // or just update it for next draw.
            deck = [...lines];
            shuffleDeck();
            updateUI();
            closeSettings();
        }

        function resetDefaults() {
            els.input.value = defaultPrompts.join('\n');
        }

        init();
    </script>
</body>
</html>