<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Guess Who? | English 1 Batam</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Nunito:wght@200..900&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        e1pink: '#FF6B95',
                        e1orange: '#FF8C42',
                        e1green: '#00E676',
                        e1blue: '#2979FF',
                        e1dark: '#1e293b',
                        e1chalk: '#f8fafc',
                    },
                    fontFamily: {
                        fredoka: ['Fredoka', 'sans-serif'],
                        nunito: ['Nunito', 'sans-serif'],
                    },
                    boxShadow: {
                        'neobrutal': '6px 6px 0px 0px rgba(30, 41, 59, 1)',
                        'neobrutal-sm': '3px 3px 0px 0px rgba(30, 41, 59, 1)',
                        'neobrutal-inset': 'inset 4px 4px 0px 0px rgba(30, 41, 59, 0.1)',
                    }
                }
            }
        }
    </script>

    <style>
        .bg-graph-paper {
            background-color: #f8fafc;
            background-image:
                linear-gradient(#e2e8f0 1.5px, transparent 1.5px),
                linear-gradient(90deg, #e2e8f0 1.5px, transparent 1.5px);
            background-size: 32px 32px;
        }

        .perspective-1000 {
            perspective: 1000px;
        }

        .transform-style-3d {
            transform-style: preserve-3d;
        }

        .backface-hidden {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        /* Safari smooth scrolling */
        .overflow-y-auto {
            -webkit-overflow-scrolling: touch;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-left: 2px solid #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #FF6B95;
            border: 2px solid #1e293b;
            border-radius: 6px;
        }

        .btn-press:active {
            transform: translate(3px, 3px);
            box-shadow: 2px 2px 0px 0px rgba(30, 41, 59, 1);
        }

        @keyframes bounce-in {
            0% {
                transform: scale(0.95);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .animate-bounce-in {
            animation: bounce-in 0.3s ease-out;
        }
    </style>
</head>

<body
    class="bg-graph-paper font-nunito text-e1dark min-h-screen flex flex-col selection:bg-e1pink selection:text-white">

    <!-- Compact White Header -->
    <header class="bg-white border-b-4 border-e1dark py-3 px-4 md:px-6 sticky top-0 z-40 shadow-neobrutal">
        <div class="max-w-[1500px] mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-e1blue p-2 rounded-xl border-2 md:border-4 border-e1dark shadow-neobrutal-sm text-white">
                    <i data-lucide="scan-eye" class="w-5 h-5 md:w-7 md:h-7"></i>
                </div>
                <div>
                    <h1 class="font-fredoka text-xl md:text-3xl font-black text-e1dark tracking-tight uppercase">
                        Guess Who?
                    </h1>
                </div>
            </div>
            <div class="flex gap-2 md:gap-3">
                <button onclick="toggleInstructions()"
                    class="btn-press bg-white text-e1dark font-fredoka px-3 md:px-5 py-2 rounded-xl border-2 md:border-4 border-e1dark shadow-neobrutal flex items-center gap-2">
                    <i data-lucide="help-circle" class="w-4 h-4 text-e1blue"></i>
                    <span class="hidden sm:inline">Rules</span>
                </button>
                <button onclick="resetGame()"
                    class="btn-press bg-e1pink text-white font-fredoka px-3 md:px-5 py-2 rounded-xl border-2 md:border-4 border-e1dark shadow-neobrutal flex items-center gap-2">
                    <i data-lucide="refresh-ccw" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">Restart</span>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-[1500px] mx-auto w-full p-3 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-8">

        <!-- Sidebar - Compact for iPad -->
        <aside class="lg:col-span-3 flex flex-row lg:flex-col gap-4 order-2 lg:order-1 h-fit">

            <div
                class="bg-white border-4 border-e1dark rounded-[2rem] shadow-neobrutal p-4 relative overflow-hidden flex-1 lg:flex-none group">
                <div class="absolute top-0 left-0 w-full h-2 md:h-3 bg-e1blue border-b-2 md:border-b-4 border-e1dark">
                </div>

                <h2 class="font-fredoka text-lg md:text-xl font-black uppercase text-e1dark mb-2 mt-1 hidden lg:block">
                    My Card</h2>

                <div id="my-character-display"
                    class="bg-e1chalk border-2 md:border-4 border-e1dark border-dashed rounded-2xl p-2 md:p-4 flex items-center lg:flex-col justify-center min-h-[80px] lg:min-h-[180px] shadow-neobrutal-inset transition-colors group-hover:bg-blue-50">
                    <i data-lucide="user-search" class="w-8 h-8 text-gray-300"></i>
                </div>
            </div>

            <div
                class="bg-e1orange border-4 border-e1dark rounded-[2rem] shadow-neobrutal p-4 text-white text-center flex-1 lg:flex-none flex lg:flex-col items-center justify-between lg:justify-center gap-2">
                <p class="text-[10px] md:text-xs font-black uppercase tracking-widest opacity-90 leading-none">Left</p>
                <div
                    class="bg-white rounded-xl border-2 md:border-4 border-e1dark px-4 py-1 lg:py-2 shadow-neobrutal-sm">
                    <p id="remaining-count" class="text-2xl md:text-5xl font-fredoka font-black text-e1dark">24</p>
                </div>
                <div class="hidden lg:flex justify-center gap-1 mt-2">
                    <i data-lucide="users" class="w-4 h-4 opacity-80"></i>
                </div>
            </div>
        </aside>

        <!-- Game Grid - Optimized for iPad Landscape (6-8 cols) -->
        <section class="lg:col-span-9 order-1 lg:order-2">
            <div id="card-grid"
                class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 xl:grid-cols-8 gap-2 md:gap-3 lg:gap-4">
                <!-- Cards injected here -->
            </div>
        </section>

    </main>

    <!-- Modal: Pick Character -->
    <div id="pick-modal"
        class="fixed inset-0 z-50 flex items-center justify-center bg-e1dark/80 backdrop-blur-md p-2 md:p-4">
        <div
            class="bg-white border-4 border-e1dark rounded-[2rem] md:rounded-[3rem] shadow-neobrutal w-full max-w-6xl h-[90vh] flex flex-col overflow-hidden animate-bounce-in">
            <div
                class="bg-e1green p-4 md:p-6 border-b-4 border-e1dark flex justify-between items-center text-white shrink-0">
                <div class="flex items-center gap-2 md:gap-3">
                    <i data-lucide="fingerprint" class="w-6 h-6 md:w-8 md:h-8"></i>
                    <h3 class="font-fredoka text-xl md:text-3xl font-black uppercase tracking-tight">Pick Your Identity
                    </h3>
                </div>
            </div>

            <div class="p-4 md:p-8 overflow-y-auto flex-grow bg-graph-paper">
                <div id="pick-grid"
                    class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3 md:gap-6">
                    <!-- Options injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Instructions -->
    <div id="instructions-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-e1dark/60 backdrop-blur-sm p-4">
        <div
            class="bg-white border-4 border-e1dark rounded-[2.5rem] shadow-neobrutal w-full max-w-lg overflow-hidden animate-bounce-in">
            <div class="bg-e1blue p-5 border-b-4 border-e1dark flex justify-between items-center text-white">
                <h3 class="font-fredoka text-2xl font-black uppercase">How to Play</h3>
                <button onclick="closeModal('instructions-modal')"
                    class="p-2 border-2 border-transparent hover:border-white rounded-full">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="p-6 md:p-8 space-y-4 font-nunito text-base md:text-lg text-e1dark bg-e1chalk">
                <div class="flex gap-4 items-center">
                    <div
                        class="bg-e1pink text-white w-8 h-8 rounded-lg border-2 border-e1dark flex items-center justify-center shrink-0 font-fredoka font-bold">
                        1</div>
                    <p>Pick a character to hide.</p>
                </div>
                <div class="flex gap-4 items-center">
                    <div
                        class="bg-e1orange text-white w-8 h-8 rounded-lg border-2 border-e1dark flex items-center justify-center shrink-0 font-fredoka font-bold">
                        2</div>
                    <p>Ask <strong>Yes/No</strong> questions.</p>
                </div>
                <div class="flex gap-4 items-center">
                    <div
                        class="bg-e1green text-white w-8 h-8 rounded-lg border-2 border-e1dark flex items-center justify-center shrink-0 font-fredoka font-bold">
                        3</div>
                    <p><strong>Click cards</strong> to flip them down.</p>
                </div>
                <button onclick="closeModal('instructions-modal')"
                    class="w-full bg-e1dark text-white font-fredoka py-3 rounded-2xl border-4 border-white shadow-neobrutal-sm uppercase text-xl mt-4">
                    Got it!
                </button>
            </div>
        </div>
    </div>

    <script>
        const characters = [
            { id: 1, name: "Alex", gender: 'm' }, { id: 2, name: "Sarah", gender: 'f' },
            { id: 3, name: "Jordan", gender: 'm' }, { id: 4, name: "Emily", gender: 'f' },
            { id: 5, name: "Chris", gender: 'm' }, { id: 6, name: "Jessica", gender: 'f' },
            { id: 7, name: "Mike", gender: 'm' }, { id: 8, name: "Lisa", gender: 'f' },
            { id: 9, name: "David", gender: 'm' }, { id: 10, name: "Emma", gender: 'f' },
            { id: 11, name: "Tom", gender: 'm' }, { id: 12, name: "Anna", gender: 'f' },
            { id: 13, name: "Ryan", gender: 'm' }, { id: 14, name: "Chloe", gender: 'f' },
            { id: 15, name: "Sam", gender: 'm' }, { id: 16, name: "Kate", gender: 'f' },
            { id: 17, name: "Max", gender: 'm' }, { id: 18, name: "Olivia", gender: 'f' },
            { id: 19, name: "Ben", gender: 'm' }, { id: 20, name: "Sophie", gender: 'f' },
            { id: 21, name: "Daniel", gender: 'm' }, { id: 22, name: "Maya", gender: 'f' },
            { id: 23, name: "Jake", gender: 'm' }, { id: 24, name: "Ruby", gender: 'f' },
        ];

        let myCharacter = null;
        let eliminatedIds = new Set();

        function getAvatar(char) {
            // Note: If you convert images to WebP later, change the extension here
            return `./char/${char.name}.webp`;
        }

        function initGame() {
            eliminatedIds.clear();
            myCharacter = null;
            updateStats();
            renderGrid();     // Only runs ONCE now
            renderPickGrid(); // Only runs ONCE now
            document.getElementById('pick-modal').classList.remove('hidden');
            document.getElementById('my-character-display').innerHTML = `<i data-lucide="user-search" class="w-8 h-8 text-gray-300"></i>`;
            lucide.createIcons();
        }

        function startGame(characterId) {
            myCharacter = characters.find(c => c.id === characterId);
            document.getElementById('pick-modal').classList.add('hidden');
            const display = document.getElementById('my-character-display');
            const avatarUrl = getAvatar(myCharacter);
            const badgeBg = myCharacter.gender === 'm' ? 'bg-e1blue' : 'bg-e1pink';

            display.innerHTML = `
                <div class="flex lg:flex-col items-center gap-3 animate-bounce-in">
                    <div class="w-16 h-16 lg:w-24 lg:h-24 rounded-full border-2 md:border-4 border-e1dark bg-white overflow-hidden shadow-neobrutal-sm">
                        <img src="${avatarUrl}" alt="${myCharacter.name}" width="96" height="96" class="w-full h-full object-cover">
                    </div>
                    <div class="font-fredoka text-sm md:text-xl font-black ${badgeBg} text-white px-3 md:px-4 py-1 rounded-xl border-2 md:border-4 border-e1dark shadow-neobrutal-sm uppercase">
                        ${myCharacter.name}
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        function renderGrid() {
            const grid = document.getElementById('card-grid');
            grid.innerHTML = '';

            characters.forEach(char => {
                const accentColor = char.gender === 'm' ? 'bg-e1blue' : 'bg-e1pink';

                const card = document.createElement('div');
                // Removed 'cursor-pointer' if already eliminated logic is handled elsewhere, but kept for UI feel
                card.className = `relative h-36 md:h-44 w-full cursor-pointer perspective-1000 group select-none`;
                card.onclick = () => toggleEliminate(char.id);

                const flipper = document.createElement('div');
                flipper.id = `flipper-${char.id}`; // CRITICAL: Added ID for targeted updates
                flipper.className = `relative w-full h-full duration-500 transform-style-3d transition-all`;

                // Front Side
                const front = document.createElement('div');
                front.className = `absolute w-full h-full backface-hidden bg-white border-2 md:border-4 border-e1dark rounded-2xl md:rounded-3xl shadow-neobrutal-sm md:shadow-neobrutal flex flex-col items-center justify-between p-2 md:p-3 overflow-hidden transition-transform group-hover:-translate-y-1`;

                front.innerHTML = `
                    <div class="w-full h-full flex flex-col items-center justify-center">
                         <div class="w-14 h-14 md:w-20 md:h-20 mb-2 rounded-full border-2 md:border-4 border-e1dark bg-e1chalk overflow-hidden">
                            <img src="${getAvatar(char)}" alt="${char.name}" width="80" height="80" class="w-full h-full object-cover" loading="lazy">
                        </div>
                        <div class="font-fredoka text-[10px] md:text-base font-black ${accentColor} text-white px-2 py-0.5 rounded-lg md:rounded-xl border-2 md:border-4 border-e1dark w-full text-center truncate shadow-neobrutal-sm uppercase leading-tight">
                            ${char.name}
                        </div>
                    </div>
                `;

                // Back Side
                const back = document.createElement('div');
                back.className = `absolute w-full h-full backface-hidden rotate-y-180 bg-e1dark border-2 md:border-4 border-slate-600 rounded-2xl md:rounded-3xl flex flex-col items-center justify-center p-2`;
                back.innerHTML = `<div class="text-white/20"><i data-lucide="x-circle" class="w-8 h-8 md:w-12 md:h-12"></i></div>`;

                flipper.appendChild(front);
                flipper.appendChild(back);
                card.appendChild(flipper);
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        function renderPickGrid() {
            const grid = document.getElementById('pick-grid');
            grid.innerHTML = '';

            characters.forEach(char => {
                const btn = document.createElement('button');
                const accentCol = char.gender === 'm' ? 'text-e1blue' : 'text-e1pink';

                btn.className = "flex flex-col items-center p-2 md:p-4 bg-white border-2 md:border-4 border-e1dark rounded-2xl md:rounded-[2rem] shadow-neobrutal hover:bg-e1green/10 transition-all btn-press";
                btn.onclick = () => startGame(char.id);

                btn.innerHTML = `
                    <div class="w-16 h-16 md:w-24 md:h-24 mb-2 rounded-full border-2 md:border-4 border-e1dark bg-e1chalk overflow-hidden shadow-neobrutal-sm">
                         <img src="${getAvatar(char)}" width="96" height="96" class="w-full h-full object-cover" loading="lazy">
                    </div>
                    <span class="font-fredoka font-black text-xs md:text-xl uppercase ${accentCol}">${char.name}</span>
                `;
                grid.appendChild(btn);
            });
            lucide.createIcons();
        }

        function updateStats() {
            document.getElementById('remaining-count').innerText = characters.length - eliminatedIds.size;
        }

        function toggleEliminate(id) {
            // Logic Update
            if (eliminatedIds.has(id)) {
                eliminatedIds.delete(id);
                document.getElementById(`flipper-${id}`).classList.remove('rotate-y-180');
            } else {
                eliminatedIds.add(id);
                document.getElementById(`flipper-${id}`).classList.add('rotate-y-180');
            }
            // Removed expensive renderGrid() call
            updateStats();
        }

        function toggleInstructions() { document.getElementById('instructions-modal').classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function resetGame() { initGame(); }

        window.onload = function () {
            lucide.createIcons();
            initGame();
        };
    </script>
</body>

</html>