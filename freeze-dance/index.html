<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freeze Dance Ultimate | English 1 Batam</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        fredoka: ['Fredoka', 'sans-serif'],
                        nunito: ['Nunito', 'sans-serif'],
                    },
                    colors: {
                        e1pink: '#FF6B95',
                        e1orange: '#FF8C42',
                        e1green: '#00E676',
                        e1blue: '#2979FF',
                        e1dark: '#1e293b',
                        e1chalk: '#f8fafc',
                    },
                    boxShadow: {
                        'neo': '4px 4px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-hover': '6px 6px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-sm': '2px 2px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-pressed': '0px 0px 0px 0px rgba(30, 41, 59, 1)',
                    },
                    animation: {
                        'bounce-slight': 'bounce-slight 2s infinite',
                        'pop-in': 'pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                    },
                    keyframes: {
                        'bounce-slight': {
                            '0%, 100%': { transform: 'translateY(-5%)' },
                            '50%': { transform: 'translateY(0)' },
                        },
                        'pop-in': {
                            '0%': { transform: 'scale(0.5)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* GRAPH PAPER BACKGROUND */
        body {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.05) 1px, transparent 1px), 
                linear-gradient(90deg, rgba(30, 41, 59, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* UTILITIES */
        body::-webkit-scrollbar { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Smooth Transition for Game Stage */
        .stage-transition { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }

        /* Animation Delays */
        .delay-100 { animation-delay: 100ms; }
        .delay-200 { animation-delay: 200ms; }
        
        /* Number Input Reset */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden text-e1dark font-nunito flex flex-col">

    <header id="app-header" class="bg-white border-b-4 border-e1dark px-6 py-4 flex justify-between items-center z-50 transition-transform duration-500 shadow-sm">
        <div class="flex items-center gap-3">
            <div class="bg-e1blue text-white p-2 rounded-lg border-2 border-e1dark shadow-neo-sm transform hover:rotate-12 transition-transform">
                <i data-lucide="music" class="w-6 h-6"></i>
            </div>
            <h1 class="font-fredoka text-2xl font-bold tracking-wide">Freeze<span class="text-e1pink">Dance</span></h1>
        </div>
        <div class="hidden md:flex gap-2">
             <div class="font-bold bg-e1chalk border-2 border-e1dark px-4 py-1 rounded-full text-slate-500 text-xs uppercase shadow-neo-sm">
                <i data-lucide="settings" class="w-3 h-3 inline mr-1"></i> Custom Timing
            </div>
        </div>
    </header>

    <main class="flex-1 flex gap-6 p-6 max-w-7xl mx-auto w-full h-full relative">
        
        <aside id="panel-controls" class="w-96 bg-white border-4 border-e1dark rounded-2xl shadow-neo flex flex-col transition-all duration-500 z-40 overflow-hidden">
            
            <div class="p-5 border-b-2 border-slate-100 bg-slate-50 flex justify-between items-center">
                <h2 class="font-fredoka text-xl font-bold flex items-center gap-2 text-e1dark">
                    <i data-lucide="sliders-horizontal" class="w-5 h-5 text-e1orange"></i> Controls
                </h2>
                <div class="text-[10px] font-bold text-e1green bg-green-100 px-2 py-1 rounded-full border border-e1green">
                    Auto-Saved
                </div>
            </div>
            
            <div class="p-5 overflow-y-auto space-y-6 flex-1 no-scrollbar">
                
                <div class="group">
                    <label class="font-black text-slate-400 text-xs uppercase mb-2 block tracking-wider">1. Music Source</label>
                    <div class="relative">
                        <input type="file" id="file-input" accept="audio/*,video/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                        <div class="w-full bg-e1chalk group-hover:bg-slate-100 text-e1dark font-fredoka font-bold py-3 px-4 rounded-xl border-2 border-dashed border-e1dark transition-all flex justify-center items-center gap-2 shadow-sm">
                            <i data-lucide="upload-cloud" class="w-5 h-5 text-e1blue"></i> 
                            <span id="file-label">Upload Video/Audio</span>
                        </div>
                    </div>
                    <div id="file-meta" class="hidden mt-2 flex justify-between items-center px-1">
                        <span id="file-name-display" class="text-xs font-bold text-e1green truncate max-w-[200px]">Song Name</span>
                        <span id="file-duration-display" class="text-[10px] font-bold bg-slate-200 text-slate-500 px-2 py-0.5 rounded">0:00</span>
                    </div>
                </div>

                <div class="bg-blue-50/50 p-3 rounded-xl border-2 border-blue-100">
                    <label class="font-black text-e1blue text-xs uppercase mb-2 block tracking-wider">2. Dance Interval (Sec)</label>
                    <div class="flex gap-2">
                        <div class="flex-1">
                            <span class="text-[10px] font-bold text-slate-400 block mb-1">MIN</span>
                            <input type="number" id="dance-min" value="10" min="5" max="60" onchange="game.saveSettings()"
                                class="w-full text-center font-fredoka text-lg font-bold bg-white border-2 border-e1dark rounded-lg py-1.5 focus:outline-none focus:ring-2 focus:ring-e1blue shadow-sm">
                        </div>
                        <div class="flex-1">
                            <span class="text-[10px] font-bold text-slate-400 block mb-1">MAX</span>
                            <input type="number" id="dance-max" value="25" min="5" max="120" onchange="game.saveSettings()"
                                class="w-full text-center font-fredoka text-lg font-bold bg-white border-2 border-e1dark rounded-lg py-1.5 focus:outline-none focus:ring-2 focus:ring-e1blue shadow-sm">
                        </div>
                    </div>
                </div>

                <div class="bg-pink-50/50 p-3 rounded-xl border-2 border-pink-100 grid grid-cols-2 gap-3">
                    <div class="col-span-2">
                        <label class="font-black text-e1pink text-xs uppercase block tracking-wider">3. Freeze Time (Sec)</label>
                    </div>
                    <div>
                        <span class="text-[10px] font-bold text-slate-400 block mb-1">MIN FREEZE</span>
                        <input type="number" id="freeze-min" value="3" min="1" max="10" onchange="game.saveSettings()"
                            class="w-full text-center font-fredoka text-lg font-bold bg-white border-2 border-e1dark rounded-lg py-1.5 focus:outline-none focus:ring-2 focus:ring-e1pink shadow-sm">
                    </div>
                    <div>
                        <span class="text-[10px] font-bold text-slate-400 block mb-1">MAX FREEZE</span>
                        <input type="number" id="freeze-max" value="6" min="1" max="15" onchange="game.saveSettings()"
                            class="w-full text-center font-fredoka text-lg font-bold bg-white border-2 border-e1dark rounded-lg py-1.5 focus:outline-none focus:ring-2 focus:ring-e1pink shadow-sm">
                    </div>
                    <div class="col-span-2 pt-2 border-t border-pink-200 mt-1">
                        <div class="flex justify-between items-center">
                            <span class="text-[10px] font-bold text-slate-500 uppercase">Warning Time (Sec)</span>
                            <input type="number" id="warning-time" value="4" min="0" max="10" onchange="game.saveSettings()"
                                class="w-16 text-center font-fredoka text-sm font-bold bg-white border-2 border-e1dark rounded-lg py-1 focus:outline-none focus:ring-2 focus:ring-e1orange shadow-sm">
                        </div>
                    </div>
                </div>

                <div class="bg-e1chalk/50 p-3 rounded-xl border-2 border-e1dark/20">
                    <label class="font-black text-slate-500 text-xs uppercase mb-2 block tracking-wider">4. Student Spotlight</label>
                    <div class="flex gap-2 mb-3">
                        <input type="text" id="student-input" placeholder="Name + Enter" 
                            class="w-full px-3 py-2 rounded-lg border-2 border-e1dark font-bold text-sm focus:outline-none focus:ring-2 focus:ring-e1green transition-all shadow-neo-sm"
                            onkeypress="game.handleInput(event)">
                        <button onclick="game.addStudent()" class="bg-e1green text-white p-2 rounded-lg border-2 border-e1dark shadow-neo-sm active:translate-y-1 active:shadow-none transition-transform">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <div id="student-list" class="flex flex-wrap gap-2 max-h-24 overflow-y-auto content-start pr-1">
                        </div>
                </div>

            </div>

            <div class="p-5 mt-auto border-t-2 border-slate-100 bg-white">
                <button id="btn-start" onclick="game.toggle()" disabled 
                    class="w-full bg-slate-200 text-slate-400 font-fredoka font-bold py-4 rounded-xl border-2 border-e1dark shadow-none transition-all flex justify-center items-center gap-2 text-lg cursor-not-allowed">
                    <i data-lucide="play-circle"></i> Waiting for media...
                </button>
            </div>
        </aside>

        <section id="panel-game" class="flex-1 bg-white border-4 border-e1dark rounded-2xl shadow-neo relative overflow-hidden flex flex-col items-center justify-center p-4 stage-transition">
            
            <video id="media-player" playsinline class="hidden"></video>

            <div class="text-center z-10 relative w-full flex flex-col items-center">
                <div id="status-emoji" class="text-8xl mb-4 filter drop-shadow-md transition-transform duration-300 animate-bounce-slight">ðŸ‘‹</div>
                <h2 id="status-text" class="font-fredoka text-6xl md:text-8xl font-black tracking-tighter text-e1dark uppercase drop-shadow-sm transition-all duration-200 leading-none">
                    HELLO!
                </h2>
                <p id="sub-text" class="text-xl font-bold text-slate-400 mt-6 bg-white/80 px-4 py-1 rounded-full backdrop-blur-sm border-2 border-transparent transition-all">
                    Upload a file to begin
                </p>

                <div id="spotlight-container" class="mt-8 flex flex-col gap-4 items-center min-h-[120px] justify-center perspective-1000">
                    </div>
            </div>

            <button onclick="game.stop()" id="btn-stop-float"
                class="absolute bottom-12 bg-e1pink text-white font-fredoka font-bold py-3 px-10 rounded-full border-4 border-white shadow-lg transform translate-y-60 transition-transform duration-500 hover:scale-105 active:scale-95 flex items-center gap-2 z-50">
                <i data-lucide="square" class="fill-current"></i> STOP GAME
            </button>

            <div class="absolute inset-0 opacity-10 pointer-events-none bg-[radial-gradient(#1e293b_2px,transparent_2px)] [background-size:24px_24px]"></div>
        </section>

    </main>

    <script>
        class FreezeDanceGame {
            constructor() {
                this.state = {
                    isRunning: false,
                    isFrozen: false,
                    students: [],
                    timer: null
                };

                // DOM Elements Maps
                this.els = {
                    fileInput: document.getElementById('file-input'),
                    fileLabel: document.getElementById('file-label'),
                    fileMeta: document.getElementById('file-meta'),
                    fileName: document.getElementById('file-name-display'),
                    
                    player: document.getElementById('media-player'),
                    startBtn: document.getElementById('btn-start'),
                    stopBtn: document.getElementById('btn-stop-float'),
                    
                    controls: document.getElementById('panel-controls'),
                    gamePanel: document.getElementById('panel-game'),
                    header: document.getElementById('app-header'),
                    
                    emoji: document.getElementById('status-emoji'),
                    mainText: document.getElementById('status-text'),
                    subText: document.getElementById('sub-text'),
                    spotlight: document.getElementById('spotlight-container'),
                    
                    studentInput: document.getElementById('student-input'),
                    studentList: document.getElementById('student-list'),
                    
                    inputs: {
                        danceMin: document.getElementById('dance-min'),
                        danceMax: document.getElementById('dance-max'),
                        freezeMin: document.getElementById('freeze-min'),
                        freezeMax: document.getElementById('freeze-max'),
                        warning: document.getElementById('warning-time')
                    }
                };

                this.initListeners();
                this.loadSettings();
            }

            /* --- LOCAL STORAGE PERSISTENCE --- */
            saveSettings() {
                const settings = {
                    danceMin: this.els.inputs.danceMin.value,
                    danceMax: this.els.inputs.danceMax.value,
                    freezeMin: this.els.inputs.freezeMin.value,
                    freezeMax: this.els.inputs.freezeMax.value,
                    warning: this.els.inputs.warning.value,
                    students: this.state.students
                };
                localStorage.setItem('freezeDanceSettings', JSON.stringify(settings));
            }

            loadSettings() {
                const saved = localStorage.getItem('freezeDanceSettings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    if(settings.danceMin) this.els.inputs.danceMin.value = settings.danceMin;
                    if(settings.danceMax) this.els.inputs.danceMax.value = settings.danceMax;
                    if(settings.freezeMin) this.els.inputs.freezeMin.value = settings.freezeMin;
                    if(settings.freezeMax) this.els.inputs.freezeMax.value = settings.freezeMax;
                    if(settings.warning) this.els.inputs.warning.value = settings.warning;
                    if(settings.students) {
                        this.state.students = settings.students;
                        this.renderStudents();
                    }
                } else {
                    this.renderStudents(); // render empty state
                }
            }

            /* --- INITIALIZATION --- */
            initListeners() {
                this.els.fileInput.addEventListener('change', (e) => this.handleFileUpload(e));
                
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && this.els.player.src && document.activeElement !== this.els.studentInput) {
                        e.preventDefault();
                        if (!this.state.isRunning) this.toggle();
                        else this.manualOverride();
                    }
                });
            }

            /* --- UI MANAGMENT --- */
            handleFileUpload(e) {
                const file = e.target.files[0];
                if (!file) return;

                this.els.player.src = URL.createObjectURL(file);
                this.els.player.load();

                this.els.fileLabel.innerText = "Change Source";
                this.els.fileName.innerText = file.name;
                this.els.fileMeta.classList.remove('hidden');

                this.els.startBtn.disabled = false;
                this.els.startBtn.classList.remove('bg-slate-200', 'text-slate-400', 'cursor-not-allowed', 'shadow-none');
                this.els.startBtn.classList.add('bg-e1green', 'text-white', 'hover:bg-green-400', 'shadow-neo', 'active:translate-y-1', 'active:shadow-none');
                this.els.startBtn.innerHTML = '<i data-lucide="play" class="fill-current"></i> START GAME';
                lucide.createIcons();

                this.els.mainText.innerText = "READY?";
                this.els.subText.innerText = "Press Start to begin!";
            }

            /* --- STUDENT MANAGEMENT --- */
            handleInput(e) { if (e.key === 'Enter') this.addStudent(); }

            addStudent() {
                const val = this.els.studentInput.value.trim();
                if (!val) return;
                this.state.students.push(val);
                this.els.studentInput.value = '';
                this.renderStudents();
                this.saveSettings();
            }

            removeStudent(index) {
                this.state.students.splice(index, 1);
                this.renderStudents();
                this.saveSettings();
            }

            renderStudents() {
                this.els.studentList.innerHTML = '';
                if (this.state.students.length === 0) {
                    this.els.studentList.innerHTML = '<div class="text-xs text-slate-400 font-bold w-full text-center py-4 border-2 border-dashed border-slate-300 rounded-lg">Roster is empty</div>';
                    return;
                }
                
                this.state.students.forEach((name, i) => {
                    const tag = document.createElement('div');
                    tag.className = "bg-white border-2 border-e1dark px-3 py-1 rounded-full text-xs font-bold flex items-center gap-2 shadow-sm animate-pop-in hover:bg-slate-50";
                    tag.innerHTML = `
                        ${name}
                        <button onclick="game.removeStudent(${i})" class="text-e1pink hover:bg-e1pink hover:text-white rounded-full p-0.5 transition-colors">
                            <i data-lucide="x" class="w-3 h-3"></i>
                        </button>`;
                    this.els.studentList.appendChild(tag);
                });
                lucide.createIcons();
            }

            /* --- GAME ENGINE --- */
            toggle() {
                if (this.state.isRunning) this.stop();
                else this.start();
            }

            start() {
                if (!this.els.player.src) return;
                this.state.isRunning = true;

                // Enter Immersive Mode
                this.els.controls.style.marginLeft = "-25rem"; 
                this.els.header.style.transform = "translateY(-150%)"; 
                
                this.els.gamePanel.classList.remove('border-4', 'rounded-2xl');
                this.els.gamePanel.classList.add('fixed', 'inset-0', 'z-50', 'rounded-none');
                
                this.els.stopBtn.style.transform = "translateY(0)";

                this.runDance();
            }

            stop() {
                this.state.isRunning = false;
                clearTimeout(this.state.timer);
                this.els.player.pause();

                // Exit Immersive Mode
                this.els.controls.style.marginLeft = "0";
                this.els.header.style.transform = "translateY(0)";
                
                this.els.gamePanel.classList.add('border-4', 'rounded-2xl');
                this.els.gamePanel.classList.remove('fixed', 'inset-0', 'z-50', 'rounded-none', 'bg-e1green', 'bg-e1pink', 'bg-e1orange');
                this.els.gamePanel.classList.add('bg-white');

                this.els.stopBtn.style.transform = "translateY(150px)";

                this.els.emoji.innerText = "ðŸ˜Œ";
                this.els.mainText.innerText = "PAUSED";
                this.els.mainText.className = "font-fredoka text-6xl md:text-8xl font-black tracking-tighter text-e1dark uppercase drop-shadow-sm transition-all duration-200 leading-none";
                
                this.els.subText.innerText = "Good Game!";
                this.els.subText.className = "text-xl font-bold text-slate-400 mt-6 bg-white/80 px-4 py-1 rounded-full border-2 border-transparent transition-all";
                
                this.els.spotlight.innerHTML = "";
                this.els.startBtn.innerHTML = '<i data-lucide="rotate-ccw"></i> RESUME GAME';
                lucide.createIcons();
            }

            /* --- LOGIC TIMERS --- */
            getVal(id) {
                return parseInt(this.els.inputs[id].value) || 0;
            }

            runDance() {
                if (!this.state.isRunning) return;
                this.state.isFrozen = false;
                
                this.els.gamePanel.className = "fixed inset-0 z-50 rounded-none stage-transition bg-e1green flex flex-col items-center justify-center p-4";
                this.els.emoji.innerText = "ðŸ’ƒ";
                this.els.mainText.innerText = "DANCE!";
                this.els.mainText.classList.add('text-white', 'drop-shadow-lg');
                this.els.mainText.classList.remove('text-e1dark');
                
                this.els.subText.innerText = "Keep moving!";
                this.els.subText.className = "text-xl font-bold text-e1green mt-6 bg-white px-6 py-2 rounded-full shadow-neo-sm border-2 border-e1dark";

                this.els.spotlight.innerHTML = "";
                this.els.player.play();

                // Calculate random dance duration
                const minSec = this.getVal('danceMin');
                const maxSec = Math.max(minSec, this.getVal('danceMax')); // Fallback to min if max is lower
                
                const minMs = minSec * 1000;
                const maxMs = maxSec * 1000;
                let nextStopMs = Math.floor(Math.random() * (maxMs - minMs + 1) + minMs);

                const warningMs = this.getVal('warning') * 1000;

                // Fire warning phase if students exist and time allows
                if (this.state.students.length > 0 && warningMs > 0 && nextStopMs > warningMs + 2000) {
                    this.state.timer = setTimeout(() => this.runWarning(), nextStopMs - warningMs);
                } else {
                    this.state.timer = setTimeout(() => this.runFreeze(null), nextStopMs);
                }
            }

            runWarning() {
                if (!this.state.isRunning) return;

                this.els.gamePanel.className = "fixed inset-0 z-50 rounded-none stage-transition bg-e1orange flex flex-col items-center justify-center p-4";
                this.els.emoji.innerText = "âš ï¸";
                this.els.mainText.innerText = "GET READY...";
                this.els.subText.innerText = "Someone is about to freeze!";
                this.els.subText.className = "text-xl font-bold text-e1orange mt-6 bg-white px-6 py-2 rounded-full shadow-neo-sm border-2 border-e1dark";

                const count = Math.min(this.state.students.length, 3);
                const numToPick = Math.floor(Math.random() * count) + 1;
                
                const shuffled = [...this.state.students].sort(() => 0.5 - Math.random());
                const picked = shuffled.slice(0, numToPick);

                this.els.spotlight.innerHTML = "";
                picked.forEach((name, i) => {
                    const delayClass = i === 1 ? 'delay-100' : (i === 2 ? 'delay-200' : '');
                    const rot = (Math.random() * 6) - 3;
                    
                    const card = document.createElement('div');
                    card.className = `bg-white border-4 border-e1dark px-10 py-4 rounded-2xl shadow-neo transform animate-pop-in ${delayClass}`;
                    card.style.transform = `rotate(${rot}deg)`;
                    card.innerHTML = `<span class="text-4xl md:text-5xl font-black text-e1blue font-fredoka tracking-wide">${name}</span>`;
                    
                    this.els.spotlight.appendChild(card);
                });

                const warningMs = this.getVal('warning') * 1000;
                this.state.timer = setTimeout(() => this.runFreeze(picked), warningMs);
            }

            runFreeze(victims) {
                if (!this.state.isRunning) return;
                this.state.isFrozen = true;

                this.els.gamePanel.className = "fixed inset-0 z-50 rounded-none stage-transition bg-e1pink flex flex-col items-center justify-center p-4";
                this.els.emoji.innerText = "ðŸ¥¶";
                this.els.mainText.innerText = "FREEZE!";
                
                if (victims && victims.length > 0) {
                    const names = victims.join(" & ");
                    this.els.subText.innerText = `${names} must freeze!`;
                } else {
                    this.els.subText.innerText = "Don't move a muscle!";
                }
                this.els.subText.className = "text-xl font-bold text-e1pink mt-6 bg-white px-6 py-2 rounded-full shadow-neo-sm border-2 border-e1dark";

                this.els.player.pause();

                const minSec = this.getVal('freezeMin');
                const maxSec = Math.max(minSec, this.getVal('freezeMax'));
                const freezeMs = Math.floor(Math.random() * ((maxSec - minSec) + 1) + minSec) * 1000;

                this.state.timer = setTimeout(() => this.runDance(), freezeMs);
            }

            manualOverride() {
                clearTimeout(this.state.timer);
                if (this.state.isFrozen) this.runDance();
                else this.runFreeze();
            }
        }

        const game = new FreezeDanceGame();
        lucide.createIcons();
    </script>
</body>
</html>