<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English 1 Modular Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;600;700;800&family=Patrick+Hand&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            pink: '#FF6B95',
                            orange: '#FF8C42',
                            green: '#00E676',
                            blue: '#2979FF',
                            dark: '#1e293b',
                            chalk: '#f8fafc',
                            yellow: '#FCD34D'
                        }
                    },
                    fontFamily: {
                        heading: ['Fredoka', 'sans-serif'],
                        body: ['Nunito', 'sans-serif'],
                        hand: ['Patrick Hand', 'cursive'],
                    },
                    boxShadow: {
                        'neo': '4px 4px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-sm': '2px 2px 0px 0px rgba(30, 41, 59, 1)',
                        'neo-pressed': '0px 0px 0px 0px rgba(30, 41, 59, 1)',
                    },
                    gridTemplateColumns: {
                        '24': 'repeat(24, minmax(0, 1fr))',
                    },
                    backgroundImage: {
                        'stripes-white': 'repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px)',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="./styles.css">
</head>

<body class="bg-slate-100 h-screen w-full flex overflow-hidden font-body text-brand-dark">

    <!-- SIDEBAR: MODULE MANAGER -->
    <aside class="w-[380px] bg-white border-r-2 border-slate-300 flex flex-col h-full z-20 shadow-xl no-print shrink-0">

        <!-- 1. Header -->
        <div class="p-4 bg-brand-dark text-white shrink-0 flex justify-between items-center shadow-md z-20">
            <div class="flex items-center gap-2">
                <div class="bg-brand-blue p-1.5 rounded-lg border border-white/20">
                    <i data-lucide="layout" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                    <h1 class="font-heading text-lg font-bold leading-none">Poster Studio</h1>
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">English 1 Batam</p>
                </div>
            </div>
            <div class="flex gap-1">
                <button
                    onclick="confirmAction('Reset Default', 'Are you sure you want to reset to the A1 template?', resetTemplate, 'reset')"
                    class="p-1.5 hover:bg-white/10 rounded transition" title="Reset Default">
                    <i data-lucide="rotate-ccw" class="w-4 h-4 text-white/70 hover:text-white"></i>
                </button>
                <button
                    onclick="confirmAction('Clear Workspace', 'This will remove all blocks. Continue?', clearAll, 'delete')"
                    class="p-1.5 hover:bg-red-500/20 rounded transition group" title="Clear All">
                    <i data-lucide="trash" class="w-4 h-4 text-brand-pink group-hover:text-red-400"></i>
                </button>
            </div>
        </div>

        <!-- 2. Toolbox (Add Blocks) -->
        <div class="p-3 bg-slate-50 border-b border-slate-200 shrink-0 z-10">
            <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 px-1">Toolbox</h3>
            <div class="grid grid-cols-2 gap-2">
                <!-- Vocab -->
                <button onclick="addModule('vocab')"
                    class="flex items-center gap-2 p-2 bg-white border-2 border-slate-200 rounded-lg hover:border-brand-green hover:shadow-sm hover:-translate-y-0.5 transition-all group">
                    <div
                        class="bg-brand-green/10 p-1.5 rounded-md text-brand-green group-hover:bg-brand-green group-hover:text-white transition-colors">
                        <i data-lucide="list" class="w-4 h-4"></i>
                    </div>
                    <div class="text-left">
                        <span class="block text-xs font-bold text-slate-700">Vocabulary</span>
                        <span class="block text-[9px] text-slate-400">Bullet lists</span>
                    </div>
                </button>

                <!-- Logic -->
                <button onclick="addModule('grammar_logic')"
                    class="flex items-center gap-2 p-2 bg-white border-2 border-slate-200 rounded-lg hover:border-brand-blue hover:shadow-sm hover:-translate-y-0.5 transition-all group">
                    <div
                        class="bg-brand-blue/10 p-1.5 rounded-md text-brand-blue group-hover:bg-brand-blue group-hover:text-white transition-colors">
                        <i data-lucide="zap" class="w-4 h-4"></i>
                    </div>
                    <div class="text-left">
                        <span class="block text-xs font-bold text-slate-700">Logic</span>
                        <span class="block text-[9px] text-slate-400">Rules & Formulas</span>
                    </div>
                </button>

                <!-- Structure -->
                <button onclick="addModule('grammar_structure')"
                    class="flex items-center gap-2 p-2 bg-white border-2 border-slate-200 rounded-lg hover:border-brand-pink hover:shadow-sm hover:-translate-y-0.5 transition-all group">
                    <div
                        class="bg-brand-pink/10 p-1.5 rounded-md text-brand-pink group-hover:bg-brand-pink group-hover:text-white transition-colors">
                        <i data-lucide="blocks" class="w-4 h-4"></i>
                    </div>
                    <div class="text-left">
                        <span class="block text-xs font-bold text-slate-700">Structure</span>
                        <span class="block text-[9px] text-slate-400">Sentence Building</span>
                    </div>
                </button>

                <!-- Text -->
                <button onclick="addModule('text')"
                    class="flex items-center gap-2 p-2 bg-white border-2 border-slate-200 rounded-lg hover:border-brand-orange hover:shadow-sm hover:-translate-y-0.5 transition-all group">
                    <div
                        class="bg-brand-orange/10 p-1.5 rounded-md text-brand-orange group-hover:bg-brand-orange group-hover:text-white transition-colors">
                        <i data-lucide="message-square" class="w-4 h-4"></i>
                    </div>
                    <div class="text-left">
                        <span class="block text-xs font-bold text-slate-700">Dialogue</span>
                        <span class="block text-[9px] text-slate-400">Q&A / Text</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- 3. Layer List -->
        <div class="flex-1 overflow-hidden flex flex-col bg-slate-50/30">
            <div
                class="px-4 py-2 flex justify-between items-center border-b border-slate-100 bg-white/50 backdrop-blur-sm sticky top-0 z-10">
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Layers</span>
                <span class="text-[10px] font-bold text-slate-300" id="layer-count">0 items</span>
            </div>

            <div id="module-list" class="flex-1 overflow-y-auto p-3 space-y-2 pb-10 custom-scrollbar">
                <!-- Modules injected here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state"
                class="hidden absolute inset-0 top-[280px] flex flex-col items-center justify-start text-slate-400 p-6 text-center pointer-events-none">
                <div class="bg-slate-100 p-3 rounded-full mb-2">
                    <i data-lucide="layout-template" class="w-6 h-6 opacity-50"></i>
                </div>
                <p class="font-heading font-bold text-slate-500 text-sm">No Blocks Added</p>
                <p class="text-[10px] mt-1 max-w-[150px]">Use the toolbox above to add content to your poster.</p>
            </div>
        </div>

        <!-- 4. Properties Panel (Dynamic) -->
        <div id="properties-panel"
            class="h-[340px] bg-white border-t-4 border-slate-200 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] z-30 flex flex-col transition-all">

            <!-- A. Global Settings (Shown when nothing selected) -->
            <div id="global-settings" class="flex-1 flex flex-col">
                <div class="p-3 bg-slate-50 border-b border-slate-200 flex items-center gap-2">
                    <i data-lucide="globe" class="w-4 h-4 text-slate-400"></i>
                    <span class="text-xs font-bold text-slate-600 uppercase">Global Settings</span>
                </div>
                <div class="p-4 space-y-4 overflow-y-auto">
                    <div class="grid grid-cols-3 gap-2">
                        <div class="col-span-1">
                            <label class="editor-label">Badge</label>
                            <input type="text" id="global_badge" class="editor-input py-1 text-center" value="Week 1"
                                oninput="updateGlobal()">
                        </div>
                        <div class="col-span-2">
                            <label class="editor-label">Main Title</label>
                            <input type="text" id="global_title" class="editor-input py-1" value="ENGLISH CLASS"
                                oninput="updateGlobal()">
                        </div>
                    </div>
                    <div>
                        <label class="editor-label">Subtitle</label>
                        <input type="text" id="global_subtitle" class="editor-input py-1"
                            value="Vocabulary • Grammar • Speaking" oninput="updateGlobal()">
                    </div>
                    <div class="pt-4 border-t border-slate-100">
                        <button onclick="window.print()"
                            class="w-full bg-brand-dark text-white font-heading font-bold py-3 rounded-xl border-2 border-slate-900 shadow-neo hover:translate-y-[2px] hover:shadow-neo-sm active:translate-y-[4px] active:shadow-neo-pressed transition-all flex items-center justify-center gap-2">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>Save PDF</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- B. Block Editor (Shown when block selected) -->
            <div id="block-editor" class="flex-1 flex flex-col hidden">
                <div class="p-2 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                    <div class="flex items-center gap-2 px-2">
                        <span class="w-2 h-2 rounded-full bg-brand-blue animate-pulse"></span>
                        <span class="text-xs font-bold text-brand-blue uppercase">Edit Block</span>
                    </div>
                    <button onclick="closeEditor()"
                        class="flex items-center gap-1 text-[10px] font-bold text-slate-500 hover:text-brand-dark bg-white border border-slate-200 px-2 py-1 rounded-lg transition-all">
                        <i data-lucide="check" class="w-3 h-3"></i> Done
                    </button>
                </div>
                <div id="editor-fields" class="p-4 space-y-4 overflow-y-auto">
                    <!-- Fields injected here -->
                </div>
            </div>

        </div>
    </aside>

    <!-- PREVIEW AREA -->
    <div class="flex-1 bg-slate-200 relative overflow-hidden flex flex-col" id="preview-container">

        <!-- Toolbar -->
        <div
            class="absolute top-4 left-1/2 -translate-x-1/2 z-50 bg-white border-2 border-brand-dark rounded-full shadow-lg p-1.5 pl-4 flex items-center gap-4 no-print transition-all hover:scale-105">
            <div class="flex items-center gap-3">
                <i data-lucide="zoom-out" class="w-4 h-4 text-slate-400 cursor-pointer hover:text-brand-dark"
                    onclick="adjustZoom(-0.1)"></i>
                <span id="zoom-level" class="text-xs font-bold text-slate-600 w-8 text-center">Fit</span>
                <i data-lucide="zoom-in" class="w-4 h-4 text-slate-400 cursor-pointer hover:text-brand-dark"
                    onclick="adjustZoom(0.1)"></i>
            </div>
            <div class="w-px h-6 bg-slate-200"></div>
            <button onclick="toggleTheme()" id="themeBtn"
                class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-brand-dark text-white hover:bg-slate-700 transition group">
                <i data-lucide="moon" class="w-3.5 h-3.5 group-hover:rotate-12 transition-transform"></i>
                <span class="text-[10px] font-bold uppercase tracking-wide">Dark</span>
            </button>
            <div class="w-px h-6 bg-slate-200"></div>
            <button onclick="fitToScreen()"
                class="p-2 hover:bg-slate-100 rounded-full transition text-slate-500 hover:text-brand-blue"
                title="Fit to Screen">
                <i data-lucide="minimize" class="w-4 h-4"></i>
            </button>
            <button onclick="toggleFullScreen()"
                class="p-2 hover:bg-slate-100 rounded-full transition text-slate-500 hover:text-brand-blue"
                title="Fullscreen">
                <i data-lucide="maximize" class="w-4 h-4"></i>
            </button>
        </div>

        <!-- Canvas -->
        <div class="flex-1 flex items-center justify-center overflow-auto p-8 custom-scrollbar bg-slate-200"
            id="canvas-wrapper">
            <div id="poster-wrapper" class="origin-center transition-transform duration-300 ease-out">
                <!-- CANVAS SIZE: 1600x900 (16:9) -->
                <div id="poster-area"
                    class="bg-graph-paper w-[1600px] h-[900px] border-4 border-brand-dark shadow-neo rounded-2xl p-6 flex flex-col gap-6 bg-white transition-colors duration-300 box-border">

                    <!-- Poster Header -->
                    <header
                        class="bg-brand-chalk border-4 border-brand-dark rounded-xl shadow-neo p-5 shrink-0 flex justify-between items-center relative overflow-hidden group h-[120px]">
                        <div
                            class="absolute inset-0 bg-brand-dark opacity-0 dark:opacity-100 transition-opacity z-0 pointer-events-none">
                        </div>
                        <div class="absolute -right-10 -top-10 opacity-10 rotate-12 z-10">
                            <i data-lucide="book-open" class="w-64 h-64 text-brand-blue dark:text-white"></i>
                        </div>
                        <div class="flex items-center gap-6 relative z-10">
                            <div id="view_badge"
                                class="bg-brand-blue text-white font-heading font-bold text-3xl px-6 py-2 rounded-xl border-4 border-brand-dark dark:border-white shadow-neo-sm transform -rotate-2">
                                Week 1
                            </div>
                            <div>
                                <h1 id="view_title"
                                    class="font-heading text-5xl font-bold text-brand-dark dark:text-white leading-none tracking-tight drop-shadow-sm">
                                    ENGLISH CLASS</h1>
                                <p id="view_subtitle"
                                    class="text-lg font-bold text-slate-500 dark:text-slate-300 font-heading tracking-[0.2em] uppercase mt-1">
                                    Vocabulary • Grammar • Speaking</p>
                            </div>
                        </div>
                    </header>

                    <!-- Poster Grid (Dynamic: 24 Columns) -->
                    <main id="poster-grid"
                        class="grid grid-cols-24 gap-4 h-full min-h-0 pb-1 content-start overflow-hidden">
                        <!-- Dynamic Modules Render Here -->
                    </main>

                    <footer
                        class="text-center font-heading font-bold text-brand-dark/30 dark:text-white/30 text-xs shrink-0 flex justify-between px-4 h-[20px]">
                        <span>English 1 Design System</span>
                        <span>Generic A1 Template</span>
                    </footer>
                </div>
            </div>
        </div>
    </div>

    <!-- CUSTOM POP-UP MODAL (REDESIGNED) -->
    <div id="custom-modal"
        class="fixed inset-0 bg-slate-900/60 z-[100] hidden flex items-center justify-center backdrop-blur-sm p-4 transition-all opacity-0 pointer-events-none">
        <div
            class="bg-white border-4 border-brand-dark rounded-2xl shadow-[8px_8px_0px_0px_rgba(30,41,59,1)] max-w-sm w-full relative overflow-hidden transform scale-95 transition-transform">

            <!-- Modal Header -->
            <div class="bg-brand-dark p-4 flex items-center gap-3 bg-stripes-white">
                <div class="bg-white/10 p-2 rounded-lg border border-white/20">
                    <i data-lucide="alert-triangle" class="w-6 h-6 text-brand-yellow"></i>
                </div>
                <h3 id="modal-title" class="font-heading text-xl font-bold text-white tracking-wide">Confirm Action</h3>
            </div>

            <!-- Modal Body -->
            <div class="p-6">
                <p id="modal-msg" class="text-slate-600 font-bold text-base leading-relaxed mb-6">Are you sure you want
                    to proceed?</p>

                <div class="flex gap-3">
                    <button onclick="closeModal()"
                        class="flex-1 py-3 border-2 border-slate-300 rounded-xl font-bold text-slate-500 hover:bg-slate-100 hover:border-slate-400 transition-all">
                        Cancel
                    </button>
                    <button id="modal-confirm"
                        class="flex-1 py-3 border-2 border-brand-dark rounded-xl font-bold text-white shadow-neo-sm hover:translate-y-0.5 hover:shadow-none transition-all flex justify-center items-center gap-2">
                        <span>Confirm</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="./script.js"></script>
</body>

</html>